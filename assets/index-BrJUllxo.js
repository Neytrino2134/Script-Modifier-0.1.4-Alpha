(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();function Nx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bg={exports:{}},vl={},wg={exports:{}},wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hi=Symbol.for("react.element"),kx=Symbol.for("react.portal"),Ax=Symbol.for("react.fragment"),Ix=Symbol.for("react.strict_mode"),Px=Symbol.for("react.profiler"),Rx=Symbol.for("react.provider"),Mx=Symbol.for("react.context"),Lx=Symbol.for("react.forward_ref"),jx=Symbol.for("react.suspense"),Dx=Symbol.for("react.memo"),Ox=Symbol.for("react.lazy"),hp=Symbol.iterator;function Fx(e){return e===null||typeof e!="object"?null:(e=hp&&e[hp]||e["@@iterator"],typeof e=="function"?e:null)}var _g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Cg=Object.assign,Sg={};function Oa(e,t,n){this.props=e,this.context=t,this.refs=Sg,this.updater=n||_g}Oa.prototype.isReactComponent={};Oa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Oa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Tg(){}Tg.prototype=Oa.prototype;function Hd(e,t,n){this.props=e,this.context=t,this.refs=Sg,this.updater=n||_g}var Bd=Hd.prototype=new Tg;Bd.constructor=Hd;Cg(Bd,Oa.prototype);Bd.isPureReactComponent=!0;var mp=Array.isArray,Eg=Object.prototype.hasOwnProperty,Vd={current:null},Ng={key:!0,ref:!0,__self:!0,__source:!0};function kg(e,t,n){var r,a={},i=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(i=""+t.key),t)Eg.call(t,r)&&!Ng.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:Hi,type:e,key:i,ref:s,props:a,_owner:Vd.current}}function zx(e,t){return{$$typeof:Hi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $d(e){return typeof e=="object"&&e!==null&&e.$$typeof===Hi}function Gx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var gp=/\/+/g;function ec(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Gx(""+e.key):t.toString(36)}function ks(e,t,n,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case Hi:case kx:s=!0}}if(s)return s=e,a=a(s),e=r===""?"."+ec(s,0):r,mp(a)?(n="",e!=null&&(n=e.replace(gp,"$&/")+"/"),ks(a,t,n,"",function(d){return d})):a!=null&&($d(a)&&(a=zx(a,n+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(gp,"$&/")+"/")+e)),t.push(a)),1;if(s=0,r=r===""?".":r+":",mp(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+ec(i,l);s+=ks(i,t,n,c,a)}else if(c=Fx(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+ec(i,l++),s+=ks(i,t,n,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function es(e,t,n){if(e==null)return e;var r=[],a=0;return ks(e,r,"","",function(i){return t.call(n,i,a++)}),r}function Ux(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Hn={current:null},As={transition:null},Hx={ReactCurrentDispatcher:Hn,ReactCurrentBatchConfig:As,ReactCurrentOwner:Vd};function Ag(){throw Error("act(...) is not supported in production builds of React.")}wt.Children={map:es,forEach:function(e,t,n){es(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return es(e,function(){t++}),t},toArray:function(e){return es(e,function(t){return t})||[]},only:function(e){if(!$d(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};wt.Component=Oa;wt.Fragment=Ax;wt.Profiler=Px;wt.PureComponent=Hd;wt.StrictMode=Ix;wt.Suspense=jx;wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hx;wt.act=Ag;wt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Cg({},e.props),a=e.key,i=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,s=Vd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)Eg.call(t,c)&&!Ng.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Hi,type:e.type,key:a,ref:i,props:r,_owner:s}};wt.createContext=function(e){return e={$$typeof:Mx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Rx,_context:e},e.Consumer=e};wt.createElement=kg;wt.createFactory=function(e){var t=kg.bind(null,e);return t.type=e,t};wt.createRef=function(){return{current:null}};wt.forwardRef=function(e){return{$$typeof:Lx,render:e}};wt.isValidElement=$d;wt.lazy=function(e){return{$$typeof:Ox,_payload:{_status:-1,_result:e},_init:Ux}};wt.memo=function(e,t){return{$$typeof:Dx,type:e,compare:t===void 0?null:t}};wt.startTransition=function(e){var t=As.transition;As.transition={};try{e()}finally{As.transition=t}};wt.unstable_act=Ag;wt.useCallback=function(e,t){return Hn.current.useCallback(e,t)};wt.useContext=function(e){return Hn.current.useContext(e)};wt.useDebugValue=function(){};wt.useDeferredValue=function(e){return Hn.current.useDeferredValue(e)};wt.useEffect=function(e,t){return Hn.current.useEffect(e,t)};wt.useId=function(){return Hn.current.useId()};wt.useImperativeHandle=function(e,t,n){return Hn.current.useImperativeHandle(e,t,n)};wt.useInsertionEffect=function(e,t){return Hn.current.useInsertionEffect(e,t)};wt.useLayoutEffect=function(e,t){return Hn.current.useLayoutEffect(e,t)};wt.useMemo=function(e,t){return Hn.current.useMemo(e,t)};wt.useReducer=function(e,t,n){return Hn.current.useReducer(e,t,n)};wt.useRef=function(e){return Hn.current.useRef(e)};wt.useState=function(e){return Hn.current.useState(e)};wt.useSyncExternalStore=function(e,t,n){return Hn.current.useSyncExternalStore(e,t,n)};wt.useTransition=function(){return Hn.current.useTransition()};wt.version="18.3.1";wg.exports=wt;var x=wg.exports;const bt=Nx(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bx=x,Vx=Symbol.for("react.element"),$x=Symbol.for("react.fragment"),Wx=Object.prototype.hasOwnProperty,Yx=Bx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qx={key:!0,ref:!0,__self:!0,__source:!0};function Ig(e,t,n){var r,a={},i=null,s=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)Wx.call(t,r)&&!qx.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:Vx,type:e,key:i,ref:s,props:a,_owner:Yx.current}}vl.Fragment=$x;vl.jsx=Ig;vl.jsxs=Ig;bg.exports=vl;var o=bg.exports,Rc={},Pg={exports:{}},ro={},Rg={exports:{}},Mg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(z,G){var F=z.length;z.push(G);e:for(;0<F;){var K=F-1>>>1,ae=z[K];if(0<a(ae,G))z[K]=G,z[F]=ae,F=K;else break e}}function n(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var G=z[0],F=z.pop();if(F!==G){z[0]=F;e:for(var K=0,ae=z.length,Y=ae>>>1;K<Y;){var ge=2*(K+1)-1,W=z[ge],le=ge+1,X=z[le];if(0>a(W,F))le<ae&&0>a(X,W)?(z[K]=X,z[le]=F,K=le):(z[K]=W,z[ge]=F,K=ge);else if(le<ae&&0>a(X,F))z[K]=X,z[le]=F,K=le;else break e}}return G}function a(z,G){var F=z.sortIndex-G.sortIndex;return F!==0?F:z.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],d=[],h=1,g=null,m=3,w=!1,y=!1,b=!1,S=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function f(z){for(var G=n(d);G!==null;){if(G.callback===null)r(d);else if(G.startTime<=z)r(d),G.sortIndex=G.expirationTime,t(c,G);else break;G=n(d)}}function T(z){if(b=!1,f(z),!y)if(n(c)!==null)y=!0,O(A);else{var G=n(d);G!==null&&D(T,G.startTime-z)}}function A(z,G){y=!1,b&&(b=!1,_(N),N=-1),w=!0;var F=m;try{for(f(G),g=n(c);g!==null&&(!(g.expirationTime>G)||z&&!P());){var K=g.callback;if(typeof K=="function"){g.callback=null,m=g.priorityLevel;var ae=K(g.expirationTime<=G);G=e.unstable_now(),typeof ae=="function"?g.callback=ae:g===n(c)&&r(c),f(G)}else r(c);g=n(c)}if(g!==null)var Y=!0;else{var ge=n(d);ge!==null&&D(T,ge.startTime-G),Y=!1}return Y}finally{g=null,m=F,w=!1}}var I=!1,M=null,N=-1,k=5,E=-1;function P(){return!(e.unstable_now()-E<k)}function L(){if(M!==null){var z=e.unstable_now();E=z;var G=!0;try{G=M(!0,z)}finally{G?H():(I=!1,M=null)}}else I=!1}var H;if(typeof v=="function")H=function(){v(L)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,U=$.port2;$.port1.onmessage=L,H=function(){U.postMessage(null)}}else H=function(){S(L,0)};function O(z){M=z,I||(I=!0,H())}function D(z,G){N=S(function(){z(e.unstable_now())},G)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){y||w||(y=!0,O(A))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(z){switch(m){case 1:case 2:case 3:var G=3;break;default:G=m}var F=m;m=G;try{return z()}finally{m=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,G){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var F=m;m=z;try{return G()}finally{m=F}},e.unstable_scheduleCallback=function(z,G,F){var K=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?K+F:K):F=K,z){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=F+ae,z={id:h++,callback:G,priorityLevel:z,startTime:F,expirationTime:ae,sortIndex:-1},F>K?(z.sortIndex=F,t(d,z),n(c)===null&&z===n(d)&&(b?(_(N),N=-1):b=!0,D(T,F-K))):(z.sortIndex=ae,t(c,z),y||w||(y=!0,O(A))),z},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(z){var G=m;return function(){var F=m;m=G;try{return z.apply(this,arguments)}finally{m=F}}}})(Mg);Rg.exports=Mg;var Kx=Rg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jx=x,oo=Kx;function Be(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Lg=new Set,Si={};function Jr(e,t){Ia(e,t),Ia(e+"Capture",t)}function Ia(e,t){for(Si[e]=t,e=0;e<t.length;e++)Lg.add(t[e])}var Vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mc=Object.prototype.hasOwnProperty,Xx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fp={},yp={};function Zx(e){return Mc.call(yp,e)?!0:Mc.call(fp,e)?!1:Xx.test(e)?yp[e]=!0:(fp[e]=!0,!1)}function Qx(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function ev(e,t,n,r){if(t===null||typeof t>"u"||Qx(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Bn(e,t,n,r,a,i,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var En={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){En[e]=new Bn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];En[t]=new Bn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){En[e]=new Bn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){En[e]=new Bn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){En[e]=new Bn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){En[e]=new Bn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){En[e]=new Bn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){En[e]=new Bn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){En[e]=new Bn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Wd=/[\-:]([a-z])/g;function Yd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Wd,Yd);En[t]=new Bn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Wd,Yd);En[t]=new Bn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Wd,Yd);En[t]=new Bn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){En[e]=new Bn(e,1,!1,e.toLowerCase(),null,!1,!1)});En.xlinkHref=new Bn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){En[e]=new Bn(e,1,!1,e.toLowerCase(),null,!0,!0)});function qd(e,t,n,r){var a=En.hasOwnProperty(t)?En[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(ev(t,n,a,r)&&(n=null),r||a===null?Zx(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Jo=Jx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ts=Symbol.for("react.element"),la=Symbol.for("react.portal"),ca=Symbol.for("react.fragment"),Kd=Symbol.for("react.strict_mode"),Lc=Symbol.for("react.profiler"),jg=Symbol.for("react.provider"),Dg=Symbol.for("react.context"),Jd=Symbol.for("react.forward_ref"),jc=Symbol.for("react.suspense"),Dc=Symbol.for("react.suspense_list"),Xd=Symbol.for("react.memo"),sr=Symbol.for("react.lazy"),Og=Symbol.for("react.offscreen"),xp=Symbol.iterator;function Za(e){return e===null||typeof e!="object"?null:(e=xp&&e[xp]||e["@@iterator"],typeof e=="function"?e:null)}var rn=Object.assign,tc;function ci(e){if(tc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);tc=t&&t[1]||""}return`
`+tc+e}var nc=!1;function oc(e,t){if(!e||nc)return"";nc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=r.stack.split(`
`),s=a.length-1,l=i.length-1;1<=s&&0<=l&&a[s]!==i[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==i[l]){if(s!==1||l!==1)do if(s--,l--,0>l||a[s]!==i[l]){var c=`
`+a[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=l);break}}}finally{nc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ci(e):""}function tv(e){switch(e.tag){case 5:return ci(e.type);case 16:return ci("Lazy");case 13:return ci("Suspense");case 19:return ci("SuspenseList");case 0:case 2:case 15:return e=oc(e.type,!1),e;case 11:return e=oc(e.type.render,!1),e;case 1:return e=oc(e.type,!0),e;default:return""}}function Oc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ca:return"Fragment";case la:return"Portal";case Lc:return"Profiler";case Kd:return"StrictMode";case jc:return"Suspense";case Dc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Dg:return(e.displayName||"Context")+".Consumer";case jg:return(e._context.displayName||"Context")+".Provider";case Jd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Xd:return t=e.displayName||null,t!==null?t:Oc(e.type)||"Memo";case sr:t=e._payload,e=e._init;try{return Oc(e(t))}catch{}}return null}function nv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Oc(t);case 8:return t===Kd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function wr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Fg(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ov(e){var t=Fg(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ns(e){e._valueTracker||(e._valueTracker=ov(e))}function zg(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Fg(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Bs(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Fc(e,t){var n=t.checked;return rn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function vp(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=wr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Gg(e,t){t=t.checked,t!=null&&qd(e,"checked",t,!1)}function zc(e,t){Gg(e,t);var n=wr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Gc(e,t.type,n):t.hasOwnProperty("defaultValue")&&Gc(e,t.type,wr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function bp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Gc(e,t,n){(t!=="number"||Bs(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var di=Array.isArray;function _a(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+wr(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Uc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Be(91));return rn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function wp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Be(92));if(di(n)){if(1<n.length)throw Error(Be(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:wr(n)}}function Ug(e,t){var n=wr(t.value),r=wr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function _p(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Hg(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Hg(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var os,Bg=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(os=os||document.createElement("div"),os.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=os.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ti(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var mi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rv=["Webkit","ms","Moz","O"];Object.keys(mi).forEach(function(e){rv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),mi[t]=mi[e]})});function Vg(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||mi.hasOwnProperty(e)&&mi[e]?(""+t).trim():t+"px"}function $g(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=Vg(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var av=rn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Bc(e,t){if(t){if(av[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Be(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Be(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Be(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Be(62))}}function Vc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $c=null;function Zd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Wc=null,Ca=null,Sa=null;function Cp(e){if(e=$i(e)){if(typeof Wc!="function")throw Error(Be(280));var t=e.stateNode;t&&(t=Sl(t),Wc(e.stateNode,e.type,t))}}function Wg(e){Ca?Sa?Sa.push(e):Sa=[e]:Ca=e}function Yg(){if(Ca){var e=Ca,t=Sa;if(Sa=Ca=null,Cp(e),t)for(e=0;e<t.length;e++)Cp(t[e])}}function qg(e,t){return e(t)}function Kg(){}var rc=!1;function Jg(e,t,n){if(rc)return e(t,n);rc=!0;try{return qg(e,t,n)}finally{rc=!1,(Ca!==null||Sa!==null)&&(Kg(),Yg())}}function Ei(e,t){var n=e.stateNode;if(n===null)return null;var r=Sl(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Be(231,t,typeof n));return n}var Yc=!1;if(Vo)try{var Qa={};Object.defineProperty(Qa,"passive",{get:function(){Yc=!0}}),window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{Yc=!1}function iv(e,t,n,r,a,i,s,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(h){this.onError(h)}}var gi=!1,Vs=null,$s=!1,qc=null,sv={onError:function(e){gi=!0,Vs=e}};function lv(e,t,n,r,a,i,s,l,c){gi=!1,Vs=null,iv.apply(sv,arguments)}function cv(e,t,n,r,a,i,s,l,c){if(lv.apply(this,arguments),gi){if(gi){var d=Vs;gi=!1,Vs=null}else throw Error(Be(198));$s||($s=!0,qc=d)}}function Xr(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Xg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Sp(e){if(Xr(e)!==e)throw Error(Be(188))}function dv(e){var t=e.alternate;if(!t){if(t=Xr(e),t===null)throw Error(Be(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return Sp(a),e;if(i===r)return Sp(a),t;i=i.sibling}throw Error(Be(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,l=a.child;l;){if(l===n){s=!0,n=a,r=i;break}if(l===r){s=!0,r=a,n=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===n){s=!0,n=i,r=a;break}if(l===r){s=!0,r=i,n=a;break}l=l.sibling}if(!s)throw Error(Be(189))}}if(n.alternate!==r)throw Error(Be(190))}if(n.tag!==3)throw Error(Be(188));return n.stateNode.current===n?e:t}function Zg(e){return e=dv(e),e!==null?Qg(e):null}function Qg(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Qg(e);if(t!==null)return t;e=e.sibling}return null}var e0=oo.unstable_scheduleCallback,Tp=oo.unstable_cancelCallback,uv=oo.unstable_shouldYield,pv=oo.unstable_requestPaint,dn=oo.unstable_now,hv=oo.unstable_getCurrentPriorityLevel,Qd=oo.unstable_ImmediatePriority,t0=oo.unstable_UserBlockingPriority,Ws=oo.unstable_NormalPriority,mv=oo.unstable_LowPriority,n0=oo.unstable_IdlePriority,bl=null,Lo=null;function gv(e){if(Lo&&typeof Lo.onCommitFiberRoot=="function")try{Lo.onCommitFiberRoot(bl,e,void 0,(e.current.flags&128)===128)}catch{}}var Co=Math.clz32?Math.clz32:xv,fv=Math.log,yv=Math.LN2;function xv(e){return e>>>=0,e===0?32:31-(fv(e)/yv|0)|0}var rs=64,as=4194304;function ui(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ys(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=n&268435455;if(s!==0){var l=s&~a;l!==0?r=ui(l):(i&=s,i!==0&&(r=ui(i)))}else s=n&~a,s!==0?r=ui(s):i!==0&&(r=ui(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Co(t),a=1<<n,r|=e[n],t&=~a;return r}function vv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bv(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-Co(i),l=1<<s,c=a[s];c===-1?(!(l&n)||l&r)&&(a[s]=vv(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Kc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function o0(){var e=rs;return rs<<=1,!(rs&4194240)&&(rs=64),e}function ac(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Bi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Co(t),e[t]=n}function wv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-Co(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}function eu(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Co(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var jt=0;function r0(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var a0,tu,i0,s0,l0,Jc=!1,is=[],hr=null,mr=null,gr=null,Ni=new Map,ki=new Map,cr=[],_v="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ep(e,t){switch(e){case"focusin":case"focusout":hr=null;break;case"dragenter":case"dragleave":mr=null;break;case"mouseover":case"mouseout":gr=null;break;case"pointerover":case"pointerout":Ni.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ki.delete(t.pointerId)}}function ei(e,t,n,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=$i(t),t!==null&&tu(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Cv(e,t,n,r,a){switch(t){case"focusin":return hr=ei(hr,e,t,n,r,a),!0;case"dragenter":return mr=ei(mr,e,t,n,r,a),!0;case"mouseover":return gr=ei(gr,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Ni.set(i,ei(Ni.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,ki.set(i,ei(ki.get(i)||null,e,t,n,r,a)),!0}return!1}function c0(e){var t=Fr(e.target);if(t!==null){var n=Xr(t);if(n!==null){if(t=n.tag,t===13){if(t=Xg(n),t!==null){e.blockedOn=t,l0(e.priority,function(){i0(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Is(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);$c=r,n.target.dispatchEvent(r),$c=null}else return t=$i(n),t!==null&&tu(t),e.blockedOn=n,!1;t.shift()}return!0}function Np(e,t,n){Is(e)&&n.delete(t)}function Sv(){Jc=!1,hr!==null&&Is(hr)&&(hr=null),mr!==null&&Is(mr)&&(mr=null),gr!==null&&Is(gr)&&(gr=null),Ni.forEach(Np),ki.forEach(Np)}function ti(e,t){e.blockedOn===t&&(e.blockedOn=null,Jc||(Jc=!0,oo.unstable_scheduleCallback(oo.unstable_NormalPriority,Sv)))}function Ai(e){function t(a){return ti(a,e)}if(0<is.length){ti(is[0],e);for(var n=1;n<is.length;n++){var r=is[n];r.blockedOn===e&&(r.blockedOn=null)}}for(hr!==null&&ti(hr,e),mr!==null&&ti(mr,e),gr!==null&&ti(gr,e),Ni.forEach(t),ki.forEach(t),n=0;n<cr.length;n++)r=cr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<cr.length&&(n=cr[0],n.blockedOn===null);)c0(n),n.blockedOn===null&&cr.shift()}var Ta=Jo.ReactCurrentBatchConfig,qs=!0;function Tv(e,t,n,r){var a=jt,i=Ta.transition;Ta.transition=null;try{jt=1,nu(e,t,n,r)}finally{jt=a,Ta.transition=i}}function Ev(e,t,n,r){var a=jt,i=Ta.transition;Ta.transition=null;try{jt=4,nu(e,t,n,r)}finally{jt=a,Ta.transition=i}}function nu(e,t,n,r){if(qs){var a=Xc(e,t,n,r);if(a===null)gc(e,t,r,Ks,n),Ep(e,r);else if(Cv(a,e,t,n,r))r.stopPropagation();else if(Ep(e,r),t&4&&-1<_v.indexOf(e)){for(;a!==null;){var i=$i(a);if(i!==null&&a0(i),i=Xc(e,t,n,r),i===null&&gc(e,t,r,Ks,n),i===a)break;a=i}a!==null&&r.stopPropagation()}else gc(e,t,r,null,n)}}var Ks=null;function Xc(e,t,n,r){if(Ks=null,e=Zd(r),e=Fr(e),e!==null)if(t=Xr(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Xg(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ks=e,null}function d0(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hv()){case Qd:return 1;case t0:return 4;case Ws:case mv:return 16;case n0:return 536870912;default:return 16}default:return 16}}var ur=null,ou=null,Ps=null;function u0(){if(Ps)return Ps;var e,t=ou,n=t.length,r,a="value"in ur?ur.value:ur.textContent,i=a.length;for(e=0;e<n&&t[e]===a[e];e++);var s=n-e;for(r=1;r<=s&&t[n-r]===a[i-r];r++);return Ps=a.slice(e,1<r?1-r:void 0)}function Rs(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ss(){return!0}function kp(){return!1}function ao(e){function t(n,r,a,i,s){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ss:kp,this.isPropagationStopped=kp,this}return rn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),t}var Fa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ru=ao(Fa),Vi=rn({},Fa,{view:0,detail:0}),Nv=ao(Vi),ic,sc,ni,wl=rn({},Vi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:au,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ni&&(ni&&e.type==="mousemove"?(ic=e.screenX-ni.screenX,sc=e.screenY-ni.screenY):sc=ic=0,ni=e),ic)},movementY:function(e){return"movementY"in e?e.movementY:sc}}),Ap=ao(wl),kv=rn({},wl,{dataTransfer:0}),Av=ao(kv),Iv=rn({},Vi,{relatedTarget:0}),lc=ao(Iv),Pv=rn({},Fa,{animationName:0,elapsedTime:0,pseudoElement:0}),Rv=ao(Pv),Mv=rn({},Fa,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Lv=ao(Mv),jv=rn({},Fa,{data:0}),Ip=ao(jv),Dv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ov={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Fv[e])?!!t[e]:!1}function au(){return zv}var Gv=rn({},Vi,{key:function(e){if(e.key){var t=Dv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Rs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Ov[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:au,charCode:function(e){return e.type==="keypress"?Rs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Rs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Uv=ao(Gv),Hv=rn({},wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pp=ao(Hv),Bv=rn({},Vi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:au}),Vv=ao(Bv),$v=rn({},Fa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wv=ao($v),Yv=rn({},wl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),qv=ao(Yv),Kv=[9,13,27,32],iu=Vo&&"CompositionEvent"in window,fi=null;Vo&&"documentMode"in document&&(fi=document.documentMode);var Jv=Vo&&"TextEvent"in window&&!fi,p0=Vo&&(!iu||fi&&8<fi&&11>=fi),Rp=" ",Mp=!1;function h0(e,t){switch(e){case"keyup":return Kv.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function m0(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var da=!1;function Xv(e,t){switch(e){case"compositionend":return m0(t);case"keypress":return t.which!==32?null:(Mp=!0,Rp);case"textInput":return e=t.data,e===Rp&&Mp?null:e;default:return null}}function Zv(e,t){if(da)return e==="compositionend"||!iu&&h0(e,t)?(e=u0(),Ps=ou=ur=null,da=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return p0&&t.locale!=="ko"?null:t.data;default:return null}}var Qv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Qv[e.type]:t==="textarea"}function g0(e,t,n,r){Wg(r),t=Js(t,"onChange"),0<t.length&&(n=new ru("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var yi=null,Ii=null;function e2(e){E0(e,0)}function _l(e){var t=ha(e);if(zg(t))return e}function t2(e,t){if(e==="change")return t}var f0=!1;if(Vo){var cc;if(Vo){var dc="oninput"in document;if(!dc){var jp=document.createElement("div");jp.setAttribute("oninput","return;"),dc=typeof jp.oninput=="function"}cc=dc}else cc=!1;f0=cc&&(!document.documentMode||9<document.documentMode)}function Dp(){yi&&(yi.detachEvent("onpropertychange",y0),Ii=yi=null)}function y0(e){if(e.propertyName==="value"&&_l(Ii)){var t=[];g0(t,Ii,e,Zd(e)),Jg(e2,t)}}function n2(e,t,n){e==="focusin"?(Dp(),yi=t,Ii=n,yi.attachEvent("onpropertychange",y0)):e==="focusout"&&Dp()}function o2(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _l(Ii)}function r2(e,t){if(e==="click")return _l(t)}function a2(e,t){if(e==="input"||e==="change")return _l(t)}function i2(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var No=typeof Object.is=="function"?Object.is:i2;function Pi(e,t){if(No(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!Mc.call(t,a)||!No(e[a],t[a]))return!1}return!0}function Op(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Fp(e,t){var n=Op(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Op(n)}}function x0(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?x0(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function v0(){for(var e=window,t=Bs();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Bs(e.document)}return t}function su(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function s2(e){var t=v0(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&x0(n.ownerDocument.documentElement,n)){if(r!==null&&su(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=Fp(n,i);var s=Fp(n,r);a&&s&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var l2=Vo&&"documentMode"in document&&11>=document.documentMode,ua=null,Zc=null,xi=null,Qc=!1;function zp(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Qc||ua==null||ua!==Bs(r)||(r=ua,"selectionStart"in r&&su(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),xi&&Pi(xi,r)||(xi=r,r=Js(Zc,"onSelect"),0<r.length&&(t=new ru("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ua)))}function ls(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var pa={animationend:ls("Animation","AnimationEnd"),animationiteration:ls("Animation","AnimationIteration"),animationstart:ls("Animation","AnimationStart"),transitionend:ls("Transition","TransitionEnd")},uc={},b0={};Vo&&(b0=document.createElement("div").style,"AnimationEvent"in window||(delete pa.animationend.animation,delete pa.animationiteration.animation,delete pa.animationstart.animation),"TransitionEvent"in window||delete pa.transitionend.transition);function Cl(e){if(uc[e])return uc[e];if(!pa[e])return e;var t=pa[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in b0)return uc[e]=t[n];return e}var w0=Cl("animationend"),_0=Cl("animationiteration"),C0=Cl("animationstart"),S0=Cl("transitionend"),T0=new Map,Gp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cr(e,t){T0.set(e,t),Jr(t,[e])}for(var pc=0;pc<Gp.length;pc++){var hc=Gp[pc],c2=hc.toLowerCase(),d2=hc[0].toUpperCase()+hc.slice(1);Cr(c2,"on"+d2)}Cr(w0,"onAnimationEnd");Cr(_0,"onAnimationIteration");Cr(C0,"onAnimationStart");Cr("dblclick","onDoubleClick");Cr("focusin","onFocus");Cr("focusout","onBlur");Cr(S0,"onTransitionEnd");Ia("onMouseEnter",["mouseout","mouseover"]);Ia("onMouseLeave",["mouseout","mouseover"]);Ia("onPointerEnter",["pointerout","pointerover"]);Ia("onPointerLeave",["pointerout","pointerover"]);Jr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Jr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Jr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Jr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Jr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Jr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),u2=new Set("cancel close invalid load scroll toggle".split(" ").concat(pi));function Up(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,cv(r,t,void 0,e),e.currentTarget=null}function E0(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;Up(a,l,d),i=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;Up(a,l,d),i=c}}}if($s)throw e=qc,$s=!1,qc=null,e}function Xt(e,t){var n=t[rd];n===void 0&&(n=t[rd]=new Set);var r=e+"__bubble";n.has(r)||(N0(t,e,2,!1),n.add(r))}function mc(e,t,n){var r=0;t&&(r|=4),N0(n,e,r,t)}var cs="_reactListening"+Math.random().toString(36).slice(2);function Ri(e){if(!e[cs]){e[cs]=!0,Lg.forEach(function(n){n!=="selectionchange"&&(u2.has(n)||mc(n,!1,e),mc(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[cs]||(t[cs]=!0,mc("selectionchange",!1,t))}}function N0(e,t,n,r){switch(d0(t)){case 1:var a=Tv;break;case 4:a=Ev;break;default:a=nu}n=a.bind(null,t,n,e),a=void 0,!Yc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function gc(e,t,n,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;l!==null;){if(s=Fr(l),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}l=l.parentNode}}r=r.return}Jg(function(){var d=i,h=Zd(n),g=[];e:{var m=T0.get(e);if(m!==void 0){var w=ru,y=e;switch(e){case"keypress":if(Rs(n)===0)break e;case"keydown":case"keyup":w=Uv;break;case"focusin":y="focus",w=lc;break;case"focusout":y="blur",w=lc;break;case"beforeblur":case"afterblur":w=lc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=Ap;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=Av;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=Vv;break;case w0:case _0:case C0:w=Rv;break;case S0:w=Wv;break;case"scroll":w=Nv;break;case"wheel":w=qv;break;case"copy":case"cut":case"paste":w=Lv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=Pp}var b=(t&4)!==0,S=!b&&e==="scroll",_=b?m!==null?m+"Capture":null:m;b=[];for(var v=d,f;v!==null;){f=v;var T=f.stateNode;if(f.tag===5&&T!==null&&(f=T,_!==null&&(T=Ei(v,_),T!=null&&b.push(Mi(v,T,f)))),S)break;v=v.return}0<b.length&&(m=new w(m,y,null,n,h),g.push({event:m,listeners:b}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",m&&n!==$c&&(y=n.relatedTarget||n.fromElement)&&(Fr(y)||y[$o]))break e;if((w||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,w?(y=n.relatedTarget||n.toElement,w=d,y=y?Fr(y):null,y!==null&&(S=Xr(y),y!==S||y.tag!==5&&y.tag!==6)&&(y=null)):(w=null,y=d),w!==y)){if(b=Ap,T="onMouseLeave",_="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(b=Pp,T="onPointerLeave",_="onPointerEnter",v="pointer"),S=w==null?m:ha(w),f=y==null?m:ha(y),m=new b(T,v+"leave",w,n,h),m.target=S,m.relatedTarget=f,T=null,Fr(h)===d&&(b=new b(_,v+"enter",y,n,h),b.target=f,b.relatedTarget=S,T=b),S=T,w&&y)t:{for(b=w,_=y,v=0,f=b;f;f=na(f))v++;for(f=0,T=_;T;T=na(T))f++;for(;0<v-f;)b=na(b),v--;for(;0<f-v;)_=na(_),f--;for(;v--;){if(b===_||_!==null&&b===_.alternate)break t;b=na(b),_=na(_)}b=null}else b=null;w!==null&&Hp(g,m,w,b,!1),y!==null&&S!==null&&Hp(g,S,y,b,!0)}}e:{if(m=d?ha(d):window,w=m.nodeName&&m.nodeName.toLowerCase(),w==="select"||w==="input"&&m.type==="file")var A=t2;else if(Lp(m))if(f0)A=a2;else{A=o2;var I=n2}else(w=m.nodeName)&&w.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(A=r2);if(A&&(A=A(e,d))){g0(g,A,n,h);break e}I&&I(e,m,d),e==="focusout"&&(I=m._wrapperState)&&I.controlled&&m.type==="number"&&Gc(m,"number",m.value)}switch(I=d?ha(d):window,e){case"focusin":(Lp(I)||I.contentEditable==="true")&&(ua=I,Zc=d,xi=null);break;case"focusout":xi=Zc=ua=null;break;case"mousedown":Qc=!0;break;case"contextmenu":case"mouseup":case"dragend":Qc=!1,zp(g,n,h);break;case"selectionchange":if(l2)break;case"keydown":case"keyup":zp(g,n,h)}var M;if(iu)e:{switch(e){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else da?h0(e,n)&&(N="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(p0&&n.locale!=="ko"&&(da||N!=="onCompositionStart"?N==="onCompositionEnd"&&da&&(M=u0()):(ur=h,ou="value"in ur?ur.value:ur.textContent,da=!0)),I=Js(d,N),0<I.length&&(N=new Ip(N,e,null,n,h),g.push({event:N,listeners:I}),M?N.data=M:(M=m0(n),M!==null&&(N.data=M)))),(M=Jv?Xv(e,n):Zv(e,n))&&(d=Js(d,"onBeforeInput"),0<d.length&&(h=new Ip("onBeforeInput","beforeinput",null,n,h),g.push({event:h,listeners:d}),h.data=M))}E0(g,t)})}function Mi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Js(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Ei(e,n),i!=null&&r.unshift(Mi(e,i,a)),i=Ei(e,t),i!=null&&r.push(Mi(e,i,a))),e=e.return}return r}function na(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Hp(e,t,n,r,a){for(var i=t._reactName,s=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=Ei(n,i),c!=null&&s.unshift(Mi(n,c,l))):a||(c=Ei(n,i),c!=null&&s.push(Mi(n,c,l)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var p2=/\r\n?/g,h2=/\u0000|\uFFFD/g;function Bp(e){return(typeof e=="string"?e:""+e).replace(p2,`
`).replace(h2,"")}function ds(e,t,n){if(t=Bp(t),Bp(e)!==t&&n)throw Error(Be(425))}function Xs(){}var ed=null,td=null;function nd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var od=typeof setTimeout=="function"?setTimeout:void 0,m2=typeof clearTimeout=="function"?clearTimeout:void 0,Vp=typeof Promise=="function"?Promise:void 0,g2=typeof queueMicrotask=="function"?queueMicrotask:typeof Vp<"u"?function(e){return Vp.resolve(null).then(e).catch(f2)}:od;function f2(e){setTimeout(function(){throw e})}function fc(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),Ai(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);Ai(t)}function fr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function $p(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var za=Math.random().toString(36).slice(2),Mo="__reactFiber$"+za,Li="__reactProps$"+za,$o="__reactContainer$"+za,rd="__reactEvents$"+za,y2="__reactListeners$"+za,x2="__reactHandles$"+za;function Fr(e){var t=e[Mo];if(t)return t;for(var n=e.parentNode;n;){if(t=n[$o]||n[Mo]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=$p(e);e!==null;){if(n=e[Mo])return n;e=$p(e)}return t}e=n,n=e.parentNode}return null}function $i(e){return e=e[Mo]||e[$o],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ha(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Be(33))}function Sl(e){return e[Li]||null}var ad=[],ma=-1;function Sr(e){return{current:e}}function Zt(e){0>ma||(e.current=ad[ma],ad[ma]=null,ma--)}function qt(e,t){ma++,ad[ma]=e.current,e.current=t}var _r={},Dn=Sr(_r),Kn=Sr(!1),Vr=_r;function Pa(e,t){var n=e.type.contextTypes;if(!n)return _r;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in n)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Jn(e){return e=e.childContextTypes,e!=null}function Zs(){Zt(Kn),Zt(Dn)}function Wp(e,t,n){if(Dn.current!==_r)throw Error(Be(168));qt(Dn,t),qt(Kn,n)}function k0(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(Be(108,nv(e)||"Unknown",a));return rn({},n,r)}function Qs(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_r,Vr=Dn.current,qt(Dn,e),qt(Kn,Kn.current),!0}function Yp(e,t,n){var r=e.stateNode;if(!r)throw Error(Be(169));n?(e=k0(e,t,Vr),r.__reactInternalMemoizedMergedChildContext=e,Zt(Kn),Zt(Dn),qt(Dn,e)):Zt(Kn),qt(Kn,n)}var zo=null,Tl=!1,yc=!1;function A0(e){zo===null?zo=[e]:zo.push(e)}function v2(e){Tl=!0,A0(e)}function Tr(){if(!yc&&zo!==null){yc=!0;var e=0,t=jt;try{var n=zo;for(jt=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}zo=null,Tl=!1}catch(a){throw zo!==null&&(zo=zo.slice(e+1)),e0(Qd,Tr),a}finally{jt=t,yc=!1}}return null}var ga=[],fa=0,el=null,tl=0,lo=[],co=0,$r=null,Uo=1,Ho="";function Mr(e,t){ga[fa++]=tl,ga[fa++]=el,el=e,tl=t}function I0(e,t,n){lo[co++]=Uo,lo[co++]=Ho,lo[co++]=$r,$r=e;var r=Uo;e=Ho;var a=32-Co(r)-1;r&=~(1<<a),n+=1;var i=32-Co(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Uo=1<<32-Co(t)+a|n<<a|r,Ho=i+e}else Uo=1<<i|n<<a|r,Ho=e}function lu(e){e.return!==null&&(Mr(e,1),I0(e,1,0))}function cu(e){for(;e===el;)el=ga[--fa],ga[fa]=null,tl=ga[--fa],ga[fa]=null;for(;e===$r;)$r=lo[--co],lo[co]=null,Ho=lo[--co],lo[co]=null,Uo=lo[--co],lo[co]=null}var no=null,to=null,Qt=!1,_o=null;function P0(e,t){var n=uo(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function qp(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,no=e,to=fr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,no=e,to=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=$r!==null?{id:Uo,overflow:Ho}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=uo(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,no=e,to=null,!0):!1;default:return!1}}function id(e){return(e.mode&1)!==0&&(e.flags&128)===0}function sd(e){if(Qt){var t=to;if(t){var n=t;if(!qp(e,t)){if(id(e))throw Error(Be(418));t=fr(n.nextSibling);var r=no;t&&qp(e,t)?P0(r,n):(e.flags=e.flags&-4097|2,Qt=!1,no=e)}}else{if(id(e))throw Error(Be(418));e.flags=e.flags&-4097|2,Qt=!1,no=e}}}function Kp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;no=e}function us(e){if(e!==no)return!1;if(!Qt)return Kp(e),Qt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!nd(e.type,e.memoizedProps)),t&&(t=to)){if(id(e))throw R0(),Error(Be(418));for(;t;)P0(e,t),t=fr(t.nextSibling)}if(Kp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Be(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){to=fr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}to=null}}else to=no?fr(e.stateNode.nextSibling):null;return!0}function R0(){for(var e=to;e;)e=fr(e.nextSibling)}function Ra(){to=no=null,Qt=!1}function du(e){_o===null?_o=[e]:_o.push(e)}var b2=Jo.ReactCurrentBatchConfig;function oi(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Be(309));var r=n.stateNode}if(!r)throw Error(Be(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(s){var l=a.refs;s===null?delete l[i]:l[i]=s},t._stringRef=i,t)}if(typeof e!="string")throw Error(Be(284));if(!n._owner)throw Error(Be(290,e))}return e}function ps(e,t){throw e=Object.prototype.toString.call(t),Error(Be(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Jp(e){var t=e._init;return t(e._payload)}function M0(e){function t(_,v){if(e){var f=_.deletions;f===null?(_.deletions=[v],_.flags|=16):f.push(v)}}function n(_,v){if(!e)return null;for(;v!==null;)t(_,v),v=v.sibling;return null}function r(_,v){for(_=new Map;v!==null;)v.key!==null?_.set(v.key,v):_.set(v.index,v),v=v.sibling;return _}function a(_,v){return _=br(_,v),_.index=0,_.sibling=null,_}function i(_,v,f){return _.index=f,e?(f=_.alternate,f!==null?(f=f.index,f<v?(_.flags|=2,v):f):(_.flags|=2,v)):(_.flags|=1048576,v)}function s(_){return e&&_.alternate===null&&(_.flags|=2),_}function l(_,v,f,T){return v===null||v.tag!==6?(v=Sc(f,_.mode,T),v.return=_,v):(v=a(v,f),v.return=_,v)}function c(_,v,f,T){var A=f.type;return A===ca?h(_,v,f.props.children,T,f.key):v!==null&&(v.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===sr&&Jp(A)===v.type)?(T=a(v,f.props),T.ref=oi(_,v,f),T.return=_,T):(T=zs(f.type,f.key,f.props,null,_.mode,T),T.ref=oi(_,v,f),T.return=_,T)}function d(_,v,f,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==f.containerInfo||v.stateNode.implementation!==f.implementation?(v=Tc(f,_.mode,T),v.return=_,v):(v=a(v,f.children||[]),v.return=_,v)}function h(_,v,f,T,A){return v===null||v.tag!==7?(v=Br(f,_.mode,T,A),v.return=_,v):(v=a(v,f),v.return=_,v)}function g(_,v,f){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Sc(""+v,_.mode,f),v.return=_,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ts:return f=zs(v.type,v.key,v.props,null,_.mode,f),f.ref=oi(_,null,v),f.return=_,f;case la:return v=Tc(v,_.mode,f),v.return=_,v;case sr:var T=v._init;return g(_,T(v._payload),f)}if(di(v)||Za(v))return v=Br(v,_.mode,f,null),v.return=_,v;ps(_,v)}return null}function m(_,v,f,T){var A=v!==null?v.key:null;if(typeof f=="string"&&f!==""||typeof f=="number")return A!==null?null:l(_,v,""+f,T);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case ts:return f.key===A?c(_,v,f,T):null;case la:return f.key===A?d(_,v,f,T):null;case sr:return A=f._init,m(_,v,A(f._payload),T)}if(di(f)||Za(f))return A!==null?null:h(_,v,f,T,null);ps(_,f)}return null}function w(_,v,f,T,A){if(typeof T=="string"&&T!==""||typeof T=="number")return _=_.get(f)||null,l(v,_,""+T,A);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ts:return _=_.get(T.key===null?f:T.key)||null,c(v,_,T,A);case la:return _=_.get(T.key===null?f:T.key)||null,d(v,_,T,A);case sr:var I=T._init;return w(_,v,f,I(T._payload),A)}if(di(T)||Za(T))return _=_.get(f)||null,h(v,_,T,A,null);ps(v,T)}return null}function y(_,v,f,T){for(var A=null,I=null,M=v,N=v=0,k=null;M!==null&&N<f.length;N++){M.index>N?(k=M,M=null):k=M.sibling;var E=m(_,M,f[N],T);if(E===null){M===null&&(M=k);break}e&&M&&E.alternate===null&&t(_,M),v=i(E,v,N),I===null?A=E:I.sibling=E,I=E,M=k}if(N===f.length)return n(_,M),Qt&&Mr(_,N),A;if(M===null){for(;N<f.length;N++)M=g(_,f[N],T),M!==null&&(v=i(M,v,N),I===null?A=M:I.sibling=M,I=M);return Qt&&Mr(_,N),A}for(M=r(_,M);N<f.length;N++)k=w(M,_,N,f[N],T),k!==null&&(e&&k.alternate!==null&&M.delete(k.key===null?N:k.key),v=i(k,v,N),I===null?A=k:I.sibling=k,I=k);return e&&M.forEach(function(P){return t(_,P)}),Qt&&Mr(_,N),A}function b(_,v,f,T){var A=Za(f);if(typeof A!="function")throw Error(Be(150));if(f=A.call(f),f==null)throw Error(Be(151));for(var I=A=null,M=v,N=v=0,k=null,E=f.next();M!==null&&!E.done;N++,E=f.next()){M.index>N?(k=M,M=null):k=M.sibling;var P=m(_,M,E.value,T);if(P===null){M===null&&(M=k);break}e&&M&&P.alternate===null&&t(_,M),v=i(P,v,N),I===null?A=P:I.sibling=P,I=P,M=k}if(E.done)return n(_,M),Qt&&Mr(_,N),A;if(M===null){for(;!E.done;N++,E=f.next())E=g(_,E.value,T),E!==null&&(v=i(E,v,N),I===null?A=E:I.sibling=E,I=E);return Qt&&Mr(_,N),A}for(M=r(_,M);!E.done;N++,E=f.next())E=w(M,_,N,E.value,T),E!==null&&(e&&E.alternate!==null&&M.delete(E.key===null?N:E.key),v=i(E,v,N),I===null?A=E:I.sibling=E,I=E);return e&&M.forEach(function(L){return t(_,L)}),Qt&&Mr(_,N),A}function S(_,v,f,T){if(typeof f=="object"&&f!==null&&f.type===ca&&f.key===null&&(f=f.props.children),typeof f=="object"&&f!==null){switch(f.$$typeof){case ts:e:{for(var A=f.key,I=v;I!==null;){if(I.key===A){if(A=f.type,A===ca){if(I.tag===7){n(_,I.sibling),v=a(I,f.props.children),v.return=_,_=v;break e}}else if(I.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===sr&&Jp(A)===I.type){n(_,I.sibling),v=a(I,f.props),v.ref=oi(_,I,f),v.return=_,_=v;break e}n(_,I);break}else t(_,I);I=I.sibling}f.type===ca?(v=Br(f.props.children,_.mode,T,f.key),v.return=_,_=v):(T=zs(f.type,f.key,f.props,null,_.mode,T),T.ref=oi(_,v,f),T.return=_,_=T)}return s(_);case la:e:{for(I=f.key;v!==null;){if(v.key===I)if(v.tag===4&&v.stateNode.containerInfo===f.containerInfo&&v.stateNode.implementation===f.implementation){n(_,v.sibling),v=a(v,f.children||[]),v.return=_,_=v;break e}else{n(_,v);break}else t(_,v);v=v.sibling}v=Tc(f,_.mode,T),v.return=_,_=v}return s(_);case sr:return I=f._init,S(_,v,I(f._payload),T)}if(di(f))return y(_,v,f,T);if(Za(f))return b(_,v,f,T);ps(_,f)}return typeof f=="string"&&f!==""||typeof f=="number"?(f=""+f,v!==null&&v.tag===6?(n(_,v.sibling),v=a(v,f),v.return=_,_=v):(n(_,v),v=Sc(f,_.mode,T),v.return=_,_=v),s(_)):n(_,v)}return S}var Ma=M0(!0),L0=M0(!1),nl=Sr(null),ol=null,ya=null,uu=null;function pu(){uu=ya=ol=null}function hu(e){var t=nl.current;Zt(nl),e._currentValue=t}function ld(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ea(e,t){ol=e,uu=ya=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(qn=!0),e.firstContext=null)}function mo(e){var t=e._currentValue;if(uu!==e)if(e={context:e,memoizedValue:t,next:null},ya===null){if(ol===null)throw Error(Be(308));ya=e,ol.dependencies={lanes:0,firstContext:e}}else ya=ya.next=e;return t}var zr=null;function mu(e){zr===null?zr=[e]:zr.push(e)}function j0(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,mu(t)):(n.next=a.next,a.next=n),t.interleaved=n,Wo(e,r)}function Wo(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var lr=!1;function gu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function D0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Bo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function yr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Tt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Wo(e,n)}return a=r.interleaved,a===null?(t.next=t,mu(r)):(t.next=a.next,a.next=t),r.interleaved=t,Wo(e,n)}function Ms(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,eu(e,n)}}function Xp(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?a=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?a=i=t:i=i.next=t}else a=i=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function rl(e,t,n,r){var a=e.updateQueue;lr=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,s===null?i=d:s.next=d,s=c;var h=e.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==s&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var g=a.baseState;s=0,h=d=c=null,l=i;do{var m=l.lane,w=l.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:w,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=e,b=l;switch(m=t,w=n,b.tag){case 1:if(y=b.payload,typeof y=="function"){g=y.call(w,g,m);break e}g=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=b.payload,m=typeof y=="function"?y.call(w,g,m):y,m==null)break e;g=rn({},g,m);break e;case 2:lr=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=a.effects,m===null?a.effects=[l]:m.push(l))}else w={eventTime:w,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=w,c=g):h=h.next=w,s|=m;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;m=l,l=m.next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}while(!0);if(h===null&&(c=g),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=h,t=a.shared.interleaved,t!==null){a=t;do s|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Yr|=s,e.lanes=s,e.memoizedState=g}}function Zp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(Be(191,a));a.call(r)}}}var Wi={},jo=Sr(Wi),ji=Sr(Wi),Di=Sr(Wi);function Gr(e){if(e===Wi)throw Error(Be(174));return e}function fu(e,t){switch(qt(Di,t),qt(ji,e),qt(jo,Wi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Hc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Hc(t,e)}Zt(jo),qt(jo,t)}function La(){Zt(jo),Zt(ji),Zt(Di)}function O0(e){Gr(Di.current);var t=Gr(jo.current),n=Hc(t,e.type);t!==n&&(qt(ji,e),qt(jo,n))}function yu(e){ji.current===e&&(Zt(jo),Zt(ji))}var nn=Sr(0);function al(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var xc=[];function xu(){for(var e=0;e<xc.length;e++)xc[e]._workInProgressVersionPrimary=null;xc.length=0}var Ls=Jo.ReactCurrentDispatcher,vc=Jo.ReactCurrentBatchConfig,Wr=0,on=null,fn=null,wn=null,il=!1,vi=!1,Oi=0,w2=0;function kn(){throw Error(Be(321))}function vu(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!No(e[n],t[n]))return!1;return!0}function bu(e,t,n,r,a,i){if(Wr=i,on=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ls.current=e===null||e.memoizedState===null?T2:E2,e=n(r,a),vi){i=0;do{if(vi=!1,Oi=0,25<=i)throw Error(Be(301));i+=1,wn=fn=null,t.updateQueue=null,Ls.current=N2,e=n(r,a)}while(vi)}if(Ls.current=sl,t=fn!==null&&fn.next!==null,Wr=0,wn=fn=on=null,il=!1,t)throw Error(Be(300));return e}function wu(){var e=Oi!==0;return Oi=0,e}function Ro(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wn===null?on.memoizedState=wn=e:wn=wn.next=e,wn}function go(){if(fn===null){var e=on.alternate;e=e!==null?e.memoizedState:null}else e=fn.next;var t=wn===null?on.memoizedState:wn.next;if(t!==null)wn=t,fn=e;else{if(e===null)throw Error(Be(310));fn=e,e={memoizedState:fn.memoizedState,baseState:fn.baseState,baseQueue:fn.baseQueue,queue:fn.queue,next:null},wn===null?on.memoizedState=wn=e:wn=wn.next=e}return wn}function Fi(e,t){return typeof t=="function"?t(e):t}function bc(e){var t=go(),n=t.queue;if(n===null)throw Error(Be(311));n.lastRenderedReducer=e;var r=fn,a=r.baseQueue,i=n.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=s=null,c=null,d=i;do{var h=d.lane;if((Wr&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var g={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=g,s=r):c=c.next=g,on.lanes|=h,Yr|=h}d=d.next}while(d!==null&&d!==i);c===null?s=r:c.next=l,No(r,t.memoizedState)||(qn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do i=a.lane,on.lanes|=i,Yr|=i,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wc(e){var t=go(),n=t.queue;if(n===null)throw Error(Be(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do i=e(i,s.action),s=s.next;while(s!==a);No(i,t.memoizedState)||(qn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function F0(){}function z0(e,t){var n=on,r=go(),a=t(),i=!No(r.memoizedState,a);if(i&&(r.memoizedState=a,qn=!0),r=r.queue,_u(H0.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||wn!==null&&wn.memoizedState.tag&1){if(n.flags|=2048,zi(9,U0.bind(null,n,r,a,t),void 0,null),_n===null)throw Error(Be(349));Wr&30||G0(n,t,a)}return a}function G0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=on.updateQueue,t===null?(t={lastEffect:null,stores:null},on.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function U0(e,t,n,r){t.value=n,t.getSnapshot=r,B0(t)&&V0(e)}function H0(e,t,n){return n(function(){B0(t)&&V0(e)})}function B0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!No(e,n)}catch{return!0}}function V0(e){var t=Wo(e,1);t!==null&&So(t,e,1,-1)}function Qp(e){var t=Ro();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fi,lastRenderedState:e},t.queue=e,e=e.dispatch=S2.bind(null,on,e),[t.memoizedState,e]}function zi(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=on.updateQueue,t===null?(t={lastEffect:null,stores:null},on.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function $0(){return go().memoizedState}function js(e,t,n,r){var a=Ro();on.flags|=e,a.memoizedState=zi(1|t,n,void 0,r===void 0?null:r)}function El(e,t,n,r){var a=go();r=r===void 0?null:r;var i=void 0;if(fn!==null){var s=fn.memoizedState;if(i=s.destroy,r!==null&&vu(r,s.deps)){a.memoizedState=zi(t,n,i,r);return}}on.flags|=e,a.memoizedState=zi(1|t,n,i,r)}function eh(e,t){return js(8390656,8,e,t)}function _u(e,t){return El(2048,8,e,t)}function W0(e,t){return El(4,2,e,t)}function Y0(e,t){return El(4,4,e,t)}function q0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function K0(e,t,n){return n=n!=null?n.concat([e]):null,El(4,4,q0.bind(null,t,e),n)}function Cu(){}function J0(e,t){var n=go();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&vu(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function X0(e,t){var n=go();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&vu(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Z0(e,t,n){return Wr&21?(No(n,t)||(n=o0(),on.lanes|=n,Yr|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,qn=!0),e.memoizedState=n)}function _2(e,t){var n=jt;jt=n!==0&&4>n?n:4,e(!0);var r=vc.transition;vc.transition={};try{e(!1),t()}finally{jt=n,vc.transition=r}}function Q0(){return go().memoizedState}function C2(e,t,n){var r=vr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ef(e))tf(t,n);else if(n=j0(e,t,n,r),n!==null){var a=zn();So(n,e,r,a),nf(n,t,r)}}function S2(e,t,n){var r=vr(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ef(e))tf(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var s=t.lastRenderedState,l=i(s,n);if(a.hasEagerState=!0,a.eagerState=l,No(l,s)){var c=t.interleaved;c===null?(a.next=a,mu(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}n=j0(e,t,a,r),n!==null&&(a=zn(),So(n,e,r,a),nf(n,t,r))}}function ef(e){var t=e.alternate;return e===on||t!==null&&t===on}function tf(e,t){vi=il=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function nf(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,eu(e,n)}}var sl={readContext:mo,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useInsertionEffect:kn,useLayoutEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useMutableSource:kn,useSyncExternalStore:kn,useId:kn,unstable_isNewReconciler:!1},T2={readContext:mo,useCallback:function(e,t){return Ro().memoizedState=[e,t===void 0?null:t],e},useContext:mo,useEffect:eh,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,js(4194308,4,q0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return js(4194308,4,e,t)},useInsertionEffect:function(e,t){return js(4,2,e,t)},useMemo:function(e,t){var n=Ro();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ro();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=C2.bind(null,on,e),[r.memoizedState,e]},useRef:function(e){var t=Ro();return e={current:e},t.memoizedState=e},useState:Qp,useDebugValue:Cu,useDeferredValue:function(e){return Ro().memoizedState=e},useTransition:function(){var e=Qp(!1),t=e[0];return e=_2.bind(null,e[1]),Ro().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=on,a=Ro();if(Qt){if(n===void 0)throw Error(Be(407));n=n()}else{if(n=t(),_n===null)throw Error(Be(349));Wr&30||G0(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,eh(H0.bind(null,r,i,e),[e]),r.flags|=2048,zi(9,U0.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Ro(),t=_n.identifierPrefix;if(Qt){var n=Ho,r=Uo;n=(r&~(1<<32-Co(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Oi++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=w2++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},E2={readContext:mo,useCallback:J0,useContext:mo,useEffect:_u,useImperativeHandle:K0,useInsertionEffect:W0,useLayoutEffect:Y0,useMemo:X0,useReducer:bc,useRef:$0,useState:function(){return bc(Fi)},useDebugValue:Cu,useDeferredValue:function(e){var t=go();return Z0(t,fn.memoizedState,e)},useTransition:function(){var e=bc(Fi)[0],t=go().memoizedState;return[e,t]},useMutableSource:F0,useSyncExternalStore:z0,useId:Q0,unstable_isNewReconciler:!1},N2={readContext:mo,useCallback:J0,useContext:mo,useEffect:_u,useImperativeHandle:K0,useInsertionEffect:W0,useLayoutEffect:Y0,useMemo:X0,useReducer:wc,useRef:$0,useState:function(){return wc(Fi)},useDebugValue:Cu,useDeferredValue:function(e){var t=go();return fn===null?t.memoizedState=e:Z0(t,fn.memoizedState,e)},useTransition:function(){var e=wc(Fi)[0],t=go().memoizedState;return[e,t]},useMutableSource:F0,useSyncExternalStore:z0,useId:Q0,unstable_isNewReconciler:!1};function bo(e,t){if(e&&e.defaultProps){t=rn({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function cd(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:rn({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Nl={isMounted:function(e){return(e=e._reactInternals)?Xr(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=zn(),a=vr(e),i=Bo(r,a);i.payload=t,n!=null&&(i.callback=n),t=yr(e,i,a),t!==null&&(So(t,e,a,r),Ms(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=zn(),a=vr(e),i=Bo(r,a);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=yr(e,i,a),t!==null&&(So(t,e,a,r),Ms(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=zn(),r=vr(e),a=Bo(n,r);a.tag=2,t!=null&&(a.callback=t),t=yr(e,a,r),t!==null&&(So(t,e,r,n),Ms(t,e,r))}};function th(e,t,n,r,a,i,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,s):t.prototype&&t.prototype.isPureReactComponent?!Pi(n,r)||!Pi(a,i):!0}function of(e,t,n){var r=!1,a=_r,i=t.contextType;return typeof i=="object"&&i!==null?i=mo(i):(a=Jn(t)?Vr:Dn.current,r=t.contextTypes,i=(r=r!=null)?Pa(e,a):_r),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Nl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function nh(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Nl.enqueueReplaceState(t,t.state,null)}function dd(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},gu(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=mo(i):(i=Jn(t)?Vr:Dn.current,a.context=Pa(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(cd(e,t,i,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Nl.enqueueReplaceState(a,a.state,null),rl(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function ja(e,t){try{var n="",r=t;do n+=tv(r),r=r.return;while(r);var a=n}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function _c(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function ud(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var k2=typeof WeakMap=="function"?WeakMap:Map;function rf(e,t,n){n=Bo(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){cl||(cl=!0,wd=r),ud(e,t)},n}function af(e,t,n){n=Bo(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ud(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){ud(e,t),typeof r!="function"&&(xr===null?xr=new Set([this]):xr.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function oh(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new k2;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=H2.bind(null,e,t,n),t.then(e,e))}function rh(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function ah(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Bo(-1,1),t.tag=2,yr(n,t,1))),n.lanes|=1),e)}var A2=Jo.ReactCurrentOwner,qn=!1;function Fn(e,t,n,r){t.child=e===null?L0(t,null,n,r):Ma(t,e.child,n,r)}function ih(e,t,n,r,a){n=n.render;var i=t.ref;return Ea(t,a),r=bu(e,t,n,r,i,a),n=wu(),e!==null&&!qn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Yo(e,t,a)):(Qt&&n&&lu(t),t.flags|=1,Fn(e,t,r,a),t.child)}function sh(e,t,n,r,a){if(e===null){var i=n.type;return typeof i=="function"&&!Pu(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,sf(e,t,i,r,a)):(e=zs(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:Pi,n(s,r)&&e.ref===t.ref)return Yo(e,t,a)}return t.flags|=1,e=br(i,r),e.ref=t.ref,e.return=t,t.child=e}function sf(e,t,n,r,a){if(e!==null){var i=e.memoizedProps;if(Pi(i,r)&&e.ref===t.ref)if(qn=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(qn=!0);else return t.lanes=e.lanes,Yo(e,t,a)}return pd(e,t,n,r,a)}function lf(e,t,n){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},qt(va,eo),eo|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,qt(va,eo),eo|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,qt(va,eo),eo|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,qt(va,eo),eo|=r;return Fn(e,t,a,n),t.child}function cf(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function pd(e,t,n,r,a){var i=Jn(n)?Vr:Dn.current;return i=Pa(t,i),Ea(t,a),n=bu(e,t,n,r,i,a),r=wu(),e!==null&&!qn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Yo(e,t,a)):(Qt&&r&&lu(t),t.flags|=1,Fn(e,t,n,a),t.child)}function lh(e,t,n,r,a){if(Jn(n)){var i=!0;Qs(t)}else i=!1;if(Ea(t,a),t.stateNode===null)Ds(e,t),of(t,n,r),dd(t,n,r,a),r=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var c=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=mo(d):(d=Jn(n)?Vr:Dn.current,d=Pa(t,d));var h=n.getDerivedStateFromProps,g=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";g||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==d)&&nh(t,s,r,d),lr=!1;var m=t.memoizedState;s.state=m,rl(t,r,s,a),c=t.memoizedState,l!==r||m!==c||Kn.current||lr?(typeof h=="function"&&(cd(t,n,h,r),c=t.memoizedState),(l=lr||th(t,n,l,r,m,c,d))?(g||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=d,r=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,D0(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:bo(t.type,l),s.props=d,g=t.pendingProps,m=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=mo(c):(c=Jn(n)?Vr:Dn.current,c=Pa(t,c));var w=n.getDerivedStateFromProps;(h=typeof w=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==g||m!==c)&&nh(t,s,r,c),lr=!1,m=t.memoizedState,s.state=m,rl(t,r,s,a);var y=t.memoizedState;l!==g||m!==y||Kn.current||lr?(typeof w=="function"&&(cd(t,n,w,r),y=t.memoizedState),(d=lr||th(t,n,d,r,m,y,c)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,y,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,y,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=y),s.props=r,s.state=y,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),r=!1)}return hd(e,t,n,r,i,a)}function hd(e,t,n,r,a,i){cf(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return a&&Yp(t,n,!1),Yo(e,t,i);r=t.stateNode,A2.current=t;var l=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=Ma(t,e.child,null,i),t.child=Ma(t,null,l,i)):Fn(e,t,l,i),t.memoizedState=r.state,a&&Yp(t,n,!0),t.child}function df(e){var t=e.stateNode;t.pendingContext?Wp(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Wp(e,t.context,!1),fu(e,t.containerInfo)}function ch(e,t,n,r,a){return Ra(),du(a),t.flags|=256,Fn(e,t,n,r),t.child}var md={dehydrated:null,treeContext:null,retryLane:0};function gd(e){return{baseLanes:e,cachePool:null,transitions:null}}function uf(e,t,n){var r=t.pendingProps,a=nn.current,i=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),qt(nn,a&1),e===null)return sd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,i?(r=t.mode,i=t.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=Il(s,r,0,null),e=Br(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=gd(n),t.memoizedState=md,e):Su(t,s));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return I2(e,t,s,r,l,a,n);if(i){i=r.fallback,s=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=br(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=br(l,i):(i=Br(i,s,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,s=e.child.memoizedState,s=s===null?gd(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=e.childLanes&~n,t.memoizedState=md,r}return i=e.child,e=i.sibling,r=br(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Su(e,t){return t=Il({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function hs(e,t,n,r){return r!==null&&du(r),Ma(t,e.child,null,n),e=Su(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function I2(e,t,n,r,a,i,s){if(n)return t.flags&256?(t.flags&=-257,r=_c(Error(Be(422))),hs(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=Il({mode:"visible",children:r.children},a,0,null),i=Br(i,a,s,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&Ma(t,e.child,null,s),t.child.memoizedState=gd(s),t.memoizedState=md,i);if(!(t.mode&1))return hs(e,t,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(Be(419)),r=_c(i,r,void 0),hs(e,t,s,r)}if(l=(s&e.childLanes)!==0,qn||l){if(r=_n,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Wo(e,a),So(r,e,a,-1))}return Iu(),r=_c(Error(Be(421))),hs(e,t,s,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=B2.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,to=fr(a.nextSibling),no=t,Qt=!0,_o=null,e!==null&&(lo[co++]=Uo,lo[co++]=Ho,lo[co++]=$r,Uo=e.id,Ho=e.overflow,$r=t),t=Su(t,r.children),t.flags|=4096,t)}function dh(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),ld(e.return,t,n)}function Cc(e,t,n,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function pf(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Fn(e,t,r.children,n),r=nn.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&dh(e,n,t);else if(e.tag===19)dh(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(qt(nn,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&al(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Cc(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&al(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Cc(t,!0,n,null,i);break;case"together":Cc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ds(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Yo(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Yr|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Be(153));if(t.child!==null){for(e=t.child,n=br(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=br(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function P2(e,t,n){switch(t.tag){case 3:df(t),Ra();break;case 5:O0(t);break;case 1:Jn(t.type)&&Qs(t);break;case 4:fu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;qt(nl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(qt(nn,nn.current&1),t.flags|=128,null):n&t.child.childLanes?uf(e,t,n):(qt(nn,nn.current&1),e=Yo(e,t,n),e!==null?e.sibling:null);qt(nn,nn.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return pf(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),qt(nn,nn.current),r)break;return null;case 22:case 23:return t.lanes=0,lf(e,t,n)}return Yo(e,t,n)}var hf,fd,mf,gf;hf=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};fd=function(){};mf=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Gr(jo.current);var i=null;switch(n){case"input":a=Fc(e,a),r=Fc(e,r),i=[];break;case"select":a=rn({},a,{value:void 0}),r=rn({},r,{value:void 0}),i=[];break;case"textarea":a=Uc(e,a),r=Uc(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Xs)}Bc(n,r);var s;n=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Si.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Si.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Xt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};gf=function(e,t,n,r){n!==r&&(t.flags|=4)};function ri(e,t){if(!Qt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function An(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function R2(e,t,n){var r=t.pendingProps;switch(cu(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(t),null;case 1:return Jn(t.type)&&Zs(),An(t),null;case 3:return r=t.stateNode,La(),Zt(Kn),Zt(Dn),xu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(us(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,_o!==null&&(Sd(_o),_o=null))),fd(e,t),An(t),null;case 5:yu(t);var a=Gr(Di.current);if(n=t.type,e!==null&&t.stateNode!=null)mf(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Be(166));return An(t),null}if(e=Gr(jo.current),us(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[Mo]=t,r[Li]=i,e=(t.mode&1)!==0,n){case"dialog":Xt("cancel",r),Xt("close",r);break;case"iframe":case"object":case"embed":Xt("load",r);break;case"video":case"audio":for(a=0;a<pi.length;a++)Xt(pi[a],r);break;case"source":Xt("error",r);break;case"img":case"image":case"link":Xt("error",r),Xt("load",r);break;case"details":Xt("toggle",r);break;case"input":vp(r,i),Xt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Xt("invalid",r);break;case"textarea":wp(r,i),Xt("invalid",r)}Bc(n,i),a=null;for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];s==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&ds(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&ds(r.textContent,l,e),a=["children",""+l]):Si.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Xt("scroll",r)}switch(n){case"input":ns(r),bp(r,i,!0);break;case"textarea":ns(r),_p(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Xs)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Hg(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(n,{is:r.is}):(e=s.createElement(n),n==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,n),e[Mo]=t,e[Li]=r,hf(e,t,!1,!1),t.stateNode=e;e:{switch(s=Vc(n,r),n){case"dialog":Xt("cancel",e),Xt("close",e),a=r;break;case"iframe":case"object":case"embed":Xt("load",e),a=r;break;case"video":case"audio":for(a=0;a<pi.length;a++)Xt(pi[a],e);a=r;break;case"source":Xt("error",e),a=r;break;case"img":case"image":case"link":Xt("error",e),Xt("load",e),a=r;break;case"details":Xt("toggle",e),a=r;break;case"input":vp(e,r),a=Fc(e,r),Xt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=rn({},r,{value:void 0}),Xt("invalid",e);break;case"textarea":wp(e,r),a=Uc(e,r),Xt("invalid",e);break;default:a=r}Bc(n,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?$g(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Bg(e,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ti(e,c):typeof c=="number"&&Ti(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Si.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Xt("scroll",e):c!=null&&qd(e,i,c,s))}switch(n){case"input":ns(e),bp(e,r,!1);break;case"textarea":ns(e),_p(e);break;case"option":r.value!=null&&e.setAttribute("value",""+wr(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?_a(e,!!r.multiple,i,!1):r.defaultValue!=null&&_a(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Xs)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return An(t),null;case 6:if(e&&t.stateNode!=null)gf(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Be(166));if(n=Gr(Di.current),Gr(jo.current),us(t)){if(r=t.stateNode,n=t.memoizedProps,r[Mo]=t,(i=r.nodeValue!==n)&&(e=no,e!==null))switch(e.tag){case 3:ds(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ds(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Mo]=t,t.stateNode=r}return An(t),null;case 13:if(Zt(nn),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Qt&&to!==null&&t.mode&1&&!(t.flags&128))R0(),Ra(),t.flags|=98560,i=!1;else if(i=us(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(Be(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Be(317));i[Mo]=t}else Ra(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;An(t),i=!1}else _o!==null&&(Sd(_o),_o=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||nn.current&1?yn===0&&(yn=3):Iu())),t.updateQueue!==null&&(t.flags|=4),An(t),null);case 4:return La(),fd(e,t),e===null&&Ri(t.stateNode.containerInfo),An(t),null;case 10:return hu(t.type._context),An(t),null;case 17:return Jn(t.type)&&Zs(),An(t),null;case 19:if(Zt(nn),i=t.memoizedState,i===null)return An(t),null;if(r=(t.flags&128)!==0,s=i.rendering,s===null)if(r)ri(i,!1);else{if(yn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=al(e),s!==null){for(t.flags|=128,ri(i,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return qt(nn,nn.current&1|2),t.child}e=e.sibling}i.tail!==null&&dn()>Da&&(t.flags|=128,r=!0,ri(i,!1),t.lanes=4194304)}else{if(!r)if(e=al(s),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ri(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Qt)return An(t),null}else 2*dn()-i.renderingStartTime>Da&&n!==1073741824&&(t.flags|=128,r=!0,ri(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(n=i.last,n!==null?n.sibling=s:t.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=dn(),t.sibling=null,n=nn.current,qt(nn,r?n&1|2:n&1),t):(An(t),null);case 22:case 23:return Au(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?eo&1073741824&&(An(t),t.subtreeFlags&6&&(t.flags|=8192)):An(t),null;case 24:return null;case 25:return null}throw Error(Be(156,t.tag))}function M2(e,t){switch(cu(t),t.tag){case 1:return Jn(t.type)&&Zs(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return La(),Zt(Kn),Zt(Dn),xu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return yu(t),null;case 13:if(Zt(nn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Be(340));Ra()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Zt(nn),null;case 4:return La(),null;case 10:return hu(t.type._context),null;case 22:case 23:return Au(),null;case 24:return null;default:return null}}var ms=!1,Ln=!1,L2=typeof WeakSet=="function"?WeakSet:Set,Xe=null;function xa(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ln(e,t,r)}else n.current=null}function yd(e,t,n){try{n()}catch(r){ln(e,t,r)}}var uh=!1;function j2(e,t){if(ed=qs,e=v0(),su(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var s=0,l=-1,c=-1,d=0,h=0,g=e,m=null;t:for(;;){for(var w;g!==n||a!==0&&g.nodeType!==3||(l=s+a),g!==i||r!==0&&g.nodeType!==3||(c=s+r),g.nodeType===3&&(s+=g.nodeValue.length),(w=g.firstChild)!==null;)m=g,g=w;for(;;){if(g===e)break t;if(m===n&&++d===a&&(l=s),m===i&&++h===r&&(c=s),(w=g.nextSibling)!==null)break;g=m,m=g.parentNode}g=w}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(td={focusedElem:e,selectionRange:n},qs=!1,Xe=t;Xe!==null;)if(t=Xe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Xe=e;else for(;Xe!==null;){t=Xe;try{var y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var b=y.memoizedProps,S=y.memoizedState,_=t.stateNode,v=_.getSnapshotBeforeUpdate(t.elementType===t.type?b:bo(t.type,b),S);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var f=t.stateNode.containerInfo;f.nodeType===1?f.textContent="":f.nodeType===9&&f.documentElement&&f.removeChild(f.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Be(163))}}catch(T){ln(t,t.return,T)}if(e=t.sibling,e!==null){e.return=t.return,Xe=e;break}Xe=t.return}return y=uh,uh=!1,y}function bi(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&yd(t,n,i)}a=a.next}while(a!==r)}}function kl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function xd(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function ff(e){var t=e.alternate;t!==null&&(e.alternate=null,ff(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Mo],delete t[Li],delete t[rd],delete t[y2],delete t[x2])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function yf(e){return e.tag===5||e.tag===3||e.tag===4}function ph(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||yf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function vd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Xs));else if(r!==4&&(e=e.child,e!==null))for(vd(e,t,n),e=e.sibling;e!==null;)vd(e,t,n),e=e.sibling}function bd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(bd(e,t,n),e=e.sibling;e!==null;)bd(e,t,n),e=e.sibling}var Sn=null,wo=!1;function or(e,t,n){for(n=n.child;n!==null;)xf(e,t,n),n=n.sibling}function xf(e,t,n){if(Lo&&typeof Lo.onCommitFiberUnmount=="function")try{Lo.onCommitFiberUnmount(bl,n)}catch{}switch(n.tag){case 5:Ln||xa(n,t);case 6:var r=Sn,a=wo;Sn=null,or(e,t,n),Sn=r,wo=a,Sn!==null&&(wo?(e=Sn,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Sn.removeChild(n.stateNode));break;case 18:Sn!==null&&(wo?(e=Sn,n=n.stateNode,e.nodeType===8?fc(e.parentNode,n):e.nodeType===1&&fc(e,n),Ai(e)):fc(Sn,n.stateNode));break;case 4:r=Sn,a=wo,Sn=n.stateNode.containerInfo,wo=!0,or(e,t,n),Sn=r,wo=a;break;case 0:case 11:case 14:case 15:if(!Ln&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&yd(n,t,s),a=a.next}while(a!==r)}or(e,t,n);break;case 1:if(!Ln&&(xa(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ln(n,t,l)}or(e,t,n);break;case 21:or(e,t,n);break;case 22:n.mode&1?(Ln=(r=Ln)||n.memoizedState!==null,or(e,t,n),Ln=r):or(e,t,n);break;default:or(e,t,n)}}function hh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new L2),t.forEach(function(r){var a=V2.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function vo(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:Sn=l.stateNode,wo=!1;break e;case 3:Sn=l.stateNode.containerInfo,wo=!0;break e;case 4:Sn=l.stateNode.containerInfo,wo=!0;break e}l=l.return}if(Sn===null)throw Error(Be(160));xf(i,s,a),Sn=null,wo=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){ln(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)vf(t,e),t=t.sibling}function vf(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vo(t,e),Po(e),r&4){try{bi(3,e,e.return),kl(3,e)}catch(b){ln(e,e.return,b)}try{bi(5,e,e.return)}catch(b){ln(e,e.return,b)}}break;case 1:vo(t,e),Po(e),r&512&&n!==null&&xa(n,n.return);break;case 5:if(vo(t,e),Po(e),r&512&&n!==null&&xa(n,n.return),e.flags&32){var a=e.stateNode;try{Ti(a,"")}catch(b){ln(e,e.return,b)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,s=n!==null?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Gg(a,i),Vc(l,s);var d=Vc(l,i);for(s=0;s<c.length;s+=2){var h=c[s],g=c[s+1];h==="style"?$g(a,g):h==="dangerouslySetInnerHTML"?Bg(a,g):h==="children"?Ti(a,g):qd(a,h,g,d)}switch(l){case"input":zc(a,i);break;case"textarea":Ug(a,i);break;case"select":var m=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var w=i.value;w!=null?_a(a,!!i.multiple,w,!1):m!==!!i.multiple&&(i.defaultValue!=null?_a(a,!!i.multiple,i.defaultValue,!0):_a(a,!!i.multiple,i.multiple?[]:"",!1))}a[Li]=i}catch(b){ln(e,e.return,b)}}break;case 6:if(vo(t,e),Po(e),r&4){if(e.stateNode===null)throw Error(Be(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(b){ln(e,e.return,b)}}break;case 3:if(vo(t,e),Po(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ai(t.containerInfo)}catch(b){ln(e,e.return,b)}break;case 4:vo(t,e),Po(e);break;case 13:vo(t,e),Po(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Nu=dn())),r&4&&hh(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(Ln=(d=Ln)||h,vo(t,e),Ln=d):vo(t,e),Po(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!h&&e.mode&1)for(Xe=e,h=e.child;h!==null;){for(g=Xe=h;Xe!==null;){switch(m=Xe,w=m.child,m.tag){case 0:case 11:case 14:case 15:bi(4,m,m.return);break;case 1:xa(m,m.return);var y=m.stateNode;if(typeof y.componentWillUnmount=="function"){r=m,n=m.return;try{t=r,y.props=t.memoizedProps,y.state=t.memoizedState,y.componentWillUnmount()}catch(b){ln(r,n,b)}}break;case 5:xa(m,m.return);break;case 22:if(m.memoizedState!==null){gh(g);continue}}w!==null?(w.return=m,Xe=w):gh(g)}h=h.sibling}e:for(h=null,g=e;;){if(g.tag===5){if(h===null){h=g;try{a=g.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=g.stateNode,c=g.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Vg("display",s))}catch(b){ln(e,e.return,b)}}}else if(g.tag===6){if(h===null)try{g.stateNode.nodeValue=d?"":g.memoizedProps}catch(b){ln(e,e.return,b)}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===e)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===e)break e;for(;g.sibling===null;){if(g.return===null||g.return===e)break e;h===g&&(h=null),g=g.return}h===g&&(h=null),g.sibling.return=g.return,g=g.sibling}}break;case 19:vo(t,e),Po(e),r&4&&hh(e);break;case 21:break;default:vo(t,e),Po(e)}}function Po(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(yf(n)){var r=n;break e}n=n.return}throw Error(Be(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Ti(a,""),r.flags&=-33);var i=ph(e);bd(e,i,a);break;case 3:case 4:var s=r.stateNode.containerInfo,l=ph(e);vd(e,l,s);break;default:throw Error(Be(161))}}catch(c){ln(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function D2(e,t,n){Xe=e,bf(e)}function bf(e,t,n){for(var r=(e.mode&1)!==0;Xe!==null;){var a=Xe,i=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||ms;if(!s){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Ln;l=ms;var d=Ln;if(ms=s,(Ln=c)&&!d)for(Xe=a;Xe!==null;)s=Xe,c=s.child,s.tag===22&&s.memoizedState!==null?fh(a):c!==null?(c.return=s,Xe=c):fh(a);for(;i!==null;)Xe=i,bf(i),i=i.sibling;Xe=a,ms=l,Ln=d}mh(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,Xe=i):mh(e)}}function mh(e){for(;Xe!==null;){var t=Xe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ln||kl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Ln)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:bo(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Zp(t,i,r);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Zp(t,s,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var g=h.dehydrated;g!==null&&Ai(g)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Be(163))}Ln||t.flags&512&&xd(t)}catch(m){ln(t,t.return,m)}}if(t===e){Xe=null;break}if(n=t.sibling,n!==null){n.return=t.return,Xe=n;break}Xe=t.return}}function gh(e){for(;Xe!==null;){var t=Xe;if(t===e){Xe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Xe=n;break}Xe=t.return}}function fh(e){for(;Xe!==null;){var t=Xe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{kl(4,t)}catch(c){ln(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){ln(t,a,c)}}var i=t.return;try{xd(t)}catch(c){ln(t,i,c)}break;case 5:var s=t.return;try{xd(t)}catch(c){ln(t,s,c)}}}catch(c){ln(t,t.return,c)}if(t===e){Xe=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Xe=l;break}Xe=t.return}}var O2=Math.ceil,ll=Jo.ReactCurrentDispatcher,Tu=Jo.ReactCurrentOwner,po=Jo.ReactCurrentBatchConfig,Tt=0,_n=null,pn=null,Tn=0,eo=0,va=Sr(0),yn=0,Gi=null,Yr=0,Al=0,Eu=0,wi=null,Wn=null,Nu=0,Da=1/0,Fo=null,cl=!1,wd=null,xr=null,gs=!1,pr=null,dl=0,_i=0,_d=null,Os=-1,Fs=0;function zn(){return Tt&6?dn():Os!==-1?Os:Os=dn()}function vr(e){return e.mode&1?Tt&2&&Tn!==0?Tn&-Tn:b2.transition!==null?(Fs===0&&(Fs=o0()),Fs):(e=jt,e!==0||(e=window.event,e=e===void 0?16:d0(e.type)),e):1}function So(e,t,n,r){if(50<_i)throw _i=0,_d=null,Error(Be(185));Bi(e,n,r),(!(Tt&2)||e!==_n)&&(e===_n&&(!(Tt&2)&&(Al|=n),yn===4&&dr(e,Tn)),Xn(e,r),n===1&&Tt===0&&!(t.mode&1)&&(Da=dn()+500,Tl&&Tr()))}function Xn(e,t){var n=e.callbackNode;bv(e,t);var r=Ys(e,e===_n?Tn:0);if(r===0)n!==null&&Tp(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Tp(n),t===1)e.tag===0?v2(yh.bind(null,e)):A0(yh.bind(null,e)),g2(function(){!(Tt&6)&&Tr()}),n=null;else{switch(r0(r)){case 1:n=Qd;break;case 4:n=t0;break;case 16:n=Ws;break;case 536870912:n=n0;break;default:n=Ws}n=kf(n,wf.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function wf(e,t){if(Os=-1,Fs=0,Tt&6)throw Error(Be(327));var n=e.callbackNode;if(Na()&&e.callbackNode!==n)return null;var r=Ys(e,e===_n?Tn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ul(e,r);else{t=r;var a=Tt;Tt|=2;var i=Cf();(_n!==e||Tn!==t)&&(Fo=null,Da=dn()+500,Hr(e,t));do try{G2();break}catch(l){_f(e,l)}while(!0);pu(),ll.current=i,Tt=a,pn!==null?t=0:(_n=null,Tn=0,t=yn)}if(t!==0){if(t===2&&(a=Kc(e),a!==0&&(r=a,t=Cd(e,a))),t===1)throw n=Gi,Hr(e,0),dr(e,r),Xn(e,dn()),n;if(t===6)dr(e,r);else{if(a=e.current.alternate,!(r&30)&&!F2(a)&&(t=ul(e,r),t===2&&(i=Kc(e),i!==0&&(r=i,t=Cd(e,i))),t===1))throw n=Gi,Hr(e,0),dr(e,r),Xn(e,dn()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(Be(345));case 2:Lr(e,Wn,Fo);break;case 3:if(dr(e,r),(r&130023424)===r&&(t=Nu+500-dn(),10<t)){if(Ys(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){zn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=od(Lr.bind(null,e,Wn,Fo),t);break}Lr(e,Wn,Fo);break;case 4:if(dr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-Co(r);i=1<<s,s=t[s],s>a&&(a=s),r&=~i}if(r=a,r=dn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*O2(r/1960))-r,10<r){e.timeoutHandle=od(Lr.bind(null,e,Wn,Fo),r);break}Lr(e,Wn,Fo);break;case 5:Lr(e,Wn,Fo);break;default:throw Error(Be(329))}}}return Xn(e,dn()),e.callbackNode===n?wf.bind(null,e):null}function Cd(e,t){var n=wi;return e.current.memoizedState.isDehydrated&&(Hr(e,t).flags|=256),e=ul(e,t),e!==2&&(t=Wn,Wn=n,t!==null&&Sd(t)),e}function Sd(e){Wn===null?Wn=e:Wn.push.apply(Wn,e)}function F2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!No(i(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function dr(e,t){for(t&=~Eu,t&=~Al,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Co(t),r=1<<n;e[n]=-1,t&=~r}}function yh(e){if(Tt&6)throw Error(Be(327));Na();var t=Ys(e,0);if(!(t&1))return Xn(e,dn()),null;var n=ul(e,t);if(e.tag!==0&&n===2){var r=Kc(e);r!==0&&(t=r,n=Cd(e,r))}if(n===1)throw n=Gi,Hr(e,0),dr(e,t),Xn(e,dn()),n;if(n===6)throw Error(Be(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Lr(e,Wn,Fo),Xn(e,dn()),null}function ku(e,t){var n=Tt;Tt|=1;try{return e(t)}finally{Tt=n,Tt===0&&(Da=dn()+500,Tl&&Tr())}}function qr(e){pr!==null&&pr.tag===0&&!(Tt&6)&&Na();var t=Tt;Tt|=1;var n=po.transition,r=jt;try{if(po.transition=null,jt=1,e)return e()}finally{jt=r,po.transition=n,Tt=t,!(Tt&6)&&Tr()}}function Au(){eo=va.current,Zt(va)}function Hr(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,m2(n)),pn!==null)for(n=pn.return;n!==null;){var r=n;switch(cu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Zs();break;case 3:La(),Zt(Kn),Zt(Dn),xu();break;case 5:yu(r);break;case 4:La();break;case 13:Zt(nn);break;case 19:Zt(nn);break;case 10:hu(r.type._context);break;case 22:case 23:Au()}n=n.return}if(_n=e,pn=e=br(e.current,null),Tn=eo=t,yn=0,Gi=null,Eu=Al=Yr=0,Wn=wi=null,zr!==null){for(t=0;t<zr.length;t++)if(n=zr[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,i=n.pending;if(i!==null){var s=i.next;i.next=a,r.next=s}n.pending=r}zr=null}return e}function _f(e,t){do{var n=pn;try{if(pu(),Ls.current=sl,il){for(var r=on.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}il=!1}if(Wr=0,wn=fn=on=null,vi=!1,Oi=0,Tu.current=null,n===null||n.return===null){yn=1,Gi=t,pn=null;break}e:{var i=e,s=n.return,l=n,c=t;if(t=Tn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,g=h.tag;if(!(h.mode&1)&&(g===0||g===11||g===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var w=rh(s);if(w!==null){w.flags&=-257,ah(w,s,l,i,t),w.mode&1&&oh(i,d,t),t=w,c=d;var y=t.updateQueue;if(y===null){var b=new Set;b.add(c),t.updateQueue=b}else y.add(c);break e}else{if(!(t&1)){oh(i,d,t),Iu();break e}c=Error(Be(426))}}else if(Qt&&l.mode&1){var S=rh(s);if(S!==null){!(S.flags&65536)&&(S.flags|=256),ah(S,s,l,i,t),du(ja(c,l));break e}}i=c=ja(c,l),yn!==4&&(yn=2),wi===null?wi=[i]:wi.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var _=rf(i,c,t);Xp(i,_);break e;case 1:l=c;var v=i.type,f=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(xr===null||!xr.has(f)))){i.flags|=65536,t&=-t,i.lanes|=t;var T=af(i,l,t);Xp(i,T);break e}}i=i.return}while(i!==null)}Tf(n)}catch(A){t=A,pn===n&&n!==null&&(pn=n=n.return);continue}break}while(!0)}function Cf(){var e=ll.current;return ll.current=sl,e===null?sl:e}function Iu(){(yn===0||yn===3||yn===2)&&(yn=4),_n===null||!(Yr&268435455)&&!(Al&268435455)||dr(_n,Tn)}function ul(e,t){var n=Tt;Tt|=2;var r=Cf();(_n!==e||Tn!==t)&&(Fo=null,Hr(e,t));do try{z2();break}catch(a){_f(e,a)}while(!0);if(pu(),Tt=n,ll.current=r,pn!==null)throw Error(Be(261));return _n=null,Tn=0,yn}function z2(){for(;pn!==null;)Sf(pn)}function G2(){for(;pn!==null&&!uv();)Sf(pn)}function Sf(e){var t=Nf(e.alternate,e,eo);e.memoizedProps=e.pendingProps,t===null?Tf(e):pn=t,Tu.current=null}function Tf(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=M2(n,t),n!==null){n.flags&=32767,pn=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{yn=6,pn=null;return}}else if(n=R2(n,t,eo),n!==null){pn=n;return}if(t=t.sibling,t!==null){pn=t;return}pn=t=e}while(t!==null);yn===0&&(yn=5)}function Lr(e,t,n){var r=jt,a=po.transition;try{po.transition=null,jt=1,U2(e,t,n,r)}finally{po.transition=a,jt=r}return null}function U2(e,t,n,r){do Na();while(pr!==null);if(Tt&6)throw Error(Be(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Be(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(wv(e,i),e===_n&&(pn=_n=null,Tn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||gs||(gs=!0,kf(Ws,function(){return Na(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=po.transition,po.transition=null;var s=jt;jt=1;var l=Tt;Tt|=4,Tu.current=null,j2(e,n),vf(n,e),s2(td),qs=!!ed,td=ed=null,e.current=n,D2(n),pv(),Tt=l,jt=s,po.transition=i}else e.current=n;if(gs&&(gs=!1,pr=e,dl=a),i=e.pendingLanes,i===0&&(xr=null),gv(n.stateNode),Xn(e,dn()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(cl)throw cl=!1,e=wd,wd=null,e;return dl&1&&e.tag!==0&&Na(),i=e.pendingLanes,i&1?e===_d?_i++:(_i=0,_d=e):_i=0,Tr(),null}function Na(){if(pr!==null){var e=r0(dl),t=po.transition,n=jt;try{if(po.transition=null,jt=16>e?16:e,pr===null)var r=!1;else{if(e=pr,pr=null,dl=0,Tt&6)throw Error(Be(331));var a=Tt;for(Tt|=4,Xe=e.current;Xe!==null;){var i=Xe,s=i.child;if(Xe.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Xe=d;Xe!==null;){var h=Xe;switch(h.tag){case 0:case 11:case 15:bi(8,h,i)}var g=h.child;if(g!==null)g.return=h,Xe=g;else for(;Xe!==null;){h=Xe;var m=h.sibling,w=h.return;if(ff(h),h===d){Xe=null;break}if(m!==null){m.return=w,Xe=m;break}Xe=w}}}var y=i.alternate;if(y!==null){var b=y.child;if(b!==null){y.child=null;do{var S=b.sibling;b.sibling=null,b=S}while(b!==null)}}Xe=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,Xe=s;else e:for(;Xe!==null;){if(i=Xe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:bi(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,Xe=_;break e}Xe=i.return}}var v=e.current;for(Xe=v;Xe!==null;){s=Xe;var f=s.child;if(s.subtreeFlags&2064&&f!==null)f.return=s,Xe=f;else e:for(s=v;Xe!==null;){if(l=Xe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:kl(9,l)}}catch(A){ln(l,l.return,A)}if(l===s){Xe=null;break e}var T=l.sibling;if(T!==null){T.return=l.return,Xe=T;break e}Xe=l.return}}if(Tt=a,Tr(),Lo&&typeof Lo.onPostCommitFiberRoot=="function")try{Lo.onPostCommitFiberRoot(bl,e)}catch{}r=!0}return r}finally{jt=n,po.transition=t}}return!1}function xh(e,t,n){t=ja(n,t),t=rf(e,t,1),e=yr(e,t,1),t=zn(),e!==null&&(Bi(e,1,t),Xn(e,t))}function ln(e,t,n){if(e.tag===3)xh(e,e,n);else for(;t!==null;){if(t.tag===3){xh(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xr===null||!xr.has(r))){e=ja(n,e),e=af(t,e,1),t=yr(t,e,1),e=zn(),t!==null&&(Bi(t,1,e),Xn(t,e));break}}t=t.return}}function H2(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=zn(),e.pingedLanes|=e.suspendedLanes&n,_n===e&&(Tn&n)===n&&(yn===4||yn===3&&(Tn&130023424)===Tn&&500>dn()-Nu?Hr(e,0):Eu|=n),Xn(e,t)}function Ef(e,t){t===0&&(e.mode&1?(t=as,as<<=1,!(as&130023424)&&(as=4194304)):t=1);var n=zn();e=Wo(e,t),e!==null&&(Bi(e,t,n),Xn(e,n))}function B2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Ef(e,n)}function V2(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Be(314))}r!==null&&r.delete(t),Ef(e,n)}var Nf;Nf=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Kn.current)qn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return qn=!1,P2(e,t,n);qn=!!(e.flags&131072)}else qn=!1,Qt&&t.flags&1048576&&I0(t,tl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ds(e,t),e=t.pendingProps;var a=Pa(t,Dn.current);Ea(t,n),a=bu(null,t,r,e,a,n);var i=wu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Jn(r)?(i=!0,Qs(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,gu(t),a.updater=Nl,t.stateNode=a,a._reactInternals=t,dd(t,r,e,n),t=hd(null,t,r,!0,i,n)):(t.tag=0,Qt&&i&&lu(t),Fn(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ds(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=W2(r),e=bo(r,e),a){case 0:t=pd(null,t,r,e,n);break e;case 1:t=lh(null,t,r,e,n);break e;case 11:t=ih(null,t,r,e,n);break e;case 14:t=sh(null,t,r,bo(r.type,e),n);break e}throw Error(Be(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:bo(r,a),pd(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:bo(r,a),lh(e,t,r,a,n);case 3:e:{if(df(t),e===null)throw Error(Be(387));r=t.pendingProps,i=t.memoizedState,a=i.element,D0(e,t),rl(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=ja(Error(Be(423)),t),t=ch(e,t,r,n,a);break e}else if(r!==a){a=ja(Error(Be(424)),t),t=ch(e,t,r,n,a);break e}else for(to=fr(t.stateNode.containerInfo.firstChild),no=t,Qt=!0,_o=null,n=L0(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ra(),r===a){t=Yo(e,t,n);break e}Fn(e,t,r,n)}t=t.child}return t;case 5:return O0(t),e===null&&sd(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,s=a.children,nd(r,a)?s=null:i!==null&&nd(r,i)&&(t.flags|=32),cf(e,t),Fn(e,t,s,n),t.child;case 6:return e===null&&sd(t),null;case 13:return uf(e,t,n);case 4:return fu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ma(t,null,r,n):Fn(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:bo(r,a),ih(e,t,r,a,n);case 7:return Fn(e,t,t.pendingProps,n),t.child;case 8:return Fn(e,t,t.pendingProps.children,n),t.child;case 12:return Fn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,s=a.value,qt(nl,r._currentValue),r._currentValue=s,i!==null)if(No(i.value,s)){if(i.children===a.children&&!Kn.current){t=Yo(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){s=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Bo(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),ld(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(i.tag===10)s=i.type===t.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(Be(341));s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),ld(s,n,t),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===t){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}Fn(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ea(t,n),a=mo(a),r=r(a),t.flags|=1,Fn(e,t,r,n),t.child;case 14:return r=t.type,a=bo(r,t.pendingProps),a=bo(r.type,a),sh(e,t,r,a,n);case 15:return sf(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:bo(r,a),Ds(e,t),t.tag=1,Jn(r)?(e=!0,Qs(t)):e=!1,Ea(t,n),of(t,r,a),dd(t,r,a,n),hd(null,t,r,!0,e,n);case 19:return pf(e,t,n);case 22:return lf(e,t,n)}throw Error(Be(156,t.tag))};function kf(e,t){return e0(e,t)}function $2(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uo(e,t,n,r){return new $2(e,t,n,r)}function Pu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function W2(e){if(typeof e=="function")return Pu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Jd)return 11;if(e===Xd)return 14}return 2}function br(e,t){var n=e.alternate;return n===null?(n=uo(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function zs(e,t,n,r,a,i){var s=2;if(r=e,typeof e=="function")Pu(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case ca:return Br(n.children,a,i,t);case Kd:s=8,a|=8;break;case Lc:return e=uo(12,n,t,a|2),e.elementType=Lc,e.lanes=i,e;case jc:return e=uo(13,n,t,a),e.elementType=jc,e.lanes=i,e;case Dc:return e=uo(19,n,t,a),e.elementType=Dc,e.lanes=i,e;case Og:return Il(n,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case jg:s=10;break e;case Dg:s=9;break e;case Jd:s=11;break e;case Xd:s=14;break e;case sr:s=16,r=null;break e}throw Error(Be(130,e==null?e:typeof e,""))}return t=uo(s,n,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function Br(e,t,n,r){return e=uo(7,e,r,t),e.lanes=n,e}function Il(e,t,n,r){return e=uo(22,e,r,t),e.elementType=Og,e.lanes=n,e.stateNode={isHidden:!1},e}function Sc(e,t,n){return e=uo(6,e,null,t),e.lanes=n,e}function Tc(e,t,n){return t=uo(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Y2(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ac(0),this.expirationTimes=ac(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ac(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Ru(e,t,n,r,a,i,s,l,c){return e=new Y2(e,t,n,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=uo(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},gu(i),e}function q2(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:la,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function Af(e){if(!e)return _r;e=e._reactInternals;e:{if(Xr(e)!==e||e.tag!==1)throw Error(Be(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Jn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Be(171))}if(e.tag===1){var n=e.type;if(Jn(n))return k0(e,n,t)}return t}function If(e,t,n,r,a,i,s,l,c){return e=Ru(n,r,!0,e,a,i,s,l,c),e.context=Af(null),n=e.current,r=zn(),a=vr(n),i=Bo(r,a),i.callback=t??null,yr(n,i,a),e.current.lanes=a,Bi(e,a,r),Xn(e,r),e}function Pl(e,t,n,r){var a=t.current,i=zn(),s=vr(a);return n=Af(n),t.context===null?t.context=n:t.pendingContext=n,t=Bo(i,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=yr(a,t,s),e!==null&&(So(e,a,s,i),Ms(e,a,s)),s}function pl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function vh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Mu(e,t){vh(e,t),(e=e.alternate)&&vh(e,t)}function K2(){return null}var Pf=typeof reportError=="function"?reportError:function(e){console.error(e)};function Lu(e){this._internalRoot=e}Rl.prototype.render=Lu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Be(409));Pl(e,t,null,null)};Rl.prototype.unmount=Lu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;qr(function(){Pl(null,e,null,null)}),t[$o]=null}};function Rl(e){this._internalRoot=e}Rl.prototype.unstable_scheduleHydration=function(e){if(e){var t=s0();e={blockedOn:null,target:e,priority:t};for(var n=0;n<cr.length&&t!==0&&t<cr[n].priority;n++);cr.splice(n,0,e),n===0&&c0(e)}};function ju(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ml(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function bh(){}function J2(e,t,n,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var d=pl(s);i.call(d)}}var s=If(t,r,e,0,null,!1,!1,"",bh);return e._reactRootContainer=s,e[$o]=s.current,Ri(e.nodeType===8?e.parentNode:e),qr(),s}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=pl(c);l.call(d)}}var c=Ru(e,0,!1,null,null,!1,!1,"",bh);return e._reactRootContainer=c,e[$o]=c.current,Ri(e.nodeType===8?e.parentNode:e),qr(function(){Pl(t,c,n,r)}),c}function Ll(e,t,n,r,a){var i=n._reactRootContainer;if(i){var s=i;if(typeof a=="function"){var l=a;a=function(){var c=pl(s);l.call(c)}}Pl(t,s,e,a)}else s=J2(n,t,e,a,r);return pl(s)}a0=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ui(t.pendingLanes);n!==0&&(eu(t,n|1),Xn(t,dn()),!(Tt&6)&&(Da=dn()+500,Tr()))}break;case 13:qr(function(){var r=Wo(e,1);if(r!==null){var a=zn();So(r,e,1,a)}}),Mu(e,1)}};tu=function(e){if(e.tag===13){var t=Wo(e,134217728);if(t!==null){var n=zn();So(t,e,134217728,n)}Mu(e,134217728)}};i0=function(e){if(e.tag===13){var t=vr(e),n=Wo(e,t);if(n!==null){var r=zn();So(n,e,t,r)}Mu(e,t)}};s0=function(){return jt};l0=function(e,t){var n=jt;try{return jt=e,t()}finally{jt=n}};Wc=function(e,t,n){switch(t){case"input":if(zc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=Sl(r);if(!a)throw Error(Be(90));zg(r),zc(r,a)}}}break;case"textarea":Ug(e,n);break;case"select":t=n.value,t!=null&&_a(e,!!n.multiple,t,!1)}};qg=ku;Kg=qr;var X2={usingClientEntryPoint:!1,Events:[$i,ha,Sl,Wg,Yg,ku]},ai={findFiberByHostInstance:Fr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Z2={bundleType:ai.bundleType,version:ai.version,rendererPackageName:ai.rendererPackageName,rendererConfig:ai.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Jo.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zg(e),e===null?null:e.stateNode},findFiberByHostInstance:ai.findFiberByHostInstance||K2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fs.isDisabled&&fs.supportsFiber)try{bl=fs.inject(Z2),Lo=fs}catch{}}ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X2;ro.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ju(t))throw Error(Be(200));return q2(e,t,null,n)};ro.createRoot=function(e,t){if(!ju(e))throw Error(Be(299));var n=!1,r="",a=Pf;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Ru(e,1,!1,null,null,n,!1,r,a),e[$o]=t.current,Ri(e.nodeType===8?e.parentNode:e),new Lu(t)};ro.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Be(188)):(e=Object.keys(e).join(","),Error(Be(268,e)));return e=Zg(t),e=e===null?null:e.stateNode,e};ro.flushSync=function(e){return qr(e)};ro.hydrate=function(e,t,n){if(!Ml(t))throw Error(Be(200));return Ll(null,e,t,!0,n)};ro.hydrateRoot=function(e,t,n){if(!ju(e))throw Error(Be(405));var r=n!=null&&n.hydratedSources||null,a=!1,i="",s=Pf;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=If(t,null,e,1,n??null,a,!1,i,s),e[$o]=t.current,Ri(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Rl(t)};ro.render=function(e,t,n){if(!Ml(t))throw Error(Be(200));return Ll(null,e,t,!1,n)};ro.unmountComponentAtNode=function(e){if(!Ml(e))throw Error(Be(40));return e._reactRootContainer?(qr(function(){Ll(null,null,e,!1,function(){e._reactRootContainer=null,e[$o]=null})}),!0):!1};ro.unstable_batchedUpdates=ku;ro.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ml(n))throw Error(Be(200));if(e==null||e._reactInternals===void 0)throw Error(Be(38));return Ll(e,t,n,!1,r)};ro.version="18.3.1-next-f1338f8080-20240426";function Rf(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Rf)}catch(e){console.error(e)}}Rf(),Pg.exports=ro;var Yi=Pg.exports,wh=Yi;Rc.createRoot=wh.createRoot,Rc.hydrateRoot=wh.hydrateRoot;var C=(e=>(e.TEXT_INPUT="TEXT_INPUT",e.PROMPT_PROCESSOR="PROMPT_PROCESSOR",e.PROMPT_ANALYZER="PROMPT_ANALYZER",e.CHARACTER_ANALYZER="CHARACTER_ANALYZER",e.CHARACTER_GENERATOR="CHARACTER_GENERATOR",e.IMAGE_GENERATOR="IMAGE_GENERATOR",e.IMAGE_PREVIEW="IMAGE_PREVIEW",e.CHARACTER_CARD="CHARACTER_CARD",e.GEMINI_CHAT="GEMINI_CHAT",e.TRANSLATOR="TRANSLATOR",e.SCRIPT_GENERATOR="SCRIPT_GENERATOR",e.SCRIPT_ANALYZER="SCRIPT_ANALYZER",e.SCRIPT_PROMPT_MODIFIER="SCRIPT_PROMPT_MODIFIER",e.ERROR_ANALYZER="ERROR_ANALYZER",e.NOTE="NOTE",e.IDEA_GENERATOR="IDEA_GENERATOR",e.REROUTE_DOT="REROUTE_DOT",e.DATA_READER="DATA_READER",e.SPEECH_SYNTHESIZER="SPEECH_SYNTHESIZER",e.NARRATOR_TEXT_GENERATOR="NARRATOR_TEXT_GENERATOR",e.AUDIO_TRANSCRIBER="AUDIO_TRANSCRIBER",e.YOUTUBE_TITLE_GENERATOR="YOUTUBE_TITLE_GENERATOR",e.MUSIC_IDEA_GENERATOR="MUSIC_IDEA_GENERATOR",e.YOUTUBE_ANALYTICS="YOUTUBE_ANALYTICS",e.IMAGE_EDITOR="IMAGE_EDITOR",e))(C||{}),Yt=(e=>(e.FOLDER="FOLDER",e.PROMPT="PROMPT",e))(Yt||{}),Ze=(e=>(e.FOLDER="FOLDER",e.GROUP="GROUP",e.CHARACTERS="CHARACTERS",e.SCRIPT="SCRIPT",e.ANALYSIS="ANALYSIS",e.FINAL_PROMPTS="FINAL_PROMPTS",e.YOUTUBE="YOUTUBE",e.MUSIC="MUSIC",e))(Ze||{});const Q2={"app.title":"Script Modifier","app.description":"Visually create, refine, and generate scripts with the Gemini API.","app.slogan":"Connect ideas to create a masterpiece","app.subtitle":"Visualize Your Scripts","app.error.title":"Notification","app.error.copy":"Copy Error","app.error.copied":"Copied!","error.quotaExceeded":"You have reached your usage limit. Please check your API key quota or try again later.","error.apiKeyMissing":"API key not found. Please set your Gemini API key in the settings.","error.freeKeyNotAvailable":"Free/development API key is not available in this environment. Please provide your own key.","error.fileReadError":"Error reading file.","error.videoConversionError":"Failed to convert video to audio.","error.unsupportedFile":"Unsupported file type.","error.promptModifierFile":"This file belongs to another application (Prompt Modifier). Please open it in that application.","error.invalidFileType":"Invalid file type. Please load a Script Modifier Canvas or Project file.","welcome.iAmDeveloper":"I am a Developer","welcome.letsGo":"Let's Go!","welcome.resume":"Resume","welcome.reload":"Reload App","welcome.reloadTitle":"Reset & Reload?","welcome.reloadMessage":"This will clear the entire canvas and reload the application. Unsaved data will be lost. Are you sure?","welcome.confirmReload":"Reset & Reload","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Welcome to","dialog.welcome.intro1":"Welcome to Script Modifier - your visual workspace for creating stories with Gemini.","dialog.welcome.intro2":"To get started, please select your language and enter your Gemini API key.","dialog.welcome.apiKeyExplanation":"Your API Key is stored locally in your browser. We do not send it to any server other than Google's Gemini API."},e1={"toolbar.edit":"Edit (V)","toolbar.cutter":"Cut Connection (C)","toolbar.selection":"Selection Tool (S)","toolbar.reroute":"Reroute Dot (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Toggle Snap to Grid (Shift+W)","toolbar.resetZoom":"Reset zoom to 100%","toolbar.lineStyleSpaghetti":"Spaghetti Lines (Shift+E)","toolbar.lineStyleOrthogonal":"Orthogonal Lines (Shift+E)","toolbar.addNode":"Add Node (F)","toolbar.catalog":"Catalog (Ctrl+Space)","toolbar.settings":"Settings","toolbar.resetToDefault":"Reset to Default","toolbar.closeProject":"Close Project / Clear","toolbar.enterFullscreen":"Full Screen","toolbar.exitFullscreen":"Exit Full Screen","toolbar.home":"Home","toolbar.addTextInput":"Add Text Input (T)","toolbar.addPromptAnalyzer":"Add Prompt Analyzer (A)","toolbar.addCharacterAnalyzer":"Add Character Analyzer","toolbar.addCharacterGenerator":"Add Character Generator (Shift+C)","toolbar.addImageGenerator":"Add Image Generator (O)","toolbar.addImagePreview":"Add Image Preview (I)","toolbar.addCharacterCard":"Add Character Card (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Add Prompt Processor (P)","toolbar.addGeminiChat":"Add Gemini Chat (M)","toolbar.addTranslator":"Add Translator (L)","toolbar.addIdeaGenerator":"Add Idea Generator (Shift+A)","toolbar.addScriptGenerator":"Add Script Generator (Shift+S)","toolbar.addScriptAnalyzer":"Add Script Analyzer (Shift+D)","toolbar.addScriptPromptModifier":"Add Prompt Finalizer (Shift+F)","toolbar.addErrorAnalyzer":"Add Error Analyzer","toolbar.addNote":"Add Note (N)","toolbar.addDataReader":"Add Data Reader (Shift+R)","toolbar.addSpeechSynthesizer":"Add Speech Synthesizer (Shift+N)","toolbar.addNarratorTextGenerator":"Add Narrator Text Generator (Shift+G)","toolbar.addAudioTranscriber":"Add Audio Transcriber (Shift+B)","toolbar.addYouTubeTitleGenerator":"Add YouTube Title Generator (Shift+T)","toolbar.addMusicIdeaGenerator":"Add Music Idea Generator (Shift+M)","toolbar.addYouTubeAnalytics":"Add YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Save Canvas (Ctrl+S)","toolbar.saveProject":"Save Project (Ctrl+Shift+S)","toolbar.loadCanvas":"Load Canvas/Project (Ctrl+O)","toolbar.clearCanvas":"Clear Canvas","toolbar.group.general":"General","toolbar.group.scripting":"Scripting","toolbar.group.prompting":"Prompting & Analysis","toolbar.group.characters":"Characters","toolbar.group.ai":"AI Tools","toolbar.group.file":"File","toolbar.group.images":"Images","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Canvas Controls","toolbar.expand":"Expand Panel","toolbar.collapse":"Collapse Panel","toolbar.toggleHeaders":"Toggle Headers","hotkeys.file.title":"File","hotkeys.file.save":"Save Canvas (Ctrl+S)","hotkeys.file.saveProject":"Save Project (Ctrl+Shift+S)","hotkeys.file.load":"Load Canvas (Ctrl+O)","hotkeys.tools.title":"Tools","hotkeys.tools.edit":"Edit","hotkeys.tools.cutter":"Cutter","hotkeys.tools.selection":"Selection","hotkeys.tools.reroute":"Reroute Dot","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Group (G)","hotkeys.tools.deleteGroup":"Delete group with nodes","hotkeys.tools.closeNode":"Close Node","hotkeys.tools.toggleLineStyle":"Toggle Line Style","hotkeys.tools.snapToGrid":"Snap to Grid","hotkeys.tools.selectAll":"Select All Nodes","hotkeys.tools.deselectAll":"Deselect All","hotkeys.tools.duplicate":"Duplicate with Content","hotkeys.windows.title":"Windows","hotkeys.windows.search":"Search Nodes (F)","hotkeys.windows.quickAdd":"Quick Add (Space)","hotkeys.windows.catalog":"Catalog","hotkeys.createNode.title":"Create Node","hotkeys.hide":"Hide Hotkeys","help.title":"Script Modifier - Help Center","hotkeys.show":"Show Hotkeys","search.placeholder":"Search for a node...","search.noResults":"No nodes found.","search.node.text_input.title":"Text Input","search.node.text_input.description":"A simple text box for your ideas. (T)","search.node.prompt_processor.title":"Prompt Processor","search.node.prompt_processor.description":"Enhances and combines prompts with AI. (P)","search.node.prompt_analyzer.title":"Prompt Analyzer","search.node.prompt_analyzer.description":"Splits a prompt into character and environment. (A)","search.node.character_analyzer.title":"Character Analyzer","search.node.character_analyzer.description":"Splits a description into character & clothing.","search.node.character_generator.title":"Character Generator","search.node.character_generator.description":"Create detailed characters from an idea. (Shift+C)","search.node.image_generator.title":"Image Generator","search.node.image_generator.description":"Creates an image from a text prompt. (O)","search.node.image_preview.title":"Image Preview","search.node.image_preview.description":"Displays an image from a file. (I)","search.node.character_card.title":"Character Card","search.node.character_card.description":"Stores a character's image, name, and prompt. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Have a direct conversation with Gemini AI. (M)","search.node.translator.title":"Translator","search.node.translator.description":"Translates text to a selected language. (L)","search.node.script_generator.title":"Script Generator","search.node.script_generator.description":"Breaks a story idea into script scenes. (Shift+S)","search.node.script_analyzer.title":"Script Analyzer","search.node.script_analyzer.description":"Breaks a script into frames and image prompts. (Shift+D)","search.node.script_prompt_modifier.title":"Prompt Finalizer","search.node.script_prompt_modifier.description":"Finalizes prompts from script analysis for image generation. (Shift+F)","search.node.error_analyzer.title":"Error Analyzer","search.node.error_analyzer.description":"Proofreads and corrects text for errors.","search.node.note.title":"Note","search.node.note.description":"A simple text area for your notes. (N)","search.node.reroute_dot.title":"Reroute Dot","search.node.reroute_dot.description":"A point to redirect and split connections.","search.node.data_reader.title":"Data Reader","search.node.data_reader.description":"Displays raw text from a connection.","search.node.speech_synthesizer.title":"Speech Synthesizer","search.node.speech_synthesizer.description":"Converts text to speech using a selected voice.","search.node.idea_generator.title":"Idea Generator","search.node.idea_generator.description":"Idea Generator.","search.node.narrator_text_generator.title":"Narrator Text Generator","search.node.narrator_text_generator.description":"Generates text for a narrator or announcer. (Shift+G)","search.node.audio_transcriber.title":"Audio Transcriber","search.node.audio_transcriber.description":"Converts audio/video files to text using the Gemini API.","search.node.youtube_title_generator.title":"YouTube Title Generator","search.node.youtube_title_generator.description":"Generates catchy titles, descriptions, and tags for a YouTube video.","search.node.music_idea_generator.title":"Music Idea Generator","search.node.music_idea_generator.description":"Generates song lyrics or a music prompt. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.group.input":"Inputs","search.group.process":"Processing & Analysis","search.group.scripting":"Scripting Tools","search.group.character":"Character Tools","search.group.images":"Image Tools","search.group.ai":"AI Tools","search.group.audio":"Audio Tools","search.group.youtube":"YouTube Tools","contextMenu.tools":"Tools","contextMenu.assignSlot":"Assign Slot {index}","contextMenu.addNodeFromSlot":"Add {node} ({index})","connectionMenu.title":"Add Node","quickAddMenu.title":"Quick Add","contextMenu.paste":"Paste (Ctrl+V)","node.content.simpleActions":"Simple Actions","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Fast, efficient, good for drafting.","tooltip.model.pro":"Gemini Pro: High intelligence, complex reasoning, detailed output.","tooltip.lang.ru":"Generate script in Russian.","tooltip.lang.en":"Generate script in English.","tooltip.lang.es":"Generate script in Spanish.","tooltip.lang.de":"Generate script in German.","tooltip.lang.uz":"Generate script in Uzbek.","tooltip.lang.fr":"Generate script in French.","tooltip.lang.it":"Generate script in Italian.","tooltip.lang.pt":"Generate script in Portuguese.","tooltip.lang.zh":"Generate script in Chinese.","node.action.locateInStack":"Locate in Stack","help.tabs.hotkeys":"Hotkeys & Help","help.tabs.links":"Other Apps & Links","help.category.socials":"Socials","help.category.stable":"Google AI Studio (Stable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"GitHub Repositories","help.category.gh_pages":"GitHub Pages Apps","help.link.youtube":"YouTube Channel","help.link.telegram_channel":"Telegram Channel","help.link.telegram_chat":"Telegram Chat","help.sub.news":"News & Updates","help.sub.discussion":"Discussion","help.sub.stable":"Stable Version","help.sub.alpha":"Alpha Version","imageViewer.title":"Image Viewer","languages.ru":"Russian","languages.en":"English","languages.es":"Spanish","languages.fr":"French","languages.de":"German","languages.it":"Italian","languages.pt":"Portuguese","languages.zh":"Chinese","languages.ja":"Japanese","languages.ko":"Korean","languages.uz":"Uzbek"},t1={"node.title.text_input":"Text Input","node.title.prompt_processor":"Prompt Processor","node.title.prompt_analyzer":"Prompt Analyzer","node.title.character_analyzer":"Character Analyzer","node.title.character_generator":"Character Generator","node.title.image_generator":"Image Generator","node.title.image_preview":"Image Preview","node.title.character_card":"Character Card","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Translator","node.title.script_generator":"Script Generator","node.title.script_analyzer":"Script Analyzer","node.title.script_prompt_modifier":"Prompt Finalizer","node.title.error_analyzer":"Error Analyzer","node.title.note":"Note","node.title.reroute_dot":"Reroute Dot","node.title.data_reader":"Data Reader","node.title.speech_synthesizer":"Speech Synthesizer","node.title.idea_generator":"Idea Generator","node.title.narrator_text_generator":"Narrator Text Generator","node.title.audio_transcriber":"Audio Transcriber","node.title.youtube_title_generator":"YouTube Title Generator","node.title.music_idea_generator":"Music Idea Generator","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Image Editor","node.help.text_input":"Enter basic ideas, keywords, or descriptions here. Can be connected to a Prompt Processor.","node.help.prompt_processor":"Takes text from other nodes and uses AI to combine them into a detailed, artistic prompt.","node.help.prompt_analyzer":"Analyzes incoming text and splits it into four parts: Environment, Character, Action, and Style.","node.help.character_analyzer":"Analyzes a character description and splits it into physical appearance and clothing.","node.help.character_generator":"Takes an idea prompt and generates one or more detailed character descriptions.","node.help.image_generator":"Generates an image from a text prompt using the Gemini API.","node.help.image_preview":"Displays an image from a file. Drag and drop an image file onto the node.","node.help.character_card":"Stores a character's image, name, and prompt. Allows image generation, saving, and loading.","node.help.gemini_chat":"Node for direct conversation with Gemini AI. Maintains chat history.","node.help.translator":"Translates incoming text to the selected language.","node.help.script_generator":"Takes a story idea and generates a series of script scenes.","node.help.script_analyzer":"Analyzes the script structure, breaking it down into characters and frames with detailed descriptions.","node.help.script_prompt_modifier":"Takes analyzed script data and synthesizes final, artistic prompts for image generation for each frame.","node.help.error_analyzer":"Checks and corrects text for spelling and grammar errors.","node.help.note":"A simple text area for your notes. Does not connect to other nodes.","node.help.reroute_dot":"A point to redirect and branch connections.","node.help.data_reader":"Displays raw text from a connection.","node.help.speech_synthesizer":"Converts text to speech using a selected voice.","node.help.idea_generator":"Two-stage node for generating ideas (Categories -> Idea).","node.help.narrator_text_generator":"Generates text for a narrator or announcer based on a short prompt and style.","node.help.audio_transcriber":"Uploads an audio or video file and converts its audio to text using Gemini API.","node.help.youtube_title_generator":"Generates catchy titles, descriptions, and tags for a YouTube video.","node.help.music_idea_generator":"Generates song lyrics or a musical prompt based on an idea.","node.help.youtube_analytics":"Analyzes channel statistics and provides growth advice.","node.help.image_editor":"Edit images with AI (Inpainting, Outpainting).","node.action.help":"Help","node.action.expand":"Expand","node.action.collapse":"Collapse (H)","node.action.expandAll":"Expand All","node.action.collapseAll":"Collapse All","node.action.expandAllScenes":"Expand All Scenes","node.action.collapseAllScenes":"Collapse All Scenes","node.action.expandAllFrames":"Expand All Frames","node.action.collapseAllFrames":"Collapse All Frames","node.action.expandPanel":"Expand Panel","node.action.collapsePanel":"Collapse Panel","node.action.togglePanel":"Toggle Panel","node.action.collapseScene":"Collapse Scene","node.action.expandScene":"Expand Scene","node.action.collapseFrame":"Collapse Frame","node.action.expandFrame":"Expand Frame","node.action.collapseCharacter":"Collapse Character","node.action.expandCharacter":"Expand Character","node.action.clear":"Clear","node.action.clearTooltip":"Clear input field.","node.action.clearChat":"Clear Chat","node.action.paste":"Paste","node.action.copy":"Copy","node.action.duplicateWithContent":"Duplicate (Content)","node.action.duplicateEmpty":"Duplicate (Empty)","node.action.cutConnections":"Cut Connections","node.action.close":"Close","node.action.executeChain":"Execute Chain","node.action.executeFullChain":"Execute Full Chain","node.action.processChainForward":"Process Chain Forward","node.action.executeChainTitle":"Execute all connected nodes.","node.action.addCharacter":"Add Character","node.action.addScene":"Add Scene","node.action.addFrame":"Add Frame","node.action.addFirstFrame":"Add First Frame","node.action.deleteItem":"Delete","node.action.moveUp":"Move Up","node.action.moveDown":"Move Down","node.action.saveImage":"Save Image","node.action.loadImage":"Load Image","node.action.saveCharacter":"Save Character","node.action.loadCharacter":"Load Character","node.action.readData":"Read Data","node.action.refreshData":"Refresh Data","node.action.stop":"Stop","node.action.stopping":"Stopping...","node.action.embedCharacter":"Embed Character","node.action.downloadFinalPrompts":"Download Prompts","node.action.rename":"Rename","node.action.index":"Index","node.action.improveConcept":"Improve Concept","node.action.improveConceptTooltip":"Enrich and add visual details.","node.action.downloadJson":"Download JSON","node.action.downloadSRT":"Download SRT","node.action.markPrimary":"Mark as Primary","node.input.default":"Input","node.output.default":"Output","node.output.allCharacters":"All Characters","node.output.primaryCharacter":"Primary Character","node.content.action":"Action","node.content.actionPlaceholder":"Action prompt...","node.content.allScriptParts":"All Script Parts","node.content.allScriptAnalyzerData":"Analyzer Data","node.content.allNarratorData":"All Narrator Data","node.content.analyzeCharacters":"Analyze Characters","node.content.analyzeFromScene":"Analyze From:","node.content.analyzeUpToScene":"to","node.content.endPlaceholder":"end","node.content.generateFromFrame":"Generate From Frame:","node.content.generateUpToFrame":"to frame","node.content.analyzeFromFrame":"Finalize From Frame:","node.content.processFromFrame":"Process From Frame:","node.content.processFromScene":"Process From Scene:","node.content.analyzePrompt":"Analyze Prompt","node.content.analyzeScript":"Analyze Script","node.content.analyzing":"Analyzing...","node.content.applyAliases":"Apply Aliases","node.content.applyAliasesTooltip":"Replaces names with aliases (Index).","node.content.character":"Character","node.content.characterIndex":"Index","node.content.characterPlaceholder":"Character prompt...","node.content.character_plural":"characters","node.content.characters":"Characters","node.content.charactersSynced":"Characters Synced","node.content.noCharactersConnected":"No characters connected.","node.content.appearance":"Appearance","node.content.personality":"Personality","node.content.characterType":"Type","node.content.characterTypeShort":"Type","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro (Animals)","node.content.characterType.chibi":"Chibi (Cute)","node.content.characterType.key_item":"Key Item","node.content.style":"Style","node.content.style.none":"None","node.content.style.simple":"Simple","node.content.style.realistic":"Realistic/Cinematic","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistic","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Custom","node.content.chatPlaceholder":"Type a message...","node.content.clothing":"Clothing","node.content.clothingPlaceholder":"Clothing prompt...","node.content.connectedPlaceholder":"Connected","node.content.dataPlaceholder":"Data will appear here...","node.content.readData":"Read Data","node.content.reading":"Reading...","node.content.description":"Description","node.content.sceneDescription":"Scene Description","node.content.duration":"Duration","node.content.enhancePrompt":"Generate Prompt","node.content.enhancedPromptHere":"Enhanced prompt will appear here...","node.content.enhancing":"Enhancing...","node.content.environment":"Environment","node.content.environmentPlaceholder":"Environment prompt...","node.content.environmentPrompt":"Environment & Background","node.content.compositionAndBlocking":"Composition & Action","node.content.executingChain":"Executing Chain...","node.content.imagePrompt":"Image Prompt","node.content.finalPrompt":"Final Prompt","node.content.finalPrompt_plural":"Final Prompts","node.content.fixErrors":"Fix Errors","node.content.fixingErrors":"Fixing...","node.content.frame":"Frame","node.content.frame_plural":"Frames","node.content.frames":"Output Frames","node.content.frames_analyzed":"Frames Analyzed: {count}","node.content.framesPerScene":"Frames per Scene","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Qty","node.content.fullDescription":"Full Description","node.content.generateCharacters":"Generate Characters","node.content.generateEntities":"GENERATE CHARACTERS","node.content.generateFinalPrompts":"Generate Final Prompts","node.content.generatingProgress":"Generating {current} of {total}","node.content.generateImage":"Generate Image","node.content.generateScript":"Generate Script","node.content.generateSpeech":"Generate Speech","node.content.generateText":"Generate Text","node.content.generateSSML":"Generate SSML","node.content.generateStyle":"Generate Style","node.content.generating":"Generating...","node.content.improving":"Improving...","node.content.generatedAudio":"Generated Audio","node.content.imagePromptPlaceholder":"Enter prompt for image...","node.content.modificationPromptPlaceholder":"Modification request...","node.content.narrator":"Narrator","node.content.narratorEnabled":"Enable Narrator","node.content.narratorEnabledInfo":"Adds voiceover text.","node.content.narratorMode":"Narrator Mode","node.content.narratorMode.normal":"Normal / Voiceover","node.content.narratorMode.dual":"Two Narrators","node.content.narratorMode.first_person":"First Person","node.content.role":"Role","node.content.role.narrator":"Narrator","node.content.role.announcer":"Announcer","node.content.role.first_person":"First Person","node.content.role.dual_narrator":"Two Narrators","node.content.role.dual_announcer":"Two Announcers","node.content.scene":"Scene","node.content.scene_plural":"scenes","node.content.scenes":"Scenes","node.content.scenes_generated":"Scenes Generated: {count}","node.content.sceneContext":"Scene Context","node.content.sceneContextPlaceholder":"Mood, environment, light...","node.content.scriptPromptPlaceholder":"Enter story idea...","node.content.seconds":"sec","node.content.stylePlaceholder":"Style prompt...","node.content.stylePromptPlaceholder":"Enter style prompt here...","node.content.styleOverride":"Override Style","node.content.summary":"Summary","node.content.targetLanguage":"Target Language","node.content.textToSynthesize":"Text to synthesize...","node.content.translate":"Translate","node.content.translatePlaceholder":"Text to translate...","node.content.translatedTextPlaceholder":"Translation will appear here...","node.content.translating":"Translating...","node.content.useExistingCharacters":"Use existing characters","node.content.useExistingCharactersInfo":"Uses data from connected characters instead of generating new ones.","node.content.createKeyItem":"Create Secondary/Items","node.content.createSecondaryChars":"Secondary Characters","node.content.createKeyItems":"Key Items","node.content.createKeyItemInfo":"Allows AI to create secondary characters or items.","node.content.noCharacters":"No Characters","node.content.noCharactersInfo":"Focus on events and atmosphere (documentary style).","node.content.videoPrompt":"Dynamics & Motion","node.content.videoPrompts":"Video Prompts","node.content.voice":"Voice","node.content.previewVoice":"Test Voice","node.content.voicePreviewText":"Hello, this is a voice test.","node.content.inputScripts":"Input Scenes","node.content.inputFrames":"Input Frames","node.content.outputScript":"Output Scenes","node.content.requestCategories":"Request Categories","node.content.generateIdea":"Generate Idea","node.content.requestNewCategories":"New Categories","node.content.category.action":"Action","node.content.category.place":"Place","node.content.category.obstacle":"Obstacle","node.content.generatedIdea":"Generated Idea","node.content.storyFormat":"Story Format","node.content.theme":"Theme","node.content.parameters":"Parameters","node.content.advancedMode":"Advanced Mode","node.content.numberOfScenes":"Number of scenes","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Detailed Plot","node.content.detailedPlotInfo":"Enables detailed descriptions.","node.content.includeSubscribeScene":"Subscribe Scene","node.content.includeSubscribeSceneInfo":"Adds a scene asking to subscribe.","node.content.genre":"Genre","node.content.genre2":"Genre 2","node.content.breakIntoParagraphs":"Break Paragraphs","node.content.copyVideoPrompt":"Copy Video Prompt","node.content.generateVideoPrompt":"Generate Video Prompt","node.content.model":"Model","node.content.processWholeScene":"Process Whole Scene","node.content.processWholeSceneInfo":"Processes all frames of a scene at once for consistency.","node.content.batchProcessing":"Batch Processing","node.content.batchProcessingInfo":"Process all selected scenes in one context.","node.content.extendedAnalysis":"Extended Analysis","node.content.extendedAnalysisInfo":"Splits scenes into detailed shots.","node.content.professionalStoryboard":"Director Storyboard","node.content.professionalStoryboardInfo":"Analysis based on cinematographic rules.","node.content.generateStartEndFrames":"Generate Start/End Frames","node.content.autoIndexCharacters":"Auto-index Characters","node.content.autoIndexCharactersInfo":"Automatically replaces names with aliases.","node.content.imageToText":"Image to Text","node.content.extracting":"Extracting...","node.content.extractedText":"Extracted Text","node.content.activePromptStack":"Active Prompt Stack","node.content.noCharactersAnalyzed":"No characters analyzed.","node.content.promptsGeneratedPlaceholder":"Generated prompts will appear here.","node.content.noCharactersInScript":"No characters in script.","node.content.noInputScenes":"No input data. Please connect a Script Generator.","node.content.status":"Status","node.content.status.ready":"Ready","node.content.status.paused":"Paused","node.content.status.generating":"Generating","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Processing: {current} of {total}","node.content.status.time":"Time: {current}s / {total}s","node.content.refreshing":"Refreshing...","node.content.totalFrames":"Total Frames: {count}","node.content.uploadAudio":"Upload Audio/Video","node.content.noAudioLoaded":"No audio","node.content.audioLoaded":"Audio loaded","node.content.transcriptionPlaceholder":"Transcription will appear here...","node.content.transcribe":"Transcribe","node.content.transcribing":"Transcribing...","node.content.convertingVideo":"Converting video...","node.content.recommendedFrames":"Estimated Frames","node.content.shotType":"Shot","node.content.shotType.ws":"WS (Wide)","node.content.shotType.ms":"MS (Medium)","node.content.shotType.cu":"CU (Close-up)","node.content.shotType.ecu":"ECU (Extreme Close-up)","node.content.shotType.ls":"LS (Long Shot)","node.content.characterDetail":"Character Detail","node.content.noCharDesc":"No Character Desc","node.content.includeGeneralCharDesc":"General Visual Desc","node.content.includeFullCharDesc":"Detailed Visual Desc","node.content.safeGeneration":"Safe Generation","node.content.shotFilter":"Shot Filter","node.content.shotFilter.all":"All","node.content.shotFilter.wideOnly":"Wide Only","instruction.desc.shot_filter_all":"Allow all shot types (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restrict to wide shots (WS, MS, LS). No close-ups.","node.content.anthroEnabled":"Anthro Animals","node.content.subscribeEnhancement":"Enhance Subscribe CTA","node.content.thinkingEnabled":"Thinking Mode","node.content.scenelessMode":"Sceneless","instruction.desc.sceneless_mode":"Disable narrative engine. Generate scenes directly from concept.","instruction.sceneless_mode":"Scene List Mode","node.content.microActionBreakdown":"Micro-Actions","node.content.microActionBreakdownInfo":"Decomposes complex actions into phases (Prep, Action, Reaction).","node.content.commercialSafe":"Commercial Safe","instruction.desc.commercial_safe":"Strictly avoids trademarks (Disney, Pixar, etc.) and replaces with generic descriptions.","node.content.findStack":"Find in stack...","node.content.spm_stack.priming":"1. Priming & Context","node.content.spm_stack.physics":"2. Physics & Logic","node.content.spm_stack.hierarchy":"3. Subject Hierarchy","node.content.spm_stack.construction":"4. Construction & Format","node.content.scriptGenerationStack":"SCRIPT GENERATION STACK","node.content.entityGenerationStack":"ENTITY GENERATION STACK","node.content.sg_stack.priming":"PRIMING & CONTEXT","node.content.mainChars":"MAIN","node.content.secChars":"SECONDARY","node.content.keyItems":"ITEMS","node.content.thumbnailPrompt":"Thumbnail Prompt"},n1={"genre.general":"General","genre.comedy":"Comedy","genre.drama":"Drama","genre.action":"Action","genre.scifi":"Sci-Fi","genre.fantasy":"Fantasy","genre.horror":"Horror","genre.thriller":"Thriller","genre.childrens_animation":"Animated cartoons for children","genre.shorts_story":"Short stories for shorts","genre.scientific_historical":"Scientific-Historical Narrative","character_generator.promptPlaceholder":'Enter an idea for characters, e.g., "brave knight, keeper of the ancient forest, who protects a magical sword"',"idea_generator.randomTheme":"Get a random theme","idea_generator.randomCombination":"Random Combination","idea_generator.themePlaceholder":"e.g., Space, Kitchen, Fantasy Forest","idea_generator.initialMessage":'Fill in a theme (optional) and click "{buttonName}" to get started.',"idea_generator.ideaPlaceholder":"The generated idea will appear here...","idea_generator.format.general":"General","idea_generator.format.childrens":"Children's","idea_generator.format.adventure":"Adventure","idea_generator.format.fantasy":"Fantasy / Magic","idea_generator.format.detective":"Detective","idea_generator.format.scifi":"Sci-Fi","idea_generator.format.horror":"Horror","idea_generator.format.historical":"Historical","gender.male":"Male","gender.female":"Female","node.content.autoDownload":"Auto-download upon generation","node.content.downloadSelected":"Download Selected","node.content.intonation":"Intonation","intonation.standard":"Standard","intonation.cheerful":"Cheerful","intonation.angry":"Angry","intonation.sad":"Sad","intonation.excited":"Excited","intonation.announcer":"Announcer","intonation.whispering":"Whispering","node.content.sceneMode":"Scene Mode","node.content.connectNarratorData":"Connect 'All Narrator Data' from a Script Generator.","node.content.sceneModeActive":"Scene Mode is active. Data is received from connection.","speech_synthesizer.mode.simple":"Simple","speech_synthesizer.mode.scene":"Scene","speech_synthesizer.multiSpeaker":"Two Speakers","speech_synthesizer.speaker1Name":"Speaker 1 Name","speech_synthesizer.speaker2Name":"Speaker 2 Name","speech_synthesizer.multiSpeakerHint":'Speaker names must match the names in the text (e.g., "Man: ...", "Woman: ...").',"speech_synthesizer.ssmlHint":"Intonation is controlled by SSML tags in the text.","youtube_analytics.authorName":"Author Name","youtube_analytics.videoTitle":"Video Title","youtube_analytics.views":"Views","youtube_analytics.addToChannel":"Add to Channel","youtube_analytics.noIncomingData":"No incoming data.","youtube_analytics.videoAdded":"Video added!","youtube_analytics.dragDrop":"Drag & Drop Row Screenshot Here","youtube_analytics.thumbnailUpdated":"Thumbnail updated","youtube_analytics.statsTrend":"Stats Trend","youtube_analytics.currentChannel":"Current Channel","youtube_analytics.growth":"Growth","youtube_analytics.allChannels":"All Channels","youtube_analytics.saveDisk":"Save to Disk","youtube_analytics.saveCatalog":"Save to Catalog","youtube_analytics.loadDisk":"Load from Disk","youtube_analytics.analyzing":"Analyzing...","youtube_analytics.askAI":"Ask AI for Advice","youtube_analytics.clickForAdvice":'Click "Ask AI" to get advice.',"youtube_analytics.dailyNotes":"Daily Notes","youtube_analytics.logDailyStats":"Log Daily Stats","youtube_analytics.subscribers":"Subscribers","youtube_analytics.totalViews":"Total Views","youtube_analytics.updateStats":"Update Stats","youtube_analytics.history":"History","youtube_analytics.noHistory":"No history yet.","youtube_analytics.noNotes":"No notes yet.","youtube_analytics.noVideos":"No videos yet.","youtube_analytics.loadedFromDisk":"Loaded from disk","youtube_analytics.loadFailed":"Failed to load file","youtube_analytics.savedToDisk":"Saved to disk","youtube_title_generator.mode.title":"Video Title","youtube_title_generator.mode.channel":"Channel Info","youtube_title_generator.ideaPlaceholder":"Enter video idea or topic...","youtube_title_generator.channelIdeaPlaceholder":"Enter channel theme or niche...","youtube_title_generator.title":"Title","youtube_title_generator.description":"Description","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Channel Name","youtube_title_generator.channelDescription":"Channel Description","youtube_title_generator.channelKeywords":"Keywords","youtube_title_generator.channelHandle":"Handle","music_idea_generator.mode.lyrics":"Lyrics","music_idea_generator.mode.music_prompt":"Music Prompt","music_idea_generator.ideaPlaceholder":"Enter song theme or mood...","music_idea_generator.songTitle":"Song Title","music_idea_generator.songTitlePlaceholder":"Title...","music_idea_generator.lyricsPlaceholder":"Lyrics will appear here...","music_idea_generator.musicPromptPlaceholder":"AI Music Prompt will appear here...","chat.mode.general":"General","chat.mode.script":"Script Expert","chat.mode.prompt":"Prompt Expert","chat.mode.youtube":"YouTube Expert"},o1={"catalog.title":"Catalog","catalog.tabs.groups":"Groups","catalog.tabs.library":"Prompt Library","catalog.tabs.characters":"Characters","catalog.tabs.scripts":"Scripts","catalog.tabs.analysis":"Analysis","catalog.tabs.final_prompts":"Final Prompts","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Music Ideas","catalog.empty.title":"Catalog is empty","catalog.empty.description":"Save an item to see it here, or import one from a file.","catalog.loadFromFile":"Add to Catalog from File","catalog.card.addToCanvas":"Add to Canvas","catalog.card.rename":"Rename","catalog.card.save":"Save to Disk","catalog.card.delete":"Delete","library.loadFromFile":"Load from File","library.empty.title":"Folder is empty","library.empty.description":"Create a new folder or prompt to get started.","library.emptyPrompt":"No content","library.actions.newFolder":"New Folder","library.actions.newPrompt":"New Prompt","library.actions.copy":"Copy to Clipboard","library.actions.edit":"Edit Prompt","group.rename":"Rename Group","group.saveToCatalog":"Save to Catalog","group.saveToDisk":"Save to Disk","group.ungroup":"Ungroup (Shift+Click to delete content)","group.button.create":"Group ({count})"},r1={"dialog.rename.title":"Rename Item","dialog.rename.group.title":"Rename Group","dialog.rename.catalog.title":"Rename Catalog Item","dialog.rename.label":"New name","dialog.rename.confirm":"Rename","dialog.rename.cancel":"Cancel","dialog.promptEdit.title":"Edit Prompt","dialog.promptEdit.nameLabel":"Prompt Name","dialog.promptEdit.contentLabel":"Prompt Content","dialog.promptEdit.confirm":"Save","dialog.promptEdit.cancel":"Cancel","dialog.reset.title":"Reset Canvas","dialog.reset.message":"Are you sure you want to reset the canvas to its default state? This will clear all current work and restore the initial template.","dialog.exit.title":"Close Project?","dialog.exit.message":"Are you sure? All unsaved data will be lost, and you will return to the welcome screen.","dialog.settings.title":"Settings","dialog.settings.apiKeyLabel":"Gemini API Key","dialog.settings.apiKeyPlaceholder":"Enter your API key here","dialog.settings.getApiKeyLink":"Get your API key from Google AI Studio","dialog.settings.useFreeKey":"Use the free (limited) API key","dialog.settings.save":"Save","dialog.settings.close":"Close","dialog.apiKey.title":"API Key Settings","dialog.apiKey.description":"To use this application, you need a Gemini API key. Please enter your key below. It will be stored locally in your browser.","dialog.apiKey.keyExists":"An API key is already saved in your browser.","dialog.apiKey.clear":"Clear Saved Key","dialog.apiKey.save":"Save Key","dialog.apiKey.update":"Update Key","dialog.apiKey.useFreeKey":"Use free key (for development)","dialog.permission.title":"Clipboard Access","dialog.permission.description":'This application requests access to your clipboard to enable the "Paste" functionality in nodes. We will only read from your clipboard when you explicitly use this feature.',"dialog.permission.decline":"Decline","dialog.permission.allow":"Allow","alert.groupSaved":'Group "{groupTitle}" saved to catalog!',"toast.groupSavedToDisk":'Group "{groupTitle}" saved to disk!',"alert.confirmDelete":"Are you sure you want to delete this item from the catalog?","alert.invalidCatalogFile":"Invalid or corrupted catalog item file.","alert.loadCatalogFailed":"Failed to load catalog item","alert.confirmLoadProject":"Loading a project will replace all current data (tabs, catalog, settings). Are you sure?","dialog.confirmDelete.title":"Confirm Deletion","dialog.confirmDelete.message":'Are you sure you want to delete "{itemName}"? This action cannot be undone.',"dialog.confirmDelete.folderMessage":'Are you sure you want to delete the folder "{itemName}" and all its contents? This action cannot be undone.',"dialog.confirmDelete.confirm":"Delete","dialog.confirmDelete.cancel":"Cancel","dialog.confirmClear.title":"Confirm Clear Canvas","dialog.confirmClear.message":"Are you sure you want to delete everything on the canvas? This action cannot be undone.","toast.copied":"Copied to clipboard","toast.pasted":"Pasted!","toast.cleared":"Cleared","toast.resetComplete":"Reset to default","toast.projectSaved":"Project saved to disk","toast.saveFailed":"Failed to save project","toast.connectionsCut":"Connections cut","toast.charSaved":"Character saved to disk","toast.charLoaded":"Character loaded","toast.videoPasted":"Video added from clipboard","toast.savedToCatalog":"Saved to Catalog","toast.apiKeySaved":"API Key saved successfully","toast.apiKeyCleared":"API Key cleared","toast.projectLoaded":"Project loaded successfully","alert.batchMismatch":"Warning: Scene {scene} frame count mismatch (Expected: {expected}, Got: {got}). Mapping best effort."},a1={"instruction.desc.safe_gen":"CRITICAL SAFETY CONSTRAINT: Strictly avoid any words that trigger AI safety filters. Replace terms like 'teenager', 'intimate', or 'revealing' with artistic alternatives like 'young person', 'artistic composition', or 'stylized'.","instruction.desc.layered_no_style":"Structure: 1. [Global Background] -> 2. [Subject Visuals] + [FULL POSE & ACTION] -> 3. [Camera]. You MUST describe the physical body geometry and movement."},i1={"instruction.sg_inputs":"Input Data","instruction.desc.sg_inputs":"Source: Concept/Idea, Character Profiles.","instruction.core_director":"VFX Supervisor","instruction.desc.core_director":"You are a VFX Supervisor. Describe raw footage, lighting, and physics, NOT literary feelings.","instruction.sg_thinking":"Visual Logic","instruction.desc.sg_thinking":"Visualize the set physics before writing. Where is the light coming from?","instruction.sg_improve_input":"The Sacred Prompt","instruction.desc.sg_improve_input":"The input prompt is SACRED. Do not discard ANY detail. Keep every smell, item, and color, then expand around it.","instruction.sg_anti_compression":"Anti-Compression","instruction.desc.sg_anti_compression":'ZERO OMISSION POLICY. Forbidden to summarize. Output text must be LONGER than input. If input says "cinnamon", output must have "cinnamon".',"instruction.sg_exposition":"Atmospheric Entry","instruction.desc.sg_exposition":"MANDATORY: Start every scene with 2-3 sentences establishing the location/mood BEFORE the character appears.","instruction.sg_delayed_reveal":"Cinematic Reveal","instruction.desc.sg_delayed_reveal":'Do not show the face immediately. Use "view from behind", "through objects", or "establishing shots" first.',"instruction.sg_metaphor":"Visual Proxies","instruction.desc.sg_metaphor":"Use visual symbols (broken objects, weather) to convey internal character states.","instruction.sg_pacing":"Action Atomization","instruction.desc.sg_pacing":"Break down every verb into 3-5 physical micro-movements.","instruction.sg_subtext":"Subtext","instruction.desc.sg_subtext":"Create tension between dialogue and action. Characters should rarely speak the truth directly.","instruction.desc.sg_frame_estimation":"Dynamic analysis: 5-9 frames (Low), 10-15 (Mid), 16-25 (High). Count visual beats.","instruction.rule_visuals":"Physics Only","instruction.desc.rule_visuals":"Show, Don't Tell. Describe physical actions and environmental changes.","instruction.sg_visual_dna":"Visual DNA","instruction.desc.sg_visual_dna":"Comprehensive description of lighting, color palette, and atmosphere.","instruction.rule_flow":"Seamless Flow","instruction.desc.rule_flow":"Ensure logical continuity between scenes.","instruction.rule_atmosphere":"Atmosphere","instruction.desc.rule_atmosphere":"Describe tactile details. PRESERVE specific smells and sounds from input by converting them to visual cues.","instruction.sg_visual_style":"Visual Style","instruction.desc.sg_visual_style":"Request: Generate a detailed visual style description based on '{style}'.","instruction.char_detailed_style":"Stylized Detail","instruction.desc.char_detailed_style":"Integrates the global visual style into each character's technical generation prompt for maximum visual consistency.","instruction.sg_genre":"Genre Context","instruction.desc.sg_genre":"Context: {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"AI chooses: Full Body for Characters / Frame-Fill for Objects.","instruction.char_no_dupes":"No Duplicates","instruction.desc.char_no_dupes":"CRITICAL: Do NOT re-generate characters unless a COSTUME CHANGE is required. In that case, create a duplicate with the new outfit.","instruction.create_secondary_chars":"Secondary Characters","instruction.desc.create_secondary_chars":"You MAY generate new secondary characters if the plot requires it. Costume changes are allowed.","instruction.create_key_items":"Key Items","instruction.desc.create_key_items":"Mandatory creation of 'Character Cards' for items appearing in >2 frames or multiple scenes.","instruction.char_secondary_ok":"New Chars Allowed","instruction.desc.char_secondary_ok":"You MAY generate new secondary characters or key items. IF OUTFIT CHANGE: Create a new card for the main character with the new clothing prompt.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Characters must be Anthropomorphic animals.","instruction.sg_no_chars":"No Characters","instruction.desc.sg_no_chars":"Documentary style / No named characters.","instruction.sg_detailed_plot":"Detailed Plot","instruction.desc.sg_detailed_plot":"Provide highly detailed descriptions of actions and plot.","instruction.sg_subscribe":"Subscribe Scene","instruction.desc.sg_subscribe":"Include a 4th-wall breaking subscribe scene.","instruction.char_gray_bg":"Visual Concept","instruction.desc.char_gray_bg":"For every character visual prompt, ALWAYS append: ', full body character concept on a gray background'.","instruction.char_no_new":"No New Chars","instruction.desc.char_no_new":"Do NOT create any new characters or items. Use ONLY the provided Existing Characters.","instruction.sg_new_chars":"New Characters","instruction.desc.sg_new_chars":"Generate new characters based on prompt.","instruction.sg_living_world":"Living World","instruction.desc.sg_living_world_simple":"Background extras are normal people.","instruction.desc.sg_living_world_anthro":"Background extras are animals.","instruction.sg_simple_actions":"Simple Actions","instruction.desc.sg_simple_actions":"Avoid complex physics/gymnastics. Prefer stable, renderable poses.","instruction.commercial_safe":"Commercial Safe","instruction.desc.commercial_safe":"Strictly avoids known trademarks, brands (Disney, Pixar, etc.), and copyrighted character names."},s1={"instruction.ana_role":"Analyzer Role","instruction.desc.ana_role":"You are a world-class Film Director and Cinematographer. You write instructions for AI generation. Each frame must be described repeatedly and in detail, independently of the previous one, while maintaining the context of previous frames. Do not use literary abbreviations or devices.","instruction.ana_cinema":"Cinematography","instruction.desc.ana_cinema":"Professional terms: Wide Shot, Close-up, Dutch Angle, Bokeh for framing and lighting.","instruction.ana_cinema_wide":"Cinematography (Wide)","instruction.desc.ana_cinema_wide":"Professional terms: Wide Shot, Long Shot. NO Close-ups.","instruction.ana_anthro_logic":"Anthro Logic","instruction.desc.ana_anthro_logic":'Explicitly describe characters as Anthropomorphic Animals (e.g., "Anthropomorphic Fox") in every frame description.',"instruction.ana_subscribe_logic":"Subscribe CTA","instruction.desc.ana_subscribe_logic":"If the scene asks to Subscribe, add visual actions: characters holding signs or interacting with 3D text.","instruction.rule_hierarchy":"Master Framing Algorithm","instruction.desc.rule_hierarchy":"Strict order: 1. Global Context. 2. Full Character Posture & Active Interaction (e.g. dragging). 3. Detail. Describe the full action even if partly out of frame.","instruction.rule_living_world":"Living World","instruction.desc.rule_living_world":"If public place, describe background extras/silhouettes consistent with the world context.","instruction.desc.rule_living_world_anthro":"Background extras/crowds must be Anthropomorphic Animals (NOT humans).","instruction.rule_persistence":"Persistence","instruction.desc.rule_persistence":"SCENE-WIDE CHRONOLOGICAL PERSISTENCE: Maintain a persistent global state for the entire scene. Every frame is part of a single physical space. Track the exact position, pose, and status of every character and object, even when they are off-camera. If Character A is in Frame 1 but the camera cuts to Character B in Frame 2, Character A must still exist logically in their last position. If an object is moved, it stays moved. Ensure total continuity across the sequence.","instruction.rule_mandatory_bg":"Set Design Manifesto","instruction.desc.rule_mandatory_bg":"MANDATORY: Describe the PHYSICAL SET, not just a 'background'. 1. Location (In/Out). 2. Furniture (Color, Material, Position). 3. Lighting (Warm/Cold) & Palette. This context is fixed and applies to all frames.","instruction.desc.rule_mandatory_bg_wide":"FORBIDDEN to leave background empty. Since you are using WIDE SHOTS only, you must provide comprehensive geography, horizon, and weather details in every frame.","instruction.shot_filter_wide":"Wide Shots Only","instruction.desc.shot_filter_wide":"STRICT FILTER: Use ONLY Wide, Long, and Medium shots. Close-ups (CU/ECU) are forbidden.","instruction.storyboard_rules":"Shot Variety","instruction.desc.storyboard_rules":"Alternate between WS/LS (Wide), MS (Medium), and CU/ECU (Close-up) shots for dynamic pacing and emotional focus.","instruction.storyboard_rules_wide":"Shot Variety (Wide Only)","instruction.desc.storyboard_rules_wide":"Use only Wide, Long, and Establishing shots. Vary the angle (Low/High/Aerial). NO Close-ups.","instruction.tech_directives":"Camera Control","instruction.desc.tech_directives":"Strict technical terminology. For shot types use ONLY abbreviations (WS, MS, CU).","instruction.tech_directives_wide":"Camera Control (Wide)","instruction.desc.tech_directives_wide":"Strict technical terminology. Use ONLY abbreviations (WS, MS, LS). NO CU/ECU.","instruction.use_aliases":"Use Aliases","instruction.desc.use_aliases":"Use Entity-N format (Strictly English). Rest of text in target language.","instruction.character_array_integrity":"Array Integrity","instruction.desc.character_array_integrity":"CRITICAL: The `characters` array MUST include every Entity-N mentioned in the prompt text.","instruction.action_phase_breakdown":"Micro-Actions","instruction.desc.action_phase_breakdown":"Decompose complex actions into preparation, initiation, apex, and reaction phases.","instruction.desc.action_phase_breakdown_wide":"Decompose phases, but KEEP CAMERA WIDE. Show impact via full-body posture, not zoom.","instruction.batch_processing":"Batch Processing","instruction.desc.batch_processing":"Analyze all provided scenes as a continuous sequence to maintain narrative and visual consistency.","instruction.ana_prompt_lang":"Prompt Language","instruction.desc.ana_prompt_lang":"Image and video prompts are strictly in English for best model compatibility.","instruction.extended_visuals":"Extended Visual Breakdown","instruction.desc.extended_visuals":"Decomposes scenes into short, expressive sequences (Wide, MS, CU, Detail). Focuses on cinematic rhythm, vibrant emotions, dynamic composition, and sincere energy.","instruction.extended_visuals_wide":"Extended Visual Breakdown (Wide)","instruction.desc.extended_visuals_wide":"Decomposes scenes into sequences using strictly Wide/Medium shots. Focuses on geography, group dynamics, and atmosphere. No Close-ups.","instruction.desc.target_lang":"Frame analysis and descriptions will be generated in this language.","instruction.rule_isolation":"Zero Context","instruction.desc.rule_isolation":"CRITICAL: The image generator DOES NOT know about the previous frame. You MUST re-describe the environment and weather in every single frame.","instruction.sensory_saturation":"Anti-Brevity","instruction.desc.sensory_saturation":'FORBIDDEN to be brief. Instead of "Hands gripping", write "Dirty hands with white knuckles tightly gripping the cold glass".',"instruction.ana_no_pov":"No POV","instruction.desc.ana_no_pov":'CRITICAL NEGATIVE: STRICT BAN on "POV" or "First-Person" shots. The camera MUST be external (Over-the-shoulder, Wide, etc.).',"instruction.desc.static_frame_logic":'STRICT BAN on movement verbs ("walking", "swaying"). Describe a FROZEN moment. "Foam frozen in air", "Leaves angled by wind".',"instruction.desc.anatomical_posing":'Describe body GEOMETRY. Instead of "resting", write: "Lying supine, arms at sides, head tilted back".',"instruction.desc.motion_dynamics":"SEPARATION: Image Prompt = 100% Static. Video Prompt = Movement & Time (breathing, waves, wind).","instruction.desc.anatomical_strictness":'RIGGING: Prevents "Arms behind head AND holding drink". Forces separate description: Left Arm [state], Right Arm [state]. Eliminates extra limbs.',"instruction.desc.prop_consistency":'OBJECT LOCK: Forbidden to use generic nouns ("sword", "phone"). Must specify visual attributes ("rusted iron sword", "cracked black phone") and repeat them.',"instruction.desc.subject_hierarchy":'INVISIBLE CONTEXT: If showing a Close-up of feet, you MUST describe: "Feet of Character-A WHO IS DRAGGING Character-B". Link the part to the whole action.',"instruction.inputs_data":"Inputs","instruction.desc.inputs_data":"Source Data: Script Summary, Character Profiles, Scene Texts.","instruction.static_frame_logic":"Strict Static","instruction.anatomical_posing":"Anatomical Posing","instruction.anatomical_strictness":"Anatomy Logic","instruction.prop_consistency":"Object Specificity","instruction.subject_hierarchy":"Context Anchoring","instruction.motion_dynamics":"Motion Dynamics"},l1={"instruction.inputs":"Inputs","instruction.desc.inputs":"Source Data: Script Frames, Character Visuals, Scene Style, Global Scene Context.","instruction.role":"Role: Lead Environment Artist","instruction.desc.role":"You are an expert Lead Environment Artist and AI Prompt Engineer. Synthesize inputs into a definitive visual description.","instruction.layered":"Algorithm: Unified Flow","instruction.desc.layered":"Generates a SINGLE seamless block. Structure: [Style] -> [MASTER SET DESIGN FROM CONTEXT] -> [Visuals] + [POSE & ACTION] -> [Camera].","instruction.desc.layered_no_char":"Structure: [MASTER SET DESIGN] -> [Index] + [FULL POSE & ACTION]. Omits appearance but explicitly describes body geometry/movement.","instruction.visuals":"Style: Saturation","instruction.desc.visuals":"Use rich visual descriptors: volumetric lighting, chiaroscuro, 8k textures, depth of field.","instruction.process_whole_scene":"Batch Scene","instruction.desc.process_whole_scene":"Analyze entire scene at once for consistency.","instruction.video":"Video","instruction.desc.video":"Video Prompt: [Index] (Detailed Visual Desc) [Action] in one block. Dynamics: [Env Motion]. Camera: [Movements]. NO NAMES.","instruction.stateless":"Rule: Stateless","instruction.desc.stateless":'Treat every frame as independent. MANDATORY: Fully redescribe action of EVERY character from scratch (Posture -> Limbs -> Face). No abbreviations like "same pose".',"instruction.rule_static":"Rule: Static","instruction.desc.rule_static":"Describe only the frozen moment. No narrative transitions.","instruction.atmosphere_fix":"Atmospheric Anchor","instruction.desc.atmosphere_fix":"Describe mood as physical properties of air and light.","instruction.subject_focus":"Context Hierarchy","instruction.desc.subject_focus":"CRITICAL: Even for Close-ups, describe 1. Full Character + ACTIVE INTERACTION (e.g. dragging). 2. Pose. 3. Detail. The AI needs the full context to render parts correctly.","instruction.always_env":"MANDATORY SET DESIGN","instruction.desc.always_env":"CRITICAL: Use the provided 'Global Scene Context' as the ABSOLUTE TRUTH for the background. You MUST inject the specific furniture, lighting, and textures from the context into the environment layer of EVERY prompt. Do not hallucinate generic backgrounds.","instruction.pm_anthro":"Anthro Detail","instruction.desc.pm_anthro":'MANDATORY: Word "anthropomorphic" before species in both Image AND Video. Enhanced textures/anatomy.',"instruction.pm_subscribe":"Legible Text","instruction.desc.pm_subscribe":'Ensure text like "SUBSCRIBE" is legible and integrated (neon, signs, 3D) in the final image prompt.',"instruction.strict_char_index":"Characters","instruction.desc.strict_char_index":"Strictly map character Aliases (Character-N) to each frame data.","instruction.no_names":"CRITICAL: NO NAMES","instruction.desc.no_names":"CRITICAL: Names banned. Use [Entity-N]. Tag inside brackets MUST be in English (e.g., [Entity-1]), do not translate it.","instruction.general_char_desc":"General Detail","instruction.desc.general_char_desc":"Summarize and incorporate a CONCISE, GENERAL version of the visual prompt from the character's profile.","instruction.full_char_desc":"Full Detail","instruction.desc.full_char_desc":"Incorporate the FULL and DETAILED visual prompt from the character's profile exactly as written.","instruction.formatting":"Formatting","instruction.desc.formatting":"Enables explicit HEADERS (Environment, Interaction, Technical) and line breaks. Use this if you want structure instead of a flat text block.","instruction.anatomical_strictness":"Anatomy Logic","instruction.desc.anatomical_strictness":'RIGGING: Prevents "Arms behind head AND holding drink". Forces separate description: Left Arm [state], Right Arm [state]. Eliminates extra limbs.',"instruction.img_vid_consistency":"Img->Vid Flow","instruction.desc.img_vid_consistency":"Image Prompt = Setup/Start Frame (Static). Video Prompt = Action/Movement (Evolution). Ensures video evolves naturally from the static image.","instruction.desc.prop_enhancement":'MATERIALITY: Amplifies object descriptions from input (e.g. "red board" -> "glossy red fiberglass"). Preserves specified colors/types.',"instruction.no_pov":"CRITICAL: NO POV","instruction.desc.no_pov":'STRICT BAN on First Person/POV angles. Camera MUST be external (Third Person). No "through eyes" or "view from".'},c1={"instruction.music_role":"Music Producer Role","instruction.desc.music_role":"Expert Composer and Lyricist role definition.","instruction.music_input":"Input Data","instruction.desc.music_input":"The theme or idea provided by the user.","instruction.music_creative":"Creative Freedom","instruction.desc.music_creative":"Forces AI to interpret vibe metaphorically, not literally. Prevents generic outputs.","instruction.music_lyrics":"Lyrics Structure","instruction.desc.music_lyrics":"Generates Verse/Chorus structure fitting the genre.","instruction.music_verse_count":"Verse Count","instruction.desc.music_verse_count":"Strictly controls the number of verses generated.","instruction.music_prompt_rule":"AI Music Prompt","instruction.desc.music_prompt_rule":"Technical tags for Suno/Udio (BPM, Instruments, Vocals). Max 1000 chars.","instruction.music_format":"JSON Output","instruction.desc.music_format":"Strict JSON structure for integration."},d1={"instruction.yt_role":"YouTube Strategist","instruction.desc.yt_role":"Expert in SEO, CTR, and Viral Psychology.","instruction.yt_input":"Input Data","instruction.desc.yt_input":"The topic or niche provided.","instruction.yt_title_mode":"Video Metadata","instruction.desc.yt_title_mode":"Optimizes Titles/Desc/Tags for maximum clicks.","instruction.yt_channel_mode":"Channel Branding","instruction.desc.yt_channel_mode":"Creates consistent Name, Bio, and Handle.","instruction.yt_format":"JSON Output","instruction.desc.yt_format":"Strict JSON structure for integration.","instruction.yt_hashtags":"Embed Hashtags","instruction.desc.yt_hashtags":"Appends #hashtags to the description field.","instruction.yt_thumbnail":"Thumbnail Prompt","instruction.desc.yt_thumbnail":"Generates a visual description for a click-worthy cover image."},u1={"instruction.narrator_role_story":"Storyteller Role","instruction.desc.narrator_role_story":"Engaging, descriptive tone for narratives.","instruction.narrator_role_news":"Announcer Role","instruction.desc.narrator_role_news":"Punchy, authoritative tone for broadcasts.","instruction.narrator_role_fps":"First Person Role","instruction.desc.narrator_role_fps":"Internal monologue and subjective reaction.","instruction.narrator_input":"Input Data","instruction.desc.narrator_input":"The raw text or scene description provided.","instruction.narrator_ssml":"SSML Tags","instruction.desc.narrator_ssml":"Adds breath, pauses, and emphasis tags for TTS.","instruction.narrator_format":"JSON Output","instruction.desc.narrator_format":"Strict JSON structure with language keys."},p1={...a1,...i1,...s1,...l1,...c1,...d1,...u1},h1={...Q2,...e1,...t1,...n1,...o1,...r1,...p1},m1={"app.title":" ","app.description":" ,         Gemini API.","app.slogan":" ,   ","app.subtitle":"  ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.quotaExceeded":"   . ,    API-    .","error.apiKeyMissing":"API   . ,   API  Gemini  .","error.freeKeyNotAvailable":"/ API     . ,    .","error.fileReadError":"  .","error.videoConversionError":"     .","error.unsupportedFile":"  .","error.promptModifierFile":"     (Prompt Modifier). ,     .","error.invalidFileType":"  . ,      Script Modifier.","welcome.iAmDeveloper":" ","welcome.letsGo":"!","welcome.resume":"","welcome.reload":"","welcome.reloadTitle":"  ?","welcome.reloadMessage":"      .    .  ?","welcome.confirmReload":"  ","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"  ","dialog.welcome.intro1":"   Script Modifier          Gemini.","dialog.welcome.intro2":"       API  Gemini.","dialog.welcome.apiKeyExplanation":" API     .        ,  Google Gemini API."},g1={"toolbar.edit":" (V)","toolbar.cutter":" (C)","toolbar.selection":" (S)","toolbar.reroute":"  (R)","toolbar.zoom":" (Z)","toolbar.snapToGrid":"   (Shift+W)","toolbar.resetZoom":" ","toolbar.lineStyleSpaghetti":"- (Shift+E)","toolbar.lineStyleOrthogonal":"  (Shift+E)","toolbar.addNode":"  (F)","toolbar.catalog":" (Ctrl+)","toolbar.settings":"","toolbar.resetToDefault":"  ","toolbar.closeProject":"  / ","toolbar.enterFullscreen":"  ","toolbar.exitFullscreen":"   ","toolbar.home":"","toolbar.addTextInput":"  (T)","toolbar.addPromptAnalyzer":"  (A)","toolbar.addCharacterAnalyzer":" ","toolbar.addCharacterGenerator":"  (Shift+C)","toolbar.addImageGenerator":"  (O)","toolbar.addImagePreview":"  (I)","toolbar.addCharacterCard":"  (Ctrl+Shift+C)","toolbar.addPromptProcessor":"  (P)","toolbar.addGeminiChat":"  Gemini (M)","toolbar.addTranslator":" (L)","toolbar.addIdeaGenerator":"  (Shift+A)","toolbar.addScriptGenerator":"  (Shift+S)","toolbar.addScriptAnalyzer":"  (Shift+D)","toolbar.addScriptPromptModifier":"  (Shift+F)","toolbar.addErrorAnalyzer":" ","toolbar.addNote":" (N)","toolbar.addDataReader":"  (Shift+R)","toolbar.addSpeechSynthesizer":"  (Shift+N)","toolbar.addNarratorTextGenerator":"   (Shift+G)","toolbar.addAudioTranscriber":"  (Shift+B)","toolbar.addYouTubeTitleGenerator":"  YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"   (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube  (Shift+Y)","toolbar.saveCanvas":"  (Ctrl+S)","toolbar.saveProject":"  (Ctrl+Shift+S)","toolbar.loadCanvas":"  (Ctrl+O)","toolbar.clearCanvas":" ","toolbar.group.general":"","toolbar.group.scripting":"","toolbar.group.prompting":"  ","toolbar.group.characters":"","toolbar.group.ai":" ","toolbar.group.file":"","toolbar.group.images":"","toolbar.group.audio":"","toolbar.group.youtube":"YouTube","toolbar.group.canvas":" ","toolbar.expand":" ","toolbar.collapse":" ","toolbar.toggleHeaders":" ","hotkeys.file.title":"","hotkeys.file.save":"  (Ctrl+S)","hotkeys.file.saveProject":"  (Ctrl+Shift+S)","hotkeys.file.load":"  (Ctrl+O)","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":" ","hotkeys.tools.zoom":"","hotkeys.tools.group":" (G)","hotkeys.tools.deleteGroup":"   ","hotkeys.tools.closeNode":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.snapToGrid":"  ","hotkeys.tools.selectAll":"  ","hotkeys.tools.deselectAll":" ","hotkeys.tools.duplicate":"  ","hotkeys.windows.title":"","hotkeys.windows.search":"  (F)","hotkeys.windows.quickAdd":"  ()","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","hotkeys.hide":"  ","hotkeys.show":"  ","help.title":"  -  ","search.placeholder":" ...","search.noResults":"  .","search.node.text_input.title":" ","search.node.text_input.description":"     . (T)","search.node.prompt_processor.title":" ","search.node.prompt_processor.description":"      . (P)","search.node.prompt_analyzer.title":" ","search.node.prompt_analyzer.description":"     . (A)","search.node.character_analyzer.title":" ","search.node.character_analyzer.description":"     .","search.node.character_generator.title":" ","search.node.character_generator.description":"    . (Shift+C)","search.node.image_generator.title":" ","search.node.image_generator.description":"    . (O)","search.node.image_preview.title":" ","search.node.image_preview.description":"   . (I)","search.node.character_card.title":" ","search.node.character_card.description":" ,    . (Ctrl+Shift+C)","search.node.gemini_chat.title":"  Gemini","search.node.gemini_chat.description":"   Gemini AI. (M)","search.node.translator.title":"","search.node.translator.description":"     .       .","search.node.script_generator.title":" ","search.node.script_generator.description":"     . (Shift+S)","search.node.script_analyzer.title":" ","search.node.script_analyzer.description":"       . (Shift+D)","search.node.script_prompt_modifier.title":" ","search.node.script_prompt_modifier.description":"    (, , )     , ,     ,     .","search.node.error_analyzer.title":" ","search.node.error_analyzer.description":"         .        .","search.node.note.title":"","search.node.note.description":"    . (N)","search.node.reroute_dot.title":" ","search.node.reroute_dot.description":"     .","search.node.data_reader.title":" ","search.node.data_reader.description":"      .       .","search.node.speech_synthesizer.title":" ","search.node.speech_synthesizer.description":"       .       .","search.node.idea_generator.title":" ","search.node.idea_generator.description":"   .     (, , ). ,   ,        .","search.node.narrator_text_generator.title":"  ","search.node.narrator_text_generator.description":"            .","search.node.audio_transcriber.title":" ","search.node.audio_transcriber.description":" -           Gemini API.","search.node.youtube_title_generator.title":"  YouTube","search.node.youtube_title_generator.description":"  ,      YouTube         .","search.node.music_idea_generator.title":"  ","search.node.music_idea_generator.description":"        .","search.node.youtube_analytics":"YouTube ","search.node.image_editor.title":" ","search.node.image_editor.description":"     (Inpainting, Outpainting).","search.group.input":"","search.group.process":"  ","search.group.scripting":"","search.group.character":"","search.group.images":"","search.group.ai":" ","search.group.file":"","search.group.audio":"","search.group.youtube":"YouTube","search.group.canvas":" ","contextMenu.tools":"","contextMenu.assignSlot":"  {index}","contextMenu.addNodeFromSlot":" {node} ({index})","connectionMenu.title":" ","quickAddMenu.title":" ","contextMenu.paste":" (Ctrl+V)","node.content.simpleActions":" ","node.content.smartConcept":"-","tooltip.model.flash":"Gemini Flash: , ,  .","tooltip.model.pro":"Gemini Pro:  ,  , .","tooltip.lang.ru":"   .","tooltip.lang.en":"   .","tooltip.lang.es":"   .","tooltip.lang.de":"   .","tooltip.lang.uz":"   .","tooltip.lang.fr":"   .","tooltip.lang.it":"   .","tooltip.lang.pt":"   .","tooltip.lang.zh":"   .","node.action.locateInStack":"  ","help.tabs.hotkeys":"   ","help.tabs.links":"   ","help.category.socials":" ","help.category.stable":"Google AI Studio (Stable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"GitHub ","help.category.gh_pages":"  GitHub","help.link.youtube":"YouTube ","help.link.telegram_channel":"Telegram ","help.link.telegram_chat":"Telegram ","help.sub.news":"  ","help.sub.discussion":"","help.sub.stable":" ","help.sub.alpha":" ","imageViewer.title":" ","languages.ru":"","languages.en":"","languages.es":"","languages.fr":"","languages.de":"","languages.it":"","languages.pt":"","languages.zh":"","languages.ja":"","languages.ko":"","languages.uz":""},f1={"node.title.text_input":" ","node.title.prompt_processor":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.image_generator":" ","node.title.image_preview":" ","node.title.character_card":" ","node.title.gemini_chat":"  Gemini","node.title.translator":"","node.title.script_generator":" ","node.title.script_analyzer":" ","node.title.script_prompt_modifier":" ","node.title.error_analyzer":" ","node.title.note":"","node.title.reroute_dot":" ","node.title.data_reader":" ","node.title.speech_synthesizer":" ","node.title.idea_generator":" ","node.title.narrator_text_generator":"  ","node.title.audio_transcriber":" ","node.title.youtube_title_generator":"  YouTube","node.title.music_idea_generator":"  ","node.title.youtube_analytics":"YouTube ","node.title.image_editor":" ","node.help.text_input":"     . (T)","node.help.prompt_processor":"      . (P)","node.help.prompt_analyzer":"     . (A)","node.help.character_analyzer":"     .","node.help.character_generator":"    . (Shift+C)","node.help.image_generator":"    . (O)","node.help.image_preview":"   . (I)","node.help.character_card":" ,    . (Ctrl+Shift+C)","node.help.gemini_chat":"   Gemini AI. (M)","node.help.translator":"     .       .","node.help.script_generator":"     . (Shift+S)","node.help.script_analyzer":"       . (Shift+D)","node.help.script_prompt_modifier":"    (, , )     , ,     ,     .","node.help.error_analyzer":"         .        .","node.help.note":"    . (N)","node.help.reroute_dot":"     .","node.help.data_reader":"      .       .","node.help.speech_synthesizer":"       .       .","node.help.idea_generator":"   .     (, , ). ,   ,        .","node.help.narrator_text_generator":"            .","node.help.audio_transcriber":" -           Gemini API.","node.help.youtube_title_generator":"  ,      YouTube         .","node.help.music_idea_generator":"        .","node.help.youtube_analytics":"       .","node.help.image_editor":"     (Inpainting, Outpainting).","node.action.help":"","node.action.expand":"","node.action.collapse":" (H)","node.action.expandAll":" ","node.action.collapseAll":" ","node.action.expandAllScenes":"  ","node.action.collapseAllScenes":"  ","node.action.expandAllFrames":"  ","node.action.collapseAllFrames":"  ","node.action.expandPanel":" ","node.action.collapsePanel":" ","node.action.togglePanel":" ","node.action.collapseScene":" ","node.action.expandScene":" ","node.action.collapseFrame":" ","node.action.expandFrame":" ","node.action.collapseCharacter":" ","node.action.expandCharacter":" ","node.action.clear":"","node.action.clearTooltip":"  .","node.action.clearChat":" ","node.action.paste":"","node.action.copy":"","node.action.duplicateWithContent":" ( )","node.action.duplicateEmpty":" ()","node.action.cutConnections":" ","node.action.close":"","node.action.executeChain":" ","node.action.executeFullChain":"  ","node.action.processChainForward":"  ","node.action.executeChainTitle":"   .","node.action.addCharacter":" ","node.action.addScene":" ","node.action.addFrame":" ","node.action.addFirstFrame":"  ","node.action.deleteItem":"","node.action.moveUp":"","node.action.moveDown":"","node.action.saveImage":" ","node.action.loadImage":" ","node.action.saveCharacter":" ","node.action.loadCharacter":" ","node.action.readData":" ","node.action.refreshData":" ","node.action.stop":"","node.action.stopping":"...","node.action.embedCharacter":" ","node.action.downloadFinalPrompts":" ","node.action.rename":"","node.action.index":"","node.action.improveConcept":" ","node.action.improveConceptTooltip":"    .","node.action.downloadJson":" JSON","node.action.downloadSRT":" SRT","node.action.markPrimary":" ","node.input.default":"","node.output.default":"","node.output.allCharacters":" ","node.output.primaryCharacter":" ","node.content.action":"","node.content.actionPlaceholder":" ...","node.content.allScriptParts":"  ","node.content.allScriptAnalyzerData":" ","node.content.allNarratorData":"  ","node.content.analyzeCharacters":" ","node.content.analyzeFromScene":" :","node.content.analyzeUpToScene":"","node.content.endPlaceholder":"","node.content.generateFromFrame":"  :","node.content.generateUpToFrame":" ","node.content.analyzeFromFrame":"  :","node.content.processFromFrame":"  :","node.content.processFromScene":"  :","node.content.analyzePrompt":" ","node.content.analyzeScript":" ","node.content.analyzing":"...","node.content.applyAliases":" ","node.content.applyAliasesTooltip":"    ().","node.content.character":"","node.content.characterIndex":"","node.content.characterPlaceholder":" ...","node.content.character_plural":"","node.content.characters":"","node.content.charactersSynced":" ","node.content.noCharactersConnected":"  .","node.content.appearance":"","node.content.personality":"","node.content.characterType":"","node.content.characterTypeShort":"","node.content.characterType.simple":"","node.content.characterType.anthro":" ()","node.content.characterType.chibi":" ()","node.content.characterType.key_item":" ","node.content.style":"","node.content.style.none":"","node.content.style.simple":"","node.content.style.realistic":"/","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.chatPlaceholder":" ...","node.content.clothing":"","node.content.clothingPlaceholder":" ...","node.content.connectedPlaceholder":"","node.content.dataPlaceholder":"  ...","node.content.readData":" ","node.content.reading":"...","node.content.description":"","node.content.sceneDescription":" ","node.content.duration":"","node.content.enhancePrompt":" ","node.content.enhancedPromptHere":"   ...","node.content.enhancing":"...","node.content.environment":"","node.content.environmentPlaceholder":" ...","node.content.environmentPrompt":"  ","node.content.compositionAndBlocking":"  ","node.content.executingChain":" ...","node.content.imagePrompt":" ","node.content.prompt":"","node.content.finalPrompt":" ","node.content.finalPrompt_plural":" ","node.content.fixErrors":" ","node.content.fixingErrors":"...","node.content.frame":"","node.content.frame_plural":"","node.content.frames":" ","node.content.frames_analyzed":" : {count}","node.content.framesPerScene":"  ","node.content.minFrames":"","node.content.maxFrames":"","node.content.numberOfCharactersShort":".","node.content.fullDescription":" ","node.content.generateCharacters":" ","node.content.generateEntities":" ","node.content.generateFinalPrompts":"  ","node.content.generatingProgress":" {current}  {total}","node.content.generateImage":" ","node.content.generateScript":" ","node.content.generateSpeech":" ","node.content.generateText":" ","node.content.generateSSML":" SSML","node.content.generateStyle":" ","node.content.generating":"...","node.content.improving":"...","node.content.generatedAudio":" ","node.content.imagePromptPlaceholder":"   ...","node.content.modificationPromptPlaceholder":"  ...","node.content.narrator":"","node.content.narratorEnabled":" ","node.content.narratorEnabledInfo":"  .","node.content.narratorMode":" ","node.content.narratorMode.normal":" / ","node.content.narratorMode.dual":" ","node.content.narratorMode.first_person":" ","node.content.role":"","node.content.role.narrator":"","node.content.role.announcer":"","node.content.role.first_person":" ","node.content.role.dual_narrator":" ","node.content.role.dual_announcer":" ","node.content.scene":"","node.content.scene_plural":"","node.content.scenes":"","node.content.scenes_generated":" : {count}","node.content.sceneContext":" ","node.content.sceneContextPlaceholder":", , ...","node.content.scriptPromptPlaceholder":"  ...","node.content.seconds":"","node.content.stylePlaceholder":" ...","node.content.stylePromptPlaceholder":"   ...","node.content.styleOverride":" ","node.content.summary":"","node.content.targetLanguage":" ","node.content.textToSynthesize":"  ...","node.content.translate":"","node.content.translatePlaceholder":"  ...","node.content.translatedTextPlaceholder":"  ...","node.content.translating":"...","node.content.useExistingCharacters":" ","node.content.useExistingCharactersInfo":"      .","node.content.createKeyItem":" /","node.content.createSecondaryChars":" ","node.content.createKeyItems":" ","node.content.createKeyItemInfo":"      .","node.content.noCharacters":" ","node.content.noCharactersInfo":" .","node.content.videoPrompt":"  ","node.content.videoPrompts":" ","node.content.voice":"","node.content.previewVoice":" ","node.content.voicePreviewText":",   .","node.content.inputScripts":" ","node.content.inputFrames":" ","node.content.outputScript":" ","node.content.requestCategories":" ","node.content.generateIdea":" ","node.content.requestNewCategories":" ","node.content.category.action":"","node.content.category.place":"","node.content.category.obstacle":"","node.content.generatedIdea":" ","node.content.storyFormat":" ","node.content.theme":"","node.content.parameters":"","node.content.advancedMode":" ","node.content.numberOfScenes":" ","node.content.numberOfScenes.auto":"","node.content.detailedPlot":" ","node.content.detailedPlotInfo":" .","node.content.includeSubscribeScene":" ","node.content.includeSubscribeSceneInfo":" .","node.content.genre":"","node.content.genre2":" 2","node.content.breakIntoParagraphs":"  ","node.content.copyVideoPrompt":"  ","node.content.generateVideoPrompt":"  ","node.content.model":"","node.content.processWholeScene":"  ","node.content.processWholeSceneInfo":"        .","node.content.batchProcessing":" ","node.content.batchProcessingInfo":"      .","node.content.extendedAnalysis":" ","node.content.extendedAnalysisInfo":"    .","node.content.professionalStoryboard":" ","node.content.professionalStoryboardInfo":"    .","node.content.generateStartEndFrames":" / ","node.content.autoIndexCharacters":"- ","node.content.autoIndexCharactersInfo":"    .","node.content.imageToText":"  ","node.content.extracting":"...","node.content.extractedText":" ","node.content.activePromptStack":"  ","node.content.noCharactersAnalyzed":"  .","node.content.promptsGeneratedPlaceholder":"   .","node.content.noCharactersInScript":"   .","node.content.noInputScenes":"  .   .","node.content.status":"","node.content.status.ready":"","node.content.status.paused":" ","node.content.status.generating":"","node.content.status.total":": {generated} / {total}","node.content.status.batch":": {current}  {total}","node.content.status.time":": {current} / {total}","node.content.refreshing":"...","node.content.totalFrames":" : {count}","node.content.uploadAudio":" /","node.content.noAudioLoaded":" ","node.content.audioLoaded":" ","node.content.transcriptionPlaceholder":"  ...","node.content.transcribe":"","node.content.transcribing":"...","node.content.convertingVideo":" ...","node.content.recommendedFrames":" ","node.content.shotType":"","node.content.shotType.ws":"WS ()","node.content.shotType.ms":"MS ()","node.content.shotType.cu":"CU ()","node.content.shotType.ecu":"ECU ()","node.content.shotType.ls":"LS ()","node.content.characterDetail":" ","node.content.noCharDesc":"  ","node.content.includeGeneralCharDesc":"  ","node.content.includeFullCharDesc":"  ","node.content.safeGeneration":" ","node.content.shotFilter":" ","node.content.shotFilter.all":"","node.content.shotFilter.wideOnly":" ","instruction.desc.shot_filter_all":"    (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"    (WS, MS, LS).   .","node.content.anthroEnabled":" ","node.content.subscribeEnhancement":"  ","node.content.thinkingEnabled":" ","node.content.scenelessMode":"  ","instruction.desc.sceneless_mode":"  .     .","instruction.sceneless_mode":"  ","node.content.microActionBreakdown":"-","node.content.microActionBreakdownInfo":"     (, , ).","node.content.commercialSafe":"  ","instruction.desc.commercial_safe":"    .","node.content.findStack":"  ...","node.content.spm_stack.priming":"1.   ","node.content.spm_stack.physics":"2.   ","node.content.spm_stack.hierarchy":"3.  ","node.content.spm_stack.construction":"4.   ","node.content.scriptGenerationStack":"  ","node.content.entityGenerationStack":"  ","node.content.sg_stack.priming":"  ","node.content.mainChars":"","node.content.secChars":"","node.content.keyItems":"","node.content.thumbnailPrompt":" "},y1={"genre.general":"","genre.comedy":"","genre.drama":"","genre.action":"","genre.scifi":" ","genre.fantasy":"","genre.horror":"","genre.thriller":"","genre.childrens_animation":"   ","genre.shorts_story":"   ","genre.scientific_historical":"- ","character_generator.promptPlaceholder":'   , : " ,   ,    "',"idea_generator.randomTheme":"  ","idea_generator.randomCombination":" ","idea_generator.themePlaceholder":", , ,  ","idea_generator.initialMessage":'  ()   "{buttonName}",  .',"idea_generator.ideaPlaceholder":"   ...","idea_generator.format.general":"","idea_generator.format.childrens":"","idea_generator.format.adventure":"","idea_generator.format.fantasy":" / ","idea_generator.format.detective":"","idea_generator.format.scifi":" ","idea_generator.format.horror":"","idea_generator.format.historical":"","gender.male":"","gender.female":"","node.content.autoDownload":"-  ","node.content.downloadSelected":" ","node.content.intonation":"","intonation.standard":"","intonation.cheerful":"","intonation.angry":"","intonation.sad":"","intonation.excited":"","intonation.announcer":"","intonation.whispering":"","node.content.sceneMode":" ","node.content.connectNarratorData":' "  "   .',"node.content.sceneModeActive":"  .    .","speech_synthesizer.mode.simple":"","speech_synthesizer.mode.scene":"","speech_synthesizer.multiSpeaker":" ","speech_synthesizer.speaker1Name":"  1","speech_synthesizer.speaker2Name":"  2","speech_synthesizer.multiSpeakerHint":"        (, Man: ..., Woman: ...).","speech_synthesizer.ssmlHint":"  SSML-  .","youtube_analytics.authorName":" ","youtube_analytics.videoTitle":" ","youtube_analytics.views":"","youtube_analytics.addToChannel":"  ","youtube_analytics.noIncomingData":"  .","youtube_analytics.videoAdded":" !","youtube_analytics.dragDrop":"   ","youtube_analytics.thumbnailUpdated":" ","youtube_analytics.statsTrend":" ","youtube_analytics.currentChannel":" ","youtube_analytics.growth":"","youtube_analytics.allChannels":" ","youtube_analytics.saveDisk":". ","youtube_analytics.saveCatalog":". ","youtube_analytics.loadDisk":". ","youtube_analytics.analyzing":"...","youtube_analytics.askAI":" ","youtube_analytics.clickForAdvice":' " "  .',"youtube_analytics.dailyNotes":" ","youtube_analytics.logDailyStats":" ","youtube_analytics.subscribers":"","youtube_analytics.totalViews":" ","youtube_analytics.updateStats":"","youtube_analytics.history":"","youtube_analytics.noHistory":"  .","youtube_analytics.noNotes":" .","youtube_analytics.noVideos":" .","youtube_analytics.loadedFromDisk":"  ","youtube_analytics.loadFailed":" ","youtube_analytics.savedToDisk":"  ","youtube_title_generator.mode.title":" ","youtube_title_generator.mode.channel":"  ","youtube_title_generator.ideaPlaceholder":"    ...","youtube_title_generator.channelIdeaPlaceholder":"    ...","youtube_title_generator.title":"","youtube_title_generator.description":"","youtube_title_generator.tags":"","youtube_title_generator.channelName":" ","youtube_title_generator.channelDescription":" ","youtube_title_generator.channelKeywords":" ","youtube_title_generator.channelHandle":" (@)","music_idea_generator.mode.lyrics":" ","music_idea_generator.mode.music_prompt":" ","music_idea_generator.ideaPlaceholder":"    ...","music_idea_generator.songTitle":" ","music_idea_generator.songTitlePlaceholder":"...","music_idea_generator.lyricsPlaceholder":"   ...","music_idea_generator.musicPromptPlaceholder":"     ...","chat.mode.general":"","chat.mode.script":" ","chat.mode.prompt":" ","chat.mode.youtube":"YouTube "},x1={"catalog.title":"","catalog.tabs.groups":"","catalog.tabs.library":" ","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.analysis":"","catalog.tabs.final_prompts":" ","catalog.tabs.youtube":"YouTube","catalog.tabs.music":" ","catalog.empty.title":" ","catalog.empty.description":" ,    ,    .","catalog.loadFromFile":"    ","catalog.card.addToCanvas":"  ","catalog.card.rename":"","catalog.card.save":"  ","catalog.card.delete":"","library.loadFromFile":"  ","library.empty.title":" ","library.empty.description":"    ,  .","library.emptyPrompt":" ","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"  ","library.actions.edit":"","group.rename":" ","group.saveToCatalog":"  ","group.saveToDisk":"  ","group.ungroup":" (Shift+  )","group.button.create":" ({count})"},v1={"dialog.rename.title":"","dialog.rename.group.title":" ","dialog.rename.catalog.title":"  ","dialog.rename.label":" ","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.reset.title":" ","dialog.reset.message":" ,        ?     .","dialog.exit.title":" ?","dialog.exit.message":" ?     ,      .","dialog.settings.title":"","dialog.settings.apiKeyLabel":"API  Gemini","dialog.settings.apiKeyPlaceholder":"  API  ","dialog.settings.getApiKeyLink":" API   Google AI Studio","dialog.settings.useFreeKey":"  () ","dialog.settings.save":"","dialog.settings.close":"","dialog.apiKey.title":" API ","dialog.apiKey.description":"    API  Gemini.   .      .","dialog.apiKey.keyExists":"API     .","dialog.apiKey.clear":" ","dialog.apiKey.save":" ","dialog.apiKey.update":" ","dialog.apiKey.useFreeKey":"   ( )","dialog.permission.title":"   ","dialog.permission.description":'        ""  .         .',"dialog.permission.decline":"","dialog.permission.allow":"","alert.groupSaved":' "{groupTitle}"   !',"toast.groupSavedToDisk":' "{groupTitle}"   !',"alert.confirmDelete":" ,       ?","alert.invalidCatalogFile":"    .","alert.loadCatalogFailed":"    ","alert.confirmLoadProject":"      (, , ).  ?","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":' ,    "{itemName}"?    .',"dialog.confirmDelete.folderMessage":' ,     "{itemName}"    ?    .',"dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmClear.title":" ","dialog.confirmClear.message":" ,      ?    .","toast.copied":"  ","toast.pasted":"!","toast.cleared":"","toast.resetComplete":"  ","toast.projectSaved":"   ","toast.saveFailed":"   ","toast.connectionsCut":" ","toast.charSaved":"   ","toast.charLoaded":" ","toast.videoPasted":"   ","toast.savedToCatalog":"  ","toast.apiKeySaved":"API   ","toast.apiKeyCleared":"API  ","toast.projectLoaded":"  ","alert.batchMismatch":":  {scene}   (: {expected}, : {got}).    ."},b1={"instruction.desc.safe_gen":' :     -.  : "teenager", "intimate", "erotic", "sexy".  : "young person", "young adult", "artistic atmosphere", "cinematic lighting".',"instruction.desc.layered_no_style":": 1. [  ( ->  ->  )] -> 2. [:  +   ] -> 3. [].        ."},w1={"instruction.sg_inputs":" ","instruction.desc.sg_inputs":": /,  .","instruction.core_director":"VFX ","instruction.desc.core_director":"  .    .  ,   .  ,   : , , .","instruction.sg_thinking":" ","instruction.desc.sg_thinking":"    .  ?  ?  ?","instruction.sg_improve_input":" ","instruction.desc.sg_improve_input":"   .     ,   (, , ),       .","instruction.sg_anti_compression":"-","instruction.desc.sg_anti_compression":'  .     .     "",     .     .',"instruction.sg_exposition":" ","instruction.desc.sg_exposition":":    2-3         ( ,  ).","instruction.sg_delayed_reveal":"","instruction.desc.sg_delayed_reveal":'   .   "- ", " ", " ".   .',"instruction.sg_metaphor":" ","instruction.desc.sg_metaphor":'   ("").  : " ,    ".',"instruction.sg_pacing":" ","instruction.desc.sg_pacing":':     3-5 .  "",  ",  , ,   ".',"instruction.sg_subtext":"","instruction.desc.sg_subtext":"   .","instruction.desc.sg_frame_estimation":" : 5-9  (), 10-15 (), 16-25 ().   .","instruction.rule_visuals":" ","instruction.desc.rule_visuals":" ,   .  ''  '',    .","instruction.sg_visual_dna":"  ","instruction.desc.sg_visual_dna":"         .","instruction.rule_flow":"","instruction.desc.rule_flow":",    ,    .","instruction.rule_atmosphere":"","instruction.desc.rule_atmosphere":" , , , , .         (  ).","instruction.sg_visual_style":" ","instruction.desc.sg_visual_style":"    '{style}'.","instruction.char_detailed_style":" ","instruction.desc.char_detailed_style":"  .","instruction.sg_genre":" ","instruction.desc.sg_genre":": {genre}","instruction.char_smart_concept":"-","instruction.desc.char_smart_concept":"  .","instruction.char_no_dupes":" ","instruction.desc.char_no_dupes":"   . :  .","instruction.create_main_chars":" ","instruction.desc.create_main_chars":"     .","instruction.create_secondary_chars":" ","instruction.desc.create_secondary_chars":"      .","instruction.create_key_items":" ","instruction.desc.create_key_items":"    .","instruction.sg_anthro":"","instruction.desc.sg_anthro":"   .","instruction.sg_no_chars":" ","instruction.desc.sg_no_chars":" .","instruction.sg_detailed_plot":" ","instruction.desc.sg_detailed_plot":" .","instruction.sg_subscribe":" ","instruction.desc.sg_subscribe":" .","instruction.char_gray_bg":"","instruction.desc.char_gray_bg":"    .","instruction.char_no_new":" ","instruction.desc.char_no_new":"  .","instruction.sg_new_chars":" ","instruction.desc.sg_new_chars":"  .","instruction.sg_living_world":" ","instruction.desc.sg_living_world_simple":"     .","instruction.desc.sg_living_world_anthro":"     .","instruction.sg_simple_actions":" ","instruction.desc.sg_simple_actions":"  .","instruction.commercial_safe":"  ","instruction.desc.commercial_safe":"    ."},_1={"instruction.inputs_data":" ","instruction.desc.inputs_data":":  ,  ,  .","instruction.ana_role":" ","instruction.desc.ana_role":"  .     -   .        ,          .      .","instruction.ana_cinema":"","instruction.desc.ana_cinema":".   (Wide Shot, Close-up)   (Side Profile, Rear View).","instruction.ana_cinema_wide":" ()","instruction.desc.ana_cinema_wide":". : Wide Shot, Long Shot, Dutch Angle. : Aerial, Worm's Eye.   .","instruction.ana_anthro_logic":"-","instruction.desc.ana_anthro_logic":'      (, "Anthropomorphic Fox")    .',"instruction.ana_subscribe_logic":" ","instruction.desc.ana_subscribe_logic":"   ,   :       3D .","instruction.rule_hierarchy":"  ","instruction.desc.rule_hierarchy":": 1.  . 2.    +   (, ). 3. . 4. .   ,      .","instruction.rule_living_world":" ","instruction.desc.rule_living_world":" ,  .","instruction.desc.rule_living_world_anthro":"      ( ).","instruction.rule_persistence":"","instruction.desc.rule_persistence":"  :        .","instruction.rule_mandatory_bg":"  ","instruction.desc.rule_mandatory_bg":":    ,   . 1.  (/). 2.  (, , ). 3.  (/)  .        .","instruction.desc.rule_mandatory_bg_wide":"   .        ,  ,      .","instruction.shot_filter_wide":"  ","instruction.desc.shot_filter_wide":' :    "  ",           (. " ,  ").   (CU/ECU)  .',"instruction.storyboard_rules":" ","instruction.desc.storyboard_rules":"  (WS/CU)   (, , , , ).  .","instruction.storyboard_rules_wide":"  ()","instruction.desc.storyboard_rules_wide":"  ,   : ,  ,  , .  .","instruction.tech_directives":"","instruction.desc.tech_directives":" .      (WS, MS, CU).","instruction.tech_directives_wide":" ()","instruction.desc.tech_directives_wide":" .  : WS, MS, LS.  CU/ECU.","instruction.use_aliases":"","instruction.desc.use_aliases":"  Entity-N (  ).     .","instruction.character_array_integrity":" ","instruction.desc.character_array_integrity":":  `characters`    Entity-N,    .","instruction.action_phase_breakdown":" ","instruction.desc.action_phase_breakdown":':     1 . " " = 3  ( ,  ,  ).   .',"instruction.desc.action_phase_breakdown_wide":" ,    .  /    ,   .","instruction.batch_processing":" ","instruction.desc.batch_processing":"    .","instruction.ana_prompt_lang":" ","instruction.desc.ana_prompt_lang":"   .","instruction.extended_visuals":"- ()","instruction.desc.extended_visuals":"  .        3-5  .  .  -.","instruction.extended_visuals_wide":" ()","instruction.desc.extended_visuals_wide":"         .     .   .","instruction.desc.target_lang":"  .","instruction.rule_isolation":" ","instruction.desc.rule_isolation":":       .          .","instruction.sensory_saturation":"-","instruction.desc.sensory_saturation":'  .  " "  "        ".',"instruction.ana_no_pov":" POV","instruction.desc.ana_no_pov":':        ("POV").      (- ,    ..).',"instruction.desc.static_frame_logic":'    ("", "").   . ",   ", ",  ".',"instruction.desc.anatomical_posing":'  .  "" : "  ,   ,   ".',"instruction.desc.motion_dynamics":": Image Prompt = 100% . Video Prompt =    (, , ).","instruction.desc.anatomical_strictness":":        .    :   [],   [].   3- .","instruction.desc.prop_consistency":' :     ("", "").   .  ("  ", "  ")   .',"instruction.desc.subject_hierarchy":' :      ,   : "-1  ,  .   ".      .',"instruction.static_frame_logic":" ","instruction.anatomical_posing":" ","instruction.anatomical_strictness":" ","instruction.prop_consistency":" ","instruction.subject_hierarchy":" ","instruction.motion_dynamics":" "},C1={"instruction.inputs":" ","instruction.desc.inputs":" :  ,   ,     .","instruction.role":": Technical Director","instruction.desc.role":"        -.             .      .","instruction.layered":":  ","instruction.desc.layered":": [] -> [ ] -> [Entity-1:    + ] -> [/ ] -> [].    .","instruction.desc.layered_no_char":": [ ] -> [-1 + /] -> [-2 + /].    .","instruction.visuals":": ","instruction.desc.visuals":"  :  , ,  8k,  ,  .","instruction.process_whole_scene":" ","instruction.desc.process_whole_scene":"          .","instruction.video":"-","instruction.desc.video":": [] ( . ) []. Dynamics: []. Camera: [].    .","instruction.stateless":": Stateless","instruction.desc.stateless":'   .   . :        ( ->  -> ).    ""  "  ".',"instruction.rule_static":": ","instruction.desc.rule_static":"   .     .","instruction.atmosphere_fix":" ","instruction.desc.atmosphere_fix":"       .","instruction.subject_focus":" ","instruction.desc.subject_focus":':   T-Pose   ,    .      (, , ),     "  ".',"instruction.always_env":" -","instruction.desc.always_env":':  "  "      .   ,        .   .',"instruction.pm_anthro":"-","instruction.desc.pm_anthro":':  "anthropomorphic"      .   /.',"instruction.pm_subscribe":" ","instruction.desc.pm_subscribe":'   "SUBSCRIBE"  "LIKE" (, , 3D)   .',"instruction.strict_char_index":" ","instruction.desc.strict_char_index":"      Character-N,   .","instruction.no_names":":  ","instruction.desc.no_names":":  .  [Entity-N].        (., [Entity-1]),   .","instruction.general_char_desc":" ","instruction.desc.general_char_desc":"        .","instruction.full_char_desc":" ","instruction.desc.full_char_desc":"       .","instruction.formatting":"","instruction.desc.formatting":"    (, , ).  ,    ,    .","instruction.anatomical_strictness":" ","instruction.desc.anatomical_strictness":' : "     .        ."',"instruction.img_vid_consistency":" ->","instruction.desc.img_vid_consistency":"Image Prompt = /. Video Prompt =  .    ,    (:  -> ).","instruction.desc.prop_enhancement":':      (, " " -> "  ").   /.',"instruction.no_pov":":  POV","instruction.desc.no_pov":'      (POV).    (  ).  "  ", "   ".'},S1={"instruction.music_role":" ","instruction.desc.music_role":" -   .","instruction.music_input":" ","instruction.desc.music_input":"  ,  .","instruction.music_creative":" ","instruction.desc.music_creative":"   ,   .    .","instruction.music_lyrics":" ","instruction.desc.music_lyrics":"  /  .","instruction.music_verse_count":" ","instruction.desc.music_verse_count":"    .","instruction.music_prompt_rule":"AI  ","instruction.desc.music_prompt_rule":"   Suno/Udio (BPM, , ).  1000 .","instruction.music_format":"JSON ","instruction.desc.music_format":"  JSON  ."},T1={"instruction.yt_role":"YouTube ","instruction.desc.yt_role":"  SEO, CTR   .","instruction.yt_input":" ","instruction.desc.yt_input":"    .","instruction.yt_title_mode":" ","instruction.desc.yt_title_mode":"     .","instruction.yt_channel_mode":" ","instruction.desc.yt_channel_mode":" ,   .","instruction.yt_format":"JSON ","instruction.desc.yt_format":"  JSON  .","instruction.yt_hashtags":" ","instruction.desc.yt_hashtags":" #    .","instruction.yt_thumbnail":" ","instruction.desc.yt_thumbnail":"     ."},E1={"instruction.narrator_role_story":" ","instruction.desc.narrator_role_story":",    .","instruction.narrator_role_news":" ","instruction.desc.narrator_role_news":",    .","instruction.narrator_role_fps":": 1- ","instruction.desc.narrator_role_fps":"    .","instruction.narrator_input":" ","instruction.desc.narrator_input":"    .","instruction.narrator_ssml":"SSML ","instruction.desc.narrator_ssml":" ,     .","instruction.narrator_format":"JSON ","instruction.desc.narrator_format":"  JSON   ."},N1={...b1,...w1,..._1,...C1,...S1,...T1,...E1},k1={...m1,...g1,...f1,...y1,...x1,...v1,...N1},A1={"app.title":"Modificador de Guiones","app.description":"Crea, refina y genera guiones visualmente con la API de Gemini.","app.slogan":"Conecta ideas para crear una obra maestra","app.subtitle":"Visualiza tus Guiones","app.error.title":"Notificacin","app.error.copy":"Copiar Error","app.error.copied":"Copiado!","error.quotaExceeded":"Has alcanzado tu lmite de uso. Por favor, verifica la cuota de tu clave API o intntalo de nuevo ms tarde.","error.apiKeyMissing":"Clave API no encontrada. Por favor, configura tu clave API de Gemini en los ajustes.","error.freeKeyNotAvailable":"La clave API gratuita/de desarrollo no est disponible en este entorno. Por favor, proporciona tu propia clave.","error.fileReadError":"Error al leer el archivo.","error.videoConversionError":"Error al convertir vdeo a audio.","error.unsupportedFile":"Tipo de archivo no soportado.","error.promptModifierFile":"Este archivo pertenece a otra aplicacin (Prompt Modifier). Por favor, brelo en esa aplicacin.","error.invalidFileType":"Tipo de archivo invlido. Por favor, carga un archivo de Proyecto o Lienzo de Script Modifier.","welcome.iAmDeveloper":"Soy Desarrollador","welcome.letsGo":"Vamos!","welcome.resume":"Continuar","welcome.reload":"Recargar","welcome.reloadTitle":"Reiniciar y Recargar?","welcome.reloadMessage":"Esto borrar todo el lienzo y recargar la aplicacin. Los datos no guardados se perdern. Ests seguro?","welcome.confirmReload":"Reiniciar y Recargar","dialog.welcome.title":"Modificador de Guiones","dialog.welcome.heading":"Bienvenido a","dialog.welcome.intro1":"Bienvenido a Script Modifier: tu espacio de trabajo visual para crear historias con Gemini.","dialog.welcome.intro2":"Para comenzar, selecciona tu idioma e introduce tu clave API de Gemini.","dialog.welcome.apiKeyExplanation":"Tu clave API se almacena localmente en tu navegador. No la enviamos a ningn servidor que no sea la API de Google Gemini."},I1={"toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexin (C)","toolbar.selection":"Seleccin (S)","toolbar.reroute":"Punto de Ruta (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Ajustar a la Cuadrcula (Shift+W)","toolbar.resetZoom":"Restablecer Zoom","toolbar.lineStyleSpaghetti":"Lneas Espagueti (Shift+E)","toolbar.lineStyleOrthogonal":"Lneas Ortogonales (Shift+E)","toolbar.addNode":"Aadir Nodo (F)","toolbar.catalog":"Catlogo (Ctrl+Espacio)","toolbar.settings":"Ajustes","toolbar.resetToDefault":"Restablecer por Defecto","toolbar.closeProject":"Cerrar Proyecto / Limpiar","toolbar.enterFullscreen":"Pantalla Completa","toolbar.exitFullscreen":"Salir de Pantalla Completa","toolbar.addTextInput":"Entrada de Texto (T)","toolbar.addPromptAnalyzer":"Analizador de Prompt (A)","toolbar.addCharacterAnalyzer":"Analizador de Personaje","toolbar.addCharacterGenerator":"Generador de Personajes (Shift+C)","toolbar.addImageGenerator":"Generador de Imgenes (O)","toolbar.addImagePreview":"Vista Previa de Imagen (I)","toolbar.addCharacterCard":"Ficha de Personaje (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Procesador de Prompt (P)","toolbar.addGeminiChat":"Chat Gemini (M)","toolbar.addTranslator":"Traductor (L)","toolbar.addIdeaGenerator":"Generador de Ideas (Shift+A)","toolbar.addScriptGenerator":"Generador de Guiones (Shift+S)","toolbar.addScriptAnalyzer":"Analizador de Guiones (Shift+D)","toolbar.addScriptPromptModifier":"Finalizador de Prompts (Shift+F)","toolbar.addErrorAnalyzer":"Analizador de Errores","toolbar.addNote":"Nota (N)","toolbar.addDataReader":"Lector de Datos (Shift+R)","toolbar.addSpeechSynthesizer":"Sintetizador de Voz (Shift+N)","toolbar.addNarratorTextGenerator":"Generador de Texto Narrador (Shift+G)","toolbar.addAudioTranscriber":"Transcriptor de Audio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Generador de Ttulos YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Generador de Ideas Musicales (Shift+M)","toolbar.addYouTubeAnalytics":"Analticas de YouTube (Shift+Y)","toolbar.saveCanvas":"Guardar Lienzo (Ctrl+S)","toolbar.saveProject":"Guardar Proyecto (Ctrl+Shift+S)","toolbar.loadCanvas":"Cargar Lienzo (Ctrl+O)","toolbar.clearCanvas":"Limpiar Lienzo","toolbar.group.general":"General","toolbar.group.scripting":"Guiones","toolbar.group.prompting":"Prompts y Anlisis","toolbar.group.characters":"Personajes","toolbar.group.ai":"Herramientas IA","toolbar.group.file":"Archivo","toolbar.group.images":"Imgenes","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Controles del Lienzo","toolbar.expand":"Expandir Panel","toolbar.collapse":"Contraer Panel","toolbar.toggleHeaders":"Alternar Encabezados","hotkeys.file.title":"Archivo","hotkeys.file.save":"Guardar Lienzo (Ctrl+S)","hotkeys.file.saveProject":"Guardar Proyecto (Ctrl+Shift+S)","hotkeys.file.load":"Cargar Lienzo (Ctrl+O)","hotkeys.tools.title":"Herramientas","hotkeys.tools.edit":"Editar","hotkeys.tools.cutter":"Cortar","hotkeys.tools.selection":"Seleccin","hotkeys.tools.reroute":"Punto de Ruta","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Agrupar (G)","hotkeys.tools.deleteGroup":"Eliminar grupo con nodos","hotkeys.tools.closeNode":"Cerrar Nodo","hotkeys.tools.toggleLineStyle":"Cambiar Estilo de Lnea","hotkeys.tools.snapToGrid":"Ajustar a Cuadrcula","hotkeys.tools.selectAll":"Seleccionar Todos","hotkeys.tools.deselectAll":"Deseleccionar Todos","hotkeys.tools.duplicate":"Duplicar con Contenido","hotkeys.windows.title":"Ventanas","hotkeys.windows.search":"Buscar Nodos (F)","hotkeys.windows.quickAdd":"Aadir Rpido (Espacio)","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Crear Nodo","hotkeys.hide":"Ocultar Atajos","help.title":"Atajos de Teclado","hotkeys.show":"Mostrar Atajos","search.placeholder":"Buscar un nodo...","search.noResults":"No se encontraron nodos.","search.node.text_input.title":"Entrada de Texto","search.node.text_input.description":"Un cuadro de texto simple para tus ideas. (T)","search.node.prompt_processor.title":"Procesador de Prompt","search.node.prompt_processor.description":"Mejora y combina prompts con IA. (P)","search.node.prompt_analyzer.title":"Analizador de Prompt","search.node.prompt_analyzer.description":"Divide un prompt en personaje y entorno. (A)","search.node.character_analyzer.title":"Analizador de Personaje","search.node.character_analyzer.description":"Divide una descripcin en personaje y ropa.","search.node.character_generator.title":"Generador de Personajes","search.node.character_generator.description":"Crea personajes detallados a partir de una idea. (Shift+C)","search.node.image_generator.title":"Generador de Imgenes","search.node.image_generator.description":"Crea una imagen a partir de un texto. (O)","search.node.image_preview.title":"Vista Previa de Imagen","search.node.image_preview.description":"Muestra una imagen desde un archivo. (I)","search.node.character_card.title":"Ficha de Personaje","search.node.character_card.description":"Almacena imagen, nombre y prompt del personaje. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Conversacin directa con Gemini AI. (M)","search.node.translator.title":"Traductor","search.node.translator.description":"Traduce texto al idioma seleccionado. (L)","search.node.script_generator.title":"Generador de Guiones","search.node.script_generator.description":"Convierte una idea en escenas de guion. (Shift+S)","search.node.script_analyzer.title":"Analizador de Guiones","search.node.script_analyzer.description":"Divide un guion en cuadros y prompts de imagen. (Shift+D)","search.node.script_prompt_modifier.title":"Finalizador de Prompts","search.node.script_prompt_modifier.description":"Finaliza los prompts del anlisis para generar imgenes. (Shift+F)","search.node.error_analyzer.title":"Analizador de Errores","search.node.error_analyzer.description":"Revisa y corrige gramtica y ortografa.","search.node.note.title":"Nota","search.node.note.description":"Un rea de texto simple para tus notas. (N)","search.node.reroute_dot.title":"Punto de Ruta","search.node.reroute_dot.description":"Punto para redirigir y dividir conexiones.","search.node.data_reader.title":"Lector de Datos","search.node.data_reader.description":"Muestra texto sin procesar de una conexin.","search.node.speech_synthesizer.title":"Sintetizador de Voz","search.node.speech_synthesizer.description":"Convierte texto a voz. (Shift+N)","search.node.idea_generator.title":"Generador de Ideas","search.node.idea_generator.description":"Generador de ideas (Categoras -> Idea).","search.node.narrator_text_generator.title":"Generador de Texto Narrador","search.node.narrator_text_generator.description":"Genera texto para un narrador o locutor. (Shift+G)","search.node.audio_transcriber.title":"Transcriptor de Audio","search.node.audio_transcriber.description":"Convierte archivos de audio/video a texto. (Shift+B)","search.node.youtube_title_generator.title":"Generador de Ttulos YouTube","search.node.youtube_title_generator.description":"Genera ttulos, descripciones y etiquetas atractivas para YouTube.","search.node.music_idea_generator.title":"Generador de Ideas Musicales","search.node.music_idea_generator.description":"Genera letras de canciones o prompts musicales. (Shift+M)","search.node.youtube_analytics":"Analticas de YouTube","search.node.youtube_analytics.description":"Analiza estadsticas del canal y ofrece consejos de crecimiento.","search.node.image_editor.title":"Editor de Imgenes","search.node.image_editor.description":"Edita imgenes usando IA (inpainting, outpainting).","search.group.input":"Entradas","search.group.process":"Procesamiento y Anlisis","search.group.scripting":"Herramientas de Guion","search.group.character":"Herramientas de Personaje","search.group.images":"Herramientas de Imagen","search.group.ai":"Herramientas IA","search.group.audio":"Herramientas de Audio","search.group.youtube":"Herramientas YouTube","contextMenu.tools":"Herramientas","contextMenu.assignSlot":"Asignar Ranura {index}","contextMenu.addNodeFromSlot":"Aadir {node} ({index})","connectionMenu.title":"Aadir Nodo","quickAddMenu.title":"Aadir Rpido","contextMenu.paste":"Pegar (Ctrl+V)","node.content.simpleActions":"Acciones Simples","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Rpido, eficiente, para borradores.","tooltip.model.pro":"Gemini Pro: Alta inteligencia, razonamiento complejo, detallado.","tooltip.lang.ru":"Generar guion en Ruso.","tooltip.lang.en":"Generar guion en Ingls.","tooltip.lang.es":"Generar guion en Espaol.","tooltip.lang.de":"Generar guion en Alemn.","tooltip.lang.uz":"Generar guion en Uzbeko.","tooltip.lang.fr":"Generar guion en Francs.","tooltip.lang.it":"Generar guion en Italiano.","tooltip.lang.pt":"Generar guion en Portugus.","tooltip.lang.zh":"Generar guion en Chino.","node.action.locateInStack":"Localizar en Pila","help.tabs.hotkeys":"Ayuda y Atajos","help.tabs.links":"Otras Apps y Enlaces","help.category.socials":"Redes Sociales","help.category.stable":"Google AI Studio (Estable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Repositorios GitHub","help.link.youtube":"Canal de YouTube","help.link.telegram_channel":"Canal de Telegram","help.link.telegram_chat":"Chat de Telegram","help.sub.news":"Noticias y Actualizaciones","help.sub.discussion":"Discusin","help.sub.stable":"Versin Estable","help.sub.alpha":"Versin Alpha","languages.ru":"Ruso","languages.en":"Ingls","languages.es":"Espaol","languages.fr":"Francs","languages.de":"Alemn","languages.it":"Italiano","languages.pt":"Portugus","languages.zh":"Chino","languages.ja":"Japons","languages.ko":"Coreano","languages.uz":"Uzbeko"},P1={"node.title.text_input":"Entrada de Texto","node.title.prompt_processor":"Procesador de Prompt","node.title.prompt_analyzer":"Analizador de Prompt","node.title.character_analyzer":"Analizador de Personaje","node.title.character_generator":"Generador de Personajes","node.title.image_generator":"Generador de Imgenes","node.title.image_preview":"Vista Previa de Imagen","node.title.character_card":"Ficha de Personaje","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traductor","node.title.script_generator":"Generador de Guiones","node.title.script_analyzer":"Analizador de Guiones","node.title.script_prompt_modifier":"Finalizador de Prompts","node.title.error_analyzer":"Analizador de Errores","node.title.note":"Nota","node.title.reroute_dot":"Punto de Ruta","node.title.data_reader":"Lector de Datos","node.title.speech_synthesizer":"Sintetizador de Voz","node.title.idea_generator":"Generador de Ideas","node.title.narrator_text_generator":"Generador de Texto Narrador","node.title.audio_transcriber":"Transcriptor de Audio","node.title.youtube_title_generator":"Generador de Ttulos YouTube","node.title.music_idea_generator":"Generador de Ideas Musicales","node.title.youtube_analytics":"Analticas de YouTube","node.title.image_editor":"Editor de Imgenes","node.help.text_input":"Introduce ideas bsicas, palabras clave o descripciones aqu. Se pueden conectar mltiples nodos de texto a un procesador.","node.help.prompt_processor":"Toma texto de otros nodos y usa IA para combinarlos en un prompt nico, detallado y artstico.","node.help.prompt_analyzer":"Analiza el texto entrante y lo divide en cuatro partes: entorno, personaje, accin y estilo.","node.help.character_analyzer":"Analiza la descripcin de un personaje y la divide en apariencia fsica y vestimenta.","node.help.character_generator":"Toma un prompt y genera una o ms descripciones detalladas de personajes.","node.help.image_generator":"Genera una imagen a partir de un texto usando la API de Gemini.","node.help.image_preview":"Muestra una imagen desde un archivo. Arrastra y suelta un archivo de imagen en el nodo o el lienzo.","node.help.character_card":"Almacena la imagen, nombre y prompt de un personaje. Permite generar, guardar y cargar imgenes.","node.help.gemini_chat":"Nodo para conversar directamente con Gemini. Mantiene el historial del chat.","node.help.translator":"Traduce el texto entrante al idioma seleccionado.","node.help.script_generator":"Toma un prompt y genera una serie de escenas para un guion.","node.help.script_analyzer":"Analiza la estructura del guion, dividindolo en personajes y cuadros con descripciones detalladas.","node.help.script_prompt_modifier":"Toma datos analizados del guion y sintetiza prompts finales y artsticos para cada cuadro.","node.help.error_analyzer":"Revisa y corrige la ortografa y gramtica del texto.","node.help.note":"Un rea de texto simple para tus notas. No se conecta a otros nodos.","node.help.reroute_dot":"Un punto para redirigir y ramificar conexiones. El tipo de salida coincide con el de entrada.","node.help.data_reader":"Muestra datos de texto sin procesar de un nodo conectado. til para depuracin.","node.help.speech_synthesizer":"Convierte texto a voz usando una voz seleccionada.","node.help.idea_generator":"Genera categoras (Accin, Lugar, Obstculo) y las combina en una idea de historia.","node.help.narrator_text_generator":"Genera texto para un narrador o locutor basado en un prompt y estilo.","node.help.audio_transcriber":"Sube un archivo de audio o video y convierte su audio a texto.","node.help.youtube_title_generator":"Genera ttulos, descripciones y etiquetas atractivas para YouTube.","node.help.music_idea_generator":"Genera letras de canciones o prompts descriptivos para msica IA.","node.help.youtube_analytics":"Rastrea estadsticas diarias de canales de YouTube y ofrece consejos de crecimiento con IA.","node.help.image_editor":"Edita imgenes usando IA (inpainting, outpainting).","node.action.help":"Ayuda sobre este nodo","node.action.expand":"Expandir","node.action.collapse":"Contraer (H)","node.action.expandAll":"Expandir Todo","node.action.collapseAll":"Contraer Todo","node.action.expandAllScenes":"Expandir Todas las Escenas","node.action.collapseAllScenes":"Contraer Todas las Escenas","node.action.expandAllFrames":"Expandir Todos los Cuadros","node.action.collapseAllFrames":"Contraer Todos los Cuadros","node.action.expandPanel":"Expandir Panel","node.action.collapsePanel":"Contraer Panel","node.action.togglePanel":"Alternar Panel","node.action.collapseScene":"Contraer Escena","node.action.expandScene":"Expandir Escena","node.action.collapseFrame":"Contraer Cuadro","node.action.expandFrame":"Expandir Cuadro","node.action.collapseCharacter":"Contraer Personaje","node.action.expandCharacter":"Expandir Personaje","node.action.clear":"Limpiar contenido","node.action.clearTooltip":"Limpiar campo de entrada.","node.action.clearChat":"Limpiar y Recargar Chat","node.action.paste":"Pegar del Portapapeles","node.action.copy":"Copiar Valor","node.action.duplicateWithContent":"Duplicar con Contenido","node.action.duplicateEmpty":"Duplicar Vaco","node.action.cutConnections":"Cortar Conexiones","node.action.close":"Cerrar Nodo","node.action.executeChain":"Ejecutar Cadena","node.action.executeFullChain":"Ejecutar Cadena Completa","node.action.processChainForward":"Procesar Cadena Adelante","node.action.executeChainTitle":"Ejecutar todos los nodos conectados.","node.action.addCharacter":"Aadir Personaje","node.action.addScene":"Aadir Escena","node.action.addFrame":"Aadir Cuadro","node.action.addFirstFrame":"Aadir Primer Cuadro","node.action.deleteItem":"eliminar","node.action.moveUp":"Mover Arriba","node.action.moveDown":"Mover Abajo","node.action.saveImage":"Guardar Imagen","node.action.loadImage":"Cargar Imagen","node.action.saveCharacter":"Guardar Personaje","node.action.loadCharacter":"Cargar Personaje","node.action.readData":"Leer Datos","node.action.refreshData":"Refrescar Datos","node.action.stop":"Detener","node.action.stopping":"Deteniendo...","node.action.embedCharacter":"Incrustar Personaje (Desconectar y copiar datos)","node.action.downloadFinalPrompts":"Descargar Prompts Finales","node.action.rename":"Renombrar Nodo","node.action.index":"Indexar","node.action.improveConcept":"Mejorar Concepto","node.action.improveConceptTooltip":"Enriquecer, expandir y aadir detalles visuales para generacin de imgenes.","node.action.downloadJson":"Descargar JSON","node.action.downloadSRT":"Descargar SRT","node.action.markPrimary":"Marcar como Principal","node.input.default":"Entrada","node.output.default":"Salida","node.output.allCharacters":"Todos los Personajes","node.output.primaryCharacter":"Personaje Principal","node.content.action":"Accin","node.content.actionPlaceholder":"Prompt de accin...","node.content.allScriptParts":"Todas las Partes del Guion","node.content.allScriptAnalyzerData":"Datos del analizador","node.content.allNarratorData":"Todos los Datos del Narrador","node.content.analyzeCharacters":"Analizar Personajes","node.content.analyzeFromScene":"Analizar desde:","node.content.analyzeUpToScene":"hasta","node.content.endPlaceholder":"fin","node.content.generateFromFrame":"Generar desde cuadro:","node.content.generateUpToFrame":"hasta cuadro","node.content.analyzeFromFrame":"Finalizar desde cuadro:","node.content.processFromFrame":"Procesar desde cuadro:","node.content.processFromScene":"Procesar desde escena:","node.content.analyzePrompt":"Analizar Prompt","node.content.analyzeScript":"Analizar Guion","node.content.analyzing":"Analizando...","node.content.applyAliases":"Aplicar Alias","node.content.applyAliasesTooltip":'Reemplazar nombres de personajes con los alias definidos en "ndice".',"node.content.character":"Personaje","node.content.characterIndex":"ndice","node.content.characterPlaceholder":"Prompt de personaje...","node.content.character_plural":"personajes","node.content.characters":"Personajes","node.content.charactersSynced":"Personajes Sincronizados","node.content.noCharactersConnected":"Sin personajes conectados.","node.content.appearance":"Apariencia","node.content.personality":"Personalidad","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Antropomrfico (Animales)","node.content.characterType.chibi":"Chibi (Lindo)","node.content.characterType.key_item":"Objeto Clave","node.content.style":"Estilo","node.content.style.none":"Ninguno","node.content.style.simple":"Simple","node.content.style.realistic":"Realista/Cinemtico","node.content.style.3d_cartoon":"Dibujo 3D","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animacin 2D","node.content.style.anime":"Estilo Anime","node.content.style.comics":"Cmics","node.content.style.custom":"Especial","node.content.chatPlaceholder":"Escribe un mensaje...","node.content.clothing":"Ropa","node.content.clothingPlaceholder":"Prompt de ropa...","node.content.connectedPlaceholder":"Conectado desde otro nodo","node.content.dataPlaceholder":"Los datos del nodo conectado aparecern aqu...","node.content.readData":"Leer Datos","node.content.reading":"Leyendo...","node.content.description":"Descripcin","node.content.sceneDescription":"Descripcin de Escena","node.content.duration":"Duracin","node.content.enhancePrompt":"Generar Prompt","node.content.enhancedPromptHere":"El prompt mejorado aparecer aqu...","node.content.enhancing":"Mejorando...","node.content.environment":"Entorno","node.content.environmentPlaceholder":"Prompt de entorno...","node.content.environmentPrompt":"Entorno, Decoracin y Fondo","node.content.compositionAndBlocking":"Composicin y Accin","node.content.executingChain":"Ejecutando Cadena...","node.content.imagePrompt":"Prompt de Imagen","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finales","node.content.fixErrors":"Corregir Errores","node.content.fixingErrors":"Corrigiendo...","node.content.frame":"Cuadro","node.content.frame_plural":"cuadros","node.content.frames":"Cuadros de Salida","node.content.frames_analyzed":"Cuadros Analizados: {count}","node.content.framesPerScene":"Cuadros por Escena","node.content.minFrames":"Mn","node.content.maxFrames":"Mx","node.content.numberOfCharactersShort":"Cant.","node.content.fullDescription":"Descripcin Completa","node.content.generateCharacters":"Generar Personajes","node.content.generateFinalPrompts":"Generar Prompts Finales","node.content.generatingProgress":"Generando prompt {current} de {total}","node.content.generateImage":"Generar Imagen","node.content.generateScript":"Generar Guion","node.content.generateSpeech":"Generar Voz","node.content.generateText":"Generar Texto","node.content.generateSSML":"Generar SSML","node.content.generateStyle":"Generar Estilo","node.content.generating":"Generando...","node.content.improving":"Mejorando...","node.content.generatedAudio":"Audio generado","node.content.imagePromptPlaceholder":"Introduce un prompt para generar imagen...","node.content.modificationPromptPlaceholder":"Solicitud de modificacin...","node.content.narrator":"Narrador","node.content.narratorEnabled":"Habilitar Narrador","node.content.narratorEnabledInfo":"Aade texto de voz en off para describir la escena o pensamientos.","node.content.narratorMode":"Modo Narrador","node.content.narratorMode.normal":"Normal / Voz en off","node.content.narratorMode.dual":"Dos Narradores","node.content.narratorMode.first_person":"Primera Persona","node.content.role":"Rol","node.content.role.narrator":"Narrador","node.content.role.announcer":"Locutor","node.content.role.first_person":"Primera Persona","node.content.role.dual_narrator":"Dos Narradores","node.content.role.dual_announcer":"Dos Locutores","node.content.scene":"Escena","node.content.scene_plural":"escenas","node.content.scenes":"Escenas","node.content.scenes_generated":"Escenas Generadas: {count}","node.content.sceneContext":"Contexto de Escena","node.content.sceneContextPlaceholder":"Estado de nimo, descripcin general del entorno...","node.content.scriptPromptPlaceholder":"Introduce una idea o concepto de historia...","node.content.seconds":"seg","node.content.stylePlaceholder":"Prompt de estilo...","node.content.stylePromptPlaceholder":"Introduce el prompt de estilo aqu...","node.content.styleOverride":"Anular Estilo","node.content.summary":"Resumen","node.content.targetLanguage":"Idioma Destino","node.content.textToSynthesize":"Texto a sintetizar...","node.content.translate":"Traducir","node.content.translatePlaceholder":"Texto para traducir...","node.content.translatedTextPlaceholder":"El texto traducido aparecer aqu...","node.content.translating":"Traduciendo...","node.content.useExistingCharacters":"Usar personajes existentes","node.content.useExistingCharactersInfo":"Usar datos de personajes conectados en lugar de generar nuevos.","node.content.createKeyItem":"Crear Secundarios/Objetos","node.content.createSecondaryChars":"Personajes Secundarios","node.content.createKeyItems":"Objetos Clave","node.content.createKeyItemInfo":"Permite a la IA crear personajes secundarios u objetos si la historia lo requiere.","node.content.noCharacters":"Sin personajes","node.content.noCharactersInfo":"El guion se centrar en eventos y atmsfera (estilo documental).","node.content.videoPrompt":"Dinmicas y Movimiento","node.content.videoPrompts":"Prompts de Video","node.content.voice":"Voz","node.content.previewVoice":"Probar Voz","node.content.voicePreviewText":"Hola, esta es una prueba de voz.","node.content.inputScripts":"Escenas de Entrada","node.content.inputFrames":"Cuadros de Entrada","node.content.outputScript":"Escenas de Salida","node.content.requestCategories":"Pedir Categoras","node.content.generateIdea":"Generar Idea","node.content.requestNewCategories":"Pedir Nuevas Categoras","node.content.category.action":"Accin","node.content.category.place":"Lugar","node.content.category.obstacle":"Obstculo","node.content.generatedIdea":"Idea Generada","node.content.storyFormat":"Formato de Historia","node.content.theme":"Tema","node.content.parameters":"Parmetros","node.content.advancedMode":"Modo Avanzado","node.content.numberOfScenes":"Nmero de escenas","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Trama Detallada","node.content.detailedPlotInfo":"Habilita descripciones detalladas de acciones y giros.","node.content.includeSubscribeScene":"Escena de Suscripcin","node.content.includeSubscribeSceneInfo":"Integra una escena rompiendo la cuarta pared pidiendo suscribirse.","node.content.genre":"Gnero","node.content.genre2":"Gnero 2","node.content.breakIntoParagraphs":"Dividir en prrafos","node.content.copyVideoPrompt":"Copiar prompt de video","node.content.generateVideoPrompt":"Generar prompt de video","node.content.model":"Modelo","node.content.processWholeScene":"Procesar escena completa","node.content.processWholeSceneInfo":"Procesa todos los cuadros de una escena en una sola llamada para mayor consistencia.","node.content.batchProcessing":"Procesamiento por Lotes","node.content.batchProcessingInfo":"Procesar todas las escenas seleccionadas en una ventana de contexto.","node.content.extendedAnalysis":"Anlisis Extendido","node.content.extendedAnalysisInfo":"Divide escenas en planos detallados para mejor ritmo.","node.content.professionalStoryboard":"Storyboard de Director","node.content.professionalStoryboardInfo":"Anlisis de escenas basado en reglas de lenguaje cinematogrfico.","node.content.generateStartEndFrames":"Generar Cuadros Inicio/Fin","node.content.autoIndexCharacters":"Auto-indexar Personajes","node.content.autoIndexCharactersInfo":"Reemplaza automticamente los nombres con sus alias en los resultados.","node.content.imageToText":"Imagen a Texto","node.content.extracting":"Extrayendo...","node.content.extractedText":"Texto Extrado","node.content.activePromptStack":"Pila de Prompts Activa","node.content.noCharactersAnalyzed":"No se encontraron personajes analizados.","node.content.promptsGeneratedPlaceholder":"Los prompts generados aparecern aqu.","node.content.noCharactersInScript":"No hay personajes en el guion.","node.content.noInputScenes":"Sin datos de entrada. Conecta un Generador de Guiones.","node.content.status":"Estado","node.content.status.ready":"Listo","node.content.status.paused":"Pausado","node.content.status.generating":"Generando","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Procesando: {current} de {total}","node.content.status.time":"Tiempo: {current}s / {total}s","node.content.refreshing":"Actualizando...","node.content.totalFrames":"Total Cuadros: {count}","node.content.uploadAudio":"Subir Audio/Video","node.content.noAudioLoaded":"Sin audio","node.content.audioLoaded":"Audio cargado","node.content.transcriptionPlaceholder":"La transcripcin aparecer aqu...","node.content.transcribe":"Transcribir","node.content.transcribing":"Transcribiendo...","node.content.convertingVideo":"Convirtiendo video...","node.content.recommendedFrames":"Cuadros Estimados","node.content.shotType":"Tipo de Plano","node.content.shotType.ws":"WS (Amplio)","node.content.shotType.ms":"MS (Medio)","node.content.shotType.cu":"CU (Primer Plano)","node.content.shotType.ecu":"ECU (Extremo)","node.content.shotType.ls":"LS (Largo)","node.content.characterDetail":"Detalle de Personajes","node.content.noCharDesc":"Sin descripciones de personaje","node.content.includeGeneralCharDesc":"Descripcin visual general","node.content.includeFullCharDesc":"Descripcin visual detallada","node.content.safeGeneration":"Generacin Segura","node.content.shotFilter":"Filtro de Planos","node.content.shotFilter.all":"Todos","node.content.shotFilter.wideOnly":"Solo Amplios","instruction.desc.shot_filter_all":"Permitir todos los tipos de plano (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringir a planos amplios (WS, MS, LS). Primeros planos prohibidos.","node.content.anthroEnabled":"Animales Antropomrficos","node.content.subscribeEnhancement":"Mejorar CTA Suscripcin","node.content.thinkingEnabled":"Modo Pensamiento","node.content.scenelessMode":"Escenas sin guion","instruction.desc.sceneless_mode":"Desactiva el motor narrativo. Genera lista de escenas directamente desde el concepto.","instruction.sceneless_mode":"Modo Lista de Escenas","node.content.microActionBreakdown":"Micro-Acciones","node.content.microActionBreakdownInfo":"Descompone acciones complejas en fases (Preparao, Accin, Reaccin).","node.content.commercialSafe":"Seguro Comercial","instruction.desc.commercial_safe":"Evita estrictamente marcas registradas (Disney, Pixar, etc.) y nombres de personajes con derechos de autor.","node.content.findStack":"Buscar en pila...","node.content.spm_stack.priming":"1. Preparacin y Contexto","node.content.spm_stack.physics":"2. Fsica y Lgica","node.content.spm_stack.hierarchy":"3. Jerarqua del Sujeto","node.content.spm_stack.construction":"4. Construccin y Formato"},R1={"genre.general":"General","genre.comedy":"Comedia","genre.drama":"Drama","genre.action":"Accin","genre.scifi":"Ciencia Ficcin","genre.fantasy":"Fantasa","genre.horror":"Terror","genre.thriller":"Suspense","genre.childrens_animation":"Animacin infantil","genre.shorts_story":"Historias cortas (Shorts)","genre.scientific_historical":"Narrativa Cientfico-Histrica","character_generator.promptPlaceholder":'Introduce una idea, ej: "valiente caballero, guardin del bosque antiguo"',"idea_generator.randomTheme":"Obtener tema aleatorio","idea_generator.randomCombination":"Combinacin aleatoria","idea_generator.themePlaceholder":"ej. Espacio, Cocina, Bosque Encantado","idea_generator.initialMessage":'Introduce un tema (opcional) y pulsa "{buttonName}" para comenzar.',"idea_generator.ideaPlaceholder":"La idea generada aparecer aqu...","idea_generator.format.general":"General","idea_generator.format.childrens":"Infantil","idea_generator.format.adventure":"Aventura","idea_generator.format.fantasy":"Fantasa / Magia","idea_generator.format.detective":"Detective","idea_generator.format.scifi":"Ciencia Ficcin","idea_generator.format.horror":"Terror","idea_generator.format.historical":"Histrico","gender.male":"Masculino","gender.female":"Femenino","node.content.autoDownload":"Descarga automtica al generar","node.content.downloadSelected":"Descargar Seleccionados","node.content.intonation":"Entonacin","intonation.standard":"Estndar","intonation.cheerful":"Alegre","intonation.angry":"Enojado","intonation.sad":"Triste","intonation.excited":"Emocionado","intonation.announcer":"Locutor","intonation.whispering":"Susurrando","node.content.sceneMode":"Modo Escena","node.content.connectNarratorData":'Conecta "Todos los Datos del Narrador" desde un Generador de Guiones.',"node.content.sceneModeActive":"Modo Escena activo. Datos recibidos por conexin.","speech_synthesizer.mode.simple":"Simple","speech_synthesizer.mode.scene":"Escena","speech_synthesizer.multiSpeaker":"Dos Locutores","speech_synthesizer.speaker1Name":"Nombre Locutor 1","speech_synthesizer.speaker2Name":"Nombre Locutor 2","speech_synthesizer.multiSpeakerHint":'Los nombres deben coincidir con los del texto (ej. "Hombre: ...", "Mujer: ...").',"speech_synthesizer.ssmlHint":"La entonacin se controla mediante etiquetas SSML en el texto.","youtube_analytics.authorName":"Nombre del Autor","youtube_analytics.videoTitle":"Ttulo del Video","youtube_analytics.views":"Vistas","youtube_analytics.addToChannel":"Aadir al Canal","youtube_analytics.noIncomingData":"Sin datos entrantes.","youtube_analytics.videoAdded":"Video aadido!","youtube_analytics.dragDrop":"Arrastra captura de fila aqu","youtube_analytics.thumbnailUpdated":"Miniatura actualizada","youtube_analytics.statsTrend":"Tendencia de Estadsticas","youtube_analytics.currentChannel":"Canal Actual","youtube_analytics.growth":"Crecimiento","youtube_analytics.allChannels":"Todos los Canales","youtube_analytics.saveDisk":"Guardar Disco","youtube_analytics.saveCatalog":"Guardar Catlogo","youtube_analytics.loadDisk":"Cargar Disco","youtube_analytics.analyzing":"Analizando...","youtube_analytics.askAI":"Preguntar a IA","youtube_analytics.clickForAdvice":'Clic en "Preguntar a IA" para consejos.',"youtube_analytics.dailyNotes":"Notas Diarias","youtube_analytics.logDailyStats":"Registrar Estadsticas","youtube_analytics.subscribers":"Suscriptores","youtube_analytics.totalViews":"Vistas Totales","youtube_analytics.updateStats":"Actualizar","youtube_analytics.history":"Historial","youtube_analytics.noHistory":"Sin historial.","youtube_analytics.noNotes":"Sin notas.","youtube_analytics.noVideos":"Sin videos.","youtube_analytics.loadedFromDisk":"Cargado desde disco","youtube_analytics.loadFailed":"Fallo al cargar","youtube_analytics.savedToDisk":"Guardado en disco","youtube_title_generator.mode.title":"Ttulo de Video","youtube_title_generator.mode.channel":"Info de Canal","youtube_title_generator.ideaPlaceholder":"Introduce idea o tema del video...","youtube_title_generator.channelIdeaPlaceholder":"Introduce tema o nicho del canal...","youtube_title_generator.title":"Ttulo","youtube_title_generator.description":"Descripcin","youtube_title_generator.tags":"Etiquetas","youtube_title_generator.channelName":"Nombre del Canal","youtube_title_generator.channelDescription":"Descripcin del Canal","youtube_title_generator.channelKeywords":"Palabras Clave","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Letras","music_idea_generator.mode.music_prompt":"Prompt Musical","music_idea_generator.ideaPlaceholder":"Introduce tema o estado de nimo...","music_idea_generator.songTitle":"Ttulo de Cancin","music_idea_generator.songTitlePlaceholder":"Ttulo...","music_idea_generator.lyricsPlaceholder":"La letra aparecer aqu...","music_idea_generator.musicPromptPlaceholder":"El prompt musical IA aparecer aqu...","chat.mode.general":"General","chat.mode.script":"Experto en Guiones","chat.mode.prompt":"Experto en Prompts","chat.mode.youtube":"Experto en YouTube"},M1={"catalog.title":"Catlogo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca de Prompts","catalog.tabs.characters":"Personajes","catalog.tabs.scripts":"Guiones","catalog.tabs.analysis":"Anlisis","catalog.tabs.final_prompts":"Prompts Finales","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Ideas Musicales","catalog.empty.title":"El catlogo est vaco","catalog.empty.description":"Guarda un elemento para verlo aqu, o imprtalo desde un archivo.","catalog.loadFromFile":"Aadir al Catlogo desde Archivo","catalog.card.addToCanvas":"Aadir al Lienzo","catalog.card.rename":"Renombrar","catalog.card.save":"Guardar en Disco","catalog.card.delete":"Eliminar","library.loadFromFile":"Cargar desde Archivo","library.empty.title":"La carpeta est vaca","library.empty.description":"Crea una nueva carpeta o prompt para comenzar.","library.emptyPrompt":"Sin contenido","library.actions.newFolder":"Nueva Carpeta","library.actions.newPrompt":"Nuevo Prompt","library.actions.copy":"Copiar al Portapapeles","library.actions.edit":"Editar Prompt","group.rename":"Renombrar Grupo","group.saveToCatalog":"Guardar en Catlogo","group.saveToDisk":"Guardar en Disco","group.ungroup":"Desagrupar (Shift+Clic para eliminar contenido)","group.button.create":"Agrupar ({count})"},L1={"dialog.rename.title":"Renombrar Elemento","dialog.rename.group.title":"Renombrar Grupo","dialog.rename.catalog.title":"Renombrar Elemento del Catlogo","dialog.rename.label":"Nuevo nombre","dialog.rename.confirm":"Renombrar","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nombre del Prompt","dialog.promptEdit.contentLabel":"Contenido","dialog.promptEdit.confirm":"Guardar","dialog.promptEdit.cancel":"Cancelar","dialog.reset.title":"Restablecer Lienzo","dialog.reset.message":"Ests seguro de querer restablecer el lienzo a su estado predeterminado? Esto borrar todo el trabajo actual.","dialog.exit.title":"Cerrar Proyecto?","dialog.exit.message":"Ests seguro? Todos los datos no guardados se perdern y volvers a la pantalla de bienvenida.","dialog.settings.title":"Ajustes","dialog.settings.apiKeyLabel":"Clave API de Gemini","dialog.settings.apiKeyPlaceholder":"Introduce tu clave API aqu","dialog.settings.getApiKeyLink":"Obtener clave API en Google AI Studio","dialog.settings.useFreeKey":"Usar clave API gratuita (limitada)","dialog.settings.save":"Guardar","dialog.settings.close":"Cerrar","dialog.apiKey.title":"Ajustes de Clave API","dialog.apiKey.description":"Para usar esta aplicacin, necesitas una clave API de Gemini. Por favor, introdcela abajo. Se almacenar localmente en tu navegador.","dialog.apiKey.keyExists":"Ya hay una clave API guardada en tu navegador.","dialog.apiKey.clear":"Borrar Clave","dialog.apiKey.save":"Guardar Clave","dialog.apiKey.update":"Actualizar Clave","dialog.apiKey.useFreeKey":"Usar clave gratuita (para desarrollo)","dialog.permission.title":"Acceso al Portapapeles","dialog.permission.description":'Esta aplicacin solicita acceso al portapapeles para habilitar la funcin "Pegar" en los nodos. Solo leeremos tu portapapeles cuando uses explcitamente esta funcin.',"dialog.permission.decline":"Rechazar","dialog.permission.allow":"Permitir","alert.groupSaved":'Grupo "{groupTitle}" guardado en el catlogo!',"toast.groupSavedToDisk":'Grupo "{groupTitle}" guardado en disco!',"alert.confirmDelete":"Ests seguro de que deseas eliminar este elemento del catlogo?","alert.invalidCatalogFile":"Archivo de catlogo invlido o corrupto.","alert.loadCatalogFailed":"Fallo al cargar elemento del catlogo","alert.confirmLoadProject":"Cargar un proyecto reemplazar todos los datos actuales (pestaas, catlogo, ajustes). Ests seguro?","dialog.confirmDelete.title":"Confirmar Eliminacin","dialog.confirmDelete.message":'Ests seguro de que deseas eliminar "{itemName}"? Esta accin no se puede deshacer.',"dialog.confirmDelete.folderMessage":'Ests seguro de que deseas eliminar la carpeta "{itemName}" y todo su contenido? Esta accin no se puede deshacer.',"dialog.confirmDelete.confirm":"Eliminar","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmClear.title":"Confirmar Limpieza de Lienzo","dialog.confirmClear.message":"Ests seguro de que deseas eliminar todo del lienzo? Esta accin no se puede deshacer.","toast.copied":"Copiado al portapapeles","toast.pasted":"Pegado!","toast.cleared":"Limpiado","toast.resetComplete":"Restablecido por defecto","toast.projectSaved":"Proyecto guardado en disco","toast.saveFailed":"Fallo al guardar proyecto","toast.connectionsCut":"Conexiones cortadas","toast.charSaved":"Personaje guardado en disco","toast.charLoaded":"Personaje cargado","toast.videoPasted":"Video aadido desde portapapeles","toast.savedToCatalog":"Guardado en Catlogo","toast.apiKeySaved":"Clave API guardada con xito","toast.apiKeyCleared":"Clave API eliminada","toast.projectLoaded":"Proyecto cargado con xito","alert.batchMismatch":"Advertencia: Discrepancia de cuadros en Escena {scene} (Esperado: {expected}, Obtenido: {got}). Mapeo aproximado."},j1={"instruction.desc.safe_gen":"RESTRICCIN DE SEGURIDAD CRTICA: Evita estrictamente palabras que activen filtros de seguridad de IA. Reemplaza trminos como 'adolescente', 'ntimo' o 'revelador' con alternativas artsticas como 'joven', 'composicin artstica' o 'estilizado'.","instruction.desc.layered_no_style":"Estructura: 1. [Fondo Global (Cielo -> Horizonte -> Plano Medio)] -> 2. [Jerarqua del Sujeto (Personaje Completo -> Postura -> Micro-Accin)] -> 3. [Cmara]. NUNCA describas una accin sin describir primero al personaje completo."},D1={"instruction.sg_inputs":"Datos de Entrada","instruction.desc.sg_inputs":"Fuente: Concepto/Idea, Perfiles de Personaje.","instruction.core_director":"Director Principal","instruction.desc.core_director":"Eres un Director de Cine Visionario y Guionista. Piensa en lentes, movimiento y composicin. Cada palabra es un comando cinematogrfico.","instruction.sg_thinking":"Analizar","instruction.desc.sg_thinking":"Razonar antes de escribir. Analizar causalidad y lgica. Eliminar clichs.","instruction.sg_improve_input":"Doctor de Guion","instruction.desc.sg_improve_input":"Mejorar concepto inicial, arreglar agujeros de trama y agudizar conflicto.","instruction.sg_exposition":"Exposicin","instruction.desc.sg_exposition":"Mostrar el estado del mundo a travs de historia ambiental y detalles.","instruction.sg_delayed_reveal":"Revelacin","instruction.desc.sg_delayed_reveal":"Intro gradual de hroe: entorno -> detalles -> silueta -> cara.","instruction.sg_metaphor":"Metfora","instruction.desc.sg_metaphor":"Usar smbolos visuales (objetos rotos, clima) para estados internos.","instruction.sg_pacing":"Ritmo","instruction.desc.sg_pacing":"Control de ritmo: equilibrar tomas contemplativas con edicin dinmica.","instruction.sg_subtext":"Subtexto","instruction.desc.sg_subtext":"Crear tensin entre dilogo y accin. Personajes rara vez dicen la verdad directamente.","instruction.desc.sg_frame_estimation":"Clculo recomendado de planos.","instruction.rule_visuals":"Visuales Primero","instruction.desc.rule_visuals":"Muestra, No Cuentes. En lugar de decir 'Estaba triste', describe 'Se desplom en la silla'. Foco en iluminacin, composicin, movimiento.","instruction.sg_visual_dna":"ADN Visual","instruction.desc.sg_visual_dna":"Sintetiza prompts de personajes y parmetros de estilo en una gua tcnica LookDev (Iluminacin, Lentes, Render) separada de la trama.","instruction.rule_flow":"Flujo Continuo","instruction.desc.rule_flow":"Lgica de Match Cut: Usa formas, colores o sonidos para transiciones fluidas entre escenas.","instruction.rule_atmosphere":"Atmsfera","instruction.desc.rule_atmosphere":"Describe detalles tctiles: olor a lluvia, zumbido de nen, textura de polvo. Haz el mundo real.","instruction.sg_visual_style":"Estilo Visual","instruction.desc.sg_visual_style":"Solicitud: Generar una descripcin de estilo visual detallada basada en '{style}'.","instruction.char_detailed_style":"Detalle Estilizado","instruction.desc.char_detailed_style":"Integra el estilo visual global en el prompt tcnico de cada personaje para consistencia visual mxima.","instruction.sg_genre":"Contexto de Gnero","instruction.desc.sg_genre":"Contexto: {genre}","instruction.char_smart_concept":"Concepto Inteligente","instruction.desc.char_smart_concept":"IA elige: Cuerpo Completo para Personajes / Relleno de Cuadro para Objetos.","instruction.char_no_dupes":"Sin Duplicados","instruction.desc.char_no_dupes":"CRTICO: NO regeneres personajes a menos que se requiera CAMBIO DE VESTUARIO. En ese caso, crea un duplicado con la nueva ropa.","instruction.create_secondary_chars":"Personajes Secundarios","instruction.desc.create_secondary_chars":"PUEDES generar nuevos personajes secundarios si la trama lo requiere. Cambios de vestuario permitidos.","instruction.create_key_items":"Objetos Clave","instruction.desc.create_key_items":"Creacin obligatoria de 'Fichas de Personaje' para objetos que aparecen en >2 cuadros o mltiples escenas.","instruction.char_secondary_ok":"Nuevos Permitidos","instruction.desc.char_secondary_ok":"PUEDES generar nuevos personajes secundarios u objetos clave. SI CAMBIA ROPA: Crea una nueva ficha para el personaje principal con el nuevo prompt de ropa.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Los personajes deben ser animales Antropomrficos.","instruction.sg_no_chars":"Sin Personajes","instruction.desc.sg_no_chars":"Estilo documental / Sin personajes nombrados.","instruction.sg_detailed_plot":"Trama Detallada","instruction.desc.sg_detailed_plot":"Proporcionar descripciones altamente detalladas de acciones y trama.","instruction.sg_subscribe":"Escena Suscripcin","instruction.desc.sg_subscribe":"Incluir una escena rompiendo la 4 pared pidiendo suscribirse.","instruction.char_gray_bg":"Concepto Visual","instruction.desc.char_gray_bg":"Para cada prompt visual de personaje, SIEMPRE aade: ', full body character concept on a gray background'.","instruction.char_no_new":"Sin Nuevos","instruction.desc.char_no_new":"NO crees nuevos personajes u objetos. Usa SOLO los Personajes Existentes proporcionados.","instruction.sg_new_chars":"Nuevos Personajes","instruction.desc.sg_new_chars":"Generar nuevos personajes basados en el prompt.","instruction.sg_living_world":"Mundo Vivo","instruction.desc.sg_living_world_simple":"Los extras de fondo son personas normales.","instruction.desc.sg_living_world_anthro":"Los extras de fondo son animales antropomrficos.","instruction.sg_simple_actions":"Acciones Simples","instruction.desc.sg_simple_actions":"Evitar fsica compleja/acrobacias. Preferir poses estables y renderizables.","instruction.commercial_safe":"Seguro Comercial","instruction.desc.commercial_safe":"Evita estrictamente marcas registradas (Disney, Pixar, etc.) y nombres de personajes con derechos de autor."},O1={"instruction.ana_role":"Rol de Analizador","instruction.desc.ana_role":"Eres un Director de Cine y Director de Fotografa de clase mundial. Escribes instrucciones para la generacin de imgenes y video por IA. Cada cuadro debe describirse repetidamente y en detalle, independientemente del anterior, manteniendo el contexto de los cuadros anteriores. No utilices abreviaturas ni recursos literarios.","instruction.ana_cinema":"Cinematografa","instruction.desc.ana_cinema":"Trminos profesionales: Wide Shot, Close-up, Dutch Angle, Bokeh para encuadre e iluminacin.","instruction.ana_cinema_wide":"Cinematografa (Amplia)","instruction.desc.ana_cinema_wide":"Trminos profesionales: Wide Shot, Long Shot, Dutch Angle para encuadre. Evitar Close-up.","instruction.ana_anthro_logic":"Lgica Anthro","instruction.desc.ana_anthro_logic":'Describir explcitamente personajes como Animales Antropomrficos (ej., "Anthropomorphic Fox") en cada descripcin.',"instruction.ana_subscribe_logic":"CTA Suscripcin","instruction.desc.ana_subscribe_logic":"Si la escena pide Suscribirse, aadir acciones visuales: personajes con carteles o interactuando con texto 3D.","instruction.rule_hierarchy":"Algoritmo Maestro de Encuadre","instruction.desc.rule_hierarchy":"Orden estricto: 1. Global (Ubicacin/Clima/nimo/Actividad). 2. Postura (Tumbado/De pie en objeto). 3. Interaccin con Objeto (Color/Material/Textura). 4. Accin.","instruction.rule_living_world":"Mundo Vivo","instruction.desc.rule_living_world":"Si es lugar pblico, describe extras/siluetas de fondo consistentes con el contexto del mundo.","instruction.desc.rule_living_world_anthro":"Los extras de fondo deben ser animales antropomrficos (NO humanos).","instruction.rule_persistence":"Persistencia","instruction.desc.rule_persistence":"PERSISTENCIA CRONOLGICA DE ESCENA: Mantener un estado global persistente para toda la escena. Cada cuadro es parte de un espacio fsico nico. Rastrea la posicin exacta, pose y estado de cada personaje y objeto. Si el Personaje A est en el Cuadro 1 pero la cmara corta al Personaje B en el Cuadro 2, el Personaje A debe seguir existiendo lgicamente en su ltima posicin.","instruction.rule_mandatory_bg":"Fondo Global Obligatorio","instruction.desc.rule_mandatory_bg":"PROHIBIDO dejar el fondo vaco o decir solo 'fondo borroso'. Describe siempre la ubicacin y la iluminacin completamente, incluso para tomas macro.","instruction.desc.rule_mandatory_bg_wide":"PROHIBIDO dejar el fondo vaco. Como usas SOLO PLANOS AMPLIOS, debes proporcionar detalles completos de geografa, horizonte y clima en cada cuadro.","instruction.shot_filter_wide":"Solo Planos Amplios","instruction.desc.shot_filter_wide":"FILTRO ESTRICTO: Usar SOLO Planos Amplios (WS), Largos (LS) y Medios (MS). Primeros Planos (CU/ECU) prohibidos.","instruction.storyboard_rules":"Variedad de Planos","instruction.desc.storyboard_rules":"Alternar entre planos WS/LS (Ancho), MS (Medio) y CU/ECU (Primer Plano) para ritmo dinmico y enfoque emocional.","instruction.storyboard_rules_wide":"Variedad de Planos (Solo Amplios)","instruction.desc.storyboard_rules_wide":"Usar solo planos Amplios, Largos y Establecimiento. Variar ngulo. NO Primeros Planos.","instruction.tech_directives":"Control de Cmara","instruction.desc.tech_directives":"Terminologa tcnica estricta. Para tipos de plano usar SOLO abreviaturas (WS, MS, CU).","instruction.tech_directives_wide":"Control de Cmara (Amplio)","instruction.desc.tech_directives_wide":"Terminologa tcnica estricta. Usar SOLO abreviaturas (WS, MS, LS). NO CU/ECU.","instruction.use_aliases":"Usar Alias","instruction.desc.use_aliases":"Usar formato Character-N en arrays.","instruction.action_phase_breakdown":"Micro-Acciones","instruction.desc.action_phase_breakdown":"Descomponer acciones complejas en fases de preparacin, inicio, pice y reaccin.","instruction.desc.action_phase_breakdown_wide":"Descomponer fases, pero MANTENIENDO PLANO AMPLIO. Mostrar impacto por postura corporal, no zoom.","instruction.batch_processing":"Procesamiento por Lotes","instruction.desc.batch_processing":"Analizar todas las escenas proporcionadas como una secuencia continua para mantener consistencia narrativa y visual.","instruction.ana_prompt_lang":"Idioma de Prompt","instruction.desc.ana_prompt_lang":"Prompts de imagen y video estrictamente en ingls para mejor compatibilidad.","instruction.extended_visuals":"Desglose Visual Extendido","instruction.desc.extended_visuals":"Descompone escenas en secuencias cortas y expresivas (Wide, MS, CU, Detalle). Foco en ritmo cinemtico y emocin.","instruction.extended_visuals_wide":"Desglose Visual Extendido (Amplio)","instruction.desc.extended_visuals_wide":"Descompone escenas en secuencias usando estrictamente planos Amplios/Medios. Foco en geografa y atmsfera. Sin Primeros Planos.","instruction.desc.target_lang":"El anlisis de cuadros y descripciones se generarn en este idioma.","instruction.rule_isolation":"Cero Contexto","instruction.desc.rule_isolation":"CRTICO: El generador de imgenes NO SABE sobre el cuadro anterior. DEBES volver a describir el entorno y el clima en cada cuadro.","instruction.sensory_saturation":"Anti-Brevedad","instruction.desc.sensory_saturation":'PROHIBIDO ser breve. En lugar de "Manos agarrando", escribe "Manos sucias con nudillos blancos agarrando fuertemente el vidrio fro".',"instruction.ana_no_pov":"No POV","instruction.desc.ana_no_pov":'NEGATIVO CRTICO: PROHIBICIN ESTRICTA de tomas "POV" o de "Primera Persona". La cmara DEBE ser externa.',"instruction.desc.static_frame_logic":'PROHIBICIN ESTRICTA de verbos de movimiento ("caminar", "balancearse"). Describe un momento CONGELADO. "Espuma congelada en el aire", "Hojas inclinadas por el viento".',"instruction.desc.anatomical_posing":'Describe GEOMETRA corporal. En lugar de "descansando", escribe: "Acostado supino, brazos a los lados, cabeza inclinada hacia atrs".',"instruction.desc.motion_dynamics":"SEPARACIN: Image Prompt = 100% Esttico. Video Prompt = Movimiento y Tiempo (respiracin, olas, viento).","instruction.desc.anatomical_strictness":'RIGGING: Evita "Brazos detrs de la cabeza Y sosteniendo bebida". Fuerza descripcin separada: Brazo Izquierdo [estado], Brazo Derecho [estado].',"instruction.desc.prop_consistency":'BLOQUEO DE OBJETOS: Prohibido usar sustantivos genricos ("espada", "telfono"). Debe especificar atributos visuales ("espada de hierro oxidada", "telfono de plstico negro") y repetirlos.',"instruction.desc.subject_hierarchy":'Incluso para Primeros Planos, describe: 1. Personaje Completo/Postura. 2. Interaccin con Entorno. 3. El Detalle. Ejemplo: "Parado en una tabla de surf blanca dentro de una ola -> Primer plano de cara mojada".',"instruction.inputs_data":"Entradas","instruction.desc.inputs_data":"Datos fuente: Resumen del guion, Perfiles de personajes, Textos de escenas."},F1={"instruction.inputs":"Entradas","instruction.desc.inputs":"Fuente de Datos: Cuadros del guion, Visuales de personajes, Estilo de escena, Contexto Global.","instruction.role":"Rol: Artista de Entornos Principal","instruction.desc.role":"Eres un experto Artista de Entornos e Ingeniero de Prompts. Sintetiza las entradas en una descripcin visual definitiva.","instruction.layered":"Algoritmo: Flujo Unificado","instruction.desc.layered":"Genera un bloque NICO y continuo de texto. Estructura: [Estilo] -> [DISEO MAESTRO DEL SET] -> [Visuales] + [POSE Y ACCIN] -> [Cmara].","instruction.desc.layered_no_char":"Estructura: [DISEO MAESTRO] -> [ndice] + [POSE Y ACCIN]. Omite la apariencia del personaje, manteniendo solo ndices y acciones.","instruction.visuals":"Estilo: Saturacin","instruction.desc.visuals":"Usa descriptores visuales ricos: iluminacin volumtrica, claroscuro, texturas 8k, profundidad de campo.","instruction.process_whole_scene":"Lote de Escena","instruction.desc.process_whole_scene":"Analizar la escena completa a la vez para consistencia.","instruction.video":"Video","instruction.desc.video":"Prompt de Video: [ndice] (Desc Visual Detallada) [Accin] en un bloque. Dinmicas: [Movimiento Entorno]. Cmara: [Movimientos]. SIN NOMBRES.","instruction.stateless":"Regla: Sin Estado","instruction.desc.stateless":"Trata cada cuadro como independiente. Redescribe completamente el entorno incluso si estaba en el cuadro anterior. OBLIGATORIO: Redescribe completamente la accin de CADA personaje desde cero (Postura -> Extremidades -> Cara).","instruction.rule_static":"Regla: Esttico","instruction.desc.rule_static":"Describe solo el momento congelado. Sin transies narrativas.","instruction.atmosphere_fix":"Ancla Atmosfrica","instruction.desc.atmosphere_fix":"Describe el estado de nimo como propiedades fsicas del aire y la luz.","instruction.subject_focus":"Jerarqua de Contexto","instruction.desc.subject_focus":"CRTICO: Incluso para Primeros Planos, describe 1. Personaje Completo. 2. Pose. 3. Detalle. La IA necesita el contexto corporal completo para renderizar partes correctamente.","instruction.always_env":"DISEO DE SET OBLIGATORIO","instruction.desc.always_env":"CRTICO: Usa el 'Contexto Global de Escena' como la VERDAD ABSOLUTA para el fondo. DEBES inyectar los detalles especficos de muebles, iluminacin y texturas del contexto en la capa de entorno de CADA prompt. No inventes fondos genricos.","instruction.pm_anthro":"Detalle Anthro","instruction.desc.pm_anthro":'OBLIGATORIO: Palabra "anthropomorphic" antes de especie en Imagen Y Video. Texturas/anatoma mejoradas.',"instruction.pm_subscribe":"Texto Legible","instruction.desc.pm_subscribe":'Asegurar que texto como "SUBSCRIBE" sea legible e integrado (nen, letreros, 3D) en el prompt final.',"instruction.strict_char_index":"Personajes","instruction.desc.strict_char_index":"Mapear estrictamente Alias de personajes (Character-N) a cada dato de cuadro.","instruction.no_names":"CRTICO: SIN NOMBRES","instruction.desc.no_names":'CRTICO: PROHIBICIN ABSOLUTA DE NOMBRES. Usa ESTRICTAMENTE el ID de ndice (Character-N). Prohibido "Character-1 (Nombre)". Salida SOLO "[Character-1]".',"instruction.general_char_desc":"Detalle General","instruction.desc.general_char_desc":"Resumir e incorporar una versin CONCISA y GENERAL del prompt visual del perfil del personaje.","instruction.full_char_desc":"Detalle Completo","instruction.desc.full_char_desc":"Incorporar el prompt visual COMPLETO y DETALLADO del perfil del personaje exactamente como est escrito.","instruction.formatting":"Formato","instruction.desc.formatting":"Habilita ENCABEZADOS explcitos (Entorno, Interaccin, Tcnico) y saltos de lnea. salo si prefieres estructura en lugar de texto plano.","instruction.anatomical_strictness":"Lgica Anatmica","instruction.desc.anatomical_strictness":'RIGGING: Previene "Brazos detrs de la cabeza Y sosteniendo bebida". Fuerza descripcin separada: Brazo Izquierdo [estado], Brazo Derecho [estado]. Elimina extremidades extra.',"instruction.img_vid_consistency":"Flujo Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Cuadro Inicial (Esttico). Video Prompt = Accin/Movimiento (Evolucin). Asegura que el video evolucione naturalmente desde la imagen esttica.","instruction.desc.prop_enhancement":'MATERIALIDAD: Amplifica descripciones de objetos (ej. "tabla roja" -> "fibra de vidrio roja brillante"). Preserva colores/tipos especificados.',"instruction.no_pov":"CRTICO: NO POV","instruction.desc.no_pov":'PROHIBICIN ESTRICTA de ngulos POV/Primera Persona. La cmara DEBE ser externa (Tercera Persona). No usar "visto a travs de los ojos".'},z1={"instruction.music_role":"Rol de Productor Musical","instruction.desc.music_role":"Definicin del rol de Compositor y Letrista experto.","instruction.music_input":"Datos de Entrada","instruction.desc.music_input":"El tema o idea proporcionada por el usuario.","instruction.music_creative":"Libertad Creativa","instruction.desc.music_creative":"Fuerza a la IA a interpretar el ambiente metafricamente, no literalmente. Evita salidas genricas.","instruction.music_lyrics":"Estructura de Letra","instruction.desc.music_lyrics":"Genera estructura de Verso/Estribillo adecuada al gnero.","instruction.music_prompt_rule":"Prompt Musical IA","instruction.desc.music_prompt_rule":"Etiquetas tcnicas para Suno/Udio (BPM, Instrumentos, Vocales). Mx 1000 caracteres.","instruction.music_format":"Salida JSON","instruction.desc.music_format":"Estructura JSON estricta para integracin."},G1={"instruction.yt_role":"Estratega de YouTube","instruction.desc.yt_role":"Experto en SEO, CTR y Psicologa Viral.","instruction.yt_input":"Datos de Entrada","instruction.desc.yt_input":"El tema o nicho proporcionado.","instruction.yt_title_mode":"Metadatos de Video","instruction.desc.yt_title_mode":"Optimiza Ttulos/Desc/Etiquetas para mximos clics.","instruction.yt_channel_mode":"Branding de Canal","instruction.desc.yt_channel_mode":"Crea Nombre, Bio y Handle consistentes.","instruction.yt_format":"Salida JSON","instruction.desc.yt_format":"Estructura JSON estricta para integracin."},U1={...j1,...D1,...O1,...F1,...z1,...G1},H1={...A1,...I1,...P1,...R1,...M1,...L1,...U1},B1={"app.title":"Ssenariy Modifikatori","app.description":"Gemini API yordamida ssenariylarni vizual tarzda yarating, takomillashtiring va generatsiya qiling.","app.slogan":"Goyalarni boglab, shoh asar yarating","app.subtitle":"Ssenariylaringizni Vizualizatsiya Qiling","app.error.title":"Bildirishnoma","app.error.copy":"Xatoni nusxalash","app.error.copied":"Nusxalandi!","error.quotaExceeded":"Foydalanish limitiga yetdingiz. Iltimos, API kalitingiz kvotasini tekshiring yoki keyinroq urinib koring.","error.apiKeyMissing":"API kaliti topilmadi. Iltimos, sozlamalarda Gemini API kalitingizni kiriting.","error.freeKeyNotAvailable":"Bepul/ishlab chiquvchi API kaliti ushbu muhitda mavjud emas. Iltimos, oz kalitingizni taqdim eting.","error.fileReadError":"Faylni oqishda xatolik.","error.videoConversionError":"Videoni audioga aylantirib bolmadi.","error.unsupportedFile":"Qollab-quvvatlanmaydigan fayl turi.","error.promptModifierFile":"Ushbu fayl boshqa dasturga tegishli (Prompt Modifier). Iltimos, uni tegishli ilovada oching.","error.invalidFileType":"Notogri fayl turi. Iltimos, Script Modifier loyihasi yoki kanvas faylini yuklang.","welcome.iAmDeveloper":"Men dasturchiman","welcome.letsGo":"Kettik!","welcome.resume":"Davom ettirish","welcome.reload":"Qayta yuklash","welcome.reloadTitle":"Qayta yuklansinmi?","welcome.reloadMessage":"Bu butun kanvasni tozalaydi va ilovani qayta yuklaydi. Saqlanmagan ma'lumotlar yo'qoladi. Ishonchingiz komilmi?","welcome.confirmReload":"Qayta yuklash","dialog.welcome.title":"Ssenariy Modifikatori","dialog.welcome.heading":"Xush kelibsiz","dialog.welcome.intro1":"Ssenariy Modifikatoriga xush kelibsiz  bu Gemini bilan hikoyalar yaratish uchun vizual ish maydoningiz.","dialog.welcome.intro2":"Boshlash uchun tilingizni tanlang va Gemini API kalitingizni kiriting.","dialog.welcome.apiKeyExplanation":"Sizning API kalitingiz brauzeringizda lokal saqlanadi. Biz uni Google Gemini API dan boshqa hech qanday serverga yubormaymiz."},V1={"toolbar.edit":"Tahrirlash (V)","toolbar.cutter":"Ulanishni Kesish (C)","toolbar.selection":"Tanlash (S)","toolbar.reroute":"Yonalish nuqtasi (R)","toolbar.zoom":"Mashtab (Z)","toolbar.snapToGrid":"Torga yopishtirish (Shift+W)","toolbar.resetZoom":"Mashtabni tiklash","toolbar.lineStyleSpaghetti":"Spaghetti chiziqlar (Shift+E)","toolbar.lineStyleOrthogonal":"Togri burchakli chiziqlar (Shift+E)","toolbar.addNode":"Tugun qoshish (F)","toolbar.catalog":"Katalog (Ctrl+Space)","toolbar.settings":"Sozlamalar","toolbar.resetToDefault":"Asl holatga qaytarish","toolbar.closeProject":"Loyihani yopish / Tozalash","toolbar.enterFullscreen":"Toliq Ekran","toolbar.exitFullscreen":"Toliq Ekrandan Chiqish","toolbar.addTextInput":"Matn kiritish (T)","toolbar.addPromptAnalyzer":"Prompt Tahlilchisi (A)","toolbar.addCharacterAnalyzer":"Personaj Tahlilchisi","toolbar.addCharacterGenerator":"Personaj Generatori (Shift+C)","toolbar.addImageGenerator":"Rasm Generatori (O)","toolbar.addImagePreview":"Rasmni Korish (I)","toolbar.addCharacterCard":"Personaj Kartasi (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Prompt Protsessori (P)","toolbar.addGeminiChat":"Gemini Chat (M)","toolbar.addTranslator":"Tarjimon (L)","toolbar.addIdeaGenerator":"Goya Generatori (Shift+A)","toolbar.addScriptGenerator":"Ssenariy Generatori (Shift+S)","toolbar.addScriptAnalyzer":"Ssenariy Tahlilchisi (Shift+D)","toolbar.addScriptPromptModifier":"Prompt Finalizatori (Shift+F)","toolbar.addErrorAnalyzer":"Xatolar Tahlilchisi","toolbar.addNote":"Eslatma (N)","toolbar.addDataReader":"Malumot Oquvchi (Shift+R)","toolbar.addSpeechSynthesizer":"Nutq Sintezatori (Shift+N)","toolbar.addNarratorTextGenerator":"Hikoyachi Matni Generatori (Shift+G)","toolbar.addAudioTranscriber":"Audio Transkriber (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube Sarlavha Generatori (Shift+T)","toolbar.addMusicIdeaGenerator":"Musiqa Goyasi Generatori (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analitika (Shift+Y)","toolbar.saveCanvas":"Kanvasni Saqlash (Ctrl+S)","toolbar.saveProject":"Loyihani Saqlash (Ctrl+Shift+S)","toolbar.loadCanvas":"Yuklash (Ctrl+O)","toolbar.clearCanvas":"Kanvasni Tozalash","toolbar.group.general":"Umumiy","toolbar.group.scripting":"Ssenariy","toolbar.group.prompting":"Prompt va Tahlil","toolbar.group.characters":"Personajlar","toolbar.group.ai":"AI Vositalari","toolbar.group.file":"Fayl","toolbar.group.images":"Rasmlar","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Kanvas Boshqaruvi","toolbar.expand":"Panelni yoyish","toolbar.collapse":"Panelni yigish","toolbar.toggleHeaders":"Sarlavhalarni almashtirish","hotkeys.file.title":"Fayl","hotkeys.file.save":"Saqlash (Ctrl+S)","hotkeys.file.saveProject":"Loyihani Saqlash (Ctrl+Shift+S)","hotkeys.file.load":"Yuklash (Ctrl+O)","hotkeys.tools.title":"Asboblar","hotkeys.tools.edit":"Tahrirlash","hotkeys.tools.cutter":"Kesuvchi","hotkeys.tools.selection":"Tanlash","hotkeys.tools.reroute":"Yonalish nuqtasi","hotkeys.tools.zoom":"Mashtab","hotkeys.tools.group":"Guruhlash (G)","hotkeys.tools.deleteGroup":"Guruhni ochirish","hotkeys.tools.closeNode":"Tugunni yopish","hotkeys.tools.toggleLineStyle":"Chiziq uslubini ozgartirish","hotkeys.tools.snapToGrid":"Torga yopishtirish","hotkeys.tools.selectAll":"Hammasini tanlash","hotkeys.tools.deselectAll":"Tanlovni bekor qilish","hotkeys.tools.duplicate":"Nusxalash (tarkibi bilan)","hotkeys.windows.title":"Oynalar","hotkeys.windows.search":"Qidiruv (F)","hotkeys.windows.quickAdd":"Tezkor qo'shish (Space)","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Tugun yaratish","hotkeys.hide":"Tugmalarni yashirish","help.title":"Tugmalar birikmasi","hotkeys.show":"Tugmalarni korsatish","search.placeholder":"Tugunni qidirish...","search.noResults":"Tugunlar topilmadi.","search.node.text_input.title":"Matn Kiritish","search.node.text_input.description":"Goyalaringiz uchun oddiy matn maydoni. (T)","search.node.prompt_processor.title":"Prompt Protsessori","search.node.prompt_processor.description":"AI yordamida promptlarni birlashtiradi va yaxshilaydi. (P)","search.node.prompt_analyzer.title":"Prompt Tahlilchisi","search.node.prompt_analyzer.description":"Promptni personaj va muhitga ajratadi. (A)","search.node.character_analyzer.title":"Personaj Tahlilchisi","search.node.character_analyzer.description":"Tavsifni personaj va kiyimga ajratadi.","search.node.character_generator.title":"Personaj Generatori","search.node.character_generator.description":"Goyadan batafsil personajlar yaratadi. (Shift+C)","search.node.image_generator.title":"Rasm Generatori","search.node.image_generator.description":"Matndan rasm yaratadi. (O)","search.node.image_preview.title":"Rasmni Korish","search.node.image_preview.description":"Fayldan rasmni korsatadi. (I)","search.node.character_card.title":"Personaj Kartasi","search.node.character_card.description":"Personaj rasmi, nomi va promptini saqlaydi. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Gemini AI bilan togridan-togri suhbat. (M)","search.node.translator.title":"Tarjimon","search.node.translator.description":"Matnni tanlangan tilga tarjima qiladi. (L)","search.node.script_generator.title":"Ssenariy Generatori","search.node.script_generator.description":"Hikoya goyasini ssenariy sahnalariga aylantiradi. (Shift+S)","search.node.script_analyzer.title":"Ssenariy Tahlilchisi","search.node.script_analyzer.description":"Ssenariyni kadrlar va rasm promptlariga ajratadi. (Shift+D)","search.node.script_prompt_modifier.title":"Prompt Finalizatori","search.node.script_prompt_modifier.description":"Tahlil qilingan malumotlardan yakuniy promptlarni yaratadi. (Shift+F)","search.node.error_analyzer.title":"Xatolar Tahlilchisi","search.node.error_analyzer.description":"Matndagi imlo va grammatik xatolarni tekshiradi.","search.node.note.title":"Eslatma","search.node.note.description":"Eslatmalar uchun oddiy matn maydoni. (N)","search.node.reroute_dot.title":"Yonalish nuqtasi","search.node.reroute_dot.description":"Ulanishlarni qayta yonaltirish va ajratish nuqtasi.","search.node.data_reader.title":"Malumot Oquvchi","search.node.data_reader.description":"Ulanishdan kelayotgan xom malumotlarni korsatadi.","search.node.speech_synthesizer.title":"Nutq Sintezatori","search.node.speech_synthesizer.description":"Matnni nutqqa aylantiradi. (Shift+N)","search.node.idea_generator.title":"Goya Generatori","search.node.idea_generator.description":"Goyalar generatori.","search.node.narrator_text_generator.title":"Hikoyachi Matni Generatori","search.node.narrator_text_generator.description":"Hikoyachi yoki diktor uchun matn yaratadi. (Shift+G)","search.node.audio_transcriber.title":"Audio Transkriber","search.node.audio_transcriber.description":"Audio/video fayllarni matnga aylantiradi. (Shift+B)","search.node.youtube_title_generator.title":"YouTube Sarlavha Generatori","search.node.youtube_title_generator.description":"YouTube videolari uchun sarlavha, tavsif va teglarni yaratadi.","search.node.music_idea_generator.title":"Musiqa Goyasi Generatori","search.node.music_idea_generator.description":"Qoshiq matni yoki musiqa promptini yaratadi. (Shift+M)","search.node.youtube_analytics":"YouTube Analitika","search.node.image_editor.title":"Rasm Tahrirchisi","search.node.image_editor.description":"AI yordamida rasmlarni tahrirlash (Inpainting, Outpainting).","search.group.input":"Kiritish","search.group.process":"Qayta ishlash","search.group.scripting":"Ssenariy Asboblari","search.group.character":"Personaj Asboblari","search.group.images":"Rasm Asboblari","search.group.ai":"AI Asboblari","search.group.audio":"Audio Asboblari","search.group.youtube":"YouTube Asboblari","contextMenu.tools":"Asboblar","contextMenu.assignSlot":"{index}-slotni tayinlash","contextMenu.addNodeFromSlot":"{node} qoshish ({index})","connectionMenu.title":"Tugun qoshish","quickAddMenu.title":"Tezkor qoshish","contextMenu.paste":"Joylashtirish (Ctrl+V)","node.content.simpleActions":"Oddiy harakatlar","node.content.smartConcept":"Aqlli Konsept","tooltip.model.flash":"Gemini Flash: Tez, samarali, qoralamalar uchun.","tooltip.model.pro":"Gemini Pro: Yuqori intellekt, murakkab fikrlash, batafsil.","tooltip.lang.ru":"Ssenariyni rus tilida yaratish.","tooltip.lang.en":"Ssenariyni ingliz tilida yaratish.","tooltip.lang.es":"Ssenariyni ispan tilida yaratish.","tooltip.lang.de":"Ssenariyni nemis tilida yaratish.","tooltip.lang.uz":"Ssenariyni ozbek tilida yaratish.","tooltip.lang.fr":"Ssenariyni fransuz tilida yaratish.","tooltip.lang.it":"Ssenariyni italyan tilida yaratish.","tooltip.lang.pt":"Ssenariyni portugal tilida yaratish.","tooltip.lang.zh":"Ssenariyni xitoy tilida yaratish.","node.action.locateInStack":"Stekda topish","help.tabs.hotkeys":"Yordam va Tugmalar","help.tabs.links":"Boshqa Ilovalar va Havolalar","help.category.socials":"Ijtimoiy Tarmoqlar","help.category.stable":"Google AI Studio (Barqaror)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Veb / Netlify","help.category.github":"GitHub Repozitoriylari","help.link.youtube":"YouTube Kanal","help.link.telegram_channel":"Telegram Kanal","help.link.telegram_chat":"Telegram Chat","help.sub.news":"Yangiliklar va Yangilanishlar","help.sub.discussion":"Muhokama","help.sub.stable":"Barqaror Versiya","help.sub.alpha":"Alpha Versiya","imageViewer.title":"Rasmni Korish","languages.ru":"Ruscha","languages.en":"Inglizcha","languages.es":"Ispancha","languages.fr":"Fransuzcha","languages.de":"Nemischa","languages.it":"Italyancha","languages.pt":"Portugalcha","languages.zh":"Xitoycha","languages.ja":"Yaponcha","languages.ko":"Koreyscha","languages.uz":"Ozbekcha"},$1={"node.title.text_input":"Matn Kiritish","node.title.prompt_processor":"Prompt Protsessori","node.title.prompt_analyzer":"Prompt Tahlilchisi","node.title.character_analyzer":"Personaj Tahlilchisi","node.title.character_generator":"Personaj Generatori","node.title.image_generator":"Rasm Generatori","node.title.image_preview":"Rasmni Korish","node.title.character_card":"Personaj Kartasi","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Tarjimon","node.title.script_generator":"Ssenariy Generatori","node.title.script_analyzer":"Ssenariy Tahlilchisi","node.title.script_prompt_modifier":"Prompt Finalizatori","node.title.error_analyzer":"Xatolar Tahlilchisi","node.title.note":"Eslatma","node.title.reroute_dot":"Yonalish nuqtasi","node.title.data_reader":"Malumot Oquvchi","node.title.speech_synthesizer":"Nutq Sintezatori","node.title.idea_generator":"Goya Generatori","node.title.narrator_text_generator":"Hikoyachi Matni Generatori","node.title.audio_transcriber":"Audio Transkriber","node.title.youtube_title_generator":"YouTube Sarlavha Generatori","node.title.music_idea_generator":"Musiqa Goyasi Generatori","node.title.youtube_analytics":"YouTube Analitika","node.title.image_editor":"Rasm Tahrirchisi","node.help.text_input":"Bu yerga asosiy goyalar, kalit sozlar yoki tavsiflarni kiriting.","node.help.prompt_processor":"Boshqa tugunlardan matn oladi va ularni AI yordamida bitta batafsil promptga aylantiradi.","node.help.prompt_analyzer":"Kiruvchi matnni tahlil qiladi va uni tort qismga ajratadi: muhit, personaj, harakat va uslub.","node.help.character_analyzer":"Personaj tavsifini tahlil qiladi va uni tashqi korinish hamda kiyimga ajratadi.","node.help.character_generator":"Prompt oladi va bir yoki bir nechta batafsil personaj tavsiflarini yaratadi.","node.help.image_generator":"Matnli prompt asosida Gemini API yordamida rasm yaratadi.","node.help.image_preview":"Rasmni korsatish uchun oddiy tugun. Rasm faylini sudrab tashlang.","node.help.character_card":"Personaj rasmi, nomi va promptini saqlaydi. Rasmlarni yaratish, saqlash va yuklash imkonini beradi.","node.help.gemini_chat":"Gemini AI bilan togridan-togri suhbatlashish uchun tugun.","node.help.translator":"Kiruvchi matnni tanlangan tilga tarjima qiladi.","node.help.script_generator":"Prompt oladi va ssenariy uchun sahnalar seriyasini yaratadi.","node.help.script_analyzer":"Ssenariy tuzilishini tahlil qiladi, uni personajlar va kadrlarga ajratadi.","node.help.script_prompt_modifier":"Tahlil qilingan ssenariy malumotlarini oladi va rasm yaratish uchun yakuniy promptlarni shakllantiradi.","node.help.error_analyzer":"Matndagi imlo va grammatik xatolarni tekshiradi va tuzatadi.","node.help.note":"Eslatmalar uchun oddiy matn maydoni. Boshqa tugunlarga ulanmaydi.","node.help.reroute_dot":"Ulanishlarni qayta yonaltirish va tarmoqlash uchun nuqta.","node.help.data_reader":"Ulangan tugundan kelayotgan xom malumotlarni korsatadi.","node.help.speech_synthesizer":"Matnni tanlangan ovoz yordamida nutqqa aylantiradi.","node.help.idea_generator":"Goyalarni yaratish uchun ikki bosqichli tugun (Kategoriyalar va Goya).","node.help.narrator_text_generator":"Hikoyachi yoki diktor uchun matn yaratadi.","node.help.audio_transcriber":"Audio yoki video faylni yuklaydi va uni matnga aylantiradi.","node.help.youtube_title_generator":"YouTube videolari uchun sarlavha, tavsif va teglarni yaratadi.","node.help.music_idea_generator":"Qoshiq matni yoki musiqa promptini yaratadi.","node.help.youtube_analytics":"YouTube kanali statistikasini kuzatadi va AI maslahatlarini beradi.","node.help.image_editor":"AI yordamida rasmlarni tahrirlang (Inpainting, Outpainting).","node.action.help":"Yordam","node.action.rename":"Nomini ozgartirish","node.action.expand":"Yoyish","node.action.collapse":"Yigish (H)","node.action.expandAll":"Hammasini yoyish","node.action.collapseAll":"Hammasini yigish","node.action.expandAllScenes":"Barcha sahnalarni yoyish","node.action.collapseAllScenes":"Barcha sahnalarni yigish","node.action.expandAllFrames":"Barcha kadrlarni yoyish","node.action.collapseAllFrames":"Barcha kadrlarni yigish","node.action.expandPanel":"Panelni yoyish","node.action.collapsePanel":"Panelni yigish","node.action.togglePanel":"Panelni ochish/yopish","node.action.collapseScene":"Sahnani yigish","node.action.expandScene":"Sahnani yoyish","node.action.collapseFrame":"Kadrni yigish","node.action.expandFrame":"Kadrni yoyish","node.action.collapseCharacter":"Personajni yigish","node.action.expandCharacter":"Personajni yoyish","node.action.clear":"Tozalash","node.action.clearTooltip":"Kiritish maydonini tozalash.","node.action.clearChat":"Chatni tozalash","node.action.paste":"Buferdan joylashtirish","node.action.copy":"Nusxalash","node.action.duplicateWithContent":"Nusxalash (tarkibi bilan)","node.action.duplicateEmpty":"Bosh nusxa olish","node.action.cutConnections":"Ulanishlarni uzish","node.action.close":"Yopish","node.action.executeChain":"Zanjirni ishga tushirish","node.action.executeFullChain":"Toliq zanjirni bajarish","node.action.processChainForward":"Zanjirni oldinga ishlash","node.action.executeChainTitle":"Ushbu chiqishga olib keladigan barcha ulangan tugunlarni bajarish.","node.action.addCharacter":"Personaj qoshish","node.action.addScene":"Sahna qoshish","node.action.addFrame":"Kadr qoshish","node.action.addFirstFrame":"Birinchi kadrni qoshish","node.action.deleteItem":"ochirish","node.action.moveUp":"Yuqoriga","node.action.moveDown":"Pastga","node.action.saveImage":"Rasmni saqlash","node.action.loadImage":"Rasmni yuklash","node.action.saveCharacter":"Personajni saqlash","node.action.loadCharacter":"Personajni yuklash","node.action.readData":"Malumotni oqish","node.action.refreshData":"Yangilash","node.action.stop":"Toxtatish","node.action.stopping":"Toxtatilmoqda...","node.action.embedCharacter":"Personajni singdirish (ajratish va nusxalash)","node.action.downloadFinalPrompts":"Yakuniy promptlarni yuklab olish","node.action.index":"Indekslash","node.action.improveConcept":"Konsepsiyani yaxshilash","node.action.improveConceptTooltip":"Rasmlarni yaratish uchun boyitish, kengaytirish va vizual tafsilotlarni qo'shish.","node.action.downloadJson":"JSON yuklab olish","node.action.downloadSRT":"SRT yuklab olish","node.action.markPrimary":"Asosiy Personaj sifatida belgilash","node.input.default":"Kirish","node.output.default":"Chiqish","node.output.allCharacters":"Barcha Personajlar","node.output.primaryCharacter":"Asosiy Personaj","node.content.action":"Harakat","node.content.actionPlaceholder":"Harakat prompti...","node.content.allScriptParts":"Barcha ssenariy qismlari","node.content.allScriptAnalyzerData":"Tahlilchi malumotlari","node.content.allNarratorData":"Barcha hikoyachi malumotlari","node.content.analyzeCharacters":"Personajlarni tahlil qilish","node.content.analyzeFromScene":"Sahnadan tahlil qilish:","node.content.analyzeUpToScene":"gacha","node.content.endPlaceholder":"oxiri","node.content.generateFromFrame":"Kadrdan generatsiya:","node.content.generateUpToFrame":"kadrgacha","node.content.analyzeFromFrame":"Kadrdan finalizatsiya:","node.content.processFromFrame":"Kadrdan qayta ishlash:","node.content.processFromScene":"Sahnadan qayta ishlash:","node.content.analyzePrompt":"Promptni tahlil qilish","node.content.analyzeScript":"Ssenariyni tahlil qilish","node.content.analyzing":"Tahlil qilinmoqda...","node.content.applyAliases":"Taxalluslarni qollash","node.content.applyAliasesTooltip":"Barcha tavsiflarda personaj ismlarini ularning taxalluslari bilan almashtirish.","node.content.character":"Personaj","node.content.characterIndex":"Indeks","node.content.characterPlaceholder":"Personaj prompti...","node.content.character_plural":"personajlar","node.content.characters":"Personajlar","node.content.charactersSynced":"Personajlar sinxronlandi","node.content.noCharactersConnected":"Personajlar ulanmagan.","node.content.appearance":"Tashqi korinish","node.content.personality":"Shaxsiyat","node.content.characterType":"Tur","node.content.characterTypeShort":"Tur","node.content.characterType.simple":"Oddiy","node.content.characterType.anthro":"Antropomorfik (Hayvonlar)","node.content.characterType.chibi":"Chibi (Yoqimli)","node.content.characterType.key_item":"Asosiy buyum/obyekt","node.content.style":"Uslub","node.content.style.none":"Yoq","node.content.style.simple":"Oddiy","node.content.style.realistic":"Realistik/Kinematografik","node.content.style.3d_cartoon":"3D Multfilm","node.content.style.3d_realistic":"Realistik 3D","node.content.style.2d_animation":"2D Animatsiya","node.content.style.anime":"Anime","node.content.style.comics":"Komiks","node.content.style.custom":"Maxsus","node.content.chatPlaceholder":"Xabar yozing...","node.content.clothing":"Kiyim","node.content.clothingPlaceholder":"Kiyim prompti...","node.content.connectedPlaceholder":"Boshqa tugundan ulangan","node.content.dataPlaceholder":"Malumotlar bu yerda paydo boladi...","node.content.readData":"Malumotni oqish","node.content.reading":"Oqilmoqda...","node.content.description":"Tavsif","node.content.sceneDescription":"Sahna Tavsifi","node.content.duration":"Davomiylik","node.content.enhancePrompt":"Prompt yaratish","node.content.enhancedPromptHere":"Yaxshilangan prompt bu yerda paydo boladi...","node.content.enhancing":"Yaxshilanmoqda...","node.content.environment":"Muhit","node.content.environmentPlaceholder":"Muhit prompti...","node.content.environmentPrompt":"Muhit, Dekoratsiya va Fon","node.content.compositionAndBlocking":"Kompozitsiya va Harakat","node.content.executingChain":"Zanjir bajarilmoqda...","node.content.imagePrompt":"Rasm Prompti","node.content.finalPrompt":"Yakuniy Prompt","node.content.finalPrompt_plural":"Yakuniy Promptlar","node.content.fixErrors":"Xatolarni tuzatish","node.content.fixingErrors":"Tuzatilmoqda...","node.content.frame":"Kadr","node.content.frame_plural":"kadrlar","node.content.frames":"Chiqish Kadrlari","node.content.frames_analyzed":"Tahlil qilingan kadrlar: {count}","node.content.framesPerScene":"Sahna uchun kadrlar","node.content.minFrames":"Min","node.content.maxFrames":"Maks","node.content.numberOfCharactersShort":"Soni","node.content.fullDescription":"Toliq Tavsif","node.content.generateCharacters":"Personajlarni yaratish","node.content.generateFinalPrompts":"Yakuniy promptlarni yaratish","node.content.generatingProgress":"Prompt generatsiyasi {current} / {total}","node.content.generateImage":"Rasm yaratish","node.content.generateScript":"Ssenariy yaratish","node.content.generateSpeech":"Nutq yaratish","node.content.generateText":"Matn yaratish","node.content.generateSSML":"SSML yaratish","node.content.generateStyle":"Uslub yaratish","node.content.generating":"Yaratilmoqda...","node.content.improving":"Yaxshilanmoqda...","node.content.generatedAudio":"Yaratilgan audio","node.content.imagePromptPlaceholder":"Rasm uchun prompt kiriting...","node.content.modificationPromptPlaceholder":"Ozgartirish uchun sorov...","node.content.narrator":"Hikoyachi","node.content.narratorEnabled":"Hikoyachini yoqish","node.content.narratorEnabledInfo":"Sahna yoki ichki fikrlarni tasvirlash uchun ovozli matn qoshadi.","node.content.narratorMode":"Hikoyachi Rejimi","node.content.narratorMode.normal":"Normal / Ovozli","node.content.narratorMode.dual":"Ikki Hikoyachi","node.content.narratorMode.first_person":"Birinchi shaxsdan","node.content.role":"Rol","node.content.role.narrator":"Hikoyachi","node.content.role.announcer":"Diktor","node.content.role.first_person":"Birinchi shaxs","node.content.role.dual_narrator":"Ikki Hikoyachi","node.content.role.dual_announcer":"Ikki Diktor","node.content.scene":"Sahna","node.content.scene_plural":"sahnalar","node.content.scenes":"Sahnalar","node.content.scenes_generated":"Sahnalar yaratildi: {count}","node.content.sceneContext":"Sahna Konteksti","node.content.sceneContextPlaceholder":"Umumiy joylashuv, yoritish, kayfiyat...","node.content.scriptPromptPlaceholder":"Hikoya goyasini kiriting...","node.content.seconds":"sek","node.content.stylePlaceholder":"Uslub prompti...","node.content.stylePromptPlaceholder":"Uslub promptini bu yerga kiriting...","node.content.styleOverride":"Uslubni ozgartirish (Override)","node.content.summary":"Xulosa","node.content.targetLanguage":"Maqsadli til","node.content.textToSynthesize":"Sintez uchun matn...","node.content.translate":"Tarjima qilish","node.content.translatePlaceholder":"Tarjima uchun matn...","node.content.translatedTextPlaceholder":"Tarjima qilingan matn bu yerda paydo boladi...","node.content.translating":"Tarjima qilinmoqda...","node.content.useExistingCharacters":"Mavjud personajlardan foydalanish","node.content.useExistingCharactersInfo":"Model noldan yaratish orniga ulangan personaj malumotlaridan foydalanadi.","node.content.createKeyItem":"Ikkinchi darajali va buyumlar","node.content.createSecondaryChars":"Ikkinchi darajali personajlar","node.content.createKeyItems":"Asosiy buyumlar","node.content.createKeyItemInfo":"Agar syujet talab qilsa, ikkinchi darajali personajlar yoki buyumlar yaratishga ruxsat beradi. Agar ochirilgan bolsa, faqat asosiy (kiruvchi) personajlar ishlatiladi.","node.content.noCharacters":"Personajlarsiz","node.content.noCharactersInfo":"Ssenariy voqealar va atmosferaga qaratilgan boladi (hujjatli uslub).","node.content.videoPrompt":"Dinamika va Harakat","node.content.videoPrompts":"Video Promptlar","node.content.voice":"Ovoz","node.action.previewVoice":"Ovozni tinglash","node.content.voicePreviewText":"Salom, bu ovoz namunasi.","node.content.inputScripts":"Kiruvchi Sahnalar","node.content.inputFrames":"Kiruvchi Kadrlar","node.content.outputScript":"Chiquvchi Sahnalar","node.content.requestCategories":"Kategoriyalarni sorash","node.content.generateIdea":"Goya yaratish","node.content.requestNewCategories":"Yangi kategoriyalar sorash","node.content.category.action":"Harakat","node.content.category.place":"Joy","node.content.category.obstacle":"Tosiq","node.content.generatedIdea":"Yaratilgan Goya","node.content.storyFormat":"Hikoya Formati","node.content.theme":"Mavzu","node.content.parameters":"Parametrlar","node.content.advancedMode":"Kengaytirilgan rejim","node.content.numberOfScenes":"Sahnalar soni","node.content.numberOfScenes.auto":"Avto","node.content.detailedPlot":"Batafsil syujet","node.content.detailedPlotInfo":"Harakatlar va syujet burilishlarining batafsil tavsifini yoqadi.","node.content.includeSubscribeScene":"Obuna bolish sahnasi","node.content.includeSubscribeSceneInfo":"Obuna bolish yoki layk bosishni sorovchi sahnani qoshadi.","node.content.genre":"Janr","node.content.genre2":"Janr 2","node.content.breakIntoParagraphs":"Abzaslarga bolish","node.content.copyVideoPrompt":"Video promptni nusxalash","node.content.generateVideoPrompt":"Video prompt yaratish","node.content.model":"Model","node.content.processWholeScene":"Toliq sahnani ishlash","node.content.processWholeSceneInfo":"Sahnaning barcha kadrlarini bir vaqtda qayta ishlaydi. Izchillikni oshiradi.","node.content.batchProcessing":"Paket qayta ishlash","node.content.batchProcessingInfo":"Barcha tanlangan sahnalarni bitta kontekst oynasida qayta ishlash.","node.content.extendedAnalysis":"Kengaytirilgan tahlil","node.content.extendedAnalysisInfo":"Sahnalarni batafsil rejalarga (umumiy, orta, yaqin) ajratadi.","node.content.professionalStoryboard":"Rejissyorlik Raskadrovkasi","node.content.professionalStoryboardInfo":"Sahnalarni kinotil qoidalari asosida tahlil qilish.","node.content.generateStartEndFrames":"Boshlangich va yakuniy kadrlarni yaratish","node.content.autoIndexCharacters":"Avto-indekslash","node.content.autoIndexCharactersInfo":"Tahlil natijalarida personaj ismlarini avtomatik ravishda taxalluslar bilan almashtiradi.","node.content.imageToText":"Rasmdan matnga","node.content.extracting":"Ajratib olinmoqda...","node.content.extractedText":"Ajratib olingan matn","node.content.activePromptStack":"Faol Prompt Steki","node.content.noCharactersAnalyzed":"Tahlil qilingan personajlar yoq.","node.content.promptsGeneratedPlaceholder":"Yaratilgan promptlar bu yerda paydo boladi.","node.content.noCharactersInScript":"Ssenariyda personajlar yoq.","node.content.noInputScenes":"Kiruvchi malumot yoq. Ssenariy Generatorini ulang.","node.content.status":"Holat","node.content.status.ready":"Tayyor","node.content.status.paused":"Toxtatildi","node.content.status.generating":"Generatsiya","node.content.status.total":"Jami: {generated} / {total}","node.content.status.batch":"Ishlanmoqda: {current} / {total}","node.content.status.time":"Vaqt: {current}s / {total}s","node.content.refreshing":"Yangilanmoqda...","node.content.totalFrames":"Jami kadrlar: {count}","node.content.uploadAudio":"Audio/Video yuklash","node.content.noAudioLoaded":"Audio yuklanmagan","node.content.audioLoaded":"Audio yuklandi","node.content.transcriptionPlaceholder":"Transkripsiya bu yerda paydo boladi...","node.content.transcribe":"Transkripsiya","node.content.transcribing":"Transkripsiya qilinmoqda...","node.content.convertingVideo":"Video konvertatsiya qilinmoqda...","node.content.recommendedFrames":"Kadrlar Tavsiyasi","node.content.shotType":"Kadr turi","node.content.shotType.ws":"WS (Keng)","node.content.shotType.ms":"MS (Orta)","node.content.shotType.cu":"CU (Yaqin)","node.content.shotType.ecu":"ECU (Juda Yaqin)","node.content.shotType.ls":"LS (Uzoq)","node.content.characterDetail":"Personaj tafsilotlari","node.content.noCharDesc":"Personaj tavsifisiz","node.content.includeGeneralCharDesc":"Umumiy vizual tavsif","node.content.includeFullCharDesc":"Batafsil vizual tavsif","node.content.safeGeneration":"Xavfsiz Generatsiya","node.content.shotFilter":"Kadr Filtri","node.content.shotFilter.all":"Barcha kadrlar","node.content.shotFilter.wideOnly":"Faqat keng","instruction.desc.shot_filter_all":"Barcha kadr turlariga ruxsat (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Faqat keng kadrlarga ruxsat (WS, MS, LS). Yaqin kadrlar taqiqlanadi.","node.content.anthroEnabled":"Antropomorfik Hayvonlar","node.content.subscribeEnhancement":"Obuna chaqirig'ini kuchaytirish","node.content.thinkingEnabled":"Fikrlash Rejimi","node.content.scenelessMode":"Ssenariysiz sahnalar","instruction.desc.sceneless_mode":"Hikoya motorini o'chirish. Konsepsiya ro'yxatidan to'g'ridan-to'g'ri sahnalarni yaratish.","instruction.sceneless_mode":"Sahnalar Ro'yxati Rejimi","node.content.microActionBreakdown":"Mikro-harakatlar","node.content.microActionBreakdownInfo":"Murakkab harakatlarni fazolarga ajratadi (Tayyorgarlik, Harakat, Reaksiya).","node.content.commercialSafe":"Tijorat uchun xavfsiz","instruction.desc.commercial_safe":"Mashhur savdo belgilari (Disney, Pixar) dan qat'iy qochadi va ularni umumiy tavsiflar bilan almashtiradi.","node.content.findStack":"Stekni topish...","node.content.spm_stack.priming":"1. Prayming va Kontekst","node.content.spm_stack.physics":"2. Fizika va Mantiq","node.content.spm_stack.hierarchy":"3. Subyekt Ierarxiyasi","node.content.spm_stack.construction":"4. Qurilish va Format"},W1={"genre.general":"Umumiy","genre.comedy":"Komediya","genre.drama":"Drama","genre.action":"Jangari","genre.scifi":"Ilmiy fantastika","genre.fantasy":"Fantastika","genre.horror":"Qorqinchli","genre.thriller":"Triller","genre.childrens_animation":"Bolalar uchun animatsiya","genre.shorts_story":"Shorts uchun qisqa hikoyalar","genre.scientific_historical":"Ilmiy-tarixiy hikoya","character_generator.promptPlaceholder":'Personajlar uchun goya kiriting, masalan: "qadimgi ormon qoriqchisi, sehrli qilichni himoya qiluvchi jasur ritsar"',"idea_generator.randomTheme":"Tasodifiy mavzu olish","idea_generator.randomCombination":"Tasodifiy kombinatsiya","idea_generator.themePlaceholder":"masalan, Kosmos, Oshxona, Sehrli Ormon","idea_generator.initialMessage":'Mavzuni kiriting (ixtiyoriy) va boshlash uchun "{buttonName}" tugmasini bosing.',"idea_generator.ideaPlaceholder":"Yaratilgan goya bu yerda paydo boladi...","idea_generator.format.general":"Umumiy","idea_generator.format.childrens":"Bolalar","idea_generator.format.adventure":"Sarguzasht","idea_generator.format.fantasy":"Fantastika / Sehr","idea_generator.format.detective":"Detektiv","idea_generator.format.scifi":"Ilmiy Fantastika","idea_generator.format.horror":"Qorqinchli","idea_generator.format.historical":"Tarixiy","gender.male":"Erkak","gender.female":"Ayol","node.content.autoDownload":"Yaratilganda avtomatik yuklash","node.content.downloadSelected":"Tanlanganlarni yuklash","node.content.intonation":"Intonatsiya","intonation.standard":"Standart","intonation.cheerful":"Xursand","intonation.angry":"Gazabli","intonation.sad":"Gamgin","intonation.excited":"Hayajonlangan","intonation.announcer":"Diktor","intonation.whispering":"Shivirlab","node.content.sceneMode":"Sahna Rejimi","node.content.connectNarratorData":'Ssenariy Generatoridan "Barcha hikoyachi malumotlari"ni ulang.',"node.content.sceneModeActive":"Sahna Rejimi faol. Malumotlar ulanishdan olinmoqda.","speech_synthesizer.mode.simple":"Oddiy","speech_synthesizer.mode.scene":"Sahnavor","speech_synthesizer.multiSpeaker":"Ikki Diktor","speech_synthesizer.speaker1Name":"Diktor 1 Ismi","speech_synthesizer.speaker2Name":"Diktor 2 Ismi","speech_synthesizer.multiSpeakerHint":'Diktor ismlari matndagi ismlarga mos kelishi kerak (masalan, "Erkak: ...", "Ayol: ...").',"speech_synthesizer.ssmlHint":"Intonatsiya matndagi SSML teglari orqali boshqariladi.","youtube_analytics.authorName":"Muallif Ismi","youtube_analytics.videoTitle":"Video Sarlavhasi","youtube_analytics.views":"Korishlar","youtube_analytics.addToChannel":"Kanalga qoshish","youtube_analytics.noIncomingData":"Kiruvchi malumot yoq.","youtube_analytics.videoAdded":"Video qoshildi!","youtube_analytics.dragDrop":"Qator skrinshotini bu yerga tashlang","youtube_analytics.thumbnailUpdated":"Eskiz yangilandi","youtube_analytics.statsTrend":"Statistika Trendlari","youtube_analytics.currentChannel":"Joriy Kanal","youtube_analytics.growth":"Osish","youtube_analytics.allChannels":"Barcha Kanallar","youtube_analytics.saveDisk":"Diskka saqlash","youtube_analytics.saveCatalog":"Katalogga saqlash","youtube_analytics.loadDisk":"Diskdan yuklash","youtube_analytics.analyzing":"Tahlil qilinmoqda...","youtube_analytics.askAI":"AIdan sorash","youtube_analytics.clickForAdvice":"Maslahat olish uchun bosing.","youtube_analytics.dailyNotes":"Kunlik Eslatmalar","youtube_analytics.logDailyStats":"Kunlik Statistika","youtube_analytics.subscribers":"Obunachilar","youtube_analytics.totalViews":"Jami Korishlar","youtube_analytics.updateStats":"Yangilash","youtube_analytics.history":"Tarix","youtube_analytics.noHistory":"Tarix hali yoq.","youtube_analytics.noNotes":"Eslatmalar yoq.","youtube_analytics.noVideos":"Videolar yoq.","youtube_analytics.loadedFromDisk":"Diskdan yuklandi","youtube_analytics.loadFailed":"Yuklashda xatolik","youtube_analytics.savedToDisk":"Diskka saqlandi","youtube_title_generator.mode.title":"Video Sarlavhasi","youtube_title_generator.mode.channel":"Kanal Info","youtube_title_generator.ideaPlaceholder":"Video goyasi yoki mavzusini kiriting...","youtube_title_generator.channelIdeaPlaceholder":"Kanal mavzusi yoki yonalishini kiriting...","youtube_title_generator.title":"Sarlavha","youtube_title_generator.description":"Tavsif","youtube_title_generator.tags":"Teglar","youtube_title_generator.channelName":"Kanal Nomi","youtube_title_generator.channelDescription":"Kanal Tavsifi","youtube_title_generator.channelKeywords":"Kalit sozlar","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Qoshiq matni","music_idea_generator.mode.music_prompt":"Musiqa Prompti","music_idea_generator.ideaPlaceholder":"Qoshiq mavzusi yoki kayfiyatini kiriting...","music_idea_generator.songTitle":"Qoshiq Nomi","music_idea_generator.songTitlePlaceholder":"Nom...","music_idea_generator.lyricsPlaceholder":"Qoshiq matni bu yerda paydo boladi...","music_idea_generator.musicPromptPlaceholder":"AI musiqa prompti bu yerda paydo boladi...","chat.mode.general":"Umumiy","chat.mode.script":"Ssenariy Eksperti","chat.mode.prompt":"Prompt Eksperti","chat.mode.youtube":"YouTube Eksperti"},Y1={"catalog.title":"Katalog","catalog.tabs.groups":"Guruhlar","catalog.tabs.library":"Prompt Kutubxonasi","catalog.tabs.characters":"Personajlar","catalog.tabs.scripts":"Ssenariylar","catalog.tabs.analysis":"Tahlil","catalog.tabs.final_prompts":"Yakuniy Promptlar","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Musiqa G'oyalari","catalog.empty.title":"Katalog bosh","catalog.empty.description":"Elementni bu yerda korish uchun saqlang yoki fayldan import qiling.","catalog.loadFromFile":"Katalogga fayldan qoshish","catalog.card.addToCanvas":"Kanvasga qoshish","catalog.card.rename":"Nomini ozgartirish","catalog.card.save":"Diskka saqlash","catalog.card.delete":"Ochirish","library.loadFromFile":"Fayldan yuklash","library.empty.title":"Papka bosh","library.empty.description":"Boshlash uchun yangi papka yoki prompt yarating.","library.emptyPrompt":"Tarkib yoq","library.actions.newFolder":"Yangi Papka","library.actions.newPrompt":"Yangi Prompt","library.actions.copy":"Buferga nusxalash","library.actions.edit":"Tahrirlash","group.rename":"Guruh nomini ozgartirish","group.saveToCatalog":"Katalogga saqlash","group.saveToDisk":"Diskka saqlash","group.ungroup":"Guruhni buzish (Tarkibni ochirish uchun Shift+Bosish)","group.button.create":"Guruhlash ({count})"},q1={"dialog.rename.title":"Nomni ozgartirish","dialog.rename.group.title":"Guruh nomini ozgartirish","dialog.rename.catalog.title":"Katalog elementini qayta nomlash","dialog.rename.label":"Yangi nom","dialog.rename.confirm":"Ozgartirish","dialog.rename.cancel":"Bekor qilish","dialog.promptEdit.title":"Promptni Tahrirlash","dialog.promptEdit.nameLabel":"Prompt Nomi","dialog.promptEdit.contentLabel":"Tarkib","dialog.promptEdit.confirm":"Saqlash","dialog.promptEdit.cancel":"Bekor qilish","dialog.reset.title":"Kanvasni tiklash","dialog.reset.message":"Kanvasni asl holatiga qaytarishni xohlaysizmi? Bu barcha joriy ishlarni ochirib yuboradi.","dialog.exit.title":"Loyihani yopish?","dialog.exit.message":"Ishonchingiz komilmi? Saqlanmagan malumotlar yoqoladi va siz xush kelibsiz ekraniga qaytasiz.","dialog.settings.title":"Sozlamalar","dialog.settings.apiKeyLabel":"Gemini API Kaliti","dialog.settings.apiKeyPlaceholder":"API kalitingizni bu yerga kiriting","dialog.settings.getApiKeyLink":"Google AI Studio dan API kalit olish","dialog.settings.useFreeKey":"Bepul (cheklangan) kalitdan foydalanish","dialog.settings.save":"Saqlash","dialog.settings.close":"Yopish","dialog.apiKey.title":"API Kalit Sozlamalari","dialog.apiKey.description":"Ilovadan foydalanish uchun Gemini API kaliti kerak. Iltimos, quyida kiriting. U brauzeringizda lokal saqlanadi.","dialog.apiKey.keyExists":"API kalit allaqachon brauzerda saqlangan.","dialog.apiKey.clear":"Kalitni tozalash","dialog.apiKey.save":"Kalitni saqlash","dialog.apiKey.update":"Kalitni yangilash","dialog.apiKey.useFreeKey":"Bepul kalitdan foydalanish (ishlab chiqish uchun)","dialog.permission.title":"Buferga kirish ruxsati","dialog.permission.description":'Ilova tugunlarda "Joylashtirish" funksiyasi ishlashi uchun buferga kirishni soramoqda. Biz faqat siz ushbu funksiyani ishlatganingizda buferni oqiymiz.',"dialog.permission.decline":"Rad etish","dialog.permission.allow":"Ruxsat berish","alert.groupSaved":'"{groupTitle}" guruhi katalogga saqlandi!',"toast.groupSavedToDisk":'"{groupTitle}" guruhi diskka saqlandi!',"alert.confirmDelete":"Ushbu elementni katalogdan ochirishni xohlaysizmi?","alert.invalidCatalogFile":"Notogri yoki buzilgan katalog fayli.","alert.loadCatalogFailed":"Katalog elementini yuklab bolmadi","alert.confirmLoadProject":"Loyiha yuklansa, barcha joriy malumotlar (tablar, katalog, sozlamalar) almashtiriladi. Ishonchingiz komilmi?","dialog.confirmDelete.title":"Ochirishni tasdiqlash","dialog.confirmDelete.message":'Haqiqatan ham "{itemName}" ni ochirmoqchimisiz? Bu amalni bekor qilib bolmaydi.',"dialog.confirmDelete.folderMessage":'Haqiqatan ham "{itemName}" papkasini va uning barcha tarkibini ochirmoqchimisiz? Bu amalni bekor qilib bolmaydi.',"dialog.confirmDelete.confirm":"Ochirish","dialog.confirmDelete.cancel":"Bekor qilish","dialog.confirmClear.title":"Kanvasni tozalashni tasdiqlash","dialog.confirmClear.message":"Kanvasdagi hamma narsani ochirishni xohlaysizmi? Bu amalni bekor qilib bolmaydi.","toast.copied":"Buferga nusxalandi","toast.pasted":"Joylashtirildi!","toast.cleared":"Tozalandi","toast.resetComplete":"Asl holatga qaytarildi","toast.projectSaved":"Loyiha diskka saqlandi","toast.saveFailed":"Loyihani saqlab bolmadi","toast.connectionsCut":"Ulanishlar uzildi","toast.charSaved":"Personaj diskka saqlandi","toast.charLoaded":"Personaj yuklandi","toast.videoPasted":"Video buferdan qoshildi","toast.savedToCatalog":"Katalogga saqlandi","toast.apiKeySaved":"API kalit muvaffaqiyatli saqlandi","toast.apiKeyCleared":"API kalit ochirildi","toast.projectLoaded":"Loyiha muvaffaqiyatli yuklandi","alert.batchMismatch":"Ogohlantirish: {scene}-sahna kadrlar sonida nomuvofiqlik (Kutilgan: {expected}, Olingan: {got})."},K1={"instruction.inputs":"Kirishlar","instruction.desc.inputs":"Manba malumotlari: Ssenariy kadrlari, Personaj vizuallari, Uslub tarifi.","instruction.inputs_data":"Kirishlar","instruction.desc.inputs_data":"Manba malumotlari: Ssenariy xulosasi, Personaj profillari, Sahna matnlari.","instruction.role":"Rol: Bosh Muhit Rassomi","instruction.desc.role":"Siz ekspert Bosh Muhit Rassomi va Prompt Muhandisisiz. Kirish malumotlarini aniq vizual tavsifga aylantiring.","instruction.no_names":"MUHIM: ISMLAR YOQ","instruction.desc.no_names":"MUHIM: Yakuniy promptda HECH QACHON personaj ismlarini ishlatmang. FAQAT vizual tavsiflar yoki Taxallus IDlaridan (Character-1) foydalaning.","instruction.always_env":"MUHIM: DOIM MUHIT","instruction.desc.always_env":"MUHIM: DOIMO muhitni toliq tasvirlang. Hatto yaqin planlar (Close-Up) uchun ham fon teksturasi, yoritish yoki bokehni tasvirlang. Hech qachon joylashuvni aniqlanmagan holda qoldirmang.","instruction.layered":"Algoritm: Qatlamlar","instruction.desc.layered":"Tuzilishi: [Uslub] -> [Dunyo] -> [Batafsil Muhit/Fon Obyektlari] -> [Integratsiyalashgan Obyektlar (Indeks + Vizual + Harakat)] -> [Kamera]. Tavsif va harakatni ajratmang.","instruction.desc.layered_no_style":"Tuzilishi: [Dunyo] -> [Batafsil Muhit/Fon Obyektlari] -> [Integratsiyalashgan Obyektlar (Indeks + Vizual + Harakat)] -> [Kamera]. Tavsif va harakatni ajratmang.","instruction.visuals":"Uslub: Toyinganlik","instruction.desc.visuals":"Boy vizual tavsiflardan foydalaning: hajmli yoritish, kyiaroskuro, 8k teksturalar, maydon chuqurligi.","instruction.stateless":"Qoida: Holatsiz","instruction.desc.stateless":"Har bir kadrni mustaqil deb hisoblang. Muhitni oldingi kadrda bolgan bolsa ham qaytadan toliq tasvirlang.","instruction.formatting":"Formatlash","instruction.desc.formatting":"Chiqishni oqish oson abzaslarga boling.","instruction.video":"Video","instruction.desc.video":"Video Prompt Tuzilishi: [Indeks] [Vizual] [Harakat] ketma-ket. Dynamics: [Muhit]. Camera: [Kamera]. ISMLARSIZ.","instruction.process_whole_scene":"Paket Sahna","instruction.desc.process_whole_scene":"Butun sahnani bir vaqtda tahlil qilish, izchillik uchun.","instruction.strict_char_index":"Personajlar","instruction.desc.strict_char_index":"Personaj Taxalluslarini (Character-N) har bir kadr malumotiga qatiy moslang.","instruction.rule_hierarchy":"Ierarxiya","instruction.desc.rule_hierarchy":"Tavsif tuzilishi: [Batafsil Muhit] -> [Obyekt Konteksti] -> [Aniq Harakat]. Avval kontekstni ornating.","instruction.rule_persistence":"Doimiylik","instruction.desc.rule_persistence":"Jismoniy holatni kuzating. Agar personaj 1-kadrda otirgan bolsa, aksini aytilmaguncha 2-kadrda ham otiradi.","instruction.rule_mandatory_bg":"Majburiy Fon","instruction.desc.rule_mandatory_bg":"DOIMO fon/muhitni tasvirlang, hatto yaqin planlar uchun ham. Hech qachon 'fon korinmaydi' deb yozmang. Xira bokeh/teksturani tasvirlang.","instruction.rule_living_world":"Tirik Dunyo","instruction.desc.rule_living_world":"Agar jamoat joyi bolsa, dunyo kontekstiga mos keladigan fon massovkasi/siluetlarni tasvirlang.","instruction.core_director":"Bosh Rejissyor","instruction.desc.core_director":"Siz vizyoner kino rejissyori va ssenariynavissiz. Kitob uchun emas, ekran uchun yozing. Vizualga etibor qarating.","instruction.rule_visuals":"Avval Vizual","instruction.desc.rule_visuals":"Korsating, aytib bermang. 'U xafa edi' deyish orniga, 'U stulga chokdi' deb tasvirlang. Yoritish, kompozitsiya, harakat.","instruction.rule_flow":"Uzluksiz Oqim","instruction.desc.rule_flow":"N+1-sahna N-sahnadan vizual va mantiqiy ravishda kelib chiqishi kerak. Uzuk sakrashlardan qoching.","instruction.rule_atmosphere":"Atmosfera","instruction.desc.rule_atmosphere":"Har bir sahnani sensorli tafsilotlar bilan boyiting (yoruglik, teksturalar, ob-havo, tovushlar).","instruction.batch_processing":"Paket Qayta Ishlash","instruction.desc.batch_processing":"Barcha taqdim etilgan sahnalarni hikoya va vizual izchillikni saqlash uchun uzluksiz ketma-ketlik sifatida tahlil qiling.","instruction.char_gray_bg":"Vizual Konsept","instruction.desc.char_gray_bg":"Har bir personaj vizual prompti uchun DOIMO qoshing: ', full body character concept on a gray background'.","instruction.char_secondary_ok":"Yangi Personajlar Ruxsat","instruction.desc.char_secondary_ok":"Agar syujet talab qilsa, yangi personajlar yaratish mumkin. KIYIM ALMASHTIRISH: Agar personaj kiyimini o'zgartirsa, yangi prompt bilan yangi karta yarating.","instruction.char_no_new":"Yangi Personajlar Yoq","instruction.desc.char_no_new":"Yangi personajlar yoki buyumlar YARATMANG. FAQAT taqdim etilgan Mavjud Personajlardan foydalaning.","instruction.char_no_dupes":"Dublikatlar Yoq","instruction.desc.char_no_dupes":"Dublikatlar taqiqlanadi. ISTISNO: Kiyim o'zgarishi. Bunday holda yangi kiyim bilan dublikat yarating.","instruction.sg_visual_style":"Vizual Uslub","instruction.desc.sg_visual_style":"Sorov: '{style}' asosida batafsil vizual uslub tavsifini yarating.","instruction.sg_genre":"Janr Konteksti","instruction.desc.sg_genre":"Kontekst: {genre}","instruction.sg_new_chars":"Yangi Personajlar","instruction.desc.sg_new_chars":"Prompt asosida yangi personajlarni yarating.","instruction.sg_anthro":"Antro","instruction.desc.sg_anthro":"Personajlar insoniy xususiyatlarga ega hayvonlar bolishi kerak.","instruction.sg_no_chars":"Personajlarsiz","instruction.desc.sg_no_chars":"Hujjatli uslub / Ismli personajlar yoq.","instruction.sg_detailed_plot":"Batafsil Syujet","instruction.desc.sg_detailed_plot":"Harakatlar va syujetning juda batafsil tavsiflarini taqdim eting.","instruction.sg_subscribe":"Obuna Sahnasi","instruction.desc.sg_subscribe":"Tomoshabindan obuna bolishni sorovchi sahnani (tortinchi devorni buzish) kiriting.","instruction.sg_inputs":"Kirish Malumotlari","instruction.desc.sg_inputs":"Manba: Goya/Konsepsiya, Personaj Profillari.","instruction.sg_thinking":"Tahlil","instruction.desc.sg_thinking":"Yozishdan oldin fikrlash. Kausalitet va mantiqni tahlil qilish. Klishelarni yoq qilish.","instruction.sg_improve_input":"Ssenariy Doktori","instruction.desc.sg_improve_input":"Boshlangich konsepsiyani kuchaytirish, syujet teshiklarini yopish va konfliktni keskinlashtirish.","instruction.sg_exposition":"Ekspozitsiya","instruction.desc.sg_exposition":"Dunyo holatini atrof-muhit tarixi va tafsilotlari orqali korsatish.","instruction.char_smart_concept":"Aqlli Konsept","instruction.desc.char_smart_concept":"AI tanlaydi: Personajlar uchun Toliq Boy / Obyektlar uchun Kadrni Toldirish.","instruction.sg_delayed_reveal":"Oshkor Qilish","instruction.desc.sg_delayed_reveal":"Qahramonni bosqichma-bosqich tanishtirish: muhit -> detal harakatlar -> siluet -> yuzni korsatish.","instruction.sg_metaphor":"Metafora","instruction.desc.sg_metaphor":"Personajning ichki holatini ifodalash uchun vizual ramzlardan (singan buyumlar, ob-havo) foydalanish.","instruction.sg_pacing":"Surat (Pacing)","instruction.desc.sg_pacing":"Ritm nazorati: sokin kadrlarni dinamik montaj bilan muvozanatlash.","instruction.sg_subtext":"Subtekst","instruction.desc.sg_subtext":"Dialog va harakat ortasida taranglik yaratish. Personajlar kamdan-kam hollarda haqiqatni togridan-togri aytadilar.","instruction.storyboard_rules":"Kadrlar Xilma-xilligi","instruction.desc.storyboard_rules":"Dinamik ritm va hissiy fokus uchun WS/LS (Keng), MS (Orta) va CU/ECU (Yaqin) planlarni almashtirib turish.","instruction.storyboard_rules_wide":"Kadrlar Xilma-xilligi (Faqat Keng)","instruction.desc.storyboard_rules_wide":"Faqat Keng, Uzoq va Umumiy planlardan foydalaning. Rakursni ozgartiring (Past/Yuqori/Aeronavt). Yaqin planlar YOQ.","instruction.tech_directives":"Kamera Nazorati","instruction.desc.tech_directives":"Qatiy texnik terminologiya. Plan turlari uchun FAQAT qisqartmalardan foydalaning (WS, MS, CU).","instruction.ana_role":"Tahlilchi Roli","instruction.desc.ana_role":"Siz dunyo darajasidagi Kinorejissyor va Operator. Ssenariyni vizual ijro uchun tahlil qilyapsiz.","instruction.ana_cinema":"Kinematografiya","instruction.desc.ana_cinema":"Kadr va yoritish uchun professional atamalar: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_prompt_lang":"Prompt Tili","instruction.desc.ana_prompt_lang":"Rasm va video promptlar moslik uchun qatiy ingliz tilida bolishi kerak.","instruction.desc.target_lang":"Kadr tahlili va tavsiflari ushbu tilda yaratiladi.","instruction.extended_visuals":"Kengaytirilgan Vizual Tahlil","instruction.desc.extended_visuals":"Sahnalarni qisqa, ifodali ketma-ketliklarga (Keng, MS, CU, Detal) ajratadi. Kinematografik ritm va hissiyotga urgu beradi.","instruction.general_char_desc":"Umumiy Tafsilot","instruction.desc.general_char_desc":"Personaj profilidagi vizual promptning QISQA, UMUMIY versiyasini umumlashtirish va kiritish.","instruction.full_char_desc":"Toliq Tafsilot","instruction.desc.full_char_desc":"Personaj profilidagi TOLIQ va BATAFSIL vizual promptni aynan yozilganidek kiritish.","instruction.sg_visual_dna":"Vizual DNK","instruction.desc.sg_visual_dna":"Personaj promptlari va uslub parametrlarini texnik LookDev qollanmasiga (Yoritish, Linzalar, Render uslubi) birlashtiradi.","instruction.char_detailed_style":"Stilizatsiyalangan Tafsilot","instruction.desc.char_detailed_style":"Global vizual uslubni har bir personajning texnik generatsiya promptiga integratsiya qiladi.","instruction.desc.safe_gen":"XAVFSIZLIK CHEKLOVI: AI xavfsizlik filtrlarini ishga tushiruvchi sozlardan qatiy saqlaning. 'osmir', 'intim' yoki 'ochiq' kabi atamalarni 'yosh inson', 'badiiy kompozitsiya' yoki 'stilize qilingan' kabi badiiy muqobillar bilan almashtiring.","instruction.ana_anthro_logic":"Antro Mantiq","instruction.desc.ana_anthro_logic":'Har bir kadr tavsifida personajlarni Antropomorfik Hayvonlar (masalan, "Anthropomorphic Fox") sifatida aniq tasvirlang.',"instruction.ana_subscribe_logic":"Obuna Chaqiruvi","instruction.desc.ana_subscribe_logic":"Agar sahna Obuna bolishni sorasa, vizual harakatlar qoshing: personajlar belgi ushlab turadi yoki 3D matn bilan ozaro tasir qiladi.","instruction.pm_anthro":"Antro Tafsilot","instruction.desc.pm_anthro":'MAJBURIY: Rasm VA Videoda tur oldidan "anthropomorphic" sozi. Kuchaytirilgan teksturalar/anatomiya.',"instruction.pm_subscribe":"Oqiladigan Matn","instruction.desc.pm_subscribe":'"SUBSCRIBE" yoki "LIKE" matnining yakuniy rasmda oqilishi va integratsiya qilinishini (neon, belgilar, 3D) taminlang.',"instruction.shot_filter_wide":"Faqat Keng Planlar","instruction.desc.shot_filter_wide":"QATIY FILTR: FAQAT Keng (WS), Uzoq (LS) va Orta (MS) planlardan foydalaning. Yaqin planlar (CU/ECU) taqiqlanadi.","instruction.rule_static":"Qoida: Statik","instruction.desc.rule_static":"Faqat muzlatilgan lahzani tasvirlang. Hikoya otishlari yoq.","instruction.atmosphere_fix":"Atmosfera Langari","instruction.desc.atmosphere_fix":"Kayfiyatni havo va yoruglikning jismoniy xususiyatlari sifatida tasvirlang.","instruction.subject_focus":"Kontekst Ierarxiyasi","instruction.desc.subject_focus":"MUHIM: Hatto Yaqin planlar uchun ham tasvirlang: 1. Toliq Personaj. 2. Poza. 3. Detal. AI qismlarni togri renderlashi uchun toliq tana kontekstiga muhtoj.","instruction.rule_isolation":"Nol Kontekst","instruction.desc.rule_isolation":"MUHIM: Rasm generatori oldingi kadr haqida BILMAYDI. Siz har bir kadrda muhit va ob-havoni qaytadan toliq tasvirlashingiz SHART.","instruction.sensory_saturation":"Anti-Qisqa","instruction.desc.sensory_saturation":'Qisqa yozish TAQIQLANADI. "Qollar ushladi" orniga "Oqargan bogimlar bilan iflos qollar sovuq oynani mahkam ushladi" deb yozing.'},J1={...B1,...V1,...$1,...W1,...Y1,...q1,...K1},X1={"app.title":"Script Modifier","app.description":"Erstellen, verfeinern und generieren Sie Drehbcher visuell mit der Gemini API.","app.slogan":"Verbinde Ideen, um ein Meisterwerk zu schaffen","app.subtitle":"Visualisieren Sie Ihre Skripte","app.error.title":"Benachrichtigung","app.error.copy":"Fehler kopieren","app.error.copied":"Kopiert!","error.quotaExceeded":"Sie haben Ihr Nutzungslimit erreicht. Bitte berprfen Sie Ihr API-Schlssel-Kontingent oder versuchen Sie es spter erneut.","error.apiKeyMissing":"API-Schlssel nicht gefunden. Bitte geben Sie Ihren Gemini API-Schlssel in den Einstellungen ein.","error.freeKeyNotAvailable":"Kostenloser/Entwickler-API-Schlssel ist in dieser Umgebung nicht verfgbar. Bitte geben Sie Ihren eigenen Schlssel ein.","error.fileReadError":"Fehler beim Lesen der Datei.","error.videoConversionError":"Video konnte nicht in Audio umgewandelt werden.","error.unsupportedFile":"Nicht untersttzter Dateityp.","error.promptModifierFile":"Diese Datei gehrt zu einer anderen Anwendung (Prompt Modifier). Bitte ffnen Sie sie dort.","error.invalidFileType":"Ungltiger Dateityp. Bitte laden Sie eine Script Modifier Projekt- oder Canvas-Datei.","welcome.iAmDeveloper":"Ich bin Entwickler","welcome.letsGo":"Los geht's!","welcome.resume":"Fortsetzen","welcome.reload":"Neu laden","welcome.reloadTitle":"Zurcksetzen & Neu laden?","welcome.reloadMessage":"Dies lscht den gesamten Canvas und ldt die Anwendung neu. Nicht gespeicherte Daten gehen verloren. Sind Sie sicher?","welcome.confirmReload":"Zurcksetzen & Neu laden","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Willkommen im","dialog.welcome.intro1":"Willkommen beim Script Modifier  Ihrem visuellen Arbeitsbereich zum Erstellen von Geschichten mit Gemini.","dialog.welcome.intro2":"Whlen Sie zum Starten Ihre Sprache und geben Sie Ihren Gemini API-Schlssel ein.","dialog.welcome.apiKeyExplanation":"Ihr API-Schlssel wird lokal in Ihrem Browser gespeichert. Wir senden ihn an keinen anderen Server als die Google Gemini API."},Z1={"toolbar.edit":"Bearbeiten (V)","toolbar.cutter":"Verbindung trennen (C)","toolbar.selection":"Auswahl (S)","toolbar.reroute":"Umlenkpunkt (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Am Raster ausrichten (Shift+W)","toolbar.resetZoom":"Zoom zurcksetzen","toolbar.lineStyleSpaghetti":"Spaghetti-Linien (Shift+E)","toolbar.lineStyleOrthogonal":"Orthogonale Linien (Shift+E)","toolbar.addNode":"Knoten hinzufgen (F)","toolbar.catalog":"Katalog (Strg+Leertaste)","toolbar.settings":"Einstellungen","toolbar.resetToDefault":"Auf Standard zurcksetzen","toolbar.closeProject":"Projekt schlieen / Leeren","toolbar.enterFullscreen":"Vollbild","toolbar.exitFullscreen":"Vollbild beenden","toolbar.addTextInput":"Texteingabe (T)","toolbar.addPromptAnalyzer":"Prompt-Analysator (A)","toolbar.addCharacterAnalyzer":"Charakter-Analysator","toolbar.addCharacterGenerator":"Charakter-Generator (Shift+C)","toolbar.addImageGenerator":"Bild-Generator (O)","toolbar.addImagePreview":"Bild-Vorschau (I)","toolbar.addCharacterCard":"Charakterkarte (Strg+Shift+C)","toolbar.addPromptProcessor":"Prompt-Prozessor (P)","toolbar.addGeminiChat":"Gemini Chat (M)","toolbar.addTranslator":"bersetzer (L)","toolbar.addIdeaGenerator":"Ideen-Generator (Shift+A)","toolbar.addScriptGenerator":"Drehbuch-Generator (Shift+S)","toolbar.addScriptAnalyzer":"Drehbuch-Analysator (Shift+D)","toolbar.addScriptPromptModifier":"Prompt-Finalisierer (Shift+F)","toolbar.addErrorAnalyzer":"Fehler-Analysator","toolbar.addNote":"Notiz (N)","toolbar.addDataReader":"Daten-Leser (Shift+R)","toolbar.addSpeechSynthesizer":"Sprachsynthesizer (Shift+N)","toolbar.addNarratorTextGenerator":"Erzhlertext-Generator (Shift+G)","toolbar.addAudioTranscriber":"Audio-Transkribierer (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube Titel-Generator (Shift+T)","toolbar.addMusicIdeaGenerator":"Musikideen-Generator (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Canvas speichern (Strg+S)","toolbar.saveProject":"Projekt speichern (Strg+Shift+S)","toolbar.loadCanvas":"Laden (Strg+O)","toolbar.clearCanvas":"Canvas leeren","toolbar.group.general":"Allgemein","toolbar.group.scripting":"Drehbuch","toolbar.group.prompting":"Prompts & Analyse","toolbar.group.characters":"Charaktere","toolbar.group.ai":"KI-Tools","toolbar.group.file":"Datei","toolbar.group.images":"Bilder","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Canvas-Steuerung","toolbar.expand":"Panel erweitern","toolbar.collapse":"Panel einklappen","toolbar.toggleHeaders":"Kopfzeilen umschalten","hotkeys.file.title":"Datei","hotkeys.file.save":"Canvas speichern (Strg+S)","hotkeys.file.saveProject":"Projekt speichern (Strg+Shift+S)","hotkeys.file.load":"Laden (Strg+O)","hotkeys.tools.title":"Werkzeuge","hotkeys.tools.edit":"Bearbeiten","hotkeys.tools.cutter":"Cutter","hotkeys.tools.selection":"Auswahl","hotkeys.tools.reroute":"Umlenkpunkt","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Gruppieren (G)","hotkeys.tools.deleteGroup":"Gruppe lschen","hotkeys.tools.closeNode":"Knoten schlieen","hotkeys.tools.toggleLineStyle":"Linienstil umschalten","hotkeys.tools.snapToGrid":"Am Raster ausrichten","hotkeys.tools.selectAll":"Alles auswhlen","hotkeys.tools.deselectAll":"Auswahl aufheben","hotkeys.tools.duplicate":"Duplizieren (mit Inhalt)","hotkeys.windows.title":"Fenster","hotkeys.windows.search":"Suche (F)","hotkeys.windows.quickAdd":"Schnell hinzufgen (Leertaste)","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Knoten erstellen","hotkeys.hide":"Hotkeys ausblenden","help.title":"Tastenkrzel","hotkeys.show":"Hotkeys anzeigen","search.placeholder":"Knoten suchen...","search.noResults":"Keine Knoten gefunden.","search.node.text_input.title":"Texteingabe","search.node.text_input.description":"Ein einfaches Textfeld fr Ihre Ideen. (T)","search.node.prompt_processor.title":"Prompt-Prozessor","search.node.prompt_processor.description":"Verbessert und kombiniert Prompts mit KI. (P)","search.node.prompt_analyzer.title":"Prompt-Analysator","search.node.prompt_analyzer.description":"Teilt einen Prompt in Umgebung, Charakter und Aktion auf. (A)","search.node.character_analyzer.title":"Charakter-Analysator","search.node.character_analyzer.description":"Teilt eine Beschreibung in Charakter & Kleidung auf.","search.node.character_generator.title":"Charakter-Generator","search.node.character_generator.description":"Erstellt detaillierte Charaktere aus einer Idee. (Shift+C)","search.node.image_generator.title":"Bild-Generator","search.node.image_generator.description":"Erstellt ein Bild aus einem Text-Prompt. (O)","search.node.image_preview.title":"Bild-Vorschau","search.node.image_preview.description":"Zeigt ein Bild aus einer Datei an. (I)","search.node.character_card.title":"Charakterkarte","search.node.character_card.description":"Speichert Bild, Name und Prompt eines Charakters. (Strg+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Direkte Unterhaltung mit Gemini KI. (M)","search.node.translator.title":"bersetzer","search.node.translator.description":"bersetzt Text in eine gewhlte Sprache. (L)","search.node.script_generator.title":"Drehbuch-Generator","search.node.script_generator.description":"Wandelt eine Idee in Drehbuch-Szenen um. (Shift+S)","search.node.script_analyzer.title":"Drehbuch-Analysator","search.node.script_analyzer.description":"Zerlegt ein Skript in Frames und Bild-Prompts. (Shift+D)","search.node.script_prompt_modifier.title":"Prompt-Finalisierer","search.node.script_prompt_modifier.description":"Finalisiert Prompts aus der Analyse fr die Bildgenerierung. (Shift+F)","search.node.error_analyzer.title":"Fehler-Analysator","search.node.error_analyzer.description":"Prft und korrigiert Rechtschreibung und Grammatik.","search.node.note.title":"Notiz","search.node.note.description":"Ein einfaches Textfeld fr Notizen. (N)","search.node.reroute_dot.title":"Umlenkpunkt","search.node.reroute_dot.description":"Ein Punkt zum Umleiten und Verzweigen von Verbindungen.","search.node.data_reader.title":"Daten-Leser","search.node.data_reader.description":"Zeigt Rohdaten einer Verbindung an.","search.node.speech_synthesizer.title":"Sprachsynthesizer","search.node.speech_synthesizer.description":"Wandelt Text in Sprache um. (Shift+N)","search.node.idea_generator.title":"Ideen-Generator","search.node.idea_generator.description":"Generiert Kategorien und kombiniert sie zu einer Idee.","search.node.narrator_text_generator.title":"Erzhlertext-Generator","search.node.narrator_text_generator.description":"Generiert Text fr Erzhler oder Sprecher. (Shift+G)","search.node.audio_transcriber.title":"Audio-Transkribierer","search.node.audio_transcriber.description":"Wandelt Audio-/Videodateien in Text um. (Shift+B)","search.node.youtube_title_generator.title":"YouTube Titel-Generator","search.node.youtube_title_generator.description":"Generiert ansprechende Titel, Beschreibungen und Tags fr YouTube.","search.node.music_idea_generator.title":"Musikideen-Generator","search.node.music_idea_generator.description":"Generiert Songtexte oder Musik-Prompts. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analysiert Kanalstatistiken und gibt Wachstumstipps.","search.node.image_editor.title":"Bild-Editor","search.node.image_editor.description":"Bearbeiten Sie Bilder mit KI (Inpainting, Outpainting).","search.group.input":"Eingabe","search.group.process":"Verarbeitung","search.group.scripting":"Skripting","search.group.character":"Charaktere","search.group.images":"Bilder","search.group.ai":"KI-Tools","search.group.audio":"Audio","search.group.youtube":"YouTube","contextMenu.tools":"Werkzeuge","contextMenu.assignSlot":"Slot {index} zuweisen","contextMenu.addNodeFromSlot":"{node} hinzufgen ({index})","connectionMenu.title":"Knoten hinzufgen","quickAddMenu.title":"Schnell hinzufgen","contextMenu.paste":"Einfgen (Strg+V)","node.content.simpleActions":"Einfache Aktionen","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Schnell, effizient, gut fr Entwrfe.","tooltip.model.pro":"Gemini Pro: Hohe Intelligenz, komplexes Denken, detailliert.","tooltip.lang.ru":"Skript auf Russisch generieren.","tooltip.lang.en":"Skript auf Englisch generieren.","tooltip.lang.es":"Skript auf Spanisch generieren.","tooltip.lang.de":"Skript auf Deutsch generieren.","tooltip.lang.uz":"Skript auf Usbekisch generieren.","tooltip.lang.fr":"Skript auf Franzsisch generieren.","tooltip.lang.it":"Skript auf Italienisch generieren.","tooltip.lang.pt":"Skript auf Portugiesisch generieren.","tooltip.lang.zh":"Skript auf Chinesisch generieren.","node.action.locateInStack":"Im Stapel finden","help.tabs.hotkeys":"Hilfe & Hotkeys","help.tabs.links":"Andere Apps & Links","help.category.socials":"Soziale Medien","help.category.stable":"Google AI Studio (Stabil)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"GitHub Repositories","help.link.youtube":"YouTube Kanal","help.link.telegram_channel":"Telegram Kanal","help.link.telegram_chat":"Telegram Chat","help.sub.news":"Neuigkeiten & Updates","help.sub.discussion":"Diskussion","help.sub.stable":"Stabile Version","help.sub.alpha":"Alpha Version","languages.ru":"Russisch","languages.en":"Englisch","languages.es":"Spanisch","languages.fr":"Franzsisch","languages.de":"Deutsch","languages.it":"Italienisch","languages.pt":"Portugiesisch","languages.zh":"Chinesisch","languages.ja":"Japanisch","languages.ko":"Koreanisch","languages.uz":"Usbekisch"},Q1={"node.title.text_input":"Texteingabe","node.title.prompt_processor":"Prompt-Prozessor","node.title.prompt_analyzer":"Prompt-Analysator","node.title.character_analyzer":"Charakter-Analysator","node.title.character_generator":"Charakter-Generator","node.title.image_generator":"Bild-Generator","node.title.image_preview":"Bild-Vorschau","node.title.character_card":"Charakterkarte","node.title.gemini_chat":"Gemini Chat","node.title.translator":"bersetzer","node.title.script_generator":"Drehbuch-Generator","node.title.script_analyzer":"Drehbuch-Analysator","node.title.script_prompt_modifier":"Prompt-Finalisierer","node.title.error_analyzer":"Fehler-Analysator","node.title.note":"Notiz","node.title.reroute_dot":"Umlenkpunkt","node.title.data_reader":"Daten-Leser","node.title.speech_synthesizer":"Sprachsynthesizer","node.title.idea_generator":"Ideen-Generator","node.title.narrator_text_generator":"Erzhlertext-Generator","node.title.audio_transcriber":"Audio-Transkribierer","node.title.youtube_title_generator":"YouTube Titel-Generator","node.title.music_idea_generator":"Musikideen-Generator","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Bild-Editor","node.help.text_input":"Geben Sie hier grundlegende Ideen oder Schlsselwrter ein.","node.help.prompt_processor":"Kombiniert Texte aus anderen Knoten zu einem detaillierten Prompt.","node.help.prompt_analyzer":"Teilt einen Prompt in Umgebung, Charakter, Aktion und Stil auf.","node.help.character_analyzer":"Analysiert eine Charakterbeschreibung in Aussehen und Kleidung.","node.help.character_generator":"Erstellt detaillierte Charaktere aus einer Idee.","node.help.image_generator":"Generiert ein Bild aus einem Text-Prompt mit der Gemini API.","node.help.image_preview":"Zeigt ein Bild an. Ziehen Sie eine Datei darauf.","node.help.character_card":"Speichert Bild, Name und Prompt eines Charakters.","node.help.gemini_chat":"Direkte Unterhaltung mit Gemini KI.","node.help.translator":"bersetzt eingehenden Text in die gewhlte Sprache.","node.help.script_generator":"Erzeugt Drehbuch-Szenen aus einem Prompt.","node.help.script_analyzer":"Zerlegt ein Skript in Frames und Bild-Prompts.","node.help.script_prompt_modifier":"Erstellt finale knstlerische Prompts fr jeden Frame.","node.help.error_analyzer":"Prft und korrigiert Rechtschreibung und Grammatik.","node.help.note":"Ein einfaches Textfeld fr Notizen.","node.help.reroute_dot":"Ein Punkt zum Umleiten von Verbindungen.","node.help.data_reader":"Zeigt Rohdaten eines verbundenen Knotens an.","node.help.speech_synthesizer":"Wandelt Text in Sprache um.","node.help.idea_generator":"Generiert Kategorien und kombiniert sie zu einer Idee.","node.help.narrator_text_generator":"Generiert Text fr Erzhler oder Sprecher.","node.help.audio_transcriber":"Wandelt Audio-/Videodateien in Text um.","node.help.youtube_title_generator":"Generiert Titel, Beschreibungen und Tags fr YouTube.","node.help.music_idea_generator":"Generiert Songtexte oder Musik-Prompts.","node.help.youtube_analytics":"Analysiert Kanalstatistiken und gibt Wachstumstipps.","node.help.image_editor":"Bearbeiten Sie Bilder mit KI (Inpainting, Outpainting).","node.action.help":"Hilfe","node.action.expand":"Erweitern","node.action.collapse":"Einklappen (H)","node.action.expandAll":"Alles erweitern","node.action.collapseAll":"Alles einklappen","node.action.expandAllScenes":"Alle Szenen erweitern","node.action.collapseAllScenes":"Alle Szenen einklappen","node.action.expandAllFrames":"Alle Frames erweitern","node.action.collapseAllFrames":"Alle Frames einklappen","node.action.expandPanel":"Panel erweitern","node.action.collapsePanel":"Panel einklappen","node.action.togglePanel":"Umschalten","node.action.collapseScene":"Szene einklappen","node.action.expandScene":"Szene erweitern","node.action.collapseFrame":"Frame einklappen","node.action.expandFrame":"Frame erweitern","node.action.collapseCharacter":"Charakter einklappen","node.action.expandCharacter":"Charakter erweitern","node.action.clear":"Leeren","node.action.clearTooltip":"Eingabefeld leeren.","node.action.clearChat":"Chat leeren & neu laden","node.action.paste":"Einfgen","node.action.copy":"Kopieren","node.action.duplicateWithContent":"Duplizieren (Inhalt)","node.action.duplicateEmpty":"Duplizieren (Leer)","node.action.cutConnections":"Verbindungen trennen","node.action.close":"Schlieen","node.action.executeChain":"Kette ausfhren","node.action.executeFullChain":"Volle Kette ausfhren","node.action.processChainForward":"Kette vorwrts verarbeiten","node.action.executeChainTitle":"Alle verbundenen Knoten ausfhren.","node.action.addCharacter":"Charakter hinzufgen","node.action.addScene":"Szene hinzufgen","node.action.addFrame":"Frame hinzufgen","node.action.addFirstFrame":"Ersten Frame hinzufgen","node.action.deleteItem":"Lschen","node.action.moveUp":"Nach oben","node.action.moveDown":"Nach unten","node.action.saveImage":"Bild speichern","node.action.loadImage":"Bild laden","node.action.saveCharacter":"Charakter speichern","node.action.loadCharacter":"Charakter laden","node.action.readData":"Daten lesen","node.action.refreshData":"Daten aktualisieren","node.action.stop":"Stopp","node.action.stopping":"Stoppe...","node.action.embedCharacter":"Charakter einbetten","node.action.downloadFinalPrompts":"Prompts herunterladen","node.action.rename":"Umbenennen","node.action.index":"Indexieren","node.action.improveConcept":"Konzept verbessern","node.action.improveConceptTooltip":"Erweitern und visuelle Details hinzufgen.","node.action.downloadJson":"JSON herunterladen","node.action.downloadSRT":"SRT herunterladen","node.action.markPrimary":"Als Hauptcharakter markieren","node.input.default":"Eingang","node.output.default":"Ausgang","node.output.allCharacters":"Alle Charaktere","node.output.primaryCharacter":"Hauptcharakter","node.content.action":"Aktion","node.content.actionPlaceholder":"Aktions-Prompt...","node.content.allScriptParts":"Alle Skriptteile","node.content.allScriptAnalyzerData":"Daten vom Analysator","node.content.allNarratorData":"Alle Erzhlerdaten","node.content.analyzeCharacters":"Charaktere analysieren","node.content.analyzeFromScene":"Analysieren ab:","node.content.analyzeUpToScene":"bis","node.content.endPlaceholder":"Ende","node.content.generateFromFrame":"Generieren ab Frame:","node.content.generateUpToFrame":"bis Frame","node.content.analyzeFromFrame":"Finalisieren ab Frame:","node.content.processFromFrame":"Verarbeiten ab Frame:","node.content.processFromScene":"Verarbeiten ab Szene:","node.content.analyzePrompt":"Prompt analysieren","node.content.analyzeScript":"Skript analysieren","node.content.analyzing":"Analysiere...","node.content.applyAliases":"Aliase anwenden","node.content.applyAliasesTooltip":"Ersetzt Charakternamen durch Aliase (Index).","node.content.character":"Charakter","node.content.characterIndex":"Index","node.content.characterPlaceholder":"Charakter-Prompt...","node.content.character_plural":"Charaktere","node.content.characters":"Charaktere","node.content.charactersSynced":"Charaktere synchronisiert","node.content.noCharactersConnected":"Keine Charaktere verbunden.","node.content.appearance":"Aussehen","node.content.personality":"Persnlichkeit","node.content.characterType":"Typ","node.content.characterTypeShort":"Typ","node.content.characterType.simple":"Einfach","node.content.characterType.anthro":"Anthro (Tiere)","node.content.characterType.chibi":"Chibi (Niedlich)","node.content.characterType.key_item":"Schlsselobjekt","node.content.style":"Stil","node.content.style.none":"Keiner","node.content.style.simple":"Einfach","node.content.style.realistic":"Realistisch/Kino","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistisch","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Spezial","node.content.chatPlaceholder":"Nachricht eingeben...","node.content.clothing":"Kleidung","node.content.clothingPlaceholder":"Kleidungs-Prompt...","node.content.connectedPlaceholder":"Verbunden","node.content.dataPlaceholder":"Daten erscheinen hier...","node.content.readData":"Daten lesen","node.content.reading":"Lese...","node.content.description":"Beschreibung","node.content.sceneDescription":"Szenenbeschreibung","node.content.duration":"Dauer","node.content.enhancePrompt":"Prompt generieren","node.content.enhancedPromptHere":"Verbesserter Prompt erscheint hier...","node.content.enhancing":"Verbessere...","node.content.environment":"Umgebung","node.content.environmentPlaceholder":"Umgebungs-Prompt...","node.content.environmentPrompt":"Umgebung & Hintergrund","node.content.compositionAndBlocking":"Komposition & Aktion","node.content.executingChain":"Kette luft...","node.content.imagePrompt":"Bild-Prompt","node.content.finalPrompt":"Finaler Prompt","node.content.finalPrompt_plural":"Finale Prompts","node.content.fixErrors":"Fehler beheben","node.content.fixingErrors":"Korrigiere...","node.content.frame":"Frame","node.content.frame_plural":"Frames","node.content.frames":"Ausgabe-Frames","node.content.frames_analyzed":"Frames analysiert: {count}","node.content.framesPerScene":"Frames pro Szene","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Anz.","node.content.fullDescription":"Vollstndige Beschreibung","node.content.generateCharacters":"Charaktere generieren","node.content.generateFinalPrompts":"Finale Prompts generieren","node.content.generatingProgress":"Generiere {current} von {total}","node.content.generateImage":"Bild generieren","node.content.generateScript":"Skript generieren","node.content.generateSpeech":"Sprache generieren","node.content.generateText":"Text generieren","node.content.generateSSML":"SSML generieren","node.content.generateStyle":"Stil generieren","node.content.generating":"Generiere...","node.content.improving":"Verbessere...","node.content.generatedAudio":"Generiertes Audio","node.content.imagePromptPlaceholder":"Prompt fr Bild eingeben...","node.content.modificationPromptPlaceholder":"nderungswunsch...","node.content.narrator":"Erzhler","node.content.narratorEnabled":"Erzhler aktivieren","node.content.narratorEnabledInfo":"Fgt Voiceover-Text hinzu.","node.content.narratorMode":"Erzhler-Modus","node.content.narratorMode.normal":"Normal / Voiceover","node.content.narratorMode.dual":"Zwei Erzhler","node.content.narratorMode.first_person":"Erste Person","node.content.role":"Rolle","node.content.role.narrator":"Erzhler","node.content.role.announcer":"Ansager","node.content.role.first_person":"Erste Person","node.content.role.dual_narrator":"Zwei Erzhler","node.content.role.dual_announcer":"Zwei Ansager","node.content.scene":"Szene","node.content.scene_plural":"Szenen","node.content.scenes":"Szenen","node.content.scenes_generated":"Szenen generiert: {count}","node.content.sceneContext":"Szenen-Kontext","node.content.sceneContextPlaceholder":"Stimmung, Umgebung, Licht...","node.content.scriptPromptPlaceholder":"Story-Idee eingeben...","node.content.seconds":"Sek","node.content.stylePlaceholder":"Stil-Prompt...","node.content.stylePromptPlaceholder":"Stil-Prompt hier eingeben...","node.content.styleOverride":"Stil berschreiben","node.content.summary":"Zusammenfassung","node.content.targetLanguage":"Zielsprache","node.content.textToSynthesize":"Text zum Synthetisieren...","node.content.translate":"bersetzen","node.content.translatePlaceholder":"Text zum bersetzen...","node.content.translatedTextPlaceholder":"bersetzung erscheint hier...","node.content.translating":"bersetze...","node.content.useExistingCharacters":"Vorh. Charaktere nutzen","node.content.useExistingCharactersInfo":"Nutzt verbundene Charakterdaten statt neue zu generieren.","node.content.createKeyItem":"Sekundr/Items erstellen","node.content.createSecondaryChars":"Nebencharaktere","node.content.createKeyItems":"Schlsselobjekte","node.content.createKeyItemInfo":"Erlaubt KI, Nebencharaktere oder Items zu erstellen.","node.content.noCharacters":"Keine Charaktere","node.content.noCharactersInfo":"Fokus auf Ereignisse und Atmosphre (Doku-Stil).","node.content.videoPrompt":"Dynamik & Bewegung","node.content.videoPrompts":"Video Prompts","node.content.voice":"Stimme","node.content.previewVoice":"Stimme testen","node.content.voicePreviewText":"Hallo, dies ist ein Stimmtest.","node.content.inputScripts":"Eingabe-Szenen","node.content.inputFrames":"Eingabe-Frames","node.content.outputScript":"Ausgabe-Szenen","node.content.requestCategories":"Kategorien anfordern","node.content.generateIdea":"Idee generieren","node.content.requestNewCategories":"Neue Kategorien","node.content.category.action":"Aktion","node.content.category.place":"Ort","node.content.category.obstacle":"Hindernis","node.content.generatedIdea":"Generierte Idee","node.content.storyFormat":"Story-Format","node.content.theme":"Thema","node.content.parameters":"Parameter","node.content.advancedMode":"Erweiterter Modus","node.content.numberOfScenes":"Anzahl der Szenen","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Detaillierter Plot","node.content.detailedPlotInfo":"Aktiviert detaillierte Beschreibungen.","node.content.includeSubscribeScene":"Abo-Aufruf Szene","node.content.includeSubscribeSceneInfo":"Fgt eine Szene hinzu, die zum Abonnieren auffordert.","node.content.genre":"Genre","node.content.genre2":"Genre 2","node.content.breakIntoParagraphs":"Abstze","node.content.copyVideoPrompt":"Video-Prompt kopieren","node.content.generateVideoPrompt":"Video-Prompt generieren","node.content.model":"Modell","node.content.processWholeScene":"Ganze Szene verarbeiten","node.content.processWholeSceneInfo":"Verarbeitet alle Frames einer Szene auf einmal fr Konsistenz.","node.content.batchProcessing":"Stapelverarbeitung","node.content.batchProcessingInfo":"Alle gewhlten Szenen in einem Kontext verarbeiten.","node.content.extendedAnalysis":"Erweiterte Analyse","node.content.extendedAnalysisInfo":"Unterteilt Szenen in detaillierte Shots.","node.content.professionalStoryboard":"Regie-Storyboard","node.content.professionalStoryboardInfo":"Analyse nach filmischen Regeln.","node.content.generateStartEndFrames":"Start/End-Frames generieren","node.content.autoIndexCharacters":"Charaktere auto-indexieren","node.content.autoIndexCharactersInfo":"Ersetzt Namen automatisch durch Aliase.","node.content.imageToText":"Bild zu Text","node.content.extracting":"Extrahiere...","node.content.extractedText":"Extrahierter Text","node.content.activePromptStack":"Aktiver Prompt-Stapel","node.content.noCharactersAnalyzed":"Keine Charaktere analysiert.","node.content.promptsGeneratedPlaceholder":"Generierte Prompts erscheinen hier.","node.content.noCharactersInScript":"Keine Charaktere im Skript.","node.content.noInputScenes":"Keine Eingabedaten. Bitte Skript-Generator verbinden.","node.content.status":"Status","node.content.status.ready":"Bereit","node.content.status.paused":"Pausiert","node.content.status.generating":"Generiere","node.content.status.total":"Gesamt: {generated} / {total}","node.content.status.batch":"Verarbeite: {current} von {total}","node.content.status.time":"Zeit: {current}s / {total}s","node.content.refreshing":"Aktualisiere...","node.content.totalFrames":"Gesamt Frames: {count}","node.content.uploadAudio":"Audio/Video hochladen","node.content.noAudioLoaded":"Kein Audio","node.content.audioLoaded":"Audio geladen","node.content.transcriptionPlaceholder":"Transkription erscheint hier...","node.content.transcribe":"Transkribieren","node.content.transcribing":"Transkribiere...","node.content.convertingVideo":"Konvertiere Video...","node.content.recommendedFrames":"Geschtzte Frames","node.content.shotType":"Einstellung","node.content.shotType.ws":"WS (Totale)","node.content.shotType.ms":"MS (Halbnah)","node.content.shotType.cu":"CU (Nah)","node.content.shotType.ecu":"ECU (Detail)","node.content.shotType.ls":"LS (Halbtotale)","node.content.characterDetail":"Charakterdetails","node.content.noCharDesc":"Keine Charakterbeschreibung","node.content.includeGeneralCharDesc":"Allgemeine visuelle Beschreibung","node.content.includeFullCharDesc":"Detaillierte visuelle Beschreibung","node.content.safeGeneration":"Sichere Generierung","node.content.shotFilter":"Shot-Filter","node.content.shotFilter.all":"Alle","node.content.shotFilter.wideOnly":"Nur Weitwinkel","instruction.desc.shot_filter_all":"Alle Einstellungsgren erlaubt (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Nur weite Einstellungen (WS, MS, LS). Keine Nahaufnahmen.","node.content.anthroEnabled":"Anthropomorphe Tiere","node.content.subscribeEnhancement":"Abo-Aufruf verstrken","node.content.thinkingEnabled":"Denkmodus","node.content.scenelessMode":"Szenen ohne Skript","instruction.desc.sceneless_mode":"Deaktiviert die Narrative Engine. Generiert Szenen direkt aus dem Konzept.","instruction.sceneless_mode":"Szenenlisten-Modus","node.content.microActionBreakdown":"Mikro-Aktionen","node.content.microActionBreakdownInfo":"Zerlegt komplexe Aktionen in Phasen (Vorbereitung, Aktion, Reaktion).","node.content.commercialSafe":"Kommerziell sicher","instruction.desc.commercial_safe":"Vermeidet strikt Marken (Disney, Pixar) und ersetzt sie durch generische Beschreibungen.","node.content.findStack":"Im Stapel suchen...","node.content.spm_stack.priming":"1. Priming & Kontext","node.content.spm_stack.physics":"2. Physik & Logik","node.content.spm_stack.hierarchy":"3. Subjekt-Hierarchie","node.content.spm_stack.construction":"4. Konstruktion & Format"},eb={"genre.general":"Allgemein","genre.comedy":"Komdie","genre.drama":"Drama","genre.action":"Action","genre.scifi":"Science-Fiction","genre.fantasy":"Fantasy","genre.horror":"Horror","genre.thriller":"Thriller","genre.childrens_animation":"Kinderanimation","genre.shorts_story":"Kurzgeschichten (Shorts)","genre.scientific_historical":"Wissenschaftlich-Historisch","character_generator.promptPlaceholder":'Idee eingeben, z.B.: "tapferer Ritter, Wchter des alten Waldes"',"idea_generator.randomTheme":"Zuflliges Thema","idea_generator.randomCombination":"Zufllige Kombination","idea_generator.themePlaceholder":"z.B. Weltraum, Kche, Zauberwald","idea_generator.initialMessage":'Thema eingeben (optional) und "{buttonName}" klicken.',"idea_generator.ideaPlaceholder":"Generierte Idee erscheint hier...","idea_generator.format.general":"Allgemein","idea_generator.format.childrens":"Kinder","idea_generator.format.adventure":"Abenteuer","idea_generator.format.fantasy":"Fantasy / Magie","idea_generator.format.detective":"Detektiv","idea_generator.format.scifi":"Sci-Fi","idea_generator.format.horror":"Horror","idea_generator.format.historical":"Historisch","gender.male":"Mnnlich","gender.female":"Weiblich","node.content.autoDownload":"Auto-Download bei Generierung","node.content.downloadSelected":"Ausgewhlte herunterladen","node.content.intonation":"Betonung","intonation.standard":"Standard","intonation.cheerful":"Frhlich","intonation.angry":"Wtend","intonation.sad":"Traurig","intonation.excited":"Aufgeregt","intonation.announcer":"Ansager","intonation.whispering":"Flsternd","node.content.sceneMode":"Szenen-Modus","node.content.connectNarratorData":'Verbinde "Alle Erzhlerdaten" vom Skript-Generator.',"node.content.sceneModeActive":"Szenen-Modus aktiv. Daten aus Verbindung.","speech_synthesizer.mode.simple":"Einfach","speech_synthesizer.mode.scene":"Szene","speech_synthesizer.multiSpeaker":"Zwei Sprecher","speech_synthesizer.speaker1Name":"Name Sprecher 1","speech_synthesizer.speaker2Name":"Name Sprecher 2","speech_synthesizer.multiSpeakerHint":'Namen mssen mit Text bereinstimmen (z.B. "Mann: ...").',"speech_synthesizer.ssmlHint":"Betonung wird durch SSML im Text gesteuert.","youtube_analytics.authorName":"Autor Name","youtube_analytics.videoTitle":"Video Titel","youtube_analytics.views":"Aufrufe","youtube_analytics.addToChannel":"Zu Kanal hinzufgen","youtube_analytics.noIncomingData":"Keine eingehenden Daten.","youtube_analytics.videoAdded":"Video hinzugefgt!","youtube_analytics.dragDrop":"Screenshot hier ablegen","youtube_analytics.thumbnailUpdated":"Thumbnail aktualisiert","youtube_analytics.statsTrend":"Statistik-Trend","youtube_analytics.currentChannel":"Aktueller Kanal","youtube_analytics.growth":"Wachstum","youtube_analytics.allChannels":"Alle Kanle","youtube_analytics.saveDisk":"Auf Datentrger speichern","youtube_analytics.saveCatalog":"Im Katalog speichern","youtube_analytics.loadDisk":"Von Datentrger laden","youtube_analytics.analyzing":"Analysiere...","youtube_analytics.askAI":"KI fragen","youtube_analytics.clickForAdvice":'Klicken Sie auf "KI fragen".',"youtube_analytics.dailyNotes":"Tgliche Notizen","youtube_analytics.logDailyStats":"Statistik loggen","youtube_analytics.subscribers":"Abonnenten","youtube_analytics.totalViews":"Gesamtansichten","youtube_analytics.updateStats":"Aktualisieren","youtube_analytics.history":"Verlauf","youtube_analytics.noHistory":"Kein Verlauf.","youtube_analytics.noNotes":"Keine Notizen.","youtube_analytics.noVideos":"Keine Videos.","youtube_analytics.loadedFromDisk":"Geladen","youtube_analytics.loadFailed":"Ladefehler","youtube_analytics.savedToDisk":"Gespeichert","youtube_title_generator.mode.title":"Video-Titel","youtube_title_generator.mode.channel":"Kanal-Info","youtube_title_generator.ideaPlaceholder":"Video-Idee eingeben...","youtube_title_generator.channelIdeaPlaceholder":"Kanal-Thema eingeben...","youtube_title_generator.title":"Titel","youtube_title_generator.description":"Beschreibung","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Kanalname","youtube_title_generator.channelDescription":"Kanalbeschreibung","youtube_title_generator.channelKeywords":"Keywords","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Songtext","music_idea_generator.mode.music_prompt":"Musik-Prompt","music_idea_generator.ideaPlaceholder":"Songthema oder Stimmung...","music_idea_generator.songTitle":"Songtitel","music_idea_generator.songTitlePlaceholder":"Titel...","music_idea_generator.lyricsPlaceholder":"Songtext erscheint hier...","music_idea_generator.musicPromptPlaceholder":"KI Musik-Prompt erscheint hier...","chat.mode.general":"Allgemein","chat.mode.script":"Skript-Experte","chat.mode.prompt":"Prompt-Experte","chat.mode.youtube":"YouTube-Experte"},tb={"catalog.title":"Katalog","catalog.tabs.groups":"Gruppen","catalog.tabs.library":"Prompt-Bibliothek","catalog.tabs.characters":"Charaktere","catalog.tabs.scripts":"Skripte","catalog.tabs.analysis":"Analysen","catalog.tabs.final_prompts":"Finale Prompts","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Musik-Ideen","catalog.empty.title":"Katalog ist leer","catalog.empty.description":"Speichern Sie ein Element oder importieren Sie es.","catalog.loadFromFile":"Aus Datei laden","catalog.card.addToCanvas":"Zum Canvas hinzufgen","catalog.card.rename":"Umbenennen","catalog.card.save":"Auf Datentrger speichern","catalog.card.delete":"Lschen","library.loadFromFile":"Aus Datei laden","library.empty.title":"Ordner ist leer","library.empty.description":"Erstellen Sie einen Ordner oder Prompt.","library.emptyPrompt":"Kein Inhalt","library.actions.newFolder":"Neuer Ordner","library.actions.newPrompt":"Neuer Prompt","library.actions.copy":"In Zwischenablage kopieren","library.actions.edit":"Prompt bearbeiten","group.rename":"Gruppe umbenennen","group.saveToCatalog":"In Katalog speichern","group.saveToDisk":"Auf Datentrger speichern","group.ungroup":"Gruppierung aufheben (Shift+Klick zum Lschen)","group.button.create":"Gruppieren ({count})"},nb={"dialog.rename.title":"Umbenennen","dialog.rename.group.title":"Gruppe umbenennen","dialog.rename.catalog.title":"Katalogelement umbenennen","dialog.rename.label":"Neuer Name","dialog.rename.confirm":"Umbenennen","dialog.rename.cancel":"Abbrechen","dialog.promptEdit.title":"Prompt bearbeiten","dialog.promptEdit.nameLabel":"Name","dialog.promptEdit.contentLabel":"Inhalt","dialog.promptEdit.confirm":"Speichern","dialog.promptEdit.cancel":"Abbrechen","dialog.reset.title":"Canvas zurcksetzen","dialog.reset.message":"Mchten Sie den Canvas wirklich zurcksetzen? Alle nicht gespeicherten Arbeiten gehen verloren.","dialog.exit.title":"Projekt schlieen?","dialog.exit.message":"Sind Sie sicher? Nicht gespeicherte Daten gehen verloren.","dialog.settings.title":"Einstellungen","dialog.settings.apiKeyLabel":"Gemini API-Schlssel","dialog.settings.apiKeyPlaceholder":"Geben Sie Ihren Schlssel hier ein","dialog.settings.getApiKeyLink":"API-Schlssel von Google AI Studio erhalten","dialog.settings.useFreeKey":"Kostenlosen (limitierten) Schlssel nutzen","dialog.settings.save":"Speichern","dialog.settings.close":"Schlieen","dialog.apiKey.title":"API-Schlssel Einstellungen","dialog.apiKey.description":"Fr diese Anwendung wird ein Gemini API-Schlssel bentigt. Er wird lokal gespeichert.","dialog.apiKey.keyExists":"Ein API-Schlssel ist bereits gespeichert.","dialog.apiKey.clear":"Schlssel lschen","dialog.apiKey.save":"Schlssel speichern","dialog.apiKey.update":"Schlssel aktualisieren","dialog.apiKey.useFreeKey":"Kostenlosen Schlssel nutzen (Entwicklung)","dialog.permission.title":"Zugriff auf Zwischenablage","dialog.permission.description":'Diese Anwendung bentigt Zugriff auf die Zwischenablage fr die "Einfgen"-Funktion in Knoten.',"dialog.permission.decline":"Ablehnen","dialog.permission.allow":"Erlauben","alert.groupSaved":'Gruppe "{groupTitle}" im Katalog gespeichert!',"toast.groupSavedToDisk":'Gruppe "{groupTitle}" auf Datentrger gespeichert!',"alert.confirmDelete":"Mchten Sie dieses Element wirklich lschen?","alert.invalidCatalogFile":"Ungltige Katalogdatei.","alert.loadCatalogFailed":"Fehler beim Laden des Katalogelements","alert.confirmLoadProject":"Das Laden eines Projekts ersetzt alle aktuellen Daten. Sind Sie sicher?","dialog.confirmDelete.title":"Lschen besttigen","dialog.confirmDelete.message":'Sind Sie sicher, dass Sie "{itemName}" lschen mchten? Dies kann nicht rckgngig gemacht werden.',"dialog.confirmDelete.folderMessage":'Mchten Sie den Ordner "{itemName}" und seinen Inhalt wirklich lschen?',"dialog.confirmDelete.confirm":"Lschen","dialog.confirmDelete.cancel":"Abbrechen","dialog.confirmClear.title":"Canvas leeren besttigen","dialog.confirmClear.message":"Mchten Sie wirklich alles vom Canvas lschen?","toast.copied":"In Zwischenablage kopiert","toast.pasted":"Eingefgt!","toast.cleared":"Geleert","toast.resetComplete":"Zurckgesetzt","toast.projectSaved":"Projekt gespeichert","toast.saveFailed":"Speichern fehlgeschlagen","toast.connectionsCut":"Verbindungen getrennt","toast.charSaved":"Charakter gespeichert","toast.charLoaded":"Charakter geladen","toast.videoPasted":"Video aus Zwischenablage","toast.savedToCatalog":"In Katalog gespeichert","toast.apiKeySaved":"API-Schlssel gespeichert","toast.apiKeyCleared":"API-Schlssel gelscht","toast.projectLoaded":"Projekt geladen","alert.batchMismatch":"Warnung: Frame-Anzahl-Fehlanpassung in Szene {scene}."},ob={"instruction.desc.safe_gen":"KRITISCHE SICHERHEIT: Vermeiden Sie strikt Wrter, die KI-Sicherheitsfilter auslsen. Ersetzen Sie Begriffe wie 'teenager', 'intimate' oder 'revealing' durch knstlerische Alternativen wie 'young person', 'artistic composition' oder 'stylized'.","instruction.desc.layered_no_style":"Struktur: 1. [Globaler Hintergrund] -> 2. [Subjekt-Hierarchie] -> 3. [Kamera]. NIEMALS eine Aktion beschreiben, ohne zuerst den Charakter vollstndig zu beschreiben."},rb={"instruction.sg_inputs":"Eingabedaten","instruction.desc.sg_inputs":"Quelle: Konzept/Idee, Charakterprofile.","instruction.core_director":"Regisseur","instruction.desc.core_director":"Sie sind ein visionrer Filmregisseur. Denken Sie in Objektiven, Bewegung und Komposition.","instruction.sg_thinking":"Analysieren","instruction.desc.sg_thinking":"Logik und Kausalitt analysieren. Klischees eliminieren.","instruction.sg_improve_input":"Skript-Doktor","instruction.desc.sg_improve_input":"Konzept verbessern, Plotholes flicken, Konflikte schrfen.","instruction.sg_exposition":"Exposition","instruction.desc.sg_exposition":"Weltstatus durch Umgebungsdetails zeigen.","instruction.sg_delayed_reveal":"Enthllung","instruction.desc.sg_delayed_reveal":"Graduelle Einfhrung: Umgebung -> Detail -> Silhouette -> Gesicht.","instruction.sg_metaphor":"Metapher","instruction.desc.sg_metaphor":"Visuelle Symbole fr interne Zustnde.","instruction.sg_pacing":"Pacing","instruction.desc.sg_pacing":"Rhythmuskontrolle: Balance zwischen Ruhe und Dynamik.","instruction.sg_subtext":"Subtext","instruction.desc.sg_subtext":"Spannung zwischen Dialog und Aktion.","instruction.desc.sg_frame_estimation":"Geschtzte Anzahl der Einstellungen.","instruction.rule_visuals":"Visuals First","instruction.desc.rule_visuals":"Zeigen, nicht sagen. Fokus auf Licht, Komposition, Bewegung.","instruction.sg_visual_dna":"Visuelle DNA","instruction.desc.sg_visual_dna":"Technischer LookDev-Leitfaden (Licht, Linsen, Render-Stil).","instruction.rule_flow":"Nahtloser Fluss","instruction.desc.rule_flow":"Match Cut Logik: Formen/Farben fr bergnge nutzen.","instruction.rule_atmosphere":"Atmosphre","instruction.desc.rule_atmosphere":"Taktile Details: Geruch, Neon-Summen, Staub.","instruction.sg_visual_style":"Visueller Stil","instruction.desc.sg_visual_style":"Anfrage: Detaillierte Stilbeschreibung basierend auf '{style}'.","instruction.char_detailed_style":"Stilisierte Details","instruction.desc.char_detailed_style":"Integriert den globalen Stil in jeden Charakter-Prompt.","instruction.sg_genre":"Genre Kontext","instruction.desc.sg_genre":"Kontext: {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"KI whlt: Ganzkrper fr Charaktere / Fllend fr Objekte.","instruction.char_no_dupes":"Keine Duplikate","instruction.desc.char_no_dupes":"KRITISCH: Charaktere NICHT neu generieren, auer bei KOSTMWECHSEL.","instruction.create_secondary_chars":"Nebencharaktere","instruction.desc.create_secondary_chars":"Erlaubt Erstellung neuer Nebencharaktere bei Bedarf.","instruction.create_key_items":"Schlsselobjekte","instruction.desc.create_key_items":"Erstellung von 'Charakterkarten' fr wichtige Objekte.","instruction.char_secondary_ok":"Neue erlaubt","instruction.desc.char_secondary_ok":"Neue Charaktere oder Items erlaubt. Bei Outfit-Wechsel neue Karte erstellen.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Charaktere mssen anthropomorphe Tiere sein.","instruction.sg_no_chars":"Keine Charaktere","instruction.desc.sg_no_chars":"Doku-Stil / Keine benannten Charaktere.","instruction.sg_detailed_plot":"Detaillierter Plot","instruction.desc.sg_detailed_plot":"Sehr detaillierte Beschreibungen von Aktionen.","instruction.sg_subscribe":"Abo-Szene","instruction.desc.sg_subscribe":"Szene mit 4. Wand-Bruch zum Abonnieren.","instruction.char_gray_bg":"Visuelles Konzept","instruction.desc.char_gray_bg":"Fr jeden visuellen Prompt IMMER anhngen: ', full body character concept on a gray background'.","instruction.char_no_new":"Keine Neuen","instruction.desc.char_no_new":"KEINE neuen Charaktere erstellen. Nur existierende nutzen.","instruction.sg_new_chars":"Neue Charaktere","instruction.desc.sg_new_chars":"Generiere neue Charaktere basierend auf Prompt.","instruction.sg_living_world":"Lebendige Welt","instruction.desc.sg_living_world_simple":"Hintergrund-Statisten sind normale Menschen.","instruction.desc.sg_living_world_anthro":"Hintergrund-Statisten sind anthropomorphe Tiere.","instruction.sg_simple_actions":"Einfache Aktionen","instruction.desc.sg_simple_actions":"Vermeide komplexe Physik/Akrobatik. Bevorzuge stabile Posen.","instruction.commercial_safe":"Kommerziell Sicher","instruction.desc.commercial_safe":"Vermeidet strikt Marken (Disney, Pixar) und ersetzt sie durch generische Beschreibungen."},ab={"instruction.ana_role":"Analysator Rolle","instruction.desc.ana_role":"Sie sind ein Weltklasse-Regisseur. Schreiben Sie technische Anweisungen fr KI-Bild/Video-Generierung. Jeder Frame muss unabhngig und detailliert beschrieben werden.","instruction.ana_cinema":"Kinematographie","instruction.desc.ana_cinema":"Profi-Begriffe: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Kinematographie (Weit)","instruction.desc.ana_cinema_wide":"Profi-Begriffe: Wide Shot, Long Shot. KEINE Nahaufnahmen.","instruction.ana_anthro_logic":"Anthro Logik","instruction.desc.ana_anthro_logic":"Charaktere explizit als anthropomorphe Tiere beschreiben.","instruction.ana_subscribe_logic":"Abo-Aufruf","instruction.desc.ana_subscribe_logic":'Visuelle Aktionen fr "Abonnieren": Schilder halten, 3D-Text.',"instruction.rule_hierarchy":"Master Framing Algorithmus","instruction.desc.rule_hierarchy":"Strikte Reihenfolge: 1. Global (Ort/Wetter). 2. Subjekt-Pose. 3. Objekt-Interaktion. 4. Aktion.","instruction.rule_living_world":"Lebendige Welt","instruction.desc.rule_living_world":"Hintergrund-Statisten passend zur Welt beschreiben.","instruction.desc.rule_living_world_anthro":"Hintergrund-Statisten mssen anthropomorphe Tiere sein.","instruction.rule_persistence":"Persistenz","instruction.desc.rule_persistence":"Chronologische Konsistenz der Szene wahren. Objekte und Positionen ber Frames hinweg verfolgen.","instruction.rule_mandatory_bg":"Pflicht-Hintergrund","instruction.desc.rule_mandatory_bg":"VERBOTEN, den Hintergrund leer zu lassen. Ort und Licht immer voll beschreiben.","instruction.desc.rule_mandatory_bg_wide":"VERBOTEN, den Hintergrund leer zu lassen. Bei Weitwinkel immer Geographie und Horizont beschreiben.","instruction.shot_filter_wide":"Nur Weitwinkel","instruction.desc.shot_filter_wide":"STRIKTER FILTER: Nur Wide (WS), Long (LS) und Medium (MS). Close-ups verboten.","instruction.storyboard_rules":"Shot-Vielfalt","instruction.desc.storyboard_rules":"Wechseln zwischen WS/LS, MS und CU/ECU fr Dynamik.","instruction.storyboard_rules_wide":"Shot-Vielfalt (Weit)","instruction.desc.storyboard_rules_wide":"Nur Weit, Lang und Establishing. Winkel variieren. KEINE Close-ups.","instruction.tech_directives":"Kamera-Kontrolle","instruction.desc.tech_directives":"Strikte Terminologie. Nur Abkrzungen (WS, MS, CU).","instruction.tech_directives_wide":"Kamera-Kontrolle (Weit)","instruction.desc.tech_directives_wide":"Strikte Terminologie. Nur WS, MS, LS. Kein CU/ECU.","instruction.use_aliases":"Aliase nutzen","instruction.desc.use_aliases":"Nutze Character-N Format.","instruction.action_phase_breakdown":"Mikro-Aktionen","instruction.desc.action_phase_breakdown":"Komplexe Aktionen in Phasen zerlegen (Vorbereitung, Start, Hhepunkt, Reaktion).","instruction.desc.action_phase_breakdown_wide":"Phasen zerlegen, aber KAMERA WEIT HALTEN. Wirkung durch Krperhaltung zeigen.","instruction.batch_processing":"Stapelverarbeitung","instruction.desc.batch_processing":"Alle Szenen als kontinuierliche Sequenz analysieren.","instruction.ana_prompt_lang":"Prompt-Sprache","instruction.desc.ana_prompt_lang":"Prompts strikt auf Englisch fr beste Kompatibilitt.","instruction.extended_visuals":"Erweiterte Visualisierung","instruction.desc.extended_visuals":"Zerlegt Szenen in expressive Sequenzen (Wide, MS, CU, Detail).","instruction.extended_visuals_wide":"Erweiterte Visualisierung (Weit)","instruction.desc.extended_visuals_wide":"Zerlegt Szenen in Sequenzen aus Weit/Mittel-Shots. Fokus auf Geographie.","instruction.desc.target_lang":"Analysesprache.","instruction.rule_isolation":"Null Kontext","instruction.desc.rule_isolation":"KRITISCH: Der Bildgenerator kennt den vorherigen Frame NICHT. Umgebung in jedem Frame neu beschreiben.","instruction.sensory_saturation":"Anti-Krze","instruction.desc.sensory_saturation":"VERBOTEN kurz zu sein. Beschreibe Texturen, Licht und physisches Gewicht.","instruction.ana_no_pov":"Kein POV","instruction.desc.ana_no_pov":'KRITISCHES NEGATIV: STRIKTES VERBOT von "POV" oder "First-Person"-Aufnahmen. Die Kamera MUSS extern sein.',"instruction.desc.static_frame_logic":'STRIKTES VERBOT von Bewegungsverben ("laufen"). Beschreibe einen EINGEFRORENEN Moment.',"instruction.desc.anatomical_posing":'Beschreibe Krper-GEOMETRIE. Statt "ausruhen" schreibe "Rckenlage, Arme seitlich".',"instruction.desc.motion_dynamics":"TRENNUNG: Image Prompt = 100% Statisch. Video Prompt = Bewegung & Zeit.","instruction.desc.anatomical_strictness":'RIGGING: "Arme hinter Kopf UND hlt Getrnk" verboten. Separat beschreiben: Linker Arm [Zustand], Rechter Arm [Zustand].',"instruction.desc.prop_consistency":'OBJEKT-LOCK: Keine generischen Nomen ("Schwert"). Visuelle Attribute ("rostiges Eisenschwert") mssen genannt und wiederholt werden.',"instruction.desc.subject_hierarchy":"Auch bei Close-ups: 1. Voller Charakter/Pose. 2. Interaktion mit Umgebung. 3. Detail.","instruction.inputs_data":"Eingaben","instruction.desc.inputs_data":"Quelldaten: Zusammenfassung, Profile, Szenentexte."},ib={"instruction.inputs":"Eingaben","instruction.desc.inputs":"Datenquelle: Analysator-Frames, Visuelle Profile, Szenenstil.","instruction.role":"Rolle: Lead Environment Artist","instruction.desc.role":"Sie sind Experte fr Prompt-Engineering. Synthetisieren Sie Eingaben zu einer definitiven visuellen Beschreibung.","instruction.layered":"Algorithmus: Einheitlicher Fluss","instruction.desc.layered":"Generiert einen EINZIGEN nahtlosen Textblock. Struktur: [Stil] -> [MASTER SET DESIGN] -> [Visuals] + [POSE & AKTION] -> [Kamera].","instruction.desc.layered_no_char":"Struktur: [MASTER SET DESIGN] -> [Aktion]. Lsst Aussehen weg, behlt nur Indizes und Aktionen.","instruction.visuals":"Stil: Sttigung","instruction.desc.visuals":"Nutze reiche visuelle Deskriptoren: volumetrisches Licht, 8k Texturen, Tiefenschrfe.","instruction.process_whole_scene":"Szenen-Stapel","instruction.desc.process_whole_scene":"Ganze Szene auf einmal analysieren fr Konsistenz.","instruction.video":"Video","instruction.desc.video":"Video Prompt: [Index] (Detail Visuell) [Aktion]. Dynamik: [Umgebung]. Kamera: [Bewegung]. KEINE NAMEN.","instruction.stateless":"Regel: Zustandslos","instruction.desc.stateless":"Jeder Frame ist unabhngig. Umgebung voll neu beschreiben. Aktion jedes Charakters von Grund auf neu beschreiben.","instruction.rule_static":"Regel: Statisch","instruction.desc.rule_static":"Beschreibe nur den eingefrorenen Moment. Keine bergnge.","instruction.atmosphere_fix":"Atmosphrischer Anker","instruction.desc.atmosphere_fix":"Beschreibe Stimmung als physikalische Eigenschaft von Luft und Licht.","instruction.subject_focus":"Kontext-Hierarchie","instruction.desc.subject_focus":"KRITISCH: Auch bei Close-ups: 1. Voller Charakter. 2. Pose. 3. Detail. Die KI braucht den Krperkontext.","instruction.always_env":"OBLIGATORISCHES SET-DESIGN","instruction.desc.always_env":'KRITISCH: Nutzen Sie den bereitgestellten "Szenen-Kontext" als ABSOLUTE WAHRHEIT fr den Hintergrund. Sie MSSEN die spezifischen Mbel, Beleuchtung und Texturen in die Umgebungsebene JEDES Prompts einfgen. Erfinden Sie keine generischen Hintergrnde.',"instruction.pm_anthro":"Anthro Detail","instruction.desc.pm_anthro":'PFLICHT: Wort "anthropomorphic" vor Spezies in Bild UND Video. Verbesserte Texturen/Anatomie.',"instruction.pm_subscribe":"Lesbarer Text","instruction.desc.pm_subscribe":'Sicherstellen, dass Text wie "SUBSCRIBE" lesbar und integriert ist (Neon, Schilder).',"instruction.strict_char_index":"Charaktere","instruction.desc.strict_char_index":"Charakter-Aliase (Character-N) strikt den Frame-Daten zuordnen.","instruction.no_names":"KRITISCH: KEINE NAMEN","instruction.desc.no_names":"KRITISCH: ABSOLUTES NAMENSVERBOT. Nur Index ID in eckigen Klammern `[Character-N]` nutzen.","instruction.general_char_desc":"Allgemeines Detail","instruction.desc.general_char_desc":"Eine PRGNANTE, ALLGEMEINE Version des visuellen Prompts integrieren.","instruction.full_char_desc":"Volles Detail","instruction.desc.full_char_desc":"Den VOLLSTNDIGEN visuellen Prompt des Profils exakt integrieren.","instruction.formatting":"Formatierung","instruction.desc.formatting":"Aktiviert explizite BERSCHRIFTEN und Zeilenumbrche fr Struktur.","instruction.anatomical_strictness":"Anatomie-Logik","instruction.desc.anatomical_strictness":'RIGGING: Verhindert "Arme hinter Kopf UND hlt Getrnk". Erzwingt separate Beschreibung.',"instruction.img_vid_consistency":"Img->Vid Fluss","instruction.desc.img_vid_consistency":"Image Prompt = Start/Statisch. Video Prompt = Aktion/Entwicklung. Video muss natrlich aus dem Bild entstehen.","instruction.desc.prop_enhancement":'MATERIALITT: Verstrkt Objektbeschreibungen (z.B. "rotes Brett" -> "glnzendes rotes Fiberglas").',"instruction.no_pov":"KRITISCH: KEIN POV","instruction.desc.no_pov":"STRIKTES VERBOT von POV-Winkeln. Kamera MUSS extern sein (Dritte Person)."},sb={"instruction.music_role":"Musikproduzenten-Rolle","instruction.desc.music_role":"Experten-Komponist und Texter.","instruction.music_input":"Eingabedaten","instruction.desc.music_input":"Thema oder Idee vom Benutzer.","instruction.music_creative":"Kreative Freiheit","instruction.desc.music_creative":"Zwingt KI, Stimmung metaphorisch zu interpretieren, nicht wrtlich.","instruction.music_lyrics":"Textstruktur","instruction.desc.music_lyrics":"Generiert Strophe/Refrain Struktur passend zum Genre.","instruction.music_prompt_rule":"KI Musik-Prompt","instruction.desc.music_prompt_rule":"Technische Tags fr Suno/Udio (BPM, Instrumente, Vocals). Max 1000 Zeichen.","instruction.music_format":"JSON Ausgabe","instruction.desc.music_format":"Strikte JSON-Struktur fr Integration."},lb={"instruction.yt_role":"YouTube-Stratege","instruction.desc.yt_role":"Experte fr SEO, CTR und virale Psychologie.","instruction.yt_input":"Eingabedaten","instruction.desc.yt_input":"Das Thema oder die Nische.","instruction.yt_title_mode":"Video-Metadaten","instruction.desc.yt_title_mode":"Optimiert Titel/Beschreibung/Tags fr maximale Klicks.","instruction.yt_channel_mode":"Kanal-Branding","instruction.desc.yt_channel_mode":"Erstellt konsistenten Namen, Bio und Handle.","instruction.yt_format":"JSON Ausgabe","instruction.desc.yt_format":"Strikte JSON-Struktur fr Integration."},cb={...ob,...rb,...ab,...ib,...sb,...lb},db={...X1,...Z1,...Q1,...eb,...tb,...nb,...cb},ub={"app.title":"Script Modifier","app.description":"Crez, affinez et gnrez visuellement des scnarios avec l'API Gemini.","app.slogan":"Connectez vos ides pour crer un chef-d'uvre","app.subtitle":"Visualisez vos scnarios","app.error.title":"Notification","app.error.copy":"Copier l'erreur","app.error.copied":"Copi !","error.quotaExceeded":"Vous avez atteint votre limite d'utilisation. Veuillez vrifier le quota de votre cl API ou ressayez plus tard.","error.apiKeyMissing":"Cl API introuvable. Veuillez dfinir votre cl API Gemini dans les paramtres.","error.freeKeyNotAvailable":"La cl API gratuite/dveloppement n'est pas disponible dans cet environnement. Veuillez fournir votre propre cl.","error.fileReadError":"Erreur lors de la lecture du fichier.","error.videoConversionError":"chec de la conversion de la vido en audio.","error.unsupportedFile":"Type de fichier non pris en charge.","error.promptModifierFile":"Ce fichier appartient  une autre application (Prompt Modifier). Veuillez l'ouvrir dans cette application.","error.invalidFileType":"Type de fichier invalide. Veuillez charger un fichier de projet ou de canevas Script Modifier.","welcome.iAmDeveloper":"Je suis dveloppeur","welcome.letsGo":"C'est parti !","welcome.resume":"Reprendre","welcome.reload":"Recharger","welcome.reloadTitle":"Rinitialiser et recharger ?","welcome.reloadMessage":"Cela effacera tout le canevas et rechargera l'application. Les donnes non sauvegardes seront perdues. tes-vous sr ?","welcome.confirmReload":"Rinitialiser et recharger","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Bienvenue dans","dialog.welcome.intro1":"Bienvenue dans Script Modifier - votre espace de travail visuel pour crer des histoires avec Gemini.","dialog.welcome.intro2":"Pour commencer, veuillez slectionner votre langue et saisir votre cl API Gemini.","dialog.welcome.apiKeyExplanation":"Votre cl API est stocke localement dans votre navigateur. Nous ne l'envoyons  aucun serveur autre que l'API Google Gemini."},pb={"toolbar.edit":"diter (V)","toolbar.cutter":"Couper la connexion (C)","toolbar.selection":"Outil de slection (S)","toolbar.reroute":"Point de dviation (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Aligner sur la grille (Shift+W)","toolbar.resetZoom":"Rinitialiser le zoom","toolbar.lineStyleSpaghetti":"Lignes Spaghetti (Shift+E)","toolbar.lineStyleOrthogonal":"Lignes Orthogonales (Shift+E)","toolbar.addNode":"Ajouter un nud (F)","toolbar.catalog":"Catalogue (Ctrl+Espace)","toolbar.settings":"Paramtres","toolbar.resetToDefault":"Rtablir par dfaut","toolbar.closeProject":"Fermer le projet / Effacer","toolbar.enterFullscreen":"Plein cran","toolbar.exitFullscreen":"Quitter le plein cran","toolbar.addTextInput":"Entre de texte (T)","toolbar.addPromptAnalyzer":"Analyseur de Prompt (A)","toolbar.addCharacterAnalyzer":"Analyseur de Personnage","toolbar.addCharacterGenerator":"Gnrateur de Personnages (Shift+C)","toolbar.addImageGenerator":"Gnrateur d'Images (O)","toolbar.addImagePreview":"Aperu d'Image (I)","toolbar.addCharacterCard":"Fiche Personnage (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Processeur de Prompt (P)","toolbar.addGeminiChat":"Gemini Chat (M)","toolbar.addTranslator":"Traducteur (L)","toolbar.addIdeaGenerator":"Gnrateur d'Ides (Shift+A)","toolbar.addScriptGenerator":"Gnrateur de Scnario (Shift+S)","toolbar.addScriptAnalyzer":"Analyseur de Scnario (Shift+D)","toolbar.addScriptPromptModifier":"Finaliseur de Prompt (Shift+F)","toolbar.addErrorAnalyzer":"Analyseur d'Erreurs","toolbar.addNote":"Note (N)","toolbar.addDataReader":"Lecteur de Donnes (Shift+R)","toolbar.addSpeechSynthesizer":"Synthtiseur Vocal (Shift+N)","toolbar.addNarratorTextGenerator":"Gnrateur de Texte Narrateur (Shift+G)","toolbar.addAudioTranscriber":"Transcripteur Audio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Gnrateur de Titres YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Gnrateur d'Ides Musicales (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Sauvegarder le canevas (Ctrl+S)","toolbar.saveProject":"Sauvegarder le projet (Ctrl+Shift+S)","toolbar.loadCanvas":"Charger (Ctrl+O)","toolbar.clearCanvas":"Effacer le canevas","toolbar.group.general":"Gnral","toolbar.group.scripting":"Scnarisation","toolbar.group.prompting":"Prompts & Analyse","toolbar.group.characters":"Personnages","toolbar.group.ai":"Outils IA","toolbar.group.file":"Fichier","toolbar.group.images":"Images","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Contrles du canevas","toolbar.expand":"Dvelopper le panneau","toolbar.collapse":"Rduire le panneau","toolbar.toggleHeaders":"Basculer les en-ttes","hotkeys.file.title":"Fichier","hotkeys.file.save":"Sauvegarder le canevas (Ctrl+S)","hotkeys.file.saveProject":"Sauvegarder le projet (Ctrl+Shift+S)","hotkeys.file.load":"Charger le canevas (Ctrl+O)","hotkeys.tools.title":"Outils","hotkeys.tools.edit":"diter","hotkeys.tools.cutter":"Couper","hotkeys.tools.selection":"Slection","hotkeys.tools.reroute":"Dviation","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Grouper (G)","hotkeys.tools.deleteGroup":"Supprimer le groupe","hotkeys.tools.closeNode":"Fermer le nud","hotkeys.tools.toggleLineStyle":"Basculer le style de ligne","hotkeys.tools.snapToGrid":"Aligner sur la grille","hotkeys.tools.selectAll":"Tout slectionner","hotkeys.tools.deselectAll":"Tout dslectionner","hotkeys.tools.duplicate":"Dupliquer avec contenu","hotkeys.windows.title":"Fentres","hotkeys.windows.search":"Rechercher (F)","hotkeys.windows.quickAdd":"Ajout rapide (Espace)","hotkeys.windows.catalog":"Catalogue","hotkeys.createNode.title":"Crer un nud","hotkeys.hide":"Masquer les raccourcis","help.title":"Raccourcis clavier","hotkeys.show":"Afficher les raccourcis","search.placeholder":"Rechercher un nud...","search.noResults":"Aucun nud trouv.","search.node.text_input.title":"Entre de Texte","search.node.text_input.description":"Une zone de texte simple pour vos ides. (T)","search.node.prompt_processor.title":"Processeur de Prompt","search.node.prompt_processor.description":"Amliore et combine des prompts avec l'IA. (P)","search.node.prompt_analyzer.title":"Analyseur de Prompt","search.node.prompt_analyzer.description":"Divise un prompt en personnage et environnement. (A)","search.node.character_analyzer.title":"Analyseur de Personnage","search.node.character_analyzer.description":"Divise une description en personnage et vtements.","search.node.character_generator.title":"Gnrateur de Personnages","search.node.character_generator.description":"Cre des personnages dtaills  partir d'une ide. (Shift+C)","search.node.image_generator.title":"Gnrateur d'Images","search.node.image_generator.description":"Cre une image  partir d'un texte. (O)","search.node.image_preview.title":"Aperu d'Image","search.node.image_preview.description":"Affiche une image depuis un fichier. (I)","search.node.character_card.title":"Fiche Personnage","search.node.character_card.description":"Stocke l'image, le nom et le prompt d'un personnage. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Discussion directe avec Gemini AI. (M)","search.node.translator.title":"Traducteur","search.node.translator.description":"Traduit le texte vers une langue slectionne. (L)","search.node.script_generator.title":"Gnrateur de Scnario","search.node.script_generator.description":"Transforme une ide en scnes de scnario. (Shift+S)","search.node.script_analyzer.title":"Analyseur de Scnario","search.node.script_analyzer.description":"Dcoupe un scnario en plans et prompts d'image. (Shift+D)","search.node.script_prompt_modifier.title":"Finaliseur de Prompt","search.node.script_prompt_modifier.description":"Finalise les prompts de l'analyse pour la gnration d'images. (Shift+F)","search.node.error_analyzer.title":"Analyseur d'Erreurs","search.node.error_analyzer.description":"Vrifie et corrige la grammaire et l'orthographe.","search.node.note.title":"Note","search.node.note.description":"Une zone de texte simple pour vos notes. (N)","search.node.reroute_dot.title":"Point de dviation","search.node.reroute_dot.description":"Un point pour rediriger et diviser les connexions.","search.node.data_reader.title":"Lecteur de Donnes","search.node.data_reader.description":"Affiche le texte brut d'une connexion.","search.node.speech_synthesizer.title":"Synthtiseur Vocal","search.node.speech_synthesizer.description":"Convertit le texte en parole. (Shift+N)","search.node.idea_generator.title":"Gnrateur d'Ides","search.node.idea_generator.description":"Gnre des catgories et les combine en une ide d'histoire.","search.node.narrator_text_generator.title":"Gnrateur de Texte Narrateur","search.node.narrator_text_generator.description":"Gnre du texte pour un narrateur ou un annonceur. (Shift+G)","search.node.audio_transcriber.title":"Transcripteur Audio","search.node.audio_transcriber.description":"Convertit des fichiers audio/vido en texte. (Shift+B)","search.node.youtube_title_generator.title":"Gnrateur de Titres YouTube","search.node.youtube_title_generator.description":"Gnre des titres, descriptions et tags accrocheurs.","search.node.music_idea_generator.title":"Gnrateur d'Ides Musicales","search.node.music_idea_generator.description":"Gnre des paroles ou des prompts musicaux. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analyse les stats de la chane et donne des conseils de croissance.","search.node.image_editor.title":"diteur d'Image","search.node.image_editor.description":"ditez des images avec l'IA (Inpainting, Outpainting).","search.group.input":"Entre","search.group.process":"Traitement & Analyse","search.group.scripting":"Outils Scnario","search.group.character":"Outils Personnage","search.group.images":"Outils Image","search.group.ai":"Outils IA","search.group.audio":"Outils Audio","search.group.youtube":"Outils YouTube","contextMenu.tools":"Outils","contextMenu.assignSlot":"Assigner l'emplacement {index}","contextMenu.addNodeFromSlot":"Ajouter {node} ({index})","connectionMenu.title":"Ajouter un Nud","quickAddMenu.title":"Ajout Rapide","contextMenu.paste":"Coller (Ctrl+V)","node.content.simpleActions":"Actions Simples","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Rapide, efficace, bon pour les brouillons.","tooltip.model.pro":"Gemini Pro: Haute intelligence, raisonnement complexe, dtaill.","tooltip.lang.ru":"Gnrer le scnario en Russe.","tooltip.lang.en":"Gnrer le scnario en Anglais.","tooltip.lang.es":"Gnrer le scnario en Espagnol.","tooltip.lang.de":"Gnrer le scnario en Allemand.","tooltip.lang.uz":"Gnrer le scnario en Ouzbek.","tooltip.lang.fr":"Gnrer le scnario en Franais.","tooltip.lang.it":"Gnrer le scnario en Italien.","tooltip.lang.pt":"Gnrer le scnario en Portugais.","tooltip.lang.zh":"Gnrer le scnario en Chinois.","node.action.locateInStack":"Localiser dans la pile","help.tabs.hotkeys":"Aide & Raccourcis","help.tabs.links":"Autres Apps & Liens","help.category.socials":"Rseaux Sociaux","help.category.stable":"Google AI Studio (Stable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Dpts GitHub","help.link.youtube":"Chane YouTube","help.link.telegram_channel":"Chane Telegram","help.link.telegram_chat":"Chat Telegram","help.sub.news":"Nouvelles & Mises  jour","help.sub.discussion":"Discussion","help.sub.stable":"Version Stable","help.sub.alpha":"Version Alpha","languages.ru":"Russe","languages.en":"Anglais","languages.es":"Espagnol","languages.fr":"Franais","languages.de":"Allemand","languages.it":"Italien","languages.pt":"Portugais","languages.zh":"Chinois","languages.ja":"Japonais","languages.ko":"Coren","languages.uz":"Ouzbek"},hb={"node.title.text_input":"Entre de Texte","node.title.prompt_processor":"Processeur de Prompt","node.title.prompt_analyzer":"Analyseur de Prompt","node.title.character_analyzer":"Analyseur de Personnage","node.title.character_generator":"Gnrateur de Personnages","node.title.image_generator":"Gnrateur d'Images","node.title.image_preview":"Aperu d'Image","node.title.character_card":"Fiche Personnage","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Traducteur","node.title.script_generator":"Gnrateur de Scnario","node.title.script_analyzer":"Analyseur de Scnario","node.title.script_prompt_modifier":"Finaliseur de Prompt","node.title.error_analyzer":"Analyseur d'Erreurs","node.title.note":"Note","node.title.reroute_dot":"Point de dviation","node.title.data_reader":"Lecteur de Donnes","node.title.speech_synthesizer":"Synthtiseur Vocal","node.title.idea_generator":"Gnrateur d'Ides","node.title.narrator_text_generator":"Gnrateur de Texte Narrateur","node.title.audio_transcriber":"Transcripteur Audio","node.title.youtube_title_generator":"Gnrateur de Titres YouTube","node.title.music_idea_generator":"Gnrateur d'Ides Musicales","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"diteur d'Image","node.help.text_input":"Entrez des ides de base ou des descriptions ici.","node.help.prompt_processor":"Combine le texte d'autres nuds en un prompt dtaill.","node.help.prompt_analyzer":"Divise un prompt en environnement, personnage, action et style.","node.help.character_analyzer":"Divise une description de personnage en physique et vtements.","node.help.character_generator":"Cre des descriptions dtailles de personnages  partir d'une ide.","node.help.image_generator":"Gnre une image  partir d'un texte avec l'API Gemini.","node.help.image_preview":"Affiche une image. Glissez-dposez un fichier dessus.","node.help.character_card":"Stocke l'image, le nom et le prompt d'un personnage.","node.help.gemini_chat":"Conversation directe avec Gemini AI.","node.help.translator":"Traduit le texte entrant dans la langue slectionne.","node.help.script_generator":"Gnre des scnes de scnario  partir d'un prompt.","node.help.script_analyzer":"Dcoupe un scnario en plans et prompts d'image.","node.help.script_prompt_modifier":"Cre des prompts artistiques finaux pour chaque plan.","node.help.error_analyzer":"Vrifie et corrige l'orthographe et la grammaire.","node.help.note":"Une zone de texte simple pour vos notes.","node.help.reroute_dot":"Un point pour rediriger les connexions.","node.help.data_reader":"Affiche les donnes brutes d'un nud connect.","node.help.speech_synthesizer":"Convertit le texte en parole.","node.help.idea_generator":"Gnre des catgories et les combine en une ide.","node.help.narrator_text_generator":"Gnre du texte pour un narrateur ou annonceur.","node.help.audio_transcriber":"Convertit des fichiers audio/vido en texte.","node.help.youtube_title_generator":"Gnre des titres, descriptions et tags pour YouTube.","node.help.music_idea_generator":"Gnre des paroles ou des prompts musicaux.","node.help.youtube_analytics":"Analyse les stats de la chane et donne des conseils.","node.help.image_editor":"ditez des images avec l'IA (Inpainting, Outpainting).","node.action.help":"Aide","node.action.expand":"Dvelopper","node.action.collapse":"Rduire (H)","node.action.expandAll":"Tout dvelopper","node.action.collapseAll":"Tout rduire","node.action.expandAllScenes":"Dvelopper toutes les scnes","node.action.collapseAllScenes":"Rduire toutes les scnes","node.action.expandAllFrames":"Dvelopper tous les plans","node.action.collapseAllFrames":"Rduire tous les plans","node.action.expandPanel":"Dvelopper le panneau","node.action.collapsePanel":"Rduire le panneau","node.action.togglePanel":"Basculer le panneau","node.action.collapseScene":"Rduire la scne","node.action.expandScene":"Dvelopper la scne","node.action.collapseFrame":"Rduire le plan","node.action.expandFrame":"Dvelopper le plan","node.action.collapseCharacter":"Rduire le personnage","node.action.expandCharacter":"Dvelopper le personnage","node.action.clear":"Effacer","node.action.clearTooltip":"Effacer le champ.","node.action.clearChat":"Effacer le chat","node.action.paste":"Coller","node.action.copy":"Copier","node.action.duplicateWithContent":"Dupliquer (Contenu)","node.action.duplicateEmpty":"Dupliquer (Vide)","node.action.cutConnections":"Couper les connexions","node.action.close":"Fermer","node.action.executeChain":"Excuter la chane","node.action.executeFullChain":"Excuter toute la chane","node.action.processChainForward":"Traiter la chane vers l'avant","node.action.executeChainTitle":"Excuter tous les nuds connects.","node.action.addCharacter":"Ajouter un personnage","node.action.addScene":"Ajouter une scne","node.action.addFrame":"Ajouter un plan","node.action.addFirstFrame":"Ajouter le premier plan","node.action.deleteItem":"Supprimer","node.action.moveUp":"Monter","node.action.moveDown":"Descendre","node.action.saveImage":"Sauvegarder l'image","node.action.loadImage":"Charger une image","node.action.saveCharacter":"Sauvegarder le personnage","node.action.loadCharacter":"Charger un personnage","node.action.readData":"Lire les donnes","node.action.refreshData":"Actualiser les donnes","node.action.stop":"Arrter","node.action.stopping":"Arrt...","node.action.embedCharacter":"Intgrer le personnage","node.action.downloadFinalPrompts":"Tlcharger les prompts","node.action.rename":"Renommer","node.action.index":"Indexer","node.action.improveConcept":"Amliorer le concept","node.action.improveConceptTooltip":"Enrichir et ajouter des dtails visuels.","node.action.downloadJson":"Tlcharger JSON","node.action.downloadSRT":"Tlcharger SRT","node.action.markPrimary":"Marquer comme Principal","node.input.default":"Entre","node.output.default":"Sortie","node.output.allCharacters":"Tous les Personnages","node.output.primaryCharacter":"Personnage Principal","node.content.action":"Action","node.content.actionPlaceholder":"Prompt d'action...","node.content.allScriptParts":"Toutes les parties du scnario","node.content.allScriptAnalyzerData":"Donnes de l'analyseur","node.content.allNarratorData":"Toutes les donnes du narrateur","node.content.analyzeCharacters":"Analyser les personnages","node.content.analyzeFromScene":"Analyser de:","node.content.analyzeUpToScene":"","node.content.endPlaceholder":"fin","node.content.generateFromFrame":"Gnrer depuis le plan:","node.content.generateUpToFrame":"jusqu'au plan","node.content.analyzeFromFrame":"Finaliser depuis le plan:","node.content.processFromFrame":"Traiter depuis le plan:","node.content.processFromScene":"Traiter depuis la scne:","node.content.analyzePrompt":"Analyser le prompt","node.content.analyzeScript":"Analyser le scnario","node.content.analyzing":"Analyse...","node.content.applyAliases":"Appliquer les alias","node.content.applyAliasesTooltip":"Remplace les noms par des alias (Index).","node.content.character":"Personnage","node.content.characterIndex":"Index","node.content.characterPlaceholder":"Prompt du personnage...","node.content.character_plural":"personnages","node.content.characters":"Personnages","node.content.charactersSynced":"Personnages synchroniss","node.content.noCharactersConnected":"Aucun personnage connect.","node.content.appearance":"Apparence","node.content.personality":"Personnalit","node.content.characterType":"Type","node.content.characterTypeShort":"Type","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro (Animaux)","node.content.characterType.chibi":"Chibi (Mignon)","node.content.characterType.key_item":"Objet Cl","node.content.style":"Style","node.content.style.none":"Aucun","node.content.style.simple":"Simple","node.content.style.realistic":"Raliste/Cinma","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"3D Raliste","node.content.style.2d_animation":"Animation 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Spcial","node.content.chatPlaceholder":"Tapez un message...","node.content.clothing":"Vtements","node.content.clothingPlaceholder":"Prompt des vtements...","node.content.connectedPlaceholder":"Connect","node.content.dataPlaceholder":"Les donnes apparatront ici...","node.content.readData":"Lire les donnes","node.content.reading":"Lecture...","node.content.description":"Description","node.content.sceneDescription":"Description de la scne","node.content.duration":"Dure","node.content.enhancePrompt":"Gnrer le prompt","node.content.enhancedPromptHere":"Le prompt amlior apparatra ici...","node.content.enhancing":"Amlioration...","node.content.environment":"Environnement","node.content.environmentPlaceholder":"Prompt de l'environnement...","node.content.environmentPrompt":"Environnement & Arrire-plan","node.content.compositionAndBlocking":"Composition & Action","node.content.executingChain":"Chane en cours...","node.content.imagePrompt":"Prompt Image","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finaux","node.content.fixErrors":"Corriger les erreurs","node.content.fixingErrors":"Correction...","node.content.frame":"Plan","node.content.frame_plural":"plans","node.content.frames":"Plans de sortie","node.content.frames_analyzed":"Plans analyss : {count}","node.content.framesPerScene":"Plans par scne","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Qt","node.content.fullDescription":"Description complte","node.content.generateCharacters":"Gnrer les personnages","node.content.generateFinalPrompts":"Gnrer prompts finaux","node.content.generatingProgress":"Gnration {current} sur {total}","node.content.generateImage":"Gnrer l'image","node.content.generateScript":"Gnrer le scnario","node.content.generateSpeech":"Gnrer la parole","node.content.generateText":"Gnrer le texte","node.content.generateSSML":"Gnrer SSML","node.content.generateStyle":"Gnrer le style","node.content.generating":"Gnration...","node.content.improving":"Amlioration...","node.content.generatedAudio":"Audio gnr","node.content.imagePromptPlaceholder":"Entrez un prompt pour l'image...","node.content.modificationPromptPlaceholder":"Demande de modification...","node.content.narrator":"Narrateur","node.content.narratorEnabled":"Activer le narrateur","node.content.narratorEnabledInfo":"Ajoute un texte de voix off.","node.content.narratorMode":"Mode Narrateur","node.content.narratorMode.normal":"Normal / Voix off","node.content.narratorMode.dual":"Deux Narrateurs","node.content.narratorMode.first_person":"Premire Personne","node.content.role":"Rle","node.content.role.narrator":"Narrateur","node.content.role.announcer":"Annonceur","node.content.role.first_person":"Premire Personne","node.content.role.dual_narrator":"Deux Narrateurs","node.content.role.dual_announcer":"Deux Annonceurs","node.content.scene":"Scne","node.content.scene_plural":"scnes","node.content.scenes":"Scnes","node.content.scenes_generated":"Scnes gnres : {count}","node.content.sceneContext":"Contexte de la scne","node.content.sceneContextPlaceholder":"Ambiance, environnement, lumire...","node.content.scriptPromptPlaceholder":"Entrez une ide d'histoire...","node.content.seconds":"sec","node.content.stylePlaceholder":"Prompt de style...","node.content.stylePromptPlaceholder":"Entrez le prompt de style ici...","node.content.styleOverride":"Remplacer le style","node.content.summary":"Rsum","node.content.targetLanguage":"Langue Cible","node.content.textToSynthesize":"Texte  synthtiser...","node.content.translate":"Traduire","node.content.translatePlaceholder":"Texte  traduire...","node.content.translatedTextPlaceholder":"Le texte traduit apparatra ici...","node.content.translating":"Traduction...","node.content.useExistingCharacters":"Utiliser persos existants","node.content.useExistingCharactersInfo":"Utilise les donnes des personnages connects.","node.content.createKeyItem":"Crer Secondaire/Objets","node.content.createSecondaryChars":"Personnages Secondaires","node.content.createKeyItems":"Objets Cls","node.content.createKeyItemInfo":"Permet  l'IA de crer des personnages secondaires ou des objets.","node.content.noCharacters":"Sans Personnages","node.content.noCharactersInfo":"Focus sur les vnements et l'atmosphre (style documentaire).","node.content.videoPrompt":"Dynamique & Mouvement","node.content.videoPrompts":"Prompts Vido","node.content.voice":"Voix","node.content.previewVoice":"Tester la voix","node.content.voicePreviewText":"Bonjour, ceci est un test de voix.","node.content.inputScripts":"Scnes d'entre","node.content.inputFrames":"Plans d'entre","node.content.outputScript":"Scnes de sortie","node.content.requestCategories":"Demander des catgories","node.content.generateIdea":"Gnrer l'ide","node.content.requestNewCategories":"Nouvelles catgories","node.content.category.action":"Action","node.content.category.place":"Lieu","node.content.category.obstacle":"Obstacle","node.content.generatedIdea":"Ide Gnre","node.content.storyFormat":"Format de l'histoire","node.content.theme":"Thme","node.content.parameters":"Paramtres","node.content.advancedMode":"Mode Avanc","node.content.numberOfScenes":"Nombre de scnes","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Intrigue Dtaille","node.content.detailedPlotInfo":"Active les descriptions dtailles.","node.content.includeSubscribeScene":"Scne d'abonnement","node.content.includeSubscribeSceneInfo":"Ajoute une scne demandant de s'abonner.","node.content.genre":"Genre","node.content.genre2":"Genre 2","node.content.breakIntoParagraphs":"Paragraphes","node.content.copyVideoPrompt":"Copier le prompt vido","node.content.generateVideoPrompt":"Gnrer prompt vido","node.content.model":"Modle","node.content.processWholeScene":"Traiter toute la scne","node.content.processWholeSceneInfo":"Traite tous les plans d'une scne en une fois pour la cohrence.","node.content.batchProcessing":"Traitement par lots","node.content.batchProcessingInfo":"Traiter toutes les scnes slectionnes dans une seule fentre contextuelle.","node.content.extendedAnalysis":"Analyse tendue","node.content.extendedAnalysisInfo":"Divise les scnes en plans dtaills.","node.content.professionalStoryboard":"Storyboard Ralisateur","node.content.professionalStoryboardInfo":"Analyse selon les rgles du langage cinmatographique.","node.content.generateStartEndFrames":"Gnrer plans dbut/fin","node.content.autoIndexCharacters":"Auto-indexer Personnages","node.content.autoIndexCharactersInfo":"Remplace automatiquement les noms par des alias.","node.content.imageToText":"Image vers Texte","node.content.extracting":"Extraction...","node.content.extractedText":"Texte Extrait","node.content.activePromptStack":"Pile de Prompts Active","node.content.noCharactersAnalyzed":"Aucun personnage analys.","node.content.promptsGeneratedPlaceholder":"Les prompts gnrs apparatront ici.","node.content.noCharactersInScript":"Pas de personnages dans le script.","node.content.noInputScenes":"Aucune donne. Connectez un Gnrateur de Scnario.","node.content.status":"Statut","node.content.status.ready":"Prt","node.content.status.paused":"En pause","node.content.status.generating":"Gnration","node.content.status.total":"Total : {generated} / {total}","node.content.status.batch":"Traitement : {current} sur {total}","node.content.status.time":"Temps : {current}s / {total}s","node.content.refreshing":"Actualisation...","node.content.totalFrames":"Total Plans : {count}","node.content.uploadAudio":"Uploader Audio/Vido","node.content.noAudioLoaded":"Aucun audio","node.content.audioLoaded":"Audio charg","node.content.transcriptionPlaceholder":"La transcription apparatra ici...","node.content.transcribe":"Transcrire","node.content.transcribing":"Transcription...","node.content.convertingVideo":"Conversion vido...","node.content.recommendedFrames":"Plans Estims","node.content.shotType":"Plan","node.content.shotType.ws":"WS (Large)","node.content.shotType.ms":"MS (Moyen)","node.content.shotType.cu":"CU (Gros Plan)","node.content.shotType.ecu":"ECU (Trs Gros Plan)","node.content.shotType.ls":"LS (Plan d'ensemble)","node.content.characterDetail":"Dtails du personnage","node.content.noCharDesc":"Pas de description de personnage","node.content.includeGeneralCharDesc":"Description visuelle gnrale","node.content.includeFullCharDesc":"Description visuelle dtaille","node.content.safeGeneration":"Gnration Sre","node.content.shotFilter":"Filtre de Plan","node.content.shotFilter.all":"Tous","node.content.shotFilter.wideOnly":"Large Uniquement","instruction.desc.shot_filter_all":"Autoriser tous les types de plans (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restreindre aux plans larges (WS, MS, LS). Gros plans interdits.","node.content.anthroEnabled":"Animaux Anthropomorphes","node.content.subscribeEnhancement":"Renforcer Appel Abonnement","node.content.thinkingEnabled":"Mode Rflexion","node.content.scenelessMode":"Scnes sans script","instruction.desc.sceneless_mode":"Dsactiver le moteur narratif. Gnrer les scnes directement depuis le concept.","instruction.sceneless_mode":"Mode Liste de Scnes","node.content.microActionBreakdown":"Micro-Actions","node.content.microActionBreakdownInfo":"Dcompose les actions complexes en phases (Prparation, Action, Raction).","node.content.commercialSafe":"Sr pour le Commerce","instruction.desc.commercial_safe":"vite strictement les marques dposes (Disney, Pixar) et les remplace par des descriptions gnriques.","node.content.findStack":"Trouver dans la pile...","node.content.spm_stack.priming":"1. Amorage et Contexte","node.content.spm_stack.physics":"2. Physique et Logique","node.content.spm_stack.hierarchy":"3. Hirarchie du Sujet","node.content.spm_stack.construction":"4. Construction et Format"},mb={"genre.general":"Gnral","genre.comedy":"Comdie","genre.drama":"Drame","genre.action":"Action","genre.scifi":"Science-Fiction","genre.fantasy":"Fantaisie","genre.horror":"Horreur","genre.thriller":"Thriller","genre.childrens_animation":"Animation pour enfants","genre.shorts_story":"Histoires courtes (Shorts)","genre.scientific_historical":"Scientifique-Historique","character_generator.promptPlaceholder":'Entrez une ide, ex: "chevalier courageux, gardien de la fort ancienne"',"idea_generator.randomTheme":"Thme alatoire","idea_generator.randomCombination":"Combinaison alatoire","idea_generator.themePlaceholder":"ex. Espace, Cuisine, Fort Enchante","idea_generator.initialMessage":'Entrez un thme (optionnel) et cliquez sur "{buttonName}".',"idea_generator.ideaPlaceholder":"L'ide gnre apparatra ici...","idea_generator.format.general":"Gnral","idea_generator.format.childrens":"Enfants","idea_generator.format.adventure":"Aventure","idea_generator.format.fantasy":"Fantaisie / Magie","idea_generator.format.detective":"Dtective","idea_generator.format.scifi":"Sci-Fi","idea_generator.format.horror":"Horreur","idea_generator.format.historical":"Historique","gender.male":"Homme","gender.female":"Femme","node.content.autoDownload":"Tlchargement auto  la gnration","node.content.downloadSelected":"Tlcharger la slection","node.content.intonation":"Intonation","intonation.standard":"Standard","intonation.cheerful":"Joyeux","intonation.angry":"En colre","intonation.sad":"Triste","intonation.excited":"Excit","intonation.announcer":"Annonceur","intonation.whispering":"Chuchotement","node.content.sceneMode":"Mode Scne","node.content.connectNarratorData":'Connectez "Toutes les donnes du narrateur" depuis un Gnrateur de Scnario.',"node.content.sceneModeActive":"Mode Scne actif. Donnes reues.","speech_synthesizer.mode.simple":"Simple","speech_synthesizer.mode.scene":"Scne","speech_synthesizer.multiSpeaker":"Deux Locuteurs","speech_synthesizer.speaker1Name":"Nom Locuteur 1","speech_synthesizer.speaker2Name":"Nom Locuteur 2","speech_synthesizer.multiSpeakerHint":'Les noms doivent correspondre  ceux du texte (ex. "Homme: ...", "Femme: ...").',"speech_synthesizer.ssmlHint":"L'intonation est contrle par des balises SSML dans le texte.","youtube_analytics.authorName":"Nom de l'auteur","youtube_analytics.videoTitle":"Titre de la vido","youtube_analytics.views":"Vues","youtube_analytics.addToChannel":"Ajouter  la chane","youtube_analytics.noIncomingData":"Pas de donnes entrantes.","youtube_analytics.videoAdded":"Vido ajoute !","youtube_analytics.dragDrop":"Dposez une capture d'cran ici","youtube_analytics.thumbnailUpdated":"Miniature mise  jour","youtube_analytics.statsTrend":"Tendance Statistique","youtube_analytics.currentChannel":"Chane Actuelle","youtube_analytics.growth":"Croissance","youtube_analytics.allChannels":"Toutes les chanes","youtube_analytics.saveDisk":"Sauver sur Disque","youtube_analytics.saveCatalog":"Sauver au Catalogue","youtube_analytics.loadDisk":"Charger du Disque","youtube_analytics.analyzing":"Analyse...","youtube_analytics.askAI":"Demander  l'IA","youtube_analytics.clickForAdvice":`Cliquez sur "Demander  l'IA".`,"youtube_analytics.dailyNotes":"Notes Quotidiennes","youtube_analytics.logDailyStats":"Enreg. Stats","youtube_analytics.subscribers":"Abonns","youtube_analytics.totalViews":"Vues Totales","youtube_analytics.updateStats":"Mettre  jour","youtube_analytics.history":"Historique","youtube_analytics.noHistory":"Aucun historique.","youtube_analytics.noNotes":"Aucune note.","youtube_analytics.noVideos":"Aucune vido.","youtube_analytics.loadedFromDisk":"Charg","youtube_analytics.loadFailed":"chec du chargement","youtube_analytics.savedToDisk":"Sauvegard","youtube_title_generator.mode.title":"Titre Vido","youtube_title_generator.mode.channel":"Info Chane","youtube_title_generator.ideaPlaceholder":"Entrez une ide de vido...","youtube_title_generator.channelIdeaPlaceholder":"Entrez un thme de chane...","youtube_title_generator.title":"Titre","youtube_title_generator.description":"Description","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Nom de la Chane","youtube_title_generator.channelDescription":"Description de la Chane","youtube_title_generator.channelKeywords":"Mots-cls","youtube_title_generator.channelHandle":"Identifiant (@)","music_idea_generator.mode.lyrics":"Paroles","music_idea_generator.mode.music_prompt":"Prompt Musical","music_idea_generator.ideaPlaceholder":"Entrez un thme ou une humeur...","music_idea_generator.songTitle":"Titre de la Chanson","music_idea_generator.songTitlePlaceholder":"Titre...","music_idea_generator.lyricsPlaceholder":"Les paroles apparatront ici...","music_idea_generator.musicPromptPlaceholder":"Le prompt musical IA apparatra ici...","chat.mode.general":"Gnral","chat.mode.script":"Expert Scnario","chat.mode.prompt":"Expert Prompt","chat.mode.youtube":"Expert YouTube"},gb={"catalog.title":"Catalogue","catalog.tabs.groups":"Groupes","catalog.tabs.library":"Bibliothque de Prompts","catalog.tabs.characters":"Personnages","catalog.tabs.scripts":"Scnarios","catalog.tabs.analysis":"Analyses","catalog.tabs.final_prompts":"Prompts Finaux","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Ides Musicales","catalog.empty.title":"Le catalogue est vide","catalog.empty.description":"Sauvegardez un lment pour le voir ici, ou importez-en un.","catalog.loadFromFile":"Charger depuis un fichier","catalog.card.addToCanvas":"Ajouter au canevas","catalog.card.rename":"Renommer","catalog.card.save":"Sauvegarder sur disque","catalog.card.delete":"Supprimer","library.loadFromFile":"Charger depuis un fichier","library.empty.title":"Le dossier est vide","library.empty.description":"Crez un nouveau dossier ou prompt.","library.emptyPrompt":"Pas de contenu","library.actions.newFolder":"Nouveau Dossier","library.actions.newPrompt":"Nouveau Prompt","library.actions.copy":"Copier dans le presse-papiers","library.actions.edit":"diter le Prompt","group.rename":"Renommer le groupe","group.saveToCatalog":"Sauvegarder dans le catalogue","group.saveToDisk":"Sauvegarder sur disque","group.ungroup":"Dissocier (Shift+Clic pour supprimer)","group.button.create":"Grouper ({count})"},fb={"dialog.rename.title":"Renommer","dialog.rename.group.title":"Renommer le Groupe","dialog.rename.catalog.title":"Renommer l'lment","dialog.rename.label":"Nouveau nom","dialog.rename.confirm":"Renommer","dialog.rename.cancel":"Annuler","dialog.promptEdit.title":"diter le Prompt","dialog.promptEdit.nameLabel":"Nom","dialog.promptEdit.contentLabel":"Contenu","dialog.promptEdit.confirm":"Sauvegarder","dialog.promptEdit.cancel":"Annuler","dialog.reset.title":"Rinitialiser le canevas","dialog.reset.message":"tes-vous sr de vouloir rinitialiser le canevas ? Tout travail non sauvegard sera perdu.","dialog.exit.title":"Fermer le projet ?","dialog.exit.message":"tes-vous sr ? Les donnes non sauvegardes seront perdues.","dialog.settings.title":"Paramtres","dialog.settings.apiKeyLabel":"Cl API Gemini","dialog.settings.apiKeyPlaceholder":"Entrez votre cl ici","dialog.settings.getApiKeyLink":"Obtenir une cl API sur Google AI Studio","dialog.settings.useFreeKey":"Utiliser la cl gratuite (limite)","dialog.settings.save":"Sauvegarder","dialog.settings.close":"Fermer","dialog.apiKey.title":"Paramtres de la Cl API","dialog.apiKey.description":"Une cl API Gemini est requise. Elle sera stocke localement.","dialog.apiKey.keyExists":"Une cl API est dj enregistre.","dialog.apiKey.clear":"Effacer la cl","dialog.apiKey.save":"Sauvegarder la cl","dialog.apiKey.update":"Mettre  jour la cl","dialog.apiKey.useFreeKey":"Utiliser la cl gratuite (Dev)","dialog.permission.title":"Accs au presse-papiers","dialog.permission.description":`Cette application ncessite l'accs au presse-papiers pour la fonction "Coller".`,"dialog.permission.decline":"Refuser","dialog.permission.allow":"Autoriser","alert.groupSaved":'Groupe "{groupTitle}" sauvegard dans le catalogue !',"toast.groupSavedToDisk":'Groupe "{groupTitle}" sauvegard sur disque !',"alert.confirmDelete":"Voulez-vous vraiment supprimer cet lment ?","alert.invalidCatalogFile":"Fichier de catalogue invalide.","alert.loadCatalogFailed":"chec du chargement de l'lment","alert.confirmLoadProject":"Le chargement d'un projet remplacera toutes les donnes actuelles. tes-vous sr ?","dialog.confirmDelete.title":"Confirmer la suppression","dialog.confirmDelete.message":'tes-vous sr de vouloir supprimer "{itemName}" ? Cette action est irrversible.',"dialog.confirmDelete.folderMessage":'tes-vous sr de vouloir supprimer le dossier "{itemName}" et son contenu ?',"dialog.confirmDelete.confirm":"Supprimer","dialog.confirmDelete.cancel":"Annuler","dialog.confirmClear.title":"Confirmer l'effacement","dialog.confirmClear.message":"Voulez-vous vraiment tout supprimer du canevas ?","toast.copied":"Copi dans le presse-papiers","toast.pasted":"Coll !","toast.cleared":"Effac","toast.resetComplete":"Rinitialis","toast.projectSaved":"Projet sauvegard","toast.saveFailed":"chec de la sauvegarde","toast.connectionsCut":"Connexions coupes","toast.charSaved":"Personnage sauvegard","toast.charLoaded":"Personnage charg","toast.videoPasted":"Vido colle depuis le presse-papiers","toast.savedToCatalog":"Sauvegard dans le catalogue","toast.apiKeySaved":"Cl API sauvegarde","toast.apiKeyCleared":"Cl API efface","toast.projectLoaded":"Projet charg","alert.batchMismatch":"Attention : Inadquation du nombre de plans dans la scne {scene}."},yb={"instruction.desc.safe_gen":"SCURIT CRITIQUE : vitez strictement les mots dclenchant les filtres de scurit IA. Remplacez des termes comme 'adolescent', 'intime' ou 'rvlateur' par des alternatives artistiques comme 'jeune personne', 'composition artistique' ou 'stylis'.","instruction.desc.layered_no_style":"Structure : 1. [Arrire-plan Global] -> 2. [Hirarchie du Sujet] -> 3. [Camra]. NE JAMAIS dcrire une action sans d'abord dcrire le personnage complet."},xb={"instruction.sg_inputs":"Donnes d'entre","instruction.desc.sg_inputs":"Source : Concept/Ide, Profils de Personnages.","instruction.core_director":"Ralisateur","instruction.desc.core_director":"Vous tes un Ralisateur Visionnaire. Pensez en objectifs, mouvement et composition.","instruction.sg_thinking":"Analyser","instruction.desc.sg_thinking":"Raisonner avant d'crire. Analyser la causalit et la logique. liminer les clichs.","instruction.sg_improve_input":"Docteur de Script","instruction.desc.sg_improve_input":"Amliorer le concept initial, corriger les incohrences, affiner le conflit.","instruction.sg_exposition":"Exposition","instruction.desc.sg_exposition":"Montrer l'tat du monde  travers l'histoire environnementale et les dtails.","instruction.sg_delayed_reveal":"Rvlation","instruction.desc.sg_delayed_reveal":"Intro progressive : environnement -> dtails -> silhouette -> visage.","instruction.sg_metaphor":"Mtaphore","instruction.desc.sg_metaphor":"Utiliser des symboles visuels pour les tats internes.","instruction.sg_pacing":"Rythme","instruction.desc.sg_pacing":"Contrle du rythme : quilibrer les plans contemplatifs et le montage dynamique.","instruction.sg_subtext":"Sous-texte","instruction.desc.sg_subtext":"Tension entre dialogue et action.","instruction.desc.sg_frame_estimation":"Calcul recommand du nombre de plans.","instruction.rule_visuals":"Visuels d'abord","instruction.desc.rule_visuals":"Montrez, ne dites pas. Focus sur la lumire, la composition, le mouvement.","instruction.sg_visual_dna":"ADN Visuel","instruction.desc.sg_visual_dna":"Guide technique LookDev (Lumire, Objectifs, Style de rendu).","instruction.rule_flow":"Flux continu","instruction.desc.rule_flow":"Logique Match Cut : Utiliser formes/couleurs pour les transitions.","instruction.rule_atmosphere":"Atmosphre","instruction.desc.rule_atmosphere":"Dtails tactiles : odeur de pluie, bourdonnement non, poussire.","instruction.sg_visual_style":"Style Visuel","instruction.desc.sg_visual_style":"Demande : Description dtaille du style base sur '{style}'.","instruction.char_detailed_style":"Dtail Stylis","instruction.desc.char_detailed_style":"Intgre le style global dans chaque prompt de personnage.","instruction.sg_genre":"Contexte de Genre","instruction.desc.sg_genre":"Contexte : {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"IA choisit : Corps complet pour Persos / Remplissage pour Objets.","instruction.char_no_dupes":"Pas de Doublons","instruction.desc.char_no_dupes":"CRITIQUE : NE PAS rgnrer les personnages sauf CHANGEMENT DE COSTUME.","instruction.create_secondary_chars":"Personnages Secondaires","instruction.desc.create_secondary_chars":"Autorise la cration de personnages secondaires si ncessaire.","instruction.create_key_items":"Objets Cls","instruction.desc.create_key_items":"Cration de 'Cartes Personnage' pour les objets importants.","instruction.char_secondary_ok":"Nouveaux autoriss","instruction.desc.char_secondary_ok":"Nouveaux personnages ou objets autoriss. En cas de changement de tenue, crer une nouvelle carte.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Les personnages doivent tre des animaux anthropomorphes.","instruction.sg_no_chars":"Pas de Personnages","instruction.desc.sg_no_chars":"Style documentaire / Pas de personnages nomms.","instruction.sg_detailed_plot":"Intrigue Dtaille","instruction.desc.sg_detailed_plot":"Descriptions trs dtailles des actions.","instruction.sg_subscribe":"Scne Abonnement","instruction.desc.sg_subscribe":"Inclure une scne brisant le 4me mur pour s'abonner.","instruction.char_gray_bg":"Concept Visuel","instruction.desc.char_gray_bg":"Pour chaque prompt visuel, TOUJOURS ajouter : ', full body character concept on a gray background'.","instruction.char_no_new":"Pas de Nouveaux","instruction.desc.char_no_new":"NE PAS crer de nouveaux personnages. Utiliser seulement les existants.","instruction.sg_new_chars":"Nouveaux Personnages","instruction.desc.sg_new_chars":"Gnrer de nouveaux personnages bass sur le prompt.","instruction.sg_living_world":"Monde Vivant","instruction.desc.sg_living_world_simple":"Les figurants sont des humains normaux.","instruction.desc.sg_living_world_anthro":"Les figurants sont des animaux anthropomorphes.","instruction.sg_simple_actions":"Actions Simples","instruction.desc.sg_simple_actions":"viter la physique complexe. Prfrer des poses stables.","instruction.commercial_safe":"Scurit Commerciale","instruction.desc.commercial_safe":"vite strictement les marques dposes (Disney, Pixar) et les remplace par des descriptions gnriques."},vb={"instruction.ana_role":"Rle Analyseur","instruction.desc.ana_role":"Vous tes un Ralisateur de classe mondiale. crivez des instructions techniques pour la gnration d'images/vidos par IA. Chaque plan doit tre dcrit indpendamment et en dtail.","instruction.ana_cinema":"Cinmatographie","instruction.desc.ana_cinema":"Termes pro : Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Cinmatographie (Large)","instruction.desc.ana_cinema_wide":"Termes pro : Wide Shot, Long Shot. PAS de Gros Plans.","instruction.ana_anthro_logic":"Logique Anthro","instruction.desc.ana_anthro_logic":"Dcrire explicitement les personnages comme Animaux Anthropomorphes.","instruction.ana_subscribe_logic":"Appel Abonnement","instruction.desc.ana_subscribe_logic":`Actions visuelles pour "S'abonner" : tenir des panneaux, texte 3D.`,"instruction.rule_hierarchy":"Algorithme de Cadrage","instruction.desc.rule_hierarchy":"Ordre strict : 1. Global (Lieu/Mto). 2. Posture Sujet. 3. Interaction Objet. 4. Action.","instruction.rule_living_world":"Monde Vivant","instruction.desc.rule_living_world":"Dcrire les figurants en cohrence avec le monde.","instruction.desc.rule_living_world_anthro":"Les figurants doivent tre des animaux anthropomorphes.","instruction.rule_persistence":"Persistance","instruction.desc.rule_persistence":"Maintenir la cohrence chronologique de la scne. Suivre les objets et positions entre les plans.","instruction.rule_mandatory_bg":"Fond Obligatoire","instruction.desc.rule_mandatory_bg":"INTERDIT de laisser le fond vide. Toujours dcrire le lieu et la lumire.","instruction.desc.rule_mandatory_bg_wide":"INTERDIT de laisser le fond vide. En plan large, toujours dcrire la gographie et l'horizon.","instruction.shot_filter_wide":"Plans Larges Uniquement","instruction.desc.shot_filter_wide":"FILTRE STRICT : Seulement Wide (WS), Long (LS) et Medium (MS). Gros plans interdits.","instruction.storyboard_rules":"Varit de Plans","instruction.desc.storyboard_rules":"Alterner WS/LS, MS et CU/ECU pour le dynamisme.","instruction.storyboard_rules_wide":"Varit de Plans (Large)","instruction.desc.storyboard_rules_wide":"Seulement Wide, Long et Establishing. Varier l'angle. PAS de Gros plans.","instruction.tech_directives":"Contrle Camra","instruction.desc.tech_directives":"Terminologie stricte. Seulement abrviations (WS, MS, CU).","instruction.tech_directives_wide":"Contrle Camra (Large)","instruction.desc.tech_directives_wide":"Terminologie stricte. Seulement WS, MS, LS. Pas de CU/ECU.","instruction.use_aliases":"Utiliser Alias","instruction.desc.use_aliases":"Utiliser le format Character-N.","instruction.action_phase_breakdown":"Micro-Actions","instruction.desc.action_phase_breakdown":"Dcomposer les actions complexes en phases (Prparation, Dbut, Sommet, Raction).","instruction.desc.action_phase_breakdown_wide":"Dcomposer les phases, mais GARDER LA CAMRA LARGE. Montrer l'impact par la posture.","instruction.batch_processing":"Traitement par Lots","instruction.desc.batch_processing":"Analyser toutes les scnes comme une squence continue.","instruction.ana_prompt_lang":"Langue des Prompts","instruction.desc.ana_prompt_lang":"Prompts strictement en Anglais pour la compatibilit.","instruction.extended_visuals":"Visualisation tendue","instruction.desc.extended_visuals":"Dcompose les scnes en squences expressives (Wide, MS, CU, Dtail).","instruction.extended_visuals_wide":"Visualisation tendue (Large)","instruction.desc.extended_visuals_wide":"Dcompose les scnes en squences de plans Larges/Moyens. Focus sur la gographie.","instruction.desc.target_lang":"Langue d'analyse.","instruction.rule_isolation":"Zro Contexte","instruction.desc.rule_isolation":"CRITIQUE : Le gnrateur d'image NE CONNAT PAS le plan prcdent. Re-dcrire l'environnement  chaque plan.","instruction.sensory_saturation":"Anti-Brivet","instruction.desc.sensory_saturation":"INTERDIT d'tre bref. Dcrire textures, lumire et poids physique.","instruction.ana_no_pov":"Pas de POV","instruction.desc.ana_no_pov":'NGATIF CRITIQUE : INTERDICTION STRICTE des plans "POV" ou "Premire Personne". La camra DOIT tre externe.',"instruction.desc.static_frame_logic":'INTERDICTION STRICTE des verbes de mouvement ("marcher"). Dcrire un moment FIG.',"instruction.desc.anatomical_posing":'Dcrire la GOMTRIE du corps. Au lieu de "se reposer", crire "couch sur le dos, bras sur les cts".',"instruction.desc.motion_dynamics":"SPARATION : Image Prompt = 100% Statique. Video Prompt = Mouvement & Temps.","instruction.desc.anatomical_strictness":'RIGGING : "Bras derrire la tte ET tient un verre" interdit. Dcrire sparment : Bras Gauche [tat], Bras Droit [tat].',"instruction.desc.prop_consistency":'VERROUILLAGE OBJET : Pas de noms gnriques ("pe"). Attributs visuels ("pe en fer rouill") obligatoires.',"instruction.desc.subject_hierarchy":"Mme pour les Gros plans : 1. Personnage Complet/Posture. 2. Interaction avec Environnement. 3. Dtail.","instruction.inputs_data":"Entres","instruction.desc.inputs_data":"Donnes source : Rsum, Profils, Textes de scnes."},bb={"instruction.inputs":"Entres","instruction.desc.inputs":"Source : Plans de l'analyseur, Profils visuels, Style de scne.","instruction.role":"Rle : Lead Environment Artist","instruction.desc.role":"Expert en Prompt Engineering. Synthtisez les entres en une description visuelle dfinitive.","instruction.layered":"Algorithme : Flux Unifi","instruction.desc.layered":"Gnre un SEUL bloc de texte fluide. Structure : [Style] -> [DESIGN DCOR MATRE] -> [Visuels] + [POSE & ACTION] -> [Camra].","instruction.desc.layered_no_char":"Structure : [DESIGN DCOR MATRE] -> [Index] + [POSE & ACTION]. Omet l'apparence, garde seulement indices et actions.","instruction.visuals":"Style : Saturation","instruction.desc.visuals":"Utiliser des descripteurs riches : lumire volumtrique, textures 8k, profondeur de champ.","instruction.process_whole_scene":"Lot de Scne","instruction.desc.process_whole_scene":"Analyser toute la scne d'un coup pour la cohrence.","instruction.video":"Vido","instruction.desc.video":"Video Prompt : [Index] (Dtail Visuel) [Action]. Dynamique : [Env]. Camra : [Mouvement]. PAS DE NOMS.","instruction.stateless":"Rgle : Sans tat","instruction.desc.stateless":"Chaque plan est indpendant. Re-dcrire l'environnement. Re-dcrire l'action de chaque personnage depuis zro.","instruction.rule_static":"Rgle : Statique","instruction.desc.rule_static":"Dcrire seulement le moment fig. Pas de transitions.","instruction.atmosphere_fix":"Ancre Atmosphrique","instruction.desc.atmosphere_fix":"Dcrire l'humeur comme proprit physique de l'air et de la lumire.","instruction.subject_focus":"Hirarchie Contexte","instruction.desc.subject_focus":"CRITIQUE : Mme pour Gros plans : 1. Perso Complet. 2. Pose. 3. Dtail. L'IA a besoin du contexte corporel.","instruction.always_env":"DESIGN DCOR OBLIGATOIRE","instruction.desc.always_env":"CRITIQUE : Utilisez le 'Contexte Global de la Scne' fourni comme la VRIT ABSOLUE pour l'arrire-plan. Vous DEVEZ injecter les dtails spcifiques des meubles, de l'clairage et des textures du contexte dans la couche d'environnement de CHAQUE prompt. N'inventez pas d'arrire-plans gnriques.","instruction.pm_anthro":"Dtail Anthro","instruction.desc.pm_anthro":`OBLIGATOIRE : Mot "anthropomorphic" avant l'espce dans Image ET Vido. Textures/anatomie amliores.`,"instruction.pm_subscribe":"Texte Lisible","instruction.desc.pm_subscribe":`S'assurer que le texte comme "SUBSCRIBE" est lisible et intgr (non, panneaux).`,"instruction.strict_char_index":"Personnages","instruction.desc.strict_char_index":"Mapper strictement les alias (Character-N) aux donnes du plan.","instruction.no_names":"CRITIQUE : PAS DE NOMS","instruction.desc.no_names":"CRITIQUE : INTERDICTION ABSOLUE DES NOMS. Utiliser seulement l'ID d'Index entre crochets `[Character-N]`.","instruction.general_char_desc":"Dtail Gnral","instruction.desc.general_char_desc":"Intgrer une version CONCISE et GNRALE du prompt visuel.","instruction.full_char_desc":"Dtail Complet","instruction.desc.full_char_desc":"Intgrer le prompt visuel COMPLET du profil exactement tel quel.","instruction.formatting":"Formatage","instruction.desc.formatting":"Active les EN-TTES explicites et sauts de ligne pour la structure.","instruction.anatomical_strictness":"Logique Anatomie","instruction.desc.anatomical_strictness":'RIGGING : Empche "Bras derrire la tte ET tient un verre". Force la description spare.',"instruction.img_vid_consistency":"Flux Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Dpart/Statique. Video Prompt = Action/volution. La vido doit dcouler naturellement de l'image.","instruction.desc.prop_enhancement":`MATRIALIT : Amplifie les descriptions d'objets (ex. "planche rouge" -> "fibre de verre rouge brillante").`,"instruction.no_pov":"CRITIQUE : PAS DE POV","instruction.desc.no_pov":"INTERDICTION STRICTE des angles POV. La camra DOIT tre externe (Troisime Personne)."},wb={"instruction.music_role":"Rle Producteur Musique","instruction.desc.music_role":"Compositeur expert et parolier.","instruction.music_input":"Donnes d'entre","instruction.desc.music_input":"Thme ou ide de l'utilisateur.","instruction.music_creative":"Libert Crative","instruction.desc.music_creative":"Force l'IA  interprter l'ambiance mtaphoriquement, pas littralement.","instruction.music_lyrics":"Structure Paroles","instruction.desc.music_lyrics":"Gnre une structure Couplet/Refrain adapte au genre.","instruction.music_prompt_rule":"Prompt Musique IA","instruction.desc.music_prompt_rule":"Tags techniques pour Suno/Udio (BPM, Instruments, Voix). Max 1000 caractres.","instruction.music_format":"Sortie JSON","instruction.desc.music_format":"Structure JSON stricte pour l'intgration."},_b={"instruction.yt_role":"Stratge YouTube","instruction.desc.yt_role":"Expert en SEO, CTR et psychologie virale.","instruction.yt_input":"Donnes d'entre","instruction.desc.yt_input":"Le sujet ou la niche.","instruction.yt_title_mode":"Mtadonnes Vido","instruction.desc.yt_title_mode":"Optimise Titres/Desc/Tags pour un maximum de clics.","instruction.yt_channel_mode":"Branding Chane","instruction.desc.yt_channel_mode":"Cre Nom, Bio et Identifiant cohrents.","instruction.yt_format":"Sortie JSON","instruction.desc.yt_format":"Structure JSON stricte pour l'intgration."},Cb={...yb,...xb,...vb,...bb,...wb,..._b},Sb={...ub,...pb,...hb,...mb,...gb,...fb,...Cb},Tb={"app.title":"Script Modifier","app.description":"Crea, affina e genera visivamente sceneggiature con l'API Gemini.","app.slogan":"Connetti le idee per creare un capolavoro","app.subtitle":"Visualizza le tue sceneggiature","app.error.title":"Notifica","app.error.copy":"Copia errore","app.error.copied":"Copiato!","error.quotaExceeded":"Hai raggiunto il limite di utilizzo. Controlla la quota della tua chiave API o riprova pi tardi.","error.apiKeyMissing":"Chiave API non trovata. Imposta la tua chiave API Gemini nelle impostazioni.","error.freeKeyNotAvailable":"La chiave API gratuita/sviluppo non  disponibile in questo ambiente. Fornisci la tua chiave.","error.fileReadError":"Errore durante la lettura del file.","error.videoConversionError":"Impossibile convertire il video in audio.","error.unsupportedFile":"Tipo di file non supportato.","error.promptModifierFile":"Questo file appartiene a un'altra applicazione (Prompt Modifier). Aprilo in quell'applicazione.","error.invalidFileType":"Tipo di file non valido. Carica un file Progetto o Canvas di Script Modifier.","welcome.iAmDeveloper":"Sono uno sviluppatore","welcome.letsGo":"Andiamo!","welcome.resume":"Riprendi","welcome.reload":"Ricarica","welcome.reloadTitle":"Reimpostare e ricaricare?","welcome.reloadMessage":"Questo canceller l'intero canvas e ricaricher l'applicazione. I dati non salvati andranno persi. Sei sicuro?","welcome.confirmReload":"Reimposta e Ricarica","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Benvenuto in","dialog.welcome.intro1":"Benvenuto in Script Modifier, il tuo spazio di lavoro visivo per creare storie con Gemini.","dialog.welcome.intro2":"Per iniziare, seleziona la tua lingua e inserisci la tua chiave API Gemini.","dialog.welcome.apiKeyExplanation":"La tua chiave API  archiviata localmente nel tuo browser. Non la inviamo a nessun server diverso dall'API di Google Gemini."},Eb={"toolbar.edit":"Modifica (V)","toolbar.cutter":"Taglia connessione (C)","toolbar.selection":"Selezione (S)","toolbar.reroute":"Punto di deviazione (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Aggancia alla griglia (Shift+W)","toolbar.resetZoom":"Reimposta Zoom","toolbar.lineStyleSpaghetti":"Linee Spaghetti (Shift+E)","toolbar.lineStyleOrthogonal":"Linee Ortogonali (Shift+E)","toolbar.addNode":"Aggiungi nodo (F)","toolbar.catalog":"Catalogo (Ctrl+Spazio)","toolbar.settings":"Impostazioni","toolbar.resetToDefault":"Ripristina predefiniti","toolbar.closeProject":"Chiudi progetto / Pulisci","toolbar.enterFullscreen":"Schermo intero","toolbar.exitFullscreen":"Esci da schermo intero","toolbar.addTextInput":"Input Testo (T)","toolbar.addPromptAnalyzer":"Analizzatore Prompt (A)","toolbar.addCharacterAnalyzer":"Analizzatore Personaggio","toolbar.addCharacterGenerator":"Generatore Personaggi (Shift+C)","toolbar.addImageGenerator":"Generatore Immagini (O)","toolbar.addImagePreview":"Anteprima Immagine (I)","toolbar.addCharacterCard":"Scheda Personaggio (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Processore Prompt (P)","toolbar.addGeminiChat":"Chat Gemini (M)","toolbar.addTranslator":"Traduttore (L)","toolbar.addIdeaGenerator":"Generatore Idee (Shift+A)","toolbar.addScriptGenerator":"Generatore Sceneggiatura (Shift+S)","toolbar.addScriptAnalyzer":"Analizzatore Sceneggiatura (Shift+D)","toolbar.addScriptPromptModifier":"Finalizzatore Prompt (Shift+F)","toolbar.addErrorAnalyzer":"Analizzatore Errori","toolbar.addNote":"Nota (N)","toolbar.addDataReader":"Lettore Dati (Shift+R)","toolbar.addSpeechSynthesizer":"Sintetizzatore Vocale (Shift+N)","toolbar.addNarratorTextGenerator":"Generatore Testo Narratore (Shift+G)","toolbar.addAudioTranscriber":"Transcrittore Audio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Generatore Titoli YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Generatore Idee Musicali (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Salva Canvas (Ctrl+S)","toolbar.saveProject":"Salva Progetto (Ctrl+Shift+S)","toolbar.loadCanvas":"Carica (Ctrl+O)","toolbar.clearCanvas":"Pulisci Canvas","toolbar.group.general":"Generale","toolbar.group.scripting":"Sceneggiatura","toolbar.group.prompting":"Prompt & Analisi","toolbar.group.characters":"Personaggi","toolbar.group.ai":"Strumenti AI","toolbar.group.file":"File","toolbar.group.images":"Immagini","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Controlli Canvas","toolbar.expand":"Espandi pannello","toolbar.collapse":"Comprimi pannello","toolbar.toggleHeaders":"Mostra/Nascondi intestazioni","hotkeys.file.title":"File","hotkeys.file.save":"Salva Canvas (Ctrl+S)","hotkeys.file.saveProject":"Salva Progetto (Ctrl+Shift+S)","hotkeys.file.load":"Carica Canvas (Ctrl+O)","hotkeys.tools.title":"Strumenti","hotkeys.tools.edit":"Modifica","hotkeys.tools.cutter":"Taglierina","hotkeys.tools.selection":"Selezione","hotkeys.tools.reroute":"Deviazione","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Raggruppa (G)","hotkeys.tools.deleteGroup":"Elimina gruppo","hotkeys.tools.closeNode":"Chiudi nodo","hotkeys.tools.toggleLineStyle":"Cambia stile linea","hotkeys.tools.snapToGrid":"Aggancia alla griglia","hotkeys.tools.selectAll":"Seleziona tutto","hotkeys.tools.deselectAll":"Deseleziona tutto","hotkeys.tools.duplicate":"Duplica con contenuto","hotkeys.windows.title":"Finestre","hotkeys.windows.search":"Cerca (F)","hotkeys.windows.quickAdd":"Aggiunta rapida (Spazio)","hotkeys.windows.catalog":"Catalogo","hotkeys.createNode.title":"Crea nodo","hotkeys.hide":"Nascondi scorciatoie","help.title":"Scorciatoie da tastiera","hotkeys.show":"Mostra scorciatoie","search.placeholder":"Cerca un nodo...","search.noResults":"Nessun nodo trovato.","search.node.text_input.title":"Input Testo","search.node.text_input.description":"Una semplice casella di testo per le tue idee. (T)","search.node.prompt_processor.title":"Processore Prompt","search.node.prompt_processor.description":"Migliora e combina i prompt con l'IA. (P)","search.node.prompt_analyzer.title":"Analizzatore Prompt","search.node.prompt_analyzer.description":"Divide un prompt in ambiente, personaggio, azione e stile. (A)","search.node.character_analyzer.title":"Analizzatore Personaggio","search.node.character_analyzer.description":"Divide una descrizione in aspetto fisico e abbigliamento.","search.node.character_generator.title":"Generatore Personaggi","search.node.character_generator.description":"Crea personaggi dettagliati da un'idea. (Shift+C)","search.node.image_generator.title":"Generatore Immagini","search.node.image_generator.description":"Crea un'immagine da un prompt di testo. (O)","search.node.image_preview.title":"Anteprima Immagine","search.node.image_preview.description":"Visualizza un'immagine da file. (I)","search.node.character_card.title":"Scheda Personaggio","search.node.character_card.description":"Memorizza immagine, nome e prompt di un personaggio. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Conversazione diretta con Gemini AI. (M)","search.node.translator.title":"Traduttore","search.node.translator.description":"Traduce il testo nella lingua selezionata. (L)","search.node.script_generator.title":"Generatore Sceneggiatura","search.node.script_generator.description":"Trasforma un'idea in scene di una sceneggiatura. (Shift+S)","search.node.script_analyzer.title":"Analizzatore Sceneggiatura","search.node.script_analyzer.description":"Scompone una sceneggiatura in inquadrature e prompt immagine. (Shift+D)","search.node.script_prompt_modifier.title":"Finalizzatore Prompt","search.node.script_prompt_modifier.description":"Finalizza i prompt dall'analisi per la generazione di immagini. (Shift+F)","search.node.error_analyzer.title":"Analizzatore Errori","search.node.error_analyzer.description":"Controlla e corregge ortografia e grammatica.","search.node.note.title":"Nota","search.node.note.description":"Una semplice area di testo per appunti. (N)","search.node.reroute_dot.title":"Punto di Deviazione","search.node.reroute_dot.description":"Un punto per reindirizzare le connessioni.","search.node.data_reader.title":"Lettore Dati","search.node.data_reader.description":"Mostra i dati grezzi da un nodo connesso.","search.node.speech_synthesizer.title":"Sintetizzatore Vocale","search.node.speech_synthesizer.description":"Converte testo in voce. (Shift+N)","search.node.idea_generator.title":"Generatore Idee","search.node.idea_generator.description":"Genera categorie e le combina in un'idea.","search.node.narrator_text_generator.title":"Generatore Testo Narratore","search.node.narrator_text_generator.description":"Genera testo per un narratore o annunciatore.","search.node.audio_transcriber.title":"Transcrittore Audio","search.node.audio_transcriber.description":"Converte file audio/video in testo.","search.node.youtube_title_generator.title":"Generatore Titoli YouTube","search.node.youtube_title_generator.description":"Genera titoli, descrizioni e tag per YouTube.","search.node.music_idea_generator.title":"Generatore Idee Musicali","search.node.music_idea_generator.description":"Genera testi di canzoni o prompt musicali.","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analizza le statistiche del canale e fornisce consigli.","search.node.image_editor.title":"Editor Immagini","search.node.image_editor.description":"Modifica le immagini con l'IA (Inpainting, Outpainting).","search.group.input":"Input","search.group.process":"Elaborazione & Analisi","search.group.scripting":"Strumenti Sceneggiatura","search.group.character":"Strumenti Personaggio","search.group.images":"Strumenti Immagine","search.group.ai":"Strumenti IA","search.group.audio":"Strumenti Audio","search.group.youtube":"Strumenti YouTube","contextMenu.tools":"Strumenti","contextMenu.assignSlot":"Assegna Slot {index}","contextMenu.addNodeFromSlot":"Aggiungi {node} ({index})","connectionMenu.title":"Aggiungi Nodo","quickAddMenu.title":"Aggiunta Rapida","contextMenu.paste":"Incolla (Ctrl+V)","node.content.simpleActions":"Azioni Semplici","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Veloce, efficiente, buono per bozze.","tooltip.model.pro":"Gemini Pro: Alta intelligenza, ragionamento complesso, dettagliato.","tooltip.lang.ru":"Genera sceneggiatura in Russo.","tooltip.lang.en":"Genera sceneggiatura in Inglese.","tooltip.lang.es":"Genera sceneggiatura in Spagnolo.","tooltip.lang.de":"Genera sceneggiatura in Tedesco.","tooltip.lang.uz":"Genera sceneggiatura in Uzbeco.","tooltip.lang.fr":"Genera sceneggiatura in Francese.","tooltip.lang.it":"Genera sceneggiatura in Italiano.","tooltip.lang.pt":"Genera sceneggiatura in Portoghese.","tooltip.lang.zh":"Genera sceneggiatura in Cinese.","node.action.locateInStack":"Trova nello stack","help.tabs.hotkeys":"Aiuto & Scorciatoie","help.tabs.links":"Altre App & Link","help.category.socials":"Social","help.category.stable":"Google AI Studio (Stabile)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Repository GitHub","help.link.youtube":"Canale YouTube","help.link.telegram_channel":"Canale Telegram","help.link.telegram_chat":"Chat Telegram","help.sub.news":"Notizie & Aggiornamenti","help.sub.discussion":"Discussione","help.sub.stable":"Versione Stabile","help.sub.alpha":"Versione Alpha","languages.ru":"Russo","languages.en":"Inglese","languages.es":"Spagnolo","languages.fr":"Francese","languages.de":"Tedesco","languages.it":"Italiano","languages.pt":"Portoghese","languages.zh":"Cinese","languages.ja":"Giapponese","languages.ko":"Coreano","languages.uz":"Uzbeco"},Nb={"node.title.text_input":"Input Testo","node.title.prompt_processor":"Processore Prompt","node.title.prompt_analyzer":"Analizzatore Prompt","node.title.character_analyzer":"Analizzatore Personaggio","node.title.character_generator":"Generatore Personaggi","node.title.image_generator":"Generatore Immagini","node.title.image_preview":"Anteprima Immagine","node.title.character_card":"Scheda Personaggio","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traduttore","node.title.script_generator":"Generatore Sceneggiatura","node.title.script_analyzer":"Analizzatore Sceneggiatura","node.title.script_prompt_modifier":"Finalizzatore Prompt","node.title.error_analyzer":"Analizzatore Errori","node.title.note":"Nota","node.title.reroute_dot":"Punto di Deviazione","node.title.data_reader":"Lettore Dati","node.title.speech_synthesizer":"Sintetizzatore Vocale","node.title.idea_generator":"Generatore Idee","node.title.narrator_text_generator":"Generatore Testo Narratore","node.title.audio_transcriber":"Transcrittore Audio","node.title.youtube_title_generator":"Generatore Titoli YouTube","node.title.music_idea_generator":"Generatore Idee Musicali","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Editor Immagini","node.help.text_input":"Inserisci qui idee di base, parole chiave o descrizioni.","node.help.prompt_processor":"Combina testo da altri nodi in un prompt dettagliato.","node.help.prompt_analyzer":"Divide un prompt in ambiente, personaggio, azione e stile.","node.help.character_analyzer":"Analizza una descrizione di un personaggio dividendola in aspetto e abbigliamento.","node.help.character_generator":"Crea descrizioni dettagliate di personaggi da un'idea.","node.help.image_generator":"Genera un'immagine da un testo usando l'API Gemini.","node.help.image_preview":"Visualizza un'immagine. Trascina un file immagine sul nodo.","node.help.character_card":"Memorizza immagine, nome e prompt di un personaggio.","node.help.gemini_chat":"Conversazione diretta con Gemini AI.","node.help.translator":"Traduce il testo in ingresso nella lingua selezionata.","node.help.script_generator":"Genera scene di una sceneggiatura da un prompt.","node.help.script_analyzer":"Scompone una sceneggiatura in inquadrature e prompt immagine.","node.help.script_prompt_modifier":"Crea prompt artistici finali per ogni inquadratura.","node.help.error_analyzer":"Controlla e corregge ortografia e grammatica.","node.help.note":"Una semplice area di testo per le tue note.","node.help.reroute_dot":"Un punto per reindirizzare le connessioni.","node.help.data_reader":"Mostra i dati grezzi da un nodo connesso.","node.help.speech_synthesizer":"Converte il testo in parlato.","node.help.idea_generator":"Genera categorie e le combina in un'idea.","node.help.narrator_text_generator":"Genera testo per un narratore o annunciatore.","node.help.audio_transcriber":"Converte file audio/video in testo.","node.help.youtube_title_generator":"Genera titoli, descrizioni e tag per YouTube.","node.help.music_idea_generator":"Genera testi di canzoni o prompt musicali.","node.help.youtube_analytics":"Analizza le statistiche del canale e fornisce consigli.","node.help.image_editor":"Modifica le immagini con l'IA (Inpainting, Outpainting).","node.action.help":"Aiuto","node.action.expand":"Espandi","node.action.collapse":"Comprimi (H)","node.action.expandAll":"Espandi tutto","node.action.collapseAll":"Comprimi tutto","node.action.expandAllScenes":"Espandi tutte le scene","node.action.collapseAllScenes":"Comprimi tutte le scene","node.action.expandAllFrames":"Espandi tutte le inquadrature","node.action.collapseAllFrames":"Comprimi tutte le inquadrature","node.action.expandPanel":"Espandi pannello","node.action.collapsePanel":"Comprimi pannello","node.action.togglePanel":"Mostra/Nascondi pannello","node.action.collapseScene":"Comprimi scena","node.action.expandScene":"Espandi scena","node.action.collapseFrame":"Comprimi inquadratura","node.action.expandFrame":"Espandi inquadratura","node.action.collapseCharacter":"Comprimi personaggio","node.action.expandCharacter":"Espandi personaggio","node.action.clear":"Pulisci","node.action.clearTooltip":"Pulisci il campo di input.","node.action.clearChat":"Pulisci chat","node.action.paste":"Incolla","node.action.copy":"Copia","node.action.duplicateWithContent":"Duplica (Contenuto)","node.action.duplicateEmpty":"Duplica (Vuoto)","node.action.cutConnections":"Taglia connessioni","node.action.close":"Chiudi","node.action.executeChain":"Esegui catena","node.action.executeFullChain":"Esegui catena completa","node.action.processChainForward":"Elabora catena in avanti","node.action.executeChainTitle":"Esegui tutti i nodi connessi.","node.action.addCharacter":"Aggiungi personaggio","node.action.addScene":"Aggiungi scena","node.action.addFrame":"Aggiungi inquadratura","node.action.addFirstFrame":"Aggiungi prima inquadratura","node.action.deleteItem":"Elimina","node.action.moveUp":"Sposta su","node.action.moveDown":"Sposta gi","node.action.saveImage":"Salva immagine","node.action.loadImage":"Carica immagine","node.action.saveCharacter":"Salva personaggio","node.action.loadCharacter":"Carica personaggio","node.action.readData":"Leggi dati","node.action.refreshData":"Aggiorna dati","node.action.stop":"Stop","node.action.stopping":"Arresto...","node.action.embedCharacter":"Incorpora personaggio","node.action.downloadFinalPrompts":"Scarica prompt","node.action.rename":"Rinomina","node.action.index":"Indicizza","node.action.improveConcept":"Migliora concetto","node.action.improveConceptTooltip":"Arricchisci e aggiungi dettagli visivi.","node.action.downloadJson":"Scarica JSON","node.action.downloadSRT":"Scarica SRT","node.action.markPrimary":"Segna come Primario","node.input.default":"Input","node.output.default":"Output","node.output.allCharacters":"Tutti i Personaggi","node.output.primaryCharacter":"Personaggio Principale","node.content.action":"Azione","node.content.actionPlaceholder":"Prompt azione...","node.content.allScriptParts":"Tutte le parti della sceneggiatura","node.content.allScriptAnalyzerData":"Dati dall'analizzatore","node.content.allNarratorData":"Tutti i dati narratore","node.content.analyzeCharacters":"Analizza personaggi","node.content.analyzeFromScene":"Analizza da:","node.content.analyzeUpToScene":"a","node.content.endPlaceholder":"fine","node.content.generateFromFrame":"Genera dal frame:","node.content.generateUpToFrame":"fino al frame","node.content.analyzeFromFrame":"Finalizza dal frame:","node.content.processFromFrame":"Elabora dal frame:","node.content.processFromScene":"Elabora dalla scena:","node.content.analyzePrompt":"Analizza prompt","node.content.analyzeScript":"Analizza sceneggiatura","node.content.analyzing":"Analisi...","node.content.applyAliases":"Applica alias","node.content.applyAliasesTooltip":"Sostituisce i nomi con gli alias (Indice).","node.content.character":"Personaggio","node.content.characterIndex":"Indice","node.content.characterPlaceholder":"Prompt personaggio...","node.content.character_plural":"personaggi","node.content.characters":"Personaggi","node.content.charactersSynced":"Personaggi sincronizzati","node.content.noCharactersConnected":"Nessun personaggio connesso.","node.content.appearance":"Aspetto","node.content.personality":"Personalit","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Semplice","node.content.characterType.anthro":"Anthro (Animali)","node.content.characterType.chibi":"Chibi (Carino)","node.content.characterType.key_item":"Oggetto Chiave","node.content.style":"Stile","node.content.style.none":"Nessuno","node.content.style.simple":"Semplice","node.content.style.realistic":"Realistico/Cinema","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"Realistico 3D","node.content.style.2d_animation":"Animazione 2D","node.content.style.anime":"Anime","node.content.style.comics":"Fumetti","node.content.style.custom":"Speciale","node.content.chatPlaceholder":"Scrivi un messaggio...","node.content.clothing":"Abbigliamento","node.content.clothingPlaceholder":"Prompt abbigliamento...","node.content.connectedPlaceholder":"Connesso","node.content.dataPlaceholder":"I dati appariranno qui...","node.content.readData":"Leggi dati","node.content.reading":"Lettura...","node.content.description":"Descrizione","node.content.sceneDescription":"Descrizione scena","node.content.duration":"Durata","node.content.enhancePrompt":"Genera prompt","node.content.enhancedPromptHere":"Il prompt migliorato apparir qui...","node.content.enhancing":"Miglioramento...","node.content.environment":"Ambiente","node.content.environmentPlaceholder":"Prompt ambiente...","node.content.environmentPrompt":"Ambiente & Sfondo","node.content.compositionAndBlocking":"Composizione & Azione","node.content.executingChain":"Esecuzione catena...","node.content.imagePrompt":"Prompt Immagine","node.content.finalPrompt":"Prompt Finale","node.content.finalPrompt_plural":"Prompt Finali","node.content.fixErrors":"Correggi errori","node.content.fixingErrors":"Correzione...","node.content.frame":"Frame","node.content.frame_plural":"Frame","node.content.frames":"Frame di uscita","node.content.frames_analyzed":"Frame analizzati: {count}","node.content.framesPerScene":"Frame per scena","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Qt","node.content.fullDescription":"Descrizione completa","node.content.generateCharacters":"Genera personaggi","node.content.generateFinalPrompts":"Genera prompt finali","node.content.generatingProgress":"Generazione {current} di {total}","node.content.generateImage":"Genera immagine","node.content.generateScript":"Genera sceneggiatura","node.content.generateSpeech":"Genera voce","node.content.generateText":"Genera testo","node.content.generateSSML":"Genera SSML","node.content.generateStyle":"Genera stile","node.content.generating":"Generazione...","node.content.improving":"Miglioramento...","node.content.generatedAudio":"Audio generato","node.content.imagePromptPlaceholder":"Inserisci prompt per immagine...","node.content.modificationPromptPlaceholder":"Richiesta di modifica...","node.content.narrator":"Narratore","node.content.narratorEnabled":"Abilita narratore","node.content.narratorEnabledInfo":"Aggiunge testo voiceover.","node.content.narratorMode":"Modalit Narratore","node.content.narratorMode.normal":"Normale / Voiceover","node.content.narratorMode.dual":"Due Narratori","node.content.narratorMode.first_person":"Prima Persona","node.content.role":"Ruolo","node.content.role.narrator":"Narratore","node.content.role.announcer":"Annunciatore","node.content.role.first_person":"Prima Persona","node.content.role.dual_narrator":"Due Narratori","node.content.role.dual_announcer":"Due Annunciatori","node.content.scene":"Scena","node.content.scene_plural":"scene","node.content.scenes":"Scene","node.content.scenes_generated":"Scene Generate: {count}","node.content.sceneContext":"Contesto Scena","node.content.sceneContextPlaceholder":"Umore, ambiente, luce...","node.content.scriptPromptPlaceholder":"Inserisci idea storia...","node.content.seconds":"sec","node.content.stylePlaceholder":"Prompt stile...","node.content.stylePromptPlaceholder":"Inserisci prompt stile qui...","node.content.styleOverride":"Sovrascrivi Stile","node.content.summary":"Riassunto","node.content.targetLanguage":"Lingua Destinazione","node.content.textToSynthesize":"Testo da sintetizzare...","node.content.translate":"Traduci","node.content.translatePlaceholder":"Testo da tradurre...","node.content.translatedTextPlaceholder":"Il testo tradotto apparir qui...","node.content.translating":"Traduzione...","node.content.useExistingCharacters":"Usa personaggi esistenti","node.content.useExistingCharactersInfo":"Usa dati dei personaggi connessi invece di generarne di nuovi.","node.content.createKeyItem":"Crea Secondari/Oggetti","node.content.createSecondaryChars":"Personaggi Secondari","node.content.createKeyItems":"Oggetti Chiave","node.content.createKeyItemInfo":"Permette all'IA di creare personaggi secondari o oggetti.","node.content.noCharacters":"Nessun Personaggio","node.content.noCharactersInfo":"La sceneggiatura si concentrer su eventi e atmosfera (stile documentario).","node.content.videoPrompt":"Dinamica & Movimento","node.content.videoPrompts":"Prompt Video","node.content.voice":"Voce","node.content.previewVoice":"Prova Voce","node.content.voicePreviewText":"Ciao, questa  una prova vocale.","node.content.inputScripts":"Scene Input","node.content.inputFrames":"Frame Input","node.content.outputScript":"Scene Output","node.content.requestCategories":"Richiedi Categorie","node.content.generateIdea":"Genera Idea","node.content.requestNewCategories":"Richiedi Nuove Categorie","node.content.category.action":"Azione","node.content.category.place":"Luogo","node.content.category.obstacle":"Ostacolo","node.content.generatedIdea":"Idea Generata","node.content.storyFormat":"Formato Storia","node.content.theme":"Tema","node.content.parameters":"Parametri","node.content.advancedMode":"Modalit Avanzata","node.content.numberOfScenes":"Numero di scene","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Trama Dettagliata","node.content.detailedPlotInfo":"Abilita descrizioni dettagliate di azioni e trama.","node.content.includeSubscribeScene":"Scena Iscrizione","node.content.includeSubscribeSceneInfo":"Integra una scena che rompe la quarta parete chiedendo di iscriversi.","node.content.genre":"Genere","node.content.genre2":"Genere 2","node.content.breakIntoParagraphs":"Dividi in paragrafi","node.content.copyVideoPrompt":"Copia prompt video","node.content.generateVideoPrompt":"Genera prompt video","node.content.model":"Modello","node.content.processWholeScene":"Elabora intera scena","node.content.processWholeSceneInfo":"Elabora tutti i frame di una scena in una volta sola per coerenza.","node.content.batchProcessing":"Elaborazione Batch","node.content.batchProcessingInfo":"Elabora tutte le scene selezionate in un unico contesto.","node.content.extendedAnalysis":"Analisi Estesa","node.content.extendedAnalysisInfo":"Divide le scene in inquadrature dettagliate.","node.content.professionalStoryboard":"Storyboard Regista","node.content.professionalStoryboardInfo":"Analisi scene basata su regole linguaggio cinematografico.","node.content.generateStartEndFrames":"Genera Frame Inizio/Fine","node.content.autoIndexCharacters":"Indicizza Auto Personaggi","node.content.autoIndexCharactersInfo":"Sostituisce automaticamente i nomi con gli alias.","node.content.imageToText":"Immagine a Testo","node.content.extracting":"Estrazione...","node.content.extractedText":"Testo Estratto","node.content.activePromptStack":"Stack Prompt Attivo","node.content.noCharactersAnalyzed":"Nessun personaggio analizzato.","node.content.promptsGeneratedPlaceholder":"I prompt generati appariranno qui.","node.content.noCharactersInScript":"Nessun personaggio nella sceneggiatura.","node.content.noInputScenes":"Nessun dato in ingresso. Connetti un Generatore Sceneggiatura.","node.content.status":"Stato","node.content.status.ready":"Pronto","node.content.status.paused":"In pausa","node.content.status.generating":"Generazione","node.content.status.total":"Totale: {generated} / {total}","node.content.status.batch":"Elaborazione: {current} di {total}","node.content.status.time":"Tempo: {current}s / {total}s","node.content.refreshing":"Aggiornamento...","node.content.totalFrames":"Totale Frame: {count}","node.content.uploadAudio":"Carica Audio/Video","node.content.noAudioLoaded":"Nessun audio","node.content.audioLoaded":"Audio caricato","node.content.transcriptionPlaceholder":"La trascrizione apparir qui...","node.content.transcribe":"Trascrivi","node.content.transcribing":"Trascrizione...","node.content.convertingVideo":"Conversione video...","node.content.recommendedFrames":"Frame Stimati","node.content.shotType":"Tipo Inquadratura","node.content.shotType.ws":"WS (Campo Largo)","node.content.shotType.ms":"MS (Campo Medio)","node.content.shotType.cu":"CU (Primo Piano)","node.content.shotType.ecu":"ECU (Primissimo Piano)","node.content.shotType.ls":"LS (Campo Lungo)","node.content.characterDetail":"Dettagli Personaggio","node.content.noCharDesc":"Nessuna descrizione personaggio","node.content.includeGeneralCharDesc":"Descrizione visiva generale","node.content.includeFullCharDesc":"Descrizione visiva dettagliata","node.content.safeGeneration":"Generazione Sicura","node.content.shotFilter":"Filtro Inquadrature","node.content.shotFilter.all":"Tutte","node.content.shotFilter.wideOnly":"Solo Larghe","instruction.desc.shot_filter_all":"Consenti tutti i tipi di inquadratura (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringi a inquadrature larghe (WS, MS, LS). Primi piani vietati.","node.content.anthroEnabled":"Animali Antropomorfi","node.content.subscribeEnhancement":"Migliora CTA Iscrizione","node.content.thinkingEnabled":"Modalit Pensiero","node.content.scenelessMode":"Scene senza copione","instruction.desc.sceneless_mode":"Disabilita motore narrativo. Genera scene direttamente dal concetto.","instruction.sceneless_mode":"Modalit Lista Scene","node.content.microActionBreakdown":"Micro-Azioni","node.content.microActionBreakdownInfo":"Scompone azioni complesse in fasi (Preparazione, Azione, Reazione).","node.content.commercialSafe":"Commercial Safe","instruction.desc.commercial_safe":"Evita rigorosamente marchi registrati (Disney, Pixar, ecc.) e nomi di personaggi protetti da copyright.","node.content.findStack":"Trova nello stack...","node.content.spm_stack.priming":"1. Priming & Contesto","node.content.spm_stack.physics":"2. Fisica & Logica","node.content.spm_stack.hierarchy":"3. Gerarchia Soggetto","node.content.spm_stack.construction":"4. Costruzione & Formato"},kb={"genre.general":"Generale","genre.comedy":"Commedia","genre.drama":"Drammatico","genre.action":"Azione","genre.scifi":"Fantascienza","genre.fantasy":"Fantasy","genre.horror":"Horror","genre.thriller":"Thriller","genre.childrens_animation":"Animazione per bambini","genre.shorts_story":"Storie brevi (Shorts)","genre.scientific_historical":"Scientifico-Storico","character_generator.promptPlaceholder":'Inserisci idea, es: "cavaliere coraggioso, guardiano della foresta antica"',"idea_generator.randomTheme":"Tema casuale","idea_generator.randomCombination":"Combinazione casuale","idea_generator.themePlaceholder":"es. Spazio, Cucina, Foresta Incantata","idea_generator.initialMessage":'Inserisci un tema (opzionale) e clicca "{buttonName}".',"idea_generator.ideaPlaceholder":"L'idea generata apparir qui...","idea_generator.format.general":"Generale","idea_generator.format.childrens":"Bambini","idea_generator.format.adventure":"Avventura","idea_generator.format.fantasy":"Fantasy / Magia","idea_generator.format.detective":"Detective","idea_generator.format.scifi":"Fantascienza","idea_generator.format.horror":"Horror","idea_generator.format.historical":"Storico","gender.male":"Maschio","gender.female":"Femmina","node.content.autoDownload":"Download automatico alla generazione","node.content.downloadSelected":"Scarica selezionati","node.content.intonation":"Intonazione","intonation.standard":"Standard","intonation.cheerful":"Allegro","intonation.angry":"Arrabbiato","intonation.sad":"Triste","intonation.excited":"Eccitato","intonation.announcer":"Annunciatore","intonation.whispering":"Sussurrato","node.content.sceneMode":"Modalit Scena","node.content.connectNarratorData":'Connetti "Tutti i dati narratore" da un Generatore Sceneggiatura.',"node.content.sceneModeActive":"Modalit Scena attiva. Dati ricevuti.","speech_synthesizer.mode.simple":"Semplice","speech_synthesizer.mode.scene":"Scena","speech_synthesizer.multiSpeaker":"Due Speaker","speech_synthesizer.speaker1Name":"Nome Speaker 1","speech_synthesizer.speaker2Name":"Nome Speaker 2","speech_synthesizer.multiSpeakerHint":'I nomi devono corrispondere a quelli nel testo (es. "Uomo: ...", "Donna: ...").',"speech_synthesizer.ssmlHint":"L'intonazione  controllata da tag SSML nel testo.","youtube_analytics.authorName":"Nome Autore","youtube_analytics.videoTitle":"Titolo Video","youtube_analytics.views":"Visualizzazioni","youtube_analytics.addToChannel":"Aggiungi al canale","youtube_analytics.noIncomingData":"Nessun dato in arrivo.","youtube_analytics.videoAdded":"Video aggiunto!","youtube_analytics.dragDrop":"Trascina qui lo screenshot","youtube_analytics.thumbnailUpdated":"Miniatura aggiornata","youtube_analytics.statsTrend":"Trend Statistiche","youtube_analytics.currentChannel":"Canale Corrente","youtube_analytics.growth":"Crescita","youtube_analytics.allChannels":"Tutti i Canali","youtube_analytics.saveDisk":"Salva su Disco","youtube_analytics.saveCatalog":"Salva in Catalogo","youtube_analytics.loadDisk":"Carica da Disco","youtube_analytics.analyzing":"Analisi...","youtube_analytics.askAI":"Chiedi all'IA","youtube_analytics.clickForAdvice":`Clicca "Chiedi all'IA".`,"youtube_analytics.dailyNotes":"Note Giornaliere","youtube_analytics.logDailyStats":"Log Statistiche","youtube_analytics.subscribers":"Iscritti","youtube_analytics.totalViews":"Vis. Totali","youtube_analytics.updateStats":"Aggiorna","youtube_analytics.history":"Cronologia","youtube_analytics.noHistory":"Nessuna cronologia.","youtube_analytics.noNotes":"Nessuna nota.","youtube_analytics.noVideos":"Nessun video.","youtube_analytics.loadedFromDisk":"Caricato","youtube_analytics.loadFailed":"Caricamento fallito","youtube_analytics.savedToDisk":"Salvato","youtube_title_generator.mode.title":"Titolo Video","youtube_title_generator.mode.channel":"Info Canale","youtube_title_generator.ideaPlaceholder":"Inserisci idea video...","youtube_title_generator.channelIdeaPlaceholder":"Inserisci tema canale...","youtube_title_generator.title":"Titolo","youtube_title_generator.description":"Descrizione","youtube_title_generator.tags":"Tag","youtube_title_generator.channelName":"Nome Canale","youtube_title_generator.channelDescription":"Descrizione Canale","youtube_title_generator.channelKeywords":"Parole chiave","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Testo Canzone","music_idea_generator.mode.music_prompt":"Prompt Musicale","music_idea_generator.ideaPlaceholder":"Inserisci tema o umore...","music_idea_generator.songTitle":"Titolo Canzone","music_idea_generator.songTitlePlaceholder":"Titolo...","music_idea_generator.lyricsPlaceholder":"Il testo apparir qui...","music_idea_generator.musicPromptPlaceholder":"Il prompt musicale IA apparir qui...","chat.mode.general":"Generale","chat.mode.script":"Esperto Sceneggiatura","chat.mode.prompt":"Esperto Prompt","chat.mode.youtube":"Esperto YouTube"},Ab={"catalog.title":"Catalogo","catalog.tabs.groups":"Gruppi","catalog.tabs.library":"Libreria Prompt","catalog.tabs.characters":"Personaggi","catalog.tabs.scripts":"Sceneggiature","catalog.tabs.analysis":"Analisi","catalog.tabs.final_prompts":"Prompt Finali","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Idee Musicali","catalog.empty.title":"Il catalogo  vuoto","catalog.empty.description":"Salva un elemento per vederlo qui, o importane uno.","catalog.loadFromFile":"Carica da file","catalog.card.addToCanvas":"Aggiungi al Canvas","catalog.card.rename":"Rinomina","catalog.card.save":"Salva su disco","catalog.card.delete":"Elimina","library.loadFromFile":"Carica da file","library.empty.title":"Cartella vuota","library.empty.description":"Crea una nuova cartella o un prompt.","library.emptyPrompt":"Nessun contenuto","library.actions.newFolder":"Nuova Cartella","library.actions.newPrompt":"Nuovo Prompt","library.actions.copy":"Copia negli appunti","library.actions.edit":"Modifica Prompt","group.rename":"Rinomina gruppo","group.saveToCatalog":"Salva nel catalogo","group.saveToDisk":"Salva su disco","group.ungroup":"Separa (Shift+Click per eliminare)","group.button.create":"Raggruppa ({count})"},Ib={"dialog.rename.title":"Rinomina","dialog.rename.group.title":"Rinomina Gruppo","dialog.rename.catalog.title":"Rinomina Elemento Catalogo","dialog.rename.label":"Nuovo nome","dialog.rename.confirm":"Rinomina","dialog.rename.cancel":"Annulla","dialog.promptEdit.title":"Modifica Prompt","dialog.promptEdit.nameLabel":"Nome","dialog.promptEdit.contentLabel":"Contenuto","dialog.promptEdit.confirm":"Salva","dialog.promptEdit.cancel":"Annulla","dialog.reset.title":"Reimposta Canvas","dialog.reset.message":"Sei sicuro di voler reimpostare il canvas? Tutto il lavoro non salvato andr perso.","dialog.exit.title":"Chiudere Progetto?","dialog.exit.message":"Sei sicuro? I dati non salvati andranno persi.","dialog.settings.title":"Impostazioni","dialog.settings.apiKeyLabel":"Chiave API Gemini","dialog.settings.apiKeyPlaceholder":"Inserisci qui la tua chiave","dialog.settings.getApiKeyLink":"Ottieni chiave API da Google AI Studio","dialog.settings.useFreeKey":"Usa chiave gratuita (limitata)","dialog.settings.save":"Salva","dialog.settings.close":"Chiudi","dialog.apiKey.title":"Impostazioni Chiave API","dialog.apiKey.description":" richiesta una chiave API Gemini. Sar salvata localmente.","dialog.apiKey.keyExists":"Una chiave API  gi salvata.","dialog.apiKey.clear":"Elimina chiave","dialog.apiKey.save":"Salva chiave","dialog.apiKey.update":"Aggiorna chiave","dialog.apiKey.useFreeKey":"Usa chiave gratuita (Sviluppo)","dialog.permission.title":"Accesso Appunti","dialog.permission.description":`Questa applicazione richiede l'accesso agli appunti per la funzione "Incolla".`,"dialog.permission.decline":"Rifiuta","dialog.permission.allow":"Consenti","alert.groupSaved":'Gruppo "{groupTitle}" salvato nel catalogo!',"toast.groupSavedToDisk":'Gruppo "{groupTitle}" salvato su disco!',"alert.confirmDelete":"Vuoi davvero eliminare questo elemento?","alert.invalidCatalogFile":"File catalogo non valido.","alert.loadCatalogFailed":"Caricamento elemento fallito","alert.confirmLoadProject":"Caricare un progetto sostituir tutti i dati attuali. Sei sicuro?","dialog.confirmDelete.title":"Conferma eliminazione","dialog.confirmDelete.message":'Sei sicuro di voler eliminare "{itemName}"? Azione irreversibile.',"dialog.confirmDelete.folderMessage":'Sei sicuro di voler eliminare la cartella "{itemName}" e il suo contenuto?',"dialog.confirmDelete.confirm":"Elimina","dialog.confirmDelete.cancel":"Annulla","dialog.confirmClear.title":"Conferma pulizia","dialog.confirmClear.message":"Vuoi davvero cancellare tutto dal canvas?","toast.copied":"Copiato negli appunti","toast.pasted":"Incollato!","toast.cleared":"Pulito","toast.resetComplete":"Reimpostato","toast.projectSaved":"Progetto salvato","toast.saveFailed":"Salvataggio fallito","toast.connectionsCut":"Connessioni tagliate","toast.charSaved":"Personaggio salvato","toast.charLoaded":"Personaggio caricato","toast.videoPasted":"Video incollato dagli appunti","toast.savedToCatalog":"Salvato nel catalogo","toast.apiKeySaved":"Chiave API salvata","toast.apiKeyCleared":"Chiave API eliminata","toast.projectLoaded":"Progetto caricato","alert.batchMismatch":"Attenzione: Discrepanza numero frame nella scena {scene}."},Pb={"instruction.desc.safe_gen":"SICUREZZA CRITICA: Evita rigorosamente parole che attivano i filtri di sicurezza IA. Sostituisci termini come 'adolescente', 'intimo' o 'rivelatore' con alternative artistiche come 'giovane persona', 'composizione artistica' o 'stilizzato'.","instruction.desc.layered_no_style":"Struttura: 1. [Sfondo Globale (Cielo -> Orizzonte -> Piano Medio)] -> 2. [Gerarchia Soggetto (Personaggio Completo -> Posa -> Micro-Azione)] -> 3. [Camera]. NON descrivere MAI un'azione senza prima descrivere il personaggio completo."},Rb={"instruction.sg_inputs":"Dati Input","instruction.desc.sg_inputs":"Fonte: Concetto/Idea, Profili Personaggi.","instruction.core_director":"Regista","instruction.desc.core_director":"Sei un Regista Visionario. Pensa in obiettivi, movimento e composizione.","instruction.sg_thinking":"Analizzare","instruction.desc.sg_thinking":"Ragionare prima di scrivere. Analizzare causalit e logica. Eliminare i clich.","instruction.sg_improve_input":"Script Doctor","instruction.desc.sg_improve_input":"Migliorare concetto iniziale, correggere buchi trama, affinare conflitto.","instruction.sg_exposition":"Esposizione","instruction.desc.sg_exposition":"Mostrare lo stato del mondo attraverso storia ambientale e dettagli.","instruction.sg_delayed_reveal":"Rivelazione","instruction.desc.sg_delayed_reveal":"Intro graduale: ambiente -> dettagli -> silhouette -> viso.","instruction.sg_metaphor":"Metafora","instruction.desc.sg_metaphor":"Usare simboli visivi per stati interni.","instruction.sg_pacing":"Ritmo","instruction.desc.sg_pacing":"Controllo ritmo: bilanciare inquadrature contemplative e montaggio dinamico.","instruction.sg_subtext":"Sottotesto","instruction.desc.sg_subtext":"Tensione tra dialogo e azione.","instruction.desc.sg_frame_estimation":"Calcolo raccomandato numero inquadrature.","instruction.rule_visuals":"Visual Prima","instruction.desc.rule_visuals":"Mostra, non dire. Focus su luce, composizione, movimento.","instruction.sg_visual_dna":"DNA Visivo","instruction.desc.sg_visual_dna":"Guida tecnica LookDev (Luci, Lenti, Stile render).","instruction.rule_flow":"Flusso Continuo","instruction.desc.rule_flow":"Logica Match Cut: Usare forme/colori per le transizioni.","instruction.rule_atmosphere":"Atmosfera","instruction.desc.rule_atmosphere":"Dettagli tattili: odore pioggia, ronzio neon, polvere.","instruction.sg_visual_style":"Stile Visivo","instruction.desc.sg_visual_style":"Richiesta: Descrizione dettagliata dello stile basata su '{style}'.","instruction.char_detailed_style":"Dettaglio Stilizzato","instruction.desc.char_detailed_style":"Integra lo stile globale in ogni prompt personaggio.","instruction.sg_genre":"Contesto Genere","instruction.desc.sg_genre":"Contesto: {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"IA sceglie: Corpo intero per Personaggi / Riempimento per Oggetti.","instruction.char_no_dupes":"No Duplicati","instruction.desc.char_no_dupes":"CRITICO: NON rigenerare personaggi a meno che non ci sia CAMBIO COSTUME.","instruction.create_secondary_chars":"Personaggi Secondari","instruction.desc.create_secondary_chars":"Permette creazione di personaggi secondari se necessario.","instruction.create_key_items":"Oggetti Chiave","instruction.desc.create_key_items":"Creazione obbligatoria di 'Schede Personaggio' per oggetti importanti.","instruction.char_secondary_ok":"Nuovi permessi","instruction.desc.char_secondary_ok":"Nuovi personaggi o oggetti permessi. Se cambia abito, crea nuova scheda.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"I personaggi devono essere animali antropomorfi.","instruction.sg_no_chars":"No Personaggi","instruction.desc.sg_no_chars":"Stile documentario / Nessun personaggio nominato.","instruction.sg_detailed_plot":"Trama Dettagliata","instruction.desc.sg_detailed_plot":"Descrizioni molto dettagliate delle azioni.","instruction.sg_subscribe":"Scena Iscrizione","instruction.desc.sg_subscribe":"Includere scena che rompe la quarta parete per iscrizione.","instruction.char_gray_bg":"Concetto Visivo","instruction.desc.char_gray_bg":"Per ogni prompt visivo, AGGIUNGI SEMPRE: ', full body character concept on a gray background'.","instruction.char_no_new":"Niente Nuovi","instruction.desc.char_no_new":"NON creare nuovi personaggi. Usa solo quelli esistenti.","instruction.sg_new_chars":"Nuovi Personaggi","instruction.desc.sg_new_chars":"Genera nuovi personaggi basati sul prompt.","instruction.sg_living_world":"Mondo Vivo","instruction.desc.sg_living_world_simple":"Le comparse sono umani normali.","instruction.desc.sg_living_world_anthro":"Le comparse sono animali antropomorfi.","instruction.sg_simple_actions":"Azioni Semplici","instruction.desc.sg_simple_actions":"Evitare fisica complessa. Preferire pose stabili.","instruction.commercial_safe":"Sicurezza Commerciale","instruction.desc.commercial_safe":"Evita rigorosamente marchi registrati (Disney, Pixar) e li sostituisce con descrizioni generiche."},Mb={"instruction.ana_role":"Ruolo Analizzatore","instruction.desc.ana_role":"Sei un Regista di classe mondiale. Scrivi istruzioni tecniche per generazione IA. Ogni frame deve essere descritto indipendentemente e in dettaglio.","instruction.ana_cinema":"Cinematografia","instruction.desc.ana_cinema":"Termini pro: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Cinematografia (Larga)","instruction.desc.ana_cinema_wide":"Termini pro: Wide Shot, Long Shot. NO Primi Piani.","instruction.ana_anthro_logic":"Logica Anthro","instruction.desc.ana_anthro_logic":"Descrivere esplicitamente i personaggi come Animali Antropomorfi.","instruction.ana_subscribe_logic":"Appello Iscrizione","instruction.desc.ana_subscribe_logic":'Azioni visive per "Iscriviti": cartelli, testo 3D.',"instruction.rule_hierarchy":"Algoritmo Inquadratura","instruction.desc.rule_hierarchy":"Ordine rigoroso: 1. Globale (Luogo/Meteo). 2. Postura Soggetto. 3. Interazione Oggetto. 4. Azione.","instruction.rule_living_world":"Mondo Vivo","instruction.desc.rule_living_world":"Descrivere comparse coerenti con il mondo.","instruction.desc.rule_living_world_anthro":"Le comparse devono essere animali antropomorfi.","instruction.rule_persistence":"Persistenza","instruction.desc.rule_persistence":"Mantenere coerenza cronologica della scena. Tracciare oggetti e posizioni tra i frame.","instruction.rule_mandatory_bg":"Sfondo Obbligatorio","instruction.desc.rule_mandatory_bg":"VIETATO lasciare sfondo vuoto. Descrivere sempre luogo e luce.","instruction.desc.rule_mandatory_bg_wide":"VIETATO lasciare sfondo vuoto. In campo largo, descrivere sempre geografia e orizzonte.","instruction.shot_filter_wide":"Solo Campi Larghi","instruction.desc.shot_filter_wide":"FILTRO RIGOROSO: Solo Wide (WS), Long (LS) e Medium (MS). Primi piani vietati.","instruction.storyboard_rules":"Variet Inquadrature","instruction.desc.storyboard_rules":"Alternare WS/LS, MS e CU/ECU per dinamismo.","instruction.storyboard_rules_wide":"Variet Inquadrature (Larga)","instruction.desc.storyboard_rules_wide":"Solo Wide, Long e Establishing. Variare angolo. NO Primi piani.","instruction.tech_directives":"Controllo Camera","instruction.desc.tech_directives":"Terminologia rigorosa. Solo abbreviazioni (WS, MS, CU).","instruction.tech_directives_wide":"Controllo Camera (Larga)","instruction.desc.tech_directives_wide":"Terminologia rigorosa. Solo WS, MS, LS. No CU/ECU.","instruction.use_aliases":"Usa Alias","instruction.desc.use_aliases":"Usa formato Character-N.","instruction.action_phase_breakdown":"Micro-Azioni","instruction.desc.action_phase_breakdown":"Scomporre azioni complesse in fasi (Preparazione, Inizio, Apice, Reazione).","instruction.desc.action_phase_breakdown_wide":"Scomporre fasi, ma MANTENERE CAMERA LARGA. Mostrare impatto tramite postura.","instruction.batch_processing":"Elaborazione Batch","instruction.desc.batch_processing":"Analizzare tutte le scene come sequenza continua.","instruction.ana_prompt_lang":"Lingua Prompt","instruction.desc.ana_prompt_lang":"Prompt rigorosamente in Inglese per compatibilit.","instruction.extended_visuals":"Visualizzazione Estesa","instruction.desc.extended_visuals":"Scompone scene in sequenze espressive (Wide, MS, CU, Dettaglio).","instruction.extended_visuals_wide":"Visualizzazione Estesa (Larga)","instruction.desc.extended_visuals_wide":"Scompone scene in sequenze di piani Larghi/Medi. Focus su geografia.","instruction.desc.target_lang":"Lingua di analisi.","instruction.rule_isolation":"Zero Contesto","instruction.desc.rule_isolation":"CRITICO: Il generatore NON CONOSCE il frame precedente. Ri-descrivere l'ambiente a ogni frame.","instruction.sensory_saturation":"Anti-Brevit","instruction.desc.sensory_saturation":"VIETATO essere brevi. Descrivere texture, luce e peso fisico.","instruction.ana_no_pov":"No POV","instruction.desc.ana_no_pov":'NEGATIVO CRITICO: DIVIETO RIGOROSO di inquadrature "POV" o "Prima Persona". La telecamera DEVE essere esterna.',"instruction.desc.static_frame_logic":'DIVIETO ASSOLUTO verbi di movimento ("camminare"). Descrivere un momento CONGELATO.',"instruction.desc.anatomical_posing":'Descrivere GEOMETRIA corpo. Invece di "riposare", scrivere "supino, braccia ai lati".',"instruction.desc.motion_dynamics":"SEPARAZIONE: Image Prompt = 100% Statico. Video Prompt = Movimento & Tempo.","instruction.desc.anatomical_strictness":'RIGGING: "Braccia dietro testa E tiene bicchiere" vietato. Descrivere separatamente: Braccio SX [stato], Braccio DX [stato].',"instruction.desc.prop_consistency":'BLOCCO OGGETTO: No nomi generici ("spada"). Attributi visivi ("spada ferro arrugginito") obbligatori.',"instruction.desc.subject_hierarchy":"Anche per Primi piani: 1. Personaggio Completo/Postura. 2. Interazione con Ambiente. 3. Dettaglio.","instruction.inputs_data":"Input","instruction.desc.inputs_data":"Dati fonte: Riassunto, Profili, Testi scene."},Lb={"instruction.inputs":"Input","instruction.desc.inputs":"Fonte: Frame analizzatore, Profili visivi, Stile scena.","instruction.role":"Ruolo: Lead Environment Artist","instruction.desc.role":"Esperto Prompt Engineering. Sintetizza gli input in una descrizione visiva definitiva.","instruction.layered":"Algoritmo: Flusso Unificato","instruction.desc.layered":"Genera UN SOLO blocco di testo fluido. Struttura: [Stile] -> [DESIGN SET MASTER] -> [Visivi] + [POSA & AZIONE] -> [Camera].","instruction.desc.layered_no_char":"Struttura: [DESIGN SET MASTER] -> [Indice] + [POSA & AZIONE]. Omette aspetto, tiene solo indici e azioni.","instruction.visuals":"Stile: Saturazione","instruction.desc.visuals":"Usa descrittori ricchi: luce volumetrica, texture 8k, profondit di campo.","instruction.process_whole_scene":"Batch Scena","instruction.desc.process_whole_scene":"Analizzare intera scena insieme per coerenza.","instruction.video":"Video","instruction.desc.video":"Video Prompt: [Indice] (Dettaglio Visivo) [Azione]. Dinamica: [Ambiente]. Camera: [Movimento]. NO NOMI.","instruction.stateless":"Regola: Senza Stato","instruction.desc.stateless":"Ogni frame  indipendente. Ri-descrivere ambiente. Ri-descrivere azione da zero.","instruction.rule_static":"Regola: Statico","instruction.desc.rule_static":"Descrivere solo momento congelato. No transizioni.","instruction.atmosphere_fix":"Ancora Atmosferica","instruction.desc.atmosphere_fix":"Descrivere umore come propriet fisiche di aria e luce.","instruction.subject_focus":"Gerarchia Contesto","instruction.desc.subject_focus":"CRITICO: Anche per Primi piani: 1. Pers. Completo. 2. Posa. 3. Dettaglio. L'IA necessita contesto corporeo.","instruction.always_env":"DESIGN SET OBBLIGATORIO","instruction.desc.always_env":"CRITICO: Usa il 'Contesto Scena Globale' fornito come la VERIT ASSOLUTA per lo sfondo. DEVI iniettare i dettagli specifici di mobili, illuminazione e texture dal contesto nel livello ambiente di OGNI prompt. Non allucinare sfondi generici.","instruction.pm_anthro":"Dettaglio Anthro","instruction.desc.pm_anthro":'OBBLIGATORIO: Parola "anthropomorphic" prima della specie in Immagine E Video. Texture/anatomia migliorate.',"instruction.pm_subscribe":"Testo Leggibile","instruction.desc.pm_subscribe":'Assicurare che testo come "SUBSCRIBE" sia leggibile e integrato (neon, cartelli).',"instruction.strict_char_index":"Personaggi","instruction.desc.strict_char_index":"Mappare rigorosamente Alias (Character-N) ai dati frame.","instruction.no_names":"CRITICO: NO NOMI","instruction.desc.no_names":"CRITICO: DIVIETO ASSOLUTO NOMI. Usare SOLO ID Indice in parentesi quadre `[Character-N]`.","instruction.general_char_desc":"Dettaglio Generale","instruction.desc.general_char_desc":"Integrare versione CONCISA e GENERALE del prompt visivo.","instruction.full_char_desc":"Dettaglio Completo","instruction.desc.full_char_desc":"Integrare prompt visivo COMPLETO del profilo esattamente com'.","instruction.formatting":"Formattazione","instruction.desc.formatting":"Attiva INTESTAZIONI esplicite e a capo per struttura.","instruction.anatomical_strictness":"Logica Anatomia","instruction.desc.anatomical_strictness":'RIGGING: Previene "Braccia dietro testa E tiene bicchiere". Forza descrizione separata.',"instruction.img_vid_consistency":"Flusso Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Start/Statico. Video Prompt = Azione/Evoluzione. Il video deve evolvere dall'immagine.","instruction.desc.prop_enhancement":'MATERIALIT: Amplifica descrizioni oggetti (es. "tavola rossa" -> "fiberglass rosso lucido").',"instruction.no_pov":"CRITICO: NO POV","instruction.desc.no_pov":"DIVIETO RIGOROSO angoli POV. Camera DEVE essere esterna (Terza Persona)."},jb={"instruction.music_role":"Ruolo Produttore","instruction.desc.music_role":"Compositore esperto e paroliere.","instruction.music_input":"Dati Input","instruction.desc.music_input":"Tema o idea dell'utente.","instruction.music_creative":"Libert Creativa","instruction.desc.music_creative":"Forza l'IA a interpretare l'atmosfera metaforicamente, non letteralmente.","instruction.music_lyrics":"Struttura Testo","instruction.desc.music_lyrics":"Genera struttura Strofa/Ritornello adatta al genere.","instruction.music_prompt_rule":"Prompt Musicale IA","instruction.desc.music_prompt_rule":"Tag tecnici per Suno/Udio (BPM, Strumenti, Voci). Max 1000 caratteri.","instruction.music_format":"Output JSON","instruction.desc.music_format":"Struttura JSON rigorosa per integrazione."},Db={"instruction.yt_role":"Stratega YouTube","instruction.desc.yt_role":"Esperto SEO, CTR e psicologia virale.","instruction.yt_input":"Dati Input","instruction.desc.yt_input":"Argomento o nicchia fornita.","instruction.yt_title_mode":"Metadati Video","instruction.desc.yt_title_mode":"Ottimizza Titoli/Desc/Tag per massimi click.","instruction.yt_channel_mode":"Branding Canale","instruction.desc.yt_channel_mode":"Crea Nome, Bio e Handle coerenti.","instruction.yt_format":"Output JSON","instruction.desc.yt_format":"Struttura JSON rigorosa per integrazione."},Ob={...Pb,...Rb,...Mb,...Lb,...jb,...Db},Fb={...Tb,...Eb,...Nb,...kb,...Ab,...Ib,...Ob},zb={"app.title":"Script Modifier","app.description":"Crie, refine e gere roteiros visualmente com a API Gemini.","app.slogan":"Conecte ideias para criar uma obra-prima","app.subtitle":"Visualize seus Roteiros","app.error.title":"Notificao","app.error.copy":"Copiar Erro","app.error.copied":"Copiado!","error.quotaExceeded":"Voc atingiu seu limite de uso. Verifique a cota da sua chave API ou tente novamente mais tarde.","error.apiKeyMissing":"Chave API no encontrada. Por favor, defina sua chave API Gemini nas configuraes.","error.freeKeyNotAvailable":"A chave API gratuita/de desenvolvimento no est disponvel neste ambiente. Por favor, fornea sua prpria chave.","error.fileReadError":"Erro ao ler o arquivo.","error.videoConversionError":"Falha ao converter vdeo para udio.","error.unsupportedFile":"Tipo de arquivo no suportado.","error.promptModifierFile":"Este arquivo pertence a outra aplicao (Prompt Modifier). Por favor, abra-o nessa aplicao.","error.invalidFileType":"Tipo de arquivo invlido. Por favor, carregue um arquivo de Projeto ou Canvas do Script Modifier.","welcome.iAmDeveloper":"Sou Desenvolvedor","welcome.letsGo":"Vamos l!","welcome.resume":"Continuar","welcome.reload":"Recarregar","welcome.reloadTitle":"Redefinir e Recarregar?","welcome.reloadMessage":"Isso limpar todo o canvas e recarregar a aplicao. Dados no salvos sero perdidos. Tem certeza?","welcome.confirmReload":"Redefinir e Recarregar","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Bem-vindo ao","dialog.welcome.intro1":"Bem-vindo ao Script Modifier - seu espao de trabalho visual para criar histrias com o Gemini.","dialog.welcome.intro2":"Para comear, selecione seu idioma e insira sua chave API Gemini.","dialog.welcome.apiKeyExplanation":"Sua chave API  armazenada localmente no seu navegador. No a enviamos para nenhum servidor alm da API do Google Gemini."},Gb={"toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexo (C)","toolbar.selection":"Seleo (S)","toolbar.reroute":"Ponto de Roteamento (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Alinhar  Grade (Shift+W)","toolbar.resetZoom":"Redefinir Zoom","toolbar.lineStyleSpaghetti":"Linhas Spaghetti (Shift+E)","toolbar.lineStyleOrthogonal":"Linhas Ortogonais (Shift+E)","toolbar.addNode":"Adicionar N (F)","toolbar.catalog":"Catlogo (Ctrl+Espao)","toolbar.settings":"Configuraes","toolbar.resetToDefault":"Restaurar Padro","toolbar.closeProject":"Fechar Projeto / Limpar","toolbar.enterFullscreen":"Tela Cheia","toolbar.exitFullscreen":"Sair da Tela Cheia","toolbar.addTextInput":"Entrada de Texto (T)","toolbar.addPromptAnalyzer":"Analisador de Prompt (A)","toolbar.addCharacterAnalyzer":"Analisador de Personagem","toolbar.addCharacterGenerator":"Gerador de Personagens (Shift+C)","toolbar.addImageGenerator":"Gerador de Imagens (O)","toolbar.addImagePreview":"Pr-visualizao de Imagem (I)","toolbar.addCharacterCard":"Carto de Personagem (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Processador de Prompt (P)","toolbar.addGeminiChat":"Chat Gemini (M)","toolbar.addTranslator":"Tradutor (L)","toolbar.addIdeaGenerator":"Gerador de Ideias (Shift+A)","toolbar.addScriptGenerator":"Gerador de Roteiro (Shift+S)","toolbar.addScriptAnalyzer":"Analisador de Roteiro (Shift+D)","toolbar.addScriptPromptModifier":"Finalizador de Prompt (Shift+F)","toolbar.addErrorAnalyzer":"Analisador de Erros","toolbar.addNote":"Nota (N)","toolbar.addDataReader":"Leitor de Dados (Shift+R)","toolbar.addSpeechSynthesizer":"Sintetizador de Voz (Shift+N)","toolbar.addNarratorTextGenerator":"Gerador de Texto Narrador (Shift+G)","toolbar.addAudioTranscriber":"Transcritor de udio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Gerador de Ttulos YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Gerador de Ideias Musicais (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Salvar Canvas (Ctrl+S)","toolbar.saveProject":"Salvar Projeto (Ctrl+Shift+S)","toolbar.loadCanvas":"Carregar (Ctrl+O)","toolbar.clearCanvas":"Limpar Canvas","toolbar.group.general":"Geral","toolbar.group.scripting":"Roteiro","toolbar.group.prompting":"Prompts e Anlise","toolbar.group.characters":"Personagens","toolbar.group.ai":"Ferramentas IA","toolbar.group.file":"Arquivo","toolbar.group.images":"Imagens","toolbar.group.audio":"udio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Controles do Canvas","toolbar.expand":"Expandir Painel","toolbar.collapse":"Recolher Painel","toolbar.toggleHeaders":"Alternar Cabealhos","hotkeys.file.title":"Arquivo","hotkeys.file.save":"Salvar Canvas (Ctrl+S)","hotkeys.file.saveProject":"Salvar Projeto (Ctrl+Shift+S)","hotkeys.file.load":"Carregar Canvas (Ctrl+O)","hotkeys.tools.title":"Ferramentas","hotkeys.tools.edit":"Editar","hotkeys.tools.cutter":"Cortar","hotkeys.tools.selection":"Seleo","hotkeys.tools.reroute":"Roteamento","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Agrupar (G)","hotkeys.tools.deleteGroup":"Excluir grupo","hotkeys.tools.closeNode":"Fechar N","hotkeys.tools.toggleLineStyle":"Alternar Estilo de Linha","hotkeys.tools.snapToGrid":"Alinhar  Grade","hotkeys.tools.selectAll":"Selecionar Tudo","hotkeys.tools.deselectAll":"Desmarcar Tudo","hotkeys.tools.duplicate":"Duplicar com Contedo","hotkeys.windows.title":"Janelas","hotkeys.windows.search":"Buscar Ns (F)","hotkeys.windows.quickAdd":"Adio Rpida (Espao)","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Criar N","hotkeys.hide":"Ocultar Atalhos","help.title":"Atalhos de Teclado","hotkeys.show":"Mostrar Atalhos","search.placeholder":"Buscar um n...","search.noResults":"Nenhum n encontrado.","search.node.text_input.title":"Entrada de Texto","search.node.text_input.description":"Uma caixa de texto simples para suas ideias. (T)","search.node.prompt_processor.title":"Processador de Prompt","search.node.prompt_processor.description":"Melhora e combina prompts com IA. (P)","search.node.prompt_analyzer.title":"Analisador de Prompt","search.node.prompt_analyzer.description":"Divide um prompt em ambiente, personagem, ao e estilo. (A)","search.node.character_analyzer.title":"Analisador de Personagem","search.node.character_analyzer.description":"Divide uma descrio em personagem e roupas.","search.node.character_generator.title":"Gerador de Personagens","search.node.character_generator.description":"Cria personagens detalhados a partir de uma ideia. (Shift+C)","search.node.image_generator.title":"Gerador de Imagens","search.node.image_generator.description":"Cria uma imagem a partir de texto. (O)","search.node.image_preview.title":"Pr-visualizao de Imagem","search.node.image_preview.description":"Exibe uma imagem de um arquivo. (I)","search.node.character_card.title":"Carto de Personagem","search.node.character_card.description":"Armazena imagem, nome e prompt de um personagem. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Conversa direta com Gemini AI. (M)","search.node.translator.title":"Tradutor","search.node.translator.description":"Traduz texto para o idioma selecionado. (L)","search.node.script_generator.title":"Gerador de Roteiro","search.node.script_generator.description":"Converte uma ideia em cenas de roteiro. (Shift+S)","search.node.script_analyzer.title":"Analisador de Roteiro","search.node.script_analyzer.description":"Divide um roteiro em quadros e prompts de imagem. (Shift+D)","search.node.script_prompt_modifier.title":"Finalizador de Prompt","search.node.script_prompt_modifier.description":"Finaliza os prompts da anlise para gerao de imagens. (Shift+F)","search.node.error_analyzer.title":"Analisador de Erros","search.node.error_analyzer.description":"Verifica e corrige gramtica e ortografia.","search.node.note.title":"Nota","search.node.note.description":"Uma rea de texto simples para anotaes. (N)","search.node.reroute_dot.title":"Ponto de Roteamento","search.node.reroute_dot.description":"Um ponto para redirecionar conexes.","search.node.data_reader.title":"Leitor de Dados","search.node.data_reader.description":"Exibe dados brutos de um n conectado.","search.node.speech_synthesizer.title":"Sintetizador de Voz","search.node.speech_synthesizer.description":"Converte texto em fala. (Shift+N)","search.node.idea_generator.title":"Gerador de Ideias","search.node.idea_generator.description":"Gera categorias e as combina em uma ideia.","search.node.narrator_text_generator.title":"Gerador de Texto Narrador","search.node.narrator_text_generator.description":"Gera texto para narrador ou locutor. (Shift+G)","search.node.audio_transcriber.title":"Transcritor de udio","search.node.audio_transcriber.description":"Converte arquivos de udio/vdeo em texto. (Shift+B)","search.node.youtube_title_generator.title":"Gerador de Ttulos YouTube","search.node.youtube_title_generator.description":"Gera ttulos, descries e tags para YouTube.","search.node.music_idea_generator.title":"Gerador de Ideias Musicais","search.node.music_idea_generator.description":"Gera letras ou prompts musicais. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analisa estatsticas do canal e oferece dicas.","search.node.image_editor.title":"Editor de Imagem","search.node.image_editor.description":"Edite imagens com IA (Inpainting, Outpainting).","node.action.help":"Ajuda","node.action.expand":"Expandir","node.action.collapse":"Recolher (H)","node.action.expandAll":"Expandir Tudo","node.action.collapseAll":"Recolher Tudo","node.action.expandAllScenes":"Expandir Todas as Cenas","node.action.collapseAllScenes":"Recolher Todas as Cenas","node.action.expandAllFrames":"Expandir Todos os Quadros","node.action.collapseAllFrames":"Recolher Todos os Quadros","node.action.expandPanel":"Expandir Painel","node.action.collapsePanel":"Recolher Painel","node.action.togglePanel":"Alternar Painel","node.action.collapseScene":"Recolher Cena","node.action.expandScene":"Expandir Cena","node.action.collapseFrame":"Recolher Quadro","node.action.expandFrame":"Expandir Quadro","node.action.collapseCharacter":"Recolher Personagem","node.action.expandCharacter":"Expandir Personagem","node.action.clear":"Limpar","node.action.clearTooltip":"Limpar campo de entrada.","node.action.clearChat":"Limpar Chat","node.action.paste":"Colar","node.action.copy":"Copiar","node.action.duplicateWithContent":"Duplicar (Contedo)","node.action.duplicateEmpty":"Duplicar (Vazio)","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.executeChain":"Executar Cadeia","node.action.executeFullChain":"Executar Cadeia Completa","node.action.processChainForward":"Processar Cadeia Adiante","node.action.executeChainTitle":"Executar todos os ns conectados.","node.action.addCharacter":"Adicionar Personagem","node.action.addScene":"Adicionar Cena","node.action.addFrame":"Adicionar Quadro","node.action.addFirstFrame":"Adicionar Primeiro Quadro","node.action.deleteItem":"Excluir","node.action.moveUp":"Mover para Cima","node.action.moveDown":"Mover para Baixo","node.action.saveImage":"Salvar Imagem","node.action.loadImage":"Carregar Imagem","node.action.saveCharacter":"Salvar Personagem","node.action.loadCharacter":"Carregar Personagem","node.action.readData":"Ler Dados","node.action.refreshData":"Atualizar Dados","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.embedCharacter":"Incorporar Personagem","node.action.downloadFinalPrompts":"Baixar Prompts","node.action.rename":"Renomear","node.action.index":"Indexar","node.action.improveConcept":"Melhorar Conceito","node.action.improveConceptTooltip":"Enriquecer e adicionar detalhes visuais.","node.action.downloadJson":"Baixar JSON","node.action.downloadSRT":"Baixar SRT","node.action.markPrimary":"Marcar como Principal","node.input.default":"Entrada","node.output.default":"Sada","node.output.allCharacters":"Todos os Personagens","node.output.primaryCharacter":"Personagem Principal","node.content.action":"Ao","node.content.actionPlaceholder":"Prompt de ao...","node.content.allScriptParts":"Todas as partes do roteiro","node.content.allScriptAnalyzerData":"Dados do analisador","node.content.allNarratorData":"Todos os dados do narrador","node.content.analyzeCharacters":"Analisar personagens","node.content.analyzeFromScene":"Analisar de:","node.content.analyzeUpToScene":"at","node.content.endPlaceholder":"fim","node.content.generateFromFrame":"Gerar do quadro:","node.content.generateUpToFrame":"at o quadro","node.content.analyzeFromFrame":"Finalizar do quadro:","node.content.processFromFrame":"Processar do quadro:","node.content.processFromScene":"Processar da cena:","node.content.analyzePrompt":"Analisar prompt","node.content.analyzeScript":"Analisar roteiro","node.content.analyzing":"Analisando...","node.content.applyAliases":"Aplicar Alias","node.content.applyAliasesTooltip":"Substitui nomes por alias (ndice).","node.content.character":"Personagem","node.content.characterIndex":"ndice","node.content.characterPlaceholder":"Prompt do personagem...","node.content.character_plural":"personagens","node.content.characters":"Personagens","node.content.charactersSynced":"Personagens sincronizados","node.content.noCharactersConnected":"Nenhum personagem conectado.","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro (Animais)","node.content.characterType.chibi":"Chibi (Fofo)","node.content.characterType.key_item":"Item Chave","node.content.style":"Estilo","node.content.style.none":"Nenhum","node.content.style.simple":"Simples","node.content.style.realistic":"Realista/Cinema","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Especial","node.content.chatPlaceholder":"Digite uma mensagem...","node.content.clothing":"Roupas","node.content.clothingPlaceholder":"Prompt de roupas...","node.content.connectedPlaceholder":"Conectado","node.content.dataPlaceholder":"Dados aparecero aqui...","node.content.readData":"Ler Dados","node.content.reading":"Lendo...","node.content.description":"Descrio","node.content.sceneDescription":"Descrio da Cena","node.content.duration":"Durao","node.content.enhancePrompt":"Gerar Prompt","node.content.enhancedPromptHere":"Prompt melhorado aparecer aqui...","node.content.enhancing":"Melhorando...","node.content.environment":"Ambiente","node.content.environmentPlaceholder":"Prompt do ambiente...","node.content.environmentPrompt":"Ambiente & Fundo","node.content.compositionAndBlocking":"Composio & Ao","node.content.executingChain":"Executando cadeia...","node.content.imagePrompt":"Prompt de Imagem","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finais","node.content.fixErrors":"Corrigir Erros","node.content.fixingErrors":"Corrigindo...","node.content.frame":"Quadro","node.content.frame_plural":"Quadros","node.content.frames":"Quadros de Sada","node.content.frames_analyzed":"Quadros analisados: {count}","node.content.framesPerScene":"Quadros por Cena","node.content.minFrames":"Mn","node.content.maxFrames":"Mx","node.content.numberOfCharactersShort":"Qtd","node.content.fullDescription":"Descrio Completa","node.content.generateCharacters":"Gerar Personagens","node.content.generateFinalPrompts":"Gerar Prompts Finais","node.content.generatingProgress":"Gerando {current} de {total}","node.content.generateImage":"Gerar Imagem","node.content.generateScript":"Gerar Roteiro","node.content.generateSpeech":"Gerar Fala","node.content.generateText":"Gerar Texto","node.content.generateSSML":"Gerar SSML","node.content.generateStyle":"Gerar Estilo","node.content.generating":"Gerando...","node.content.improving":"Melhorando...","node.content.generatedAudio":"udio gerado","node.content.imagePromptPlaceholder":"Insira prompt para imagem...","node.content.modificationPromptPlaceholder":"Solicitao de modificao...","node.content.narrator":"Narrador","node.content.narratorEnabled":"Habilitar Narrador","node.content.narratorEnabledInfo":"Adiciona texto de locuo.","node.content.narratorMode":"Modo Narrador","node.content.narratorMode.normal":"Normal / Locuo","node.content.narratorMode.dual":"Dois Narradores","node.content.narratorMode.first_person":"Primeira Pessoa","node.content.role":"Papel","node.content.role.narrator":"Narrador","node.content.role.announcer":"Locutor","node.content.role.first_person":"Primeira Pessoa","node.content.role.dual_narrator":"Dois Narradores","node.content.role.dual_announcer":"Dois Locutores","node.content.scene":"Cena","node.content.scene_plural":"cenas","node.content.scenes":"Cenas","node.content.scenes_generated":"Cenas geradas: {count}","node.content.sceneContext":"Contexto da Cena","node.content.sceneContextPlaceholder":"Humor, ambiente, luz...","node.content.scriptPromptPlaceholder":"Insira ideia da histria...","node.content.seconds":"seg","node.content.stylePlaceholder":"Prompt de estilo...","node.content.stylePromptPlaceholder":"Insira prompt de estilo aqui...","node.content.styleOverride":"Substituir Estilo","node.content.summary":"Resumo","node.content.targetLanguage":"Idioma Alvo","node.content.textToSynthesize":"Texto para sintetizar...","node.content.translate":"Traduzir","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Traduo aparecer aqui...","node.content.translating":"Traduzindo...","node.content.useExistingCharacters":"Usar personagens existentes","node.content.useExistingCharactersInfo":"Usa dados de personagens conectados em vez de gerar novos.","node.content.createKeyItem":"Criar Secundrios/Itens","node.content.createSecondaryChars":"Personagens Secundrios","node.content.createKeyItems":"Itens Chave","node.content.createKeyItemInfo":"Permite  IA criar personagens secundrios ou itens.","node.content.noCharacters":"Sem Personagens","node.content.noCharactersInfo":"Foco em eventos e atmosfera (estilo documentrio).","node.content.videoPrompt":"Dinmica & Movimento","node.content.videoPrompts":"Prompts de Vdeo","node.content.voice":"Voz","node.content.previewVoice":"Testar Voz","node.content.voicePreviewText":"Ol, esta  uma prova de voz.","node.content.inputScripts":"Cenas de Entrada","node.content.inputFrames":"Quadros de Entrada","node.content.outputScript":"Cenas de Sada","node.content.requestCategories":"Pedir Categorias","node.content.generateIdea":"Gerar Ideia","node.content.requestNewCategories":"Novas Categorias","node.content.category.action":"Ao","node.content.category.place":"Lugar","node.content.category.obstacle":"Obstculo","node.content.generatedIdea":"Ideia Gerada","node.content.storyFormat":"Formato da Histria","node.content.theme":"Tema","node.content.parameters":"Parmetros","node.content.advancedMode":"Modo Avanado","node.content.numberOfScenes":"Nmero de Cenas","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Enredo Detalhado","node.content.detailedPlotInfo":"Habilita descries detalhadas.","node.content.includeSubscribeScene":"Cena de Inscrio","node.content.includeSubscribeSceneInfo":"Adiciona uma cena pedindo para se inscrever.","node.content.genre":"Gnero","node.content.genre2":"Gnero 2","node.content.breakIntoParagraphs":"Pargrafos","node.content.copyVideoPrompt":"Copiar prompt de vdeo","node.content.generateVideoPrompt":"Gerar prompt de vdeo","node.content.model":"Modelo","node.content.processWholeScene":"Processar cena inteira","node.content.processWholeSceneInfo":"Processa todos os quadros de uma cena de uma vez para consistncia.","node.content.batchProcessing":"Processamento em Lote","node.content.batchProcessingInfo":"Processar todas as cenas selecionadas em um contexto.","node.content.extendedAnalysis":"Anlise Estendida","node.content.extendedAnalysisInfo":"Divide cenas em planos detalhados.","node.content.professionalStoryboard":"Storyboard de Diretor","node.content.professionalStoryboardInfo":"Anlise baseada em regras cinematogrficas.","node.content.generateStartEndFrames":"Gerar Quadros Incio/Fim","node.content.autoIndexCharacters":"Auto-indexar Personagens","node.content.autoIndexCharactersInfo":"Substitui nomes automaticamente por alias.","node.content.imageToText":"Imagem para Texto","node.content.extracting":"Extraindo...","node.content.extractedText":"Texto Extrado","node.content.activePromptStack":"Pilha de Prompts Ativa","node.content.noCharactersAnalyzed":"Nenhum personagem analisado.","node.content.promptsGeneratedPlaceholder":"Prompts gerados aparecero aqui.","node.content.noCharactersInScript":"Sem personagens no roteiro.","node.content.noInputScenes":"Sem dados de entrada. Conecte um Gerador de Roteiro.","node.content.status":"Status","node.content.status.ready":"Pronto","node.content.status.paused":"Pausado","node.content.status.generating":"Gerando","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Processando: {current} de {total}","node.content.status.time":"Tempo: {current}s / {total}s","node.content.refreshing":"Atualizando...","node.content.totalFrames":"Total Quadros: {count}","node.content.uploadAudio":"Enviar udio/Vdeo","node.content.noAudioLoaded":"Sem udio","node.content.audioLoaded":"udio Carregado","node.content.transcriptionPlaceholder":"A transcrio aparecer aqui...","node.content.transcribe":"Transcrever","node.content.transcribing":"Transcrevendo...","node.content.convertingVideo":"Convertendo vdeo...","node.content.recommendedFrames":"Quadros Estimados","node.content.shotType":"Plano","node.content.shotType.ws":"WS (Plano Aberto)","node.content.shotType.ms":"MS (Plano Mdio)","node.content.shotType.cu":"CU (Close)","node.content.shotType.ecu":"ECU (Detalhe)","node.content.shotType.ls":"LS (Plano Geral)","node.content.characterDetail":"Detalhes do Personagem","node.content.noCharDesc":"Sem descrio de personagem","node.content.includeGeneralCharDesc":"Descrio visual geral","node.content.includeFullCharDesc":"Descrio visual detalhada","node.content.safeGeneration":"Gerao Segura","node.content.shotFilter":"Filtro de Planos","node.content.shotFilter.all":"Todos","node.content.shotFilter.wideOnly":"Apenas Abertos","instruction.desc.shot_filter_all":"Permitir todos os tipos de plano (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringir a planos abertos (WS, MS, LS). Sem closes.","node.content.anthroEnabled":"Animais Antropomrficos","node.content.subscribeEnhancement":"Melhorar Chamada de Inscrio","node.content.thinkingEnabled":"Modo Pensamento","node.content.scenelessMode":"Cenas sem roteiro","instruction.desc.sceneless_mode":"Desativar motor narrativo. Gerar cenas diretamente do conceito.","instruction.sceneless_mode":"Modo Lista de Cenas","node.content.microActionBreakdown":"Micro-Aes","node.content.microActionBreakdownInfo":"Decompe aes complexas em fases (Preparao, Ao, Reao).","node.content.commercialSafe":"Comercialmente Seguro","instruction.desc.commercial_safe":"Evita estritamente marcas registradas (Disney, Pixar) e as substitui por descries genricas.","node.content.findStack":"Buscar na pilha...","help.tabs.hotkeys":"Ajuda & Atalhos","help.tabs.links":"Outros Apps & Links","help.category.socials":"Redes Sociais","help.category.stable":"Google AI Studio (Estvel)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Repositrios GitHub","help.link.youtube":"Canal YouTube","help.link.telegram_channel":"Canal Telegram","help.link.telegram_chat":"Chat Telegram","help.sub.news":"Notcias & Atualizaes","help.sub.discussion":"Discusso","help.sub.stable":"Verso Estvel","help.sub.alpha":"Verso Alpha","languages.ru":"Russo","languages.en":"Ingls","languages.es":"Espanhol","languages.fr":"Francs","languages.de":"Alemo","languages.it":"Italiano","languages.pt":"Portugus","languages.zh":"Chins","languages.ja":"Japons","languages.ko":"Coreano","languages.uz":"Uzbeque"},Ub={"node.title.text_input":"Entrada de Texto","node.title.prompt_processor":"Processador de Prompt","node.title.prompt_analyzer":"Analisador de Prompt","node.title.character_analyzer":"Analisador de Personagem","node.title.character_generator":"Gerador de Personagens","node.title.image_generator":"Gerador de Imagens","node.title.image_preview":"Pr-visualizao de Imagem","node.title.character_card":"Carto de Personagem","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Tradutor","node.title.script_generator":"Gerador de Roteiro","node.title.script_analyzer":"Analisador de Roteiro","node.title.script_prompt_modifier":"Finalizador de Prompt","node.title.error_analyzer":"Analisador de Erros","node.title.note":"Nota","node.title.reroute_dot":"Ponto de Roteamento","node.title.data_reader":"Leitor de Dados","node.title.speech_synthesizer":"Sintetizador de Voz","node.title.idea_generator":"Gerador de Ideias","node.title.narrator_text_generator":"Gerador de Texto Narrador","node.title.audio_transcriber":"Transcritor de udio","node.title.youtube_title_generator":"Gerador de Ttulos YouTube","node.title.music_idea_generator":"Gerador de Ideias Musicais","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Editor de Imagem","node.help.text_input":"Insira ideias bsicas ou descries aqui.","node.help.prompt_processor":"Combina texto de outros ns em um prompt detalhado.","node.help.prompt_analyzer":"Divide um prompt em ambiente, personagem, ao e estilo.","node.help.character_analyzer":"Analisa a descrio de um personagem dividindo em aparncia e roupas.","node.help.character_generator":"Cria descries detalhadas de personagens a partir de uma ideia.","node.help.image_generator":"Gera uma imagem a partir de texto usando a API Gemini.","node.help.image_preview":"Exibe uma imagem. Arraste e solte um arquivo.","node.help.character_card":"Armazena imagem, nome e prompt de um personagem.","node.help.gemini_chat":"Conversa direta com Gemini AI.","node.help.translator":"Traduz o texto de entrada para o idioma selecionado.","node.help.script_generator":"Gera cenas de roteiro a partir de um prompt.","node.help.script_analyzer":"Analisa a estrutura do roteiro, dividindo em quadros e prompts.","node.help.script_prompt_modifier":"Cria prompts artsticos finais para cada quadro.","node.help.error_analyzer":"Verifica e corrige ortografia e gramtica.","node.help.note":"Uma rea de texto simples para anotaes.","node.help.reroute_dot":"Um ponto para redirecionar conexes.","node.help.data_reader":"Exibe dados brutos de um n conectado.","node.help.speech_synthesizer":"Converte texto em fala.","node.help.idea_generator":"Gera categorias e as combina em uma ideia.","node.help.narrator_text_generator":"Gera texto para narrador ou locutor.","node.help.audio_transcriber":"Converte arquivos de udio/vdeo em texto.","node.help.youtube_title_generator":"Gera ttulos, descries e tags para YouTube.","node.help.music_idea_generator":"Gera letras ou prompts musicais.","node.help.youtube_analytics":"Analisa estatsticas do canal e oferece dicas.","node.help.image_editor":"Edite imagens com IA (Inpainting, Outpainting).","node.action.help":"Ajuda","node.action.expand":"Expandir","node.action.collapse":"Recolher (H)","node.action.expandAll":"Expandir Tudo","node.action.collapseAll":"Recolher Tudo","node.action.expandAllScenes":"Expandir Todas as Cenas","node.action.collapseAllScenes":"Recolher Todas as Cenas","node.action.expandAllFrames":"Expandir Todos os Quadros","node.action.collapseAllFrames":"Recolher Todos os Quadros","node.action.expandPanel":"Expandir Painel","node.action.collapsePanel":"Recolher Painel","node.action.togglePanel":"Alternar Painel","node.action.collapseScene":"Recolher Cena","node.action.expandScene":"Expandir Cena","node.action.collapseFrame":"Recolher Quadro","node.action.expandFrame":"Expandir Quadro","node.action.collapseCharacter":"Recolher Personagem","node.action.expandCharacter":"Expandir Personagem","node.action.clear":"Limpar","node.action.clearTooltip":"Limpar campo de entrada.","node.action.clearChat":"Limpar Chat","node.action.paste":"Colar","node.action.copy":"Copiar","node.action.duplicateWithContent":"Duplicar (Contedo)","node.action.duplicateEmpty":"Duplicar (Vazio)","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.executeChain":"Executar Cadeia","node.action.executeFullChain":"Executar Cadeia Completa","node.action.processChainForward":"Processar Cadeia Adiante","node.action.executeChainTitle":"Executar todos os ns conectados.","node.action.addCharacter":"Adicionar Personagem","node.action.addScene":"Adicionar Cena","node.action.addFrame":"Adicionar Quadro","node.action.addFirstFrame":"Adicionar Primeiro Quadro","node.action.deleteItem":"Excluir","node.action.moveUp":"Mover para Cima","node.action.moveDown":"Mover para Baixo","node.action.saveImage":"Salvar Imagem","node.action.loadImage":"Carregar Imagem","node.action.saveCharacter":"Salvar Personagem","node.action.loadCharacter":"Carregar Personagem","node.action.readData":"Ler Dados","node.action.refreshData":"Atualizar Dados","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.embedCharacter":"Incorporar Personagem","node.action.downloadFinalPrompts":"Baixar Prompts","node.action.rename":"Renomear","node.action.index":"Indexar","node.action.improveConcept":"Melhorar Conceito","node.action.improveConceptTooltip":"Enriquecer e adicionar detalhes visuais.","node.action.downloadJson":"Baixar JSON","node.action.downloadSRT":"Baixar SRT","node.action.markPrimary":"Marcar como Principal","node.input.default":"Entrada","node.output.default":"Sada","node.output.allCharacters":"Todos os Personagens","node.output.primaryCharacter":"Personagem Principal","node.content.action":"Ao","node.content.actionPlaceholder":"Prompt de ao...","node.content.allScriptParts":"Todas as partes do roteiro","node.content.allScriptAnalyzerData":"Dados do analisador","node.content.allNarratorData":"Todos os dados do narrador","node.content.analyzeCharacters":"Analisar personagens","node.content.analyzeFromScene":"Analisar de:","node.content.analyzeUpToScene":"at","node.content.endPlaceholder":"fim","node.content.generateFromFrame":"Gerar do quadro:","node.content.generateUpToFrame":"at o quadro","node.content.analyzeFromFrame":"Finalizar do quadro:","node.content.processFromFrame":"Processar do quadro:","node.content.processFromScene":"Processar da cena:","node.content.analyzePrompt":"Analisar prompt","node.content.analyzeScript":"Analisar roteiro","node.content.analyzing":"Analisando...","node.content.applyAliases":"Aplicar Alias","node.content.applyAliasesTooltip":"Substitui nomes por alias (ndice).","node.content.character":"Personagem","node.content.characterIndex":"ndice","node.content.characterPlaceholder":"Prompt do personagem...","node.content.character_plural":"personagens","node.content.characters":"Personagens","node.content.charactersSynced":"Personagens sincronizados","node.content.noCharactersConnected":"Nenhum personagem conectado.","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro (Animais)","node.content.characterType.chibi":"Chibi (Fofo)","node.content.characterType.key_item":"Item Chave","node.content.style":"Estilo","node.content.style.none":"Nenhum","node.content.style.simple":"Simples","node.content.style.realistic":"Realista/Cinema","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Especial","node.content.chatPlaceholder":"Digite uma mensagem...","node.content.clothing":"Roupas","node.content.clothingPlaceholder":"Prompt de roupas...","node.content.connectedPlaceholder":"Conectado","node.content.dataPlaceholder":"Dados aparecero aqui...","node.content.readData":"Ler Dados","node.content.reading":"Lendo...","node.content.description":"Descrio","node.content.sceneDescription":"Descrio da Cena","node.content.duration":"Durao","node.content.enhancePrompt":"Gerar Prompt","node.content.enhancedPromptHere":"Prompt melhorado aparecer aqui...","node.content.enhancing":"Melhorando...","node.content.environment":"Ambiente","node.content.environmentPlaceholder":"Prompt do ambiente...","node.content.environmentPrompt":"Ambiente & Fundo","node.content.compositionAndBlocking":"Composio & Ao","node.content.executingChain":"Executando cadeia...","node.content.imagePrompt":"Prompt de Imagem","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finais","node.content.fixErrors":"Corrigir Erros","node.content.fixingErrors":"Corrigindo...","node.content.frame":"Quadro","node.content.frame_plural":"Quadros","node.content.frames":"Quadros de Sada","node.content.frames_analyzed":"Quadros analisados: {count}","node.content.framesPerScene":"Quadros por Cena","node.content.minFrames":"Mn","node.content.maxFrames":"Mx","node.content.numberOfCharactersShort":"Qtd","node.content.fullDescription":"Descrio Completa","node.content.generateCharacters":"Gerar Personagens","node.content.generateFinalPrompts":"Gerar Prompts Finais","node.content.generatingProgress":"Gerando {current} de {total}","node.content.generateImage":"Gerar Imagem","node.content.generateScript":"Gerar Roteiro","node.content.generateSpeech":"Gerar Fala","node.content.generateText":"Gerar Texto","node.content.generateSSML":"Gerar SSML","node.content.generateStyle":"Gerar Estilo","node.content.generating":"Gerando...","node.content.improving":"Melhorando...","node.content.generatedAudio":"udio gerado","node.content.imagePromptPlaceholder":"Insira prompt para imagem...","node.content.modificationPromptPlaceholder":"Solicitao de modificao...","node.content.narrator":"Narrador","node.content.narratorEnabled":"Habilitar Narrador","node.content.narratorEnabledInfo":"Adiciona texto de locuo.","node.content.narratorMode":"Modo Narrador","node.content.narratorMode.normal":"Normal / Locuo","node.content.narratorMode.dual":"Dois Narradores","node.content.narratorMode.first_person":"Primeira Pessoa","node.content.role":"Papel","node.content.role.narrator":"Narrador","node.content.role.announcer":"Locutor","node.content.role.first_person":"Primeira Pessoa","node.content.role.dual_narrator":"Dois Narradores","node.content.role.dual_announcer":"Dois Locutores","node.content.scene":"Cena","node.content.scene_plural":"cenas","node.content.scenes":"Cenas","node.content.scenes_generated":"Cenas geradas: {count}","node.content.sceneContext":"Contexto da Cena","node.content.sceneContextPlaceholder":"Humor, ambiente, luz...","node.content.scriptPromptPlaceholder":"Insira ideia da histria...","node.content.seconds":"seg","node.content.stylePlaceholder":"Prompt de estilo...","node.content.stylePromptPlaceholder":"Insira prompt de estilo aqui...","node.content.styleOverride":"Substituir Estilo","node.content.summary":"Resumo","node.content.targetLanguage":"Idioma Alvo","node.content.textToSynthesize":"Texto para sintetizar...","node.content.translate":"Traduzir","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Traduo aparecer aqui...","node.content.translating":"Traduzindo...","node.content.useExistingCharacters":"Usar personagens existentes","node.content.useExistingCharactersInfo":"Usa dados de personagens conectados em vez de gerar novos.","node.content.createKeyItem":"Criar Secundrios/Itens","node.content.createSecondaryChars":"Personagens Secundrios","node.content.createKeyItems":"Itens Chave","node.content.createKeyItemInfo":"Permite  IA criar personagens secundrios ou itens.","node.content.noCharacters":"Sem Personagens","node.content.noCharactersInfo":"Foco em eventos e atmosfera (estilo documentrio).","node.content.videoPrompt":"Dinmica & Movimento","node.content.videoPrompts":"Prompts de Vdeo","node.content.voice":"Voz","node.content.previewVoice":"Testar Voz","node.content.voicePreviewText":"Ol, esta  uma prova de voz.","node.content.inputScripts":"Cenas de Entrada","node.content.inputFrames":"Quadros de Entrada","node.content.outputScript":"Cenas de Sada","node.content.requestCategories":"Pedir Categorias","node.content.generateIdea":"Gerar Ideia","node.content.requestNewCategories":"Novas Categorias","node.content.category.action":"Ao","node.content.category.place":"Lugar","node.content.category.obstacle":"Obstculo","node.content.generatedIdea":"Ideia Gerada","node.content.storyFormat":"Formato da Histria","node.content.theme":"Tema","node.content.parameters":"Parmetros","node.content.advancedMode":"Modo Avanado","node.content.numberOfScenes":"Nmero de Cenas","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Enredo Detalhado","node.content.detailedPlotInfo":"Habilita descries detalhadas.","node.content.includeSubscribeScene":"Cena de Inscrio","node.content.includeSubscribeSceneInfo":"Adiciona uma cena pedindo para se inscrever.","node.content.genre":"Gnero","node.content.genre2":"Gnero 2","node.content.breakIntoParagraphs":"Pargrafos","node.content.copyVideoPrompt":"Copiar prompt de vdeo","node.content.generateVideoPrompt":"Gerar prompt de vdeo","node.content.model":"Modelo","node.content.processWholeScene":"Processar cena inteira","node.content.processWholeSceneInfo":"Processa todos os quadros de uma cena de uma vez para consistncia.","node.content.batchProcessing":"Processamento em Lote","node.content.batchProcessingInfo":"Processar todas as cenas selecionadas em um contexto.","node.content.extendedAnalysis":"Anlise Estendida","node.content.extendedAnalysisInfo":"Divide cenas em planos detalhados.","node.content.professionalStoryboard":"Storyboard de Diretor","node.content.professionalStoryboardInfo":"Anlise baseada em regras cinematogrficas.","node.content.generateStartEndFrames":"Gerar Quadros Incio/Fim","node.content.autoIndexCharacters":"Auto-indexar Personagens","node.content.autoIndexCharactersInfo":"Substitui nomes automaticamente por alias.","node.content.imageToText":"Imagem para Texto","node.content.extracting":"Extraindo...","node.content.extractedText":"Texto Extrado","node.content.activePromptStack":"Pilha de Prompts Ativa","node.content.noCharactersAnalyzed":"Nenhum personagem analisado.","node.content.promptsGeneratedPlaceholder":"Prompts gerados aparecero aqui.","node.content.noCharactersInScript":"Sem personagens no roteiro.","node.content.noInputScenes":"Sem dados de entrada. Conecte um Gerador de Roteiro.","node.content.status":"Status","node.content.status.ready":"Pronto","node.content.status.paused":"Pausado","node.content.status.generating":"Gerando","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Processando: {current} de {total}","node.content.status.time":"Tempo: {current}s / {total}s","node.content.refreshing":"Atualizando...","node.content.totalFrames":"Total Quadros: {count}","node.content.uploadAudio":"Enviar udio/Vdeo","node.content.noAudioLoaded":"Sem udio","node.content.audioLoaded":"udio Carregado","node.content.transcriptionPlaceholder":"A transcrio aparecer aqui...","node.content.transcribe":"Transcrever","node.content.transcribing":"Transcrevendo...","node.content.convertingVideo":"Convertendo vdeo...","node.content.recommendedFrames":"Quadros Estimados","node.content.shotType":"Plano","node.content.shotType.ws":"WS (Plano Aberto)","node.content.shotType.ms":"MS (Plano Mdio)","node.content.shotType.cu":"CU (Close)","node.content.shotType.ecu":"ECU (Detalhe)","node.content.shotType.ls":"LS (Plano Geral)","node.content.characterDetail":"Detalhes do Personagem","node.content.noCharDesc":"Sem descrio de personagem","node.content.includeGeneralCharDesc":"Descrio visual geral","node.content.includeFullCharDesc":"Descrio visual detalhada","node.content.safeGeneration":"Gerao Segura","node.content.shotFilter":"Filtro de Planos","node.content.shotFilter.all":"Todos","node.content.shotFilter.wideOnly":"Apenas Abertos","instruction.desc.shot_filter_all":"Permitir todos os tipos de plano (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringir a planos abertos (WS, MS, LS). Sem closes.","node.content.anthroEnabled":"Animais Antropomrficos","node.content.subscribeEnhancement":"Melhorar Chamada de Inscrio","node.content.thinkingEnabled":"Modo Pensamento","node.content.scenelessMode":"Cenas sem roteiro","instruction.desc.sceneless_mode":"Desativar motor narrativo. Gerar cenas diretamente do conceito.","instruction.sceneless_mode":"Modo Lista de Cenas","node.content.microActionBreakdown":"Micro-Aes","node.content.microActionBreakdownInfo":"Decompe aes complexas em fases (Preparao, Ao, Reao).","node.content.commercialSafe":"Comercialmente Seguro","instruction.desc.commercial_safe":"Evita estritamente marcas registradas (Disney, Pixar) e as substitui por descries genricas.","node.content.findStack":"Buscar na pilha...","node.content.spm_stack.priming":"1. Preparao e Contexto","node.content.spm_stack.physics":"2. Fsica e Lgica","node.content.spm_stack.hierarchy":"3. Hierarquia do Sujeito","node.content.spm_stack.construction":"4. Construo e Formato"},Hb={"genre.general":"Geral","genre.comedy":"Comdia","genre.drama":"Drama","genre.action":"Ao","genre.scifi":"Fico Cientfica","genre.fantasy":"Fantasia","genre.horror":"Terror","genre.thriller":"Suspense","genre.childrens_animation":"Animao Infantil","genre.shorts_story":"Histrias Curtas (Shorts)","genre.scientific_historical":"Cientfico-Histrico","character_generator.promptPlaceholder":'Insira uma ideia, ex: "cavaleiro corajoso, guardio da floresta antiga"',"idea_generator.randomTheme":"Tema Aleatrio","idea_generator.randomCombination":"Combinao Aleatria","idea_generator.themePlaceholder":"ex. Espao, Cozinha, Floresta Encantada","idea_generator.initialMessage":'Insira um tema (opcional) e clique em "{buttonName}".',"idea_generator.ideaPlaceholder":"A ideia gerada aparecer aqui...","idea_generator.format.general":"Geral","idea_generator.format.childrens":"Infantil","idea_generator.format.adventure":"Aventura","idea_generator.format.fantasy":"Fantasia / Magia","idea_generator.format.detective":"Detetive","idea_generator.format.scifi":"Fico Cientfica","idea_generator.format.horror":"Terror","idea_generator.format.historical":"Histrico","gender.male":"Masculino","gender.female":"Feminino","node.content.autoDownload":"Download automtico ao gerar","node.content.downloadSelected":"Baixar Selecionados","node.content.intonation":"Entonao","intonation.standard":"Padro","intonation.cheerful":"Alegre","intonation.angry":"Zangado","intonation.sad":"Triste","intonation.excited":"Animado","intonation.announcer":"Locutor","intonation.whispering":"Sussurrando","node.content.sceneMode":"Modo Cena","node.content.connectNarratorData":'Conecte "Todos os dados do narrador" de um Gerador de Roteiro.',"node.content.sceneModeActive":"Modo Cena ativo. Dados recebidos da conexo.","speech_synthesizer.mode.simple":"Simples","speech_synthesizer.mode.scene":"Cena","speech_synthesizer.multiSpeaker":"Dois Locutores","speech_synthesizer.speaker1Name":"Nome Locutor 1","speech_synthesizer.speaker2Name":"Nome Locutor 2","speech_synthesizer.multiSpeakerHint":'Os nomes devem corresponder aos do texto (ex. "Homem: ...", "Mulher: ...").',"speech_synthesizer.ssmlHint":"A entonao  controlada por tags SSML no texto.","youtube_analytics.authorName":"Nome do Autor","youtube_analytics.videoTitle":"Ttulo do Vdeo","youtube_analytics.views":"Visualizaes","youtube_analytics.addToChannel":"Adicionar ao Canal","youtube_analytics.noIncomingData":"Sem dados de entrada.","youtube_analytics.videoAdded":"Vdeo adicionado!","youtube_analytics.dragDrop":"Arraste a captura de tela aqui","youtube_analytics.thumbnailUpdated":"Miniatura atualizada","youtube_analytics.statsTrend":"Tendncia de Estatsticas","youtube_analytics.currentChannel":"Canal Atual","youtube_analytics.growth":"Crescimento","youtube_analytics.allChannels":"Todos os Canais","youtube_analytics.saveDisk":"Salvar no Disco","youtube_analytics.saveCatalog":"Salvar no Catlogo","youtube_analytics.loadDisk":"Carregar do Disco","youtube_analytics.analyzing":"Analisando...","youtube_analytics.askAI":"Perguntar  IA","youtube_analytics.clickForAdvice":'Clique em "Perguntar  IA".',"youtube_analytics.dailyNotes":"Notas Dirias","youtube_analytics.logDailyStats":"Registrar Stats","youtube_analytics.subscribers":"Inscritos","youtube_analytics.totalViews":"Vis. Totais","youtube_analytics.updateStats":"Atualizar","youtube_analytics.history":"Histrico","youtube_analytics.noHistory":"Sem histrico.","youtube_analytics.noNotes":"Sem notas.","youtube_analytics.noVideos":"Sem vdeos.","youtube_analytics.loadedFromDisk":"Carregado","youtube_analytics.loadFailed":"Falha ao carregar","youtube_analytics.savedToDisk":"Salvo","youtube_title_generator.mode.title":"Ttulo de Vdeo","youtube_title_generator.mode.channel":"Info do Canal","youtube_title_generator.ideaPlaceholder":"Insira ideia de vdeo...","youtube_title_generator.channelIdeaPlaceholder":"Insira tema do canal...","youtube_title_generator.title":"Ttulo","youtube_title_generator.description":"Descrio","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Nome do Canal","youtube_title_generator.channelDescription":"Descrio do Canal","youtube_title_generator.channelKeywords":"Palavras-chave","youtube_title_generator.channelHandle":"Identificador (@)","music_idea_generator.mode.lyrics":"Letra","music_idea_generator.mode.music_prompt":"Prompt Musical","music_idea_generator.ideaPlaceholder":"Insira tema ou humor...","music_idea_generator.songTitle":"Ttulo da Cano","music_idea_generator.songTitlePlaceholder":"Ttulo...","music_idea_generator.lyricsPlaceholder":"A letra aparecer aqui...","music_idea_generator.musicPromptPlaceholder":"O prompt musical IA aparecer aqui...","chat.mode.general":"Geral","chat.mode.script":"Especialista em Roteiro","chat.mode.prompt":"Especialista em Prompt","chat.mode.youtube":"Especialista em YouTube"},Bb={"catalog.title":"Catlogo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca de Prompts","catalog.tabs.characters":"Personagens","catalog.tabs.scripts":"Roteiros","catalog.tabs.analysis":"Anlises","catalog.tabs.final_prompts":"Prompts Finais","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Ideias Musicais","catalog.empty.title":"O catlogo est vazio","catalog.empty.description":"Salve um item para v-lo aqui ou importe de um arquivo.","catalog.loadFromFile":"Carregar de arquivo","catalog.card.addToCanvas":"Adicionar ao Canvas","catalog.card.rename":"Renomear","catalog.card.save":"Salvar no disco","catalog.card.delete":"Excluir","library.loadFromFile":"Carregar de arquivo","library.empty.title":"Pasta vazia","library.empty.description":"Crie uma nova pasta ou prompt.","library.emptyPrompt":"Sem contedo","library.actions.newFolder":"Nova Pasta","library.actions.newPrompt":"Novo Prompt","library.actions.copy":"Copiar para rea de transferncia","library.actions.edit":"Editar Prompt","group.rename":"Renomear Grupo","group.saveToCatalog":"Salvar no Catlogo","group.saveToDisk":"Salvar no Disco","group.ungroup":"Desagrupar (Shift+Clique para excluir)","group.button.create":"Agrupar ({count})"},Vb={"dialog.rename.title":"Renomear","dialog.rename.group.title":"Renomear Grupo","dialog.rename.catalog.title":"Renomear Item do Catlogo","dialog.rename.label":"Novo nome","dialog.rename.confirm":"Renomear","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nome","dialog.promptEdit.contentLabel":"Contedo","dialog.promptEdit.confirm":"Salvar","dialog.promptEdit.cancel":"Cancelar","dialog.reset.title":"Redefinir Canvas","dialog.reset.message":"Tem certeza que deseja redefinir o canvas? Todo o trabalho no salvo ser perdido.","dialog.exit.title":"Fechar Projeto?","dialog.exit.message":"Tem certeza? Dados no salvos sero perdidos.","dialog.settings.title":"Configuraes","dialog.settings.apiKeyLabel":"Chave API Gemini","dialog.settings.apiKeyPlaceholder":"Insira sua chave aqui","dialog.settings.getApiKeyLink":"Obter chave API no Google AI Studio","dialog.settings.useFreeKey":"Usar chave gratuita (limitada)","dialog.settings.save":"Salvar","dialog.settings.close":"Fechar","dialog.apiKey.title":"Configuraes de Chave API","dialog.apiKey.description":" necessria uma chave API Gemini. Ela ser salva localmente.","dialog.apiKey.keyExists":"Uma chave API j est salva.","dialog.apiKey.clear":"Excluir chave","dialog.apiKey.save":"Salvar chave","dialog.apiKey.update":"Atualizar chave","dialog.apiKey.useFreeKey":"Usar chave gratuita (Desenvolvimento)","dialog.permission.title":"Acesso  rea de Transferncia","dialog.permission.description":'Esta aplicao requer acesso  rea de transferncia para a funo "Colar".',"dialog.permission.decline":"Recusar","dialog.permission.allow":"Permitir","alert.groupSaved":'Grupo "{groupTitle}" salvo no catlogo!',"toast.groupSavedToDisk":'Grupo "{groupTitle}" salvo no disco!',"alert.confirmDelete":"Tem certeza que deseja excluir este item?","alert.invalidCatalogFile":"Arquivo de catlogo invlido.","alert.loadCatalogFailed":"Falha ao carregar item do catlogo","alert.confirmLoadProject":"Carregar um projeto substituir todos os dados atuais. Tem certeza?","dialog.confirmDelete.title":"Confirmar Excluso","dialog.confirmDelete.message":'Tem certeza que deseja excluir "{itemName}"? Isso no pode ser desfeito.',"dialog.confirmDelete.folderMessage":'Tem certeza que deseja excluir a pasta "{itemName}" e seu contedo?',"dialog.confirmDelete.confirm":"Excluir","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmClear.title":"Confirmar Limpeza","dialog.confirmClear.message":"Deseja realmente apagar tudo do canvas?","toast.copied":"Copiado para rea de transferncia","toast.pasted":"Colado!","toast.cleared":"Limpo","toast.resetComplete":"Redefinido","toast.projectSaved":"Projeto salvo","toast.saveFailed":"Falha ao salvar","toast.connectionsCut":"Conexes cortadas","toast.charSaved":"Personagem salvo","toast.charLoaded":"Personagem carregado","toast.videoPasted":"Vdeo colado da rea de transferncia","toast.savedToCatalog":"Salvo no catlogo","toast.apiKeySaved":"Chave API salva","toast.apiKeyCleared":"Chave API excluda","toast.projectLoaded":"Projeto carregado","alert.batchMismatch":"Aviso: Contagem de quadros incompatvel na cena {scene}."},$b={"instruction.desc.safe_gen":"SEGURANA CRTICA: Evite estritamente palavras que acionem filtros de segurana de IA. Substitua termos como 'adolescente', 'ntimo' ou 'revelador' por alternativas artsticas como 'jovem', 'composio artstica' ou 'estilizado'.","instruction.desc.layered_no_style":"Estrutura: 1. [Fundo Global] -> 2. [Hierarquia do Sujeito] -> 3. [Cmera]. NUNCA descreva uma ao sem antes descrever o personagem completo."},Wb={"instruction.sg_inputs":"Dados de Entrada","instruction.desc.sg_inputs":"Fonte: Conceito/Ideia, Perfis de Personagem.","instruction.core_director":"Diretor","instruction.desc.core_director":"Voc  um Diretor de Cinema Visionrio. Pense em lentes, movimento e composio.","instruction.sg_thinking":"Analisar","instruction.desc.sg_thinking":"Raciocinar antes de escrever. Analisar causalidade e lgica. Eliminar clichs.","instruction.sg_improve_input":"Doutor de Roteiro","instruction.desc.sg_improve_input":"Melhorar conceito inicial, corrigir furos na trama, afiar conflito.","instruction.sg_exposition":"Exposio","instruction.desc.sg_exposition":"Mostrar o estado do mundo atravs de histria ambiental e detalhes.","instruction.sg_delayed_reveal":"Revelao","instruction.desc.sg_delayed_reveal":"Introduo gradual: ambiente -> detalhes -> silhueta -> rosto.","instruction.sg_metaphor":"Metfora","instruction.desc.sg_metaphor":"Usar smbolos visuais para estados internos.","instruction.sg_pacing":"Ritmo","instruction.desc.sg_pacing":"Controle de ritmo: equilibrar tomadas contemplativas com edio dinmica.","instruction.sg_subtext":"Subtexto","instruction.desc.sg_subtext":"Tenso entre dilogo e ao.","instruction.desc.sg_frame_estimation":"Estimativa recomendada de quadros.","instruction.rule_visuals":"Visuais Primeiro","instruction.desc.rule_visuals":"Mostre, no conte. Foco em luz, composio, movimento.","instruction.sg_visual_dna":"DNA Visual","instruction.desc.sg_visual_dna":"Guia tcnico LookDev (Luz, Lentes, Estilo de render).","instruction.rule_flow":"Fluxo Contnuo","instruction.desc.rule_flow":"Lgica Match Cut: Usar formas/cores para transies.","instruction.rule_atmosphere":"Atmosfera","instruction.desc.rule_atmosphere":"Detalhes tteis: cheiro de chuva, zumbido neon, poeira.","instruction.sg_visual_style":"Estilo Visual","instruction.desc.sg_visual_style":"Pedido: Descrio detalhada do estilo baseada em '{style}'.","instruction.char_detailed_style":"Detalhe Estilizado","instruction.desc.char_detailed_style":"Integra o estilo global em cada prompt de personagem.","instruction.sg_genre":"Contexto de Gnero","instruction.desc.sg_genre":"Contexto: {genre}","instruction.char_smart_concept":"Conceito Inteligente","instruction.desc.char_smart_concept":"IA escolhe: Corpo Inteiro para Personagens / Preenchimento para Objetos.","instruction.char_no_dupes":"Sem Duplicatas","instruction.desc.char_no_dupes":"CRTICO: NO regenerar personagens exceto MUDANA DE TRAJE.","instruction.create_secondary_chars":"Personagens Secundrios","instruction.desc.create_secondary_chars":"Permite criao de personagens secundrios se necessrio.","instruction.create_key_items":"Itens Chave","instruction.desc.create_key_items":"Criao obrigatria de 'Cartes de Personagem' para objetos importantes.","instruction.char_secondary_ok":"Novos permitidos","instruction.desc.char_secondary_ok":"Novos personagens ou itens permitidos. Se mudar roupa, criar novo carto.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Personagens devem ser animais antropomrficos.","instruction.sg_no_chars":"Sem Personagens","instruction.desc.sg_no_chars":"Estilo documentrio / Sem personagens nomeados.","instruction.sg_detailed_plot":"Enredo Detalhado","instruction.desc.sg_detailed_plot":"Descries muito detalhadas das aes.","instruction.sg_subscribe":"Cena Inscrio","instruction.desc.sg_subscribe":"Incluir cena quebrando a 4 parede para se inscrever.","instruction.char_gray_bg":"Conceito Visual","instruction.desc.char_gray_bg":"Para cada prompt visual, SEMPRE adicionar: ', full body character concept on a gray background'.","instruction.char_no_new":"Sem Novos","instruction.desc.char_no_new":"NO crie novos personagens. Use apenas os existentes.","instruction.sg_new_chars":"Novos Personagens","instruction.desc.sg_new_chars":"Gerar novos personagens baseados no prompt.","instruction.sg_living_world":"Mundo Vivo","instruction.desc.sg_living_world_simple":"Figurantes so humanos normais.","instruction.desc.sg_living_world_anthro":"Figurantes so animais antropomrficos.","instruction.sg_simple_actions":"Aes Simples","instruction.desc.sg_simple_actions":"Evitar fsica complexa. Preferir poses estveis.","instruction.commercial_safe":"Comercialmente Seguro","instruction.desc.commercial_safe":"Evita estritamente marcas registradas (Disney, Pixar) e as substitui por descries genricas."},Yb={"instruction.ana_role":"Papel Analisador","instruction.desc.ana_role":"Voc  um Diretor de Cinema de classe mundial. Escreva instrues tcnicas para gerao de imagem/vdeo por IA.","instruction.ana_cinema":"Cinematografia","instruction.desc.ana_cinema":"Termos pro: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Cinematografia (Aberta)","instruction.desc.ana_cinema_wide":"Termos pro: Wide Shot, Long Shot. SEM Close-ups.","instruction.ana_anthro_logic":"Lgica Anthro","instruction.desc.ana_anthro_logic":"Descrever explicitamente personagens como Animais Antropomrficos.","instruction.ana_subscribe_logic":"Chamada Inscrio","instruction.desc.ana_subscribe_logic":'Aes visuais para "Inscrever-se": segurar placas, texto 3D.',"instruction.rule_hierarchy":"Algoritmo de Enquadramento","instruction.desc.rule_hierarchy":"Ordem estrita: 1. Global (Local/Clima). 2. Postura Sujeito. 3. Interao Objeto. 4. Ao.","instruction.rule_living_world":"Mundo Vivo","instruction.desc.rule_living_world":"Descrever figurantes consistentes com o mundo.","instruction.desc.rule_living_world_anthro":"Figurantes devem ser animais antropomrficos.","instruction.rule_persistence":"Persistncia","instruction.desc.rule_persistence":"Manter consistncia cronolgica da cena. Rastrear objetos e posies.","instruction.rule_mandatory_bg":"Fundo Obrigatrio","instruction.desc.rule_mandatory_bg":"PROIBIDO deixar fundo vazio. Sempre descrever local e luz.","instruction.desc.rule_mandatory_bg_wide":"PROIBIDO deixar fundo vazio. Em plano aberto, sempre descrever geografia e horizonte.","instruction.shot_filter_wide":"Apenas Planos Abertos","instruction.desc.shot_filter_wide":"FILTRO ESTRITO: Apenas Wide (WS), Long (LS) e Medium (MS). Close-ups proibidos.","instruction.storyboard_rules":"Variedade de Planos","instruction.desc.storyboard_rules":"Alternar WS/LS, MS e CU/ECU para dinamismo.","instruction.storyboard_rules_wide":"Variedade de Planos (Aberta)","instruction.desc.storyboard_rules_wide":"Apenas Wide, Long e Establishing. Variar ngulo. SEM Close-ups.","instruction.tech_directives":"Controle Cmera","instruction.desc.tech_directives":"Terminologia estrita. Apenas abreviaes (WS, MS, CU).","instruction.tech_directives_wide":"Controle Cmera (Aberta)","instruction.desc.tech_directives_wide":"Terminologia estrita. Apenas WS, MS, LS. Sem CU/ECU.","instruction.use_aliases":"Usar Alias","instruction.desc.use_aliases":"Usar formato Character-N.","instruction.action_phase_breakdown":"Micro-Aes","instruction.desc.action_phase_breakdown":"Decompor aes complexas em fases (Preparao, Incio, pice, Reao).","instruction.desc.action_phase_breakdown_wide":"Decompor fases, mas MANTER CMERA ABERTA. Mostrar impacto pela postura.","instruction.batch_processing":"Processamento em Lote","instruction.desc.batch_processing":"Analisar todas as cenas como sequncia contnua.","instruction.ana_prompt_lang":"Idioma de Prompt","instruction.desc.ana_prompt_lang":"Prompts estritamente em Ingls para compatibilidade.","instruction.extended_visuals":"Visualizao Estendida","instruction.desc.extended_visuals":"Decompe cenas em sequncias expressivas (Wide, MS, CU, Detalhe).","instruction.extended_visuals_wide":"Visualizao Estendida (Aberta)","instruction.desc.extended_visuals_wide":"Decompe cenas em sequncias de planos Abertos/Mdios. Foco na geografia.","instruction.desc.target_lang":"Idioma de anlise.","instruction.rule_isolation":"Zero Contexto","instruction.desc.rule_isolation":"CRTICO: O gerador de imagem NO SABE sobre o quadro anterior. Re-descrever ambiente.","instruction.sensory_saturation":"Anti-Brevidade","instruction.desc.sensory_saturation":"PROIBIDO ser breve. Descrever texturas, luz e peso fsico.","instruction.ana_no_pov":"Sem POV","instruction.desc.ana_no_pov":'NEGATIVO CRTICO: PROIBIO ESTRITA de planos "POV" ou "Primeira Pessoa". A cmera DEVE ser externa.',"instruction.desc.static_frame_logic":'PROIBIO ESTRITA de verbos de movimento ("andar"). Descreva um momento CONGELADO.',"instruction.desc.anatomical_posing":'Descreva GEOMETRIA corporal. Em vez de "descansando", escreva "deitado de costas, braos ao lado".',"instruction.desc.motion_dynamics":"SEPARAO: Image Prompt = 100% Esttico. Video Prompt = Movimento & Tempo.","instruction.desc.anatomical_strictness":'RIGGING: "Braos atrs da cabea E segurando copo" proibido. Descrever separadamente: Brao ESQ [estado], Brao DIR [estado].',"instruction.desc.prop_consistency":'BLOQUEIO OBJETO: Sem nomes genricos ("espada"). Atributos visuais ("espada ferro enferrujado") obrigatrios.',"instruction.desc.subject_hierarchy":"Mesmo para Close-ups: 1. Personagem Completo. 2. Interao com Ambiente. 3. Detalhe.","instruction.inputs_data":"Entradas","instruction.desc.inputs_data":"Dados fonte: Resumo, Perfis, Textos de cenas."},qb={"instruction.inputs":"Entradas","instruction.desc.inputs":"Fonte: Quadros do analisador, Perfis visuais, Estilo de cena.","instruction.role":"Papel: Artista de Ambiente Lder","instruction.desc.role":"Especialista em Engenharia de Prompt. Sintetize as entradas em uma descrio visual definitiva.","instruction.layered":"Algoritmo: Fluxo Unificado","instruction.desc.layered":"Gera UM S bloco de texto fluido. Estrutura: [Estilo] -> [DESIGN DE CENRIO MESTRE] -> [Visuais] + [POSE & AO] -> [Cmera].","instruction.desc.layered_no_char":"Estrutura: [DESIGN DE CENRIO MESTRE] -> [Ao]. Omite aparncia, mantm apenas ndices e aes.","instruction.visuals":"Estilo: Saturao","instruction.desc.visuals":"Usa descritores ricos: luz volumtrica, texturas 8k, profundidade de campo.","instruction.process_whole_scene":"Lote de Cena","instruction.desc.process_whole_scene":"Analisar cena inteira de uma vez para consistncia.","instruction.video":"Vdeo","instruction.desc.video":"Video Prompt: [ndice] (Desc Visual Detalhada) [Ao]. Dinmica: [Amb]. Cmera: [Movimento]. SEM NOMES.","instruction.stateless":"Regra: Sem Estado","instruction.desc.stateless":"Cada quadro  independente. Re-descrever ambiente. Re-descrever ao de cada personagem do zero.","instruction.rule_static":"Regra: Esttico","instruction.desc.rule_static":"Descrever apenas o momento congelado. Sem transies.","instruction.atmosphere_fix":"ncora Atmosfrica","instruction.desc.atmosphere_fix":"Descrever humor como propriedades fsicas do ar e luz.","instruction.subject_focus":"Hierarquia Contexto","instruction.desc.subject_focus":"CRTICO: Mesmo para Close-ups: 1. Perso Completo. 2. Pose. 3. Detalhe. A IA precisa do contexto corporal.","instruction.always_env":"DESIGN DE CENRIO OBRIGATRIO","instruction.desc.always_env":"CRTICO: Use o 'Contexto Global de Cena' fornecido como a VERDADE ABSOLUTA para o fundo. Voc DEVE injetar os detalhes especficos de mveis, iluminao e texturas do contexto na camada de ambiente de CADA prompt. No alucine fundos genricos.","instruction.pm_anthro":"Detalhe Anthro","instruction.desc.pm_anthro":'OBRIGATRIO: Palavra "anthropomorphic" antes da espcie em Imagem E Vdeo. Texturas/anatomia melhoradas.',"instruction.pm_subscribe":"Texto Legvel","instruction.desc.pm_subscribe":'Garantir que texto como "SUBSCRIBE" seja legvel e integrado (neon, placas).',"instruction.strict_char_index":"Personagens","instruction.desc.strict_char_index":"Mapear estritamente Alias (Character-N) aos dados do quadro.","instruction.no_names":"CRTICO: SEM NOMES","instruction.desc.no_names":"CRTICO: PROIBIO ABSOLUTA DE NOMES. Usar APENAS ID de ndice entre colchetes `[Character-N]`.","instruction.general_char_desc":"Detalhe Geral","instruction.desc.general_char_desc":"Incorporar uma verso CONCISA e GERAL do prompt visual.","instruction.full_char_desc":"Detalhe Completo","instruction.desc.full_char_desc":"Incorporar o prompt visual COMPLETO e DETALHADO do perfil exatamente como est.","instruction.formatting":"Formatao","instruction.desc.formatting":"Ativa CABEALHOS explcitos e quebras de linha para estrutura.","instruction.anatomical_strictness":"Lgica Anatomia","instruction.desc.anatomical_strictness":'RIGGING: Previne "Braos atrs da cabea E segurando copo". Fora descrio separada.',"instruction.img_vid_consistency":"Fluxo Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Incio/Esttico. Video Prompt = Ao/Evoluo. O vdeo deve evoluir naturalmente da imagem.","instruction.desc.prop_enhancement":'MATERIALIDADE: Amplifica descries de objetos (ex. "tbua vermelha" -> "fibra de vidro vermelha brilhante").',"instruction.no_pov":"CRTICO: SEM POV","instruction.desc.no_pov":"PROIBIO ESTRITA de ngulos POV. A cmera DEVE ser externa (Terceira Pessoa)."},Kb={"instruction.music_role":"Papel Produtor Musical","instruction.desc.music_role":"Compositor expert e letrista.","instruction.music_input":"Dados de Entrada","instruction.desc.music_input":"Tema ou ideia do usurio.","instruction.music_creative":"Liberdade Criativa","instruction.desc.music_creative":"Fora a IA a interpretar o clima metaforicamente, no literalmente.","instruction.music_lyrics":"Estrutura Letra","instruction.desc.music_lyrics":"Gera estrutura Verso/Refro adequada ao gnero.","instruction.music_prompt_rule":"Prompt Msica IA","instruction.desc.music_prompt_rule":"Tags tcnicas para Suno/Udio (BPM, Instrumentos, Vocais). Mx 1000 caracteres.","instruction.music_format":"Sada JSON","instruction.desc.music_format":"Estrutura JSON estrita para integrao."},Jb={"instruction.yt_role":"Estrategista YouTube","instruction.desc.yt_role":"Expert em SEO, CTR e psicologia viral.","instruction.yt_input":"Dados de Entrada","instruction.desc.yt_input":"O tpico ou nicho fornecido.","instruction.yt_title_mode":"Metadados Vdeo","instruction.desc.yt_title_mode":"Otimiza Ttulos/Desc/Tags para mximo de cliques.","instruction.yt_channel_mode":"Branding Canal","instruction.desc.yt_channel_mode":"Cria Nome, Bio e Identificador consistentes.","instruction.yt_format":"Sada JSON","instruction.desc.yt_format":"Estrutura JSON estrita para integrao."},Xb={...$b,...Wb,...Yb,...qb,...Kb,...Jb},Zb={...zb,...Gb,...Ub,...Hb,...Bb,...Vb,...Xb},Qb={"app.title":"","app.description":" Gemini API ","app.slogan":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.quotaExceeded":" API ","error.apiKeyMissing":" API  Gemini API ","error.freeKeyNotAvailable":"/ API ","error.fileReadError":"","error.videoConversionError":"","error.unsupportedFile":"","error.promptModifierFile":" (Prompt Modifier)","error.invalidFileType":" Script Modifier ","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.reload":"","welcome.reloadTitle":"","welcome.reloadMessage":"","welcome.confirmReload":"","dialog.welcome.title":"","dialog.welcome.heading":"","dialog.welcome.intro1":" Script Modifier -  Gemini ","dialog.welcome.intro2":" Gemini API ","dialog.welcome.apiKeyExplanation":" API  Google Gemini API "},ew={"toolbar.edit":" (V)","toolbar.cutter":" (C)","toolbar.selection":" (S)","toolbar.reroute":" (R)","toolbar.zoom":" (Z)","toolbar.snapToGrid":" (Shift+W)","toolbar.resetZoom":"","toolbar.lineStyleSpaghetti":" (Shift+E)","toolbar.lineStyleOrthogonal":" (Shift+E)","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl+Space)","toolbar.settings":"","toolbar.resetToDefault":"","toolbar.closeProject":" / ","toolbar.enterFullscreen":"","toolbar.exitFullscreen":"","toolbar.addTextInput":" (T)","toolbar.addPromptAnalyzer":" (A)","toolbar.addCharacterAnalyzer":"","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addImageGenerator":" (O)","toolbar.addImagePreview":" (I)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addPromptProcessor":" (P)","toolbar.addGeminiChat":"Gemini  (M)","toolbar.addTranslator":" (L)","toolbar.addIdeaGenerator":" (Shift+A)","toolbar.addScriptGenerator":" (Shift+S)","toolbar.addScriptAnalyzer":" (Shift+D)","toolbar.addScriptPromptModifier":" (Shift+F)","toolbar.addErrorAnalyzer":"","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift+R)","toolbar.addSpeechSynthesizer":" (Shift+N)","toolbar.addNarratorTextGenerator":" (Shift+G)","toolbar.addAudioTranscriber":" (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube  (Shift+T)","toolbar.addMusicIdeaGenerator":" (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube  (Shift+Y)","toolbar.saveCanvas":" (Ctrl+S)","toolbar.saveProject":" (Ctrl+Shift+S)","toolbar.loadCanvas":" (Ctrl+O)","toolbar.clearCanvas":"","toolbar.group.general":"","toolbar.group.scripting":"","toolbar.group.prompting":"","toolbar.group.characters":"","toolbar.group.ai":"AI ","toolbar.group.file":"","toolbar.group.images":"","toolbar.group.audio":"","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"","toolbar.expand":"","toolbar.collapse":"","toolbar.toggleHeaders":"","hotkeys.file.title":"","hotkeys.file.save":" (Ctrl+S)","hotkeys.file.saveProject":" (Ctrl+Shift+S)","hotkeys.file.load":" (Ctrl+O)","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.group":" (G)","hotkeys.tools.deleteGroup":"","hotkeys.tools.closeNode":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.snapToGrid":"","hotkeys.tools.selectAll":"","hotkeys.tools.deselectAll":"","hotkeys.tools.duplicate":"","hotkeys.windows.title":"","hotkeys.windows.search":" (F)","hotkeys.windows.quickAdd":" ()","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","hotkeys.hide":"","help.title":" & ","hotkeys.show":"","search.placeholder":"...","search.noResults":"","search.node.text_input.title":"","search.node.text_input.description":"(T)","search.node.prompt_processor.title":"","search.node.prompt_processor.description":" AI (P)","search.node.prompt_analyzer.title":"","search.node.prompt_analyzer.description":"(A)","search.node.character_analyzer.title":"","search.node.character_analyzer.description":"","search.node.character_generator.title":"","search.node.character_generator.description":"(Shift+C)","search.node.image_generator.title":"","search.node.image_generator.description":"(O)","search.node.image_preview.title":"","search.node.image_preview.description":"(I)","search.node.character_card.title":"","search.node.character_card.description":"(Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini ","search.node.gemini_chat.description":" Gemini AI (M)","search.node.translator.title":"","search.node.translator.description":"(L)","search.node.script_generator.title":"","search.node.script_generator.description":"(Shift+S)","search.node.script_analyzer.title":"","search.node.script_analyzer.description":"(Shift+D)","search.node.script_prompt_modifier.title":"","search.node.script_prompt_modifier.description":"(Shift+F)","search.node.error_analyzer.title":"","search.node.error_analyzer.description":"","search.node.note.title":"","search.node.note.description":"(N)","search.node.reroute_dot.title":"","search.node.reroute_dot.description":"","search.node.data_reader.title":"","search.node.data_reader.description":"","search.node.speech_synthesizer.title":"","search.node.speech_synthesizer.description":"(Shift+N)","search.node.idea_generator.title":"","search.node.idea_generator.description":"","search.node.narrator_text_generator.title":"","search.node.narrator_text_generator.description":"(Shift+G)","search.node.audio_transcriber.title":"","search.node.audio_transcriber.description":"/(Shift+B)","search.node.youtube_title_generator.title":"YouTube ","search.node.youtube_title_generator.description":"","search.node.music_idea_generator.title":"","search.node.music_idea_generator.description":"(Shift+M)","search.node.youtube_analytics.description":"","search.node.image_editor.title":"","search.node.image_editor.description":" AI ","search.group.input":"","search.group.process":"","search.group.scripting":"","search.group.character":"","search.group.images":"","search.group.ai":"AI ","search.group.audio":"","search.group.youtube":"YouTube ","contextMenu.tools":"","contextMenu.assignSlot":" {index}","contextMenu.addNodeFromSlot":" {node} ({index})","connectionMenu.title":"","quickAddMenu.title":"","contextMenu.paste":" (Ctrl+V)","node.content.simpleActions":"","node.content.smartConcept":"","tooltip.model.flash":"Gemini Flash","tooltip.model.pro":"Gemini Pro","tooltip.lang.ru":"","tooltip.lang.en":"","tooltip.lang.es":"","tooltip.lang.de":"","tooltip.lang.uz":"","tooltip.lang.fr":"","tooltip.lang.it":"","tooltip.lang.pt":"","tooltip.lang.zh":"","node.action.locateInStack":"","help.tabs.hotkeys":"","help.tabs.links":"","help.category.socials":"","help.category.stable":"Google AI Studio ()","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":" / Netlify","help.category.github":"GitHub ","help.link.youtube":"YouTube ","help.link.telegram_channel":"Telegram ","help.link.telegram_chat":"Telegram ","help.sub.news":"","help.sub.discussion":"","help.sub.stable":"","help.sub.alpha":"Alpha ","languages.ru":"","languages.en":"","languages.es":"","languages.fr":"","languages.de":"","languages.it":"","languages.pt":"","languages.zh":"","languages.ja":"","languages.ko":"","languages.uz":""},tw={"node.title.text_input":"","node.title.prompt_processor":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.image_generator":"","node.title.image_preview":"","node.title.character_card":"","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":"","node.title.script_analyzer":"","node.title.script_prompt_modifier":"","node.title.error_analyzer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.speech_synthesizer":"","node.title.idea_generator":"","node.title.narrator_text_generator":"","node.title.audio_transcriber":"","node.title.youtube_title_generator":"YouTube ","node.title.music_idea_generator":"","node.title.youtube_analytics":"YouTube ","node.title.image_editor":"","node.help.text_input":"","node.help.prompt_processor":"","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.image_generator":" Gemini API ","node.help.image_preview":"","node.help.character_card":"","node.help.gemini_chat":" Gemini AI ","node.help.translator":"","node.help.script_generator":"","node.help.script_analyzer":"","node.help.script_prompt_modifier":"","node.help.error_analyzer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.speech_synthesizer":"","node.help.idea_generator":"","node.help.narrator_text_generator":"","node.help.audio_transcriber":"/","node.help.youtube_title_generator":" YouTube ","node.help.music_idea_generator":"","node.help.youtube_analytics":"","node.help.image_editor":" AI ","node.action.help":"","node.action.expand":"","node.action.collapse":" (H)","node.action.expandAll":"","node.action.collapseAll":"","node.action.expandAllScenes":"","node.action.collapseAllScenes":"","node.action.expandAllFrames":"","node.action.collapseAllFrames":"","node.action.expandPanel":"","node.action.collapsePanel":"","node.action.togglePanel":"","node.action.collapseScene":"","node.action.expandScene":"","node.action.collapseFrame":"","node.action.expandFrame":"","node.action.collapseCharacter":"","node.action.expandCharacter":"","node.action.clear":"","node.action.clearTooltip":"","node.action.clearChat":"","node.action.paste":"","node.action.copy":"","node.action.duplicateWithContent":"","node.action.duplicateEmpty":"","node.action.cutConnections":"","node.action.close":"","node.action.executeChain":"","node.action.executeFullChain":"","node.action.processChainForward":"","node.action.executeChainTitle":"","node.action.addCharacter":"","node.action.addScene":"","node.action.addFrame":"","node.action.addFirstFrame":"","node.action.deleteItem":"","node.action.moveUp":"","node.action.moveDown":"","node.action.saveImage":"","node.action.loadImage":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.readData":"","node.action.refreshData":"","node.action.stop":"","node.action.stopping":"...","node.action.embedCharacter":"","node.action.downloadFinalPrompts":"","node.action.rename":"","node.action.index":"","node.action.improveConcept":"","node.action.improveConceptTooltip":"","node.action.downloadJson":" JSON","node.action.downloadSRT":" SRT","node.action.markPrimary":"","node.input.default":"","node.output.default":"","node.output.allCharacters":"","node.output.primaryCharacter":"","node.content.action":"","node.content.actionPlaceholder":"...","node.content.allScriptParts":"","node.content.allScriptAnalyzerData":"","node.content.allNarratorData":"","node.content.analyzeCharacters":"","node.content.analyzeFromScene":"","node.content.analyzeUpToScene":"","node.content.endPlaceholder":"","node.content.generateFromFrame":"","node.content.generateUpToFrame":"","node.content.analyzeFromFrame":"","node.content.processFromFrame":"","node.content.processFromScene":"","node.content.analyzePrompt":"","node.content.analyzeScript":"","node.content.analyzing":"...","node.content.applyAliases":"","node.content.applyAliasesTooltip":"","node.content.character":"","node.content.characterIndex":"","node.content.characterPlaceholder":"...","node.content.character_plural":"","node.content.characters":"","node.content.charactersSynced":"","node.content.noCharactersConnected":"","node.content.appearance":"","node.content.personality":"","node.content.characterType":"","node.content.characterTypeShort":"","node.content.characterType.simple":"","node.content.characterType.anthro":"Anthro ()","node.content.characterType.chibi":"Q ()","node.content.characterType.key_item":"","node.content.style":"","node.content.style.none":"","node.content.style.simple":"","node.content.style.realistic":"/","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.chatPlaceholder":"...","node.content.clothing":"","node.content.clothingPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.dataPlaceholder":"...","node.content.readData":"","node.content.reading":"...","node.content.description":"","node.content.sceneDescription":"","node.content.duration":"","node.content.enhancePrompt":"","node.content.enhancedPromptHere":"...","node.content.enhancing":"...","node.content.environment":"","node.content.environmentPlaceholder":"...","node.content.environmentPrompt":"","node.content.compositionAndBlocking":"","node.content.executingChain":"...","node.content.imagePrompt":"","node.content.finalPrompt":"","node.content.finalPrompt_plural":"","node.content.fixErrors":"","node.content.fixingErrors":"...","node.content.frame":"","node.content.frame_plural":"","node.content.frames":"","node.content.frames_analyzed":"{count}","node.content.framesPerScene":"","node.content.minFrames":"","node.content.maxFrames":"","node.content.numberOfCharactersShort":"","node.content.fullDescription":"","node.content.generateCharacters":"","node.content.generateFinalPrompts":"","node.content.generatingProgress":" {current} / {total}","node.content.generateImage":"","node.content.generateScript":"","node.content.generateSpeech":"","node.content.generateText":"","node.content.generateSSML":" SSML","node.content.generateStyle":"","node.content.generating":"...","node.content.improving":"...","node.content.generatedAudio":"","node.content.imagePromptPlaceholder":"...","node.content.modificationPromptPlaceholder":"...","node.content.narrator":"","node.content.narratorEnabled":"","node.content.narratorEnabledInfo":"","node.content.narratorMode":"","node.content.narratorMode.normal":" / ","node.content.narratorMode.dual":"","node.content.narratorMode.first_person":"","node.content.role":"","node.content.role.narrator":"","node.content.role.announcer":"","node.content.role.first_person":"","node.content.role.dual_narrator":"","node.content.role.dual_announcer":"","node.content.scene":"","node.content.scene_plural":"","node.content.scenes":"","node.content.scenes_generated":": {count}","node.content.sceneContext":"","node.content.sceneContextPlaceholder":"...","node.content.scriptPromptPlaceholder":"...","node.content.seconds":"","node.content.stylePlaceholder":"...","node.content.stylePromptPlaceholder":"...","node.content.styleOverride":"","node.content.summary":"","node.content.targetLanguage":"","node.content.textToSynthesize":"...","node.content.translate":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.translating":"...","node.content.useExistingCharacters":"","node.content.useExistingCharactersInfo":"","node.content.createKeyItem":"/","node.content.createSecondaryChars":"","node.content.createKeyItems":"","node.content.createKeyItemInfo":" AI ","node.content.noCharacters":"","node.content.noCharactersInfo":"","node.content.videoPrompt":"","node.content.videoPrompts":"","node.content.voice":"","node.content.previewVoice":"","node.content.voicePreviewText":"","node.content.inputScripts":"","node.content.inputFrames":"","node.content.outputScript":"","node.content.requestCategories":"","node.content.generateIdea":"","node.content.requestNewCategories":"","node.content.category.action":"","node.content.category.place":"","node.content.category.obstacle":"","node.content.generatedIdea":"","node.content.storyFormat":"","node.content.theme":"","node.content.parameters":"","node.content.advancedMode":"","node.content.numberOfScenes":"","node.content.numberOfScenes.auto":"","node.content.detailedPlot":"","node.content.detailedPlotInfo":"","node.content.includeSubscribeScene":"","node.content.includeSubscribeSceneInfo":"","node.content.genre":"","node.content.genre2":" 2","node.content.breakIntoParagraphs":"","node.content.copyVideoPrompt":"","node.content.generateVideoPrompt":"","node.content.model":"","node.content.processWholeScene":"","node.content.processWholeSceneInfo":"","node.content.batchProcessing":"","node.content.batchProcessingInfo":"","node.content.extendedAnalysis":"","node.content.extendedAnalysisInfo":"","node.content.professionalStoryboard":"","node.content.professionalStoryboardInfo":"","node.content.generateStartEndFrames":"/","node.content.autoIndexCharacters":"","node.content.autoIndexCharactersInfo":"","node.content.imageToText":"","node.content.extracting":"...","node.content.extractedText":"","node.content.activePromptStack":"","node.content.noCharactersAnalyzed":"","node.content.promptsGeneratedPlaceholder":"","node.content.noCharactersInScript":"","node.content.noInputScenes":"","node.content.status":"","node.content.status.ready":"","node.content.status.paused":"","node.content.status.generating":"","node.content.status.total":"{generated} / {total}","node.content.status.batch":"{current} / {total}","node.content.status.time":"{current} / {total}","node.content.refreshing":"...","node.content.totalFrames":"{count}","node.content.uploadAudio":"/","node.content.noAudioLoaded":"","node.content.audioLoaded":"","node.content.transcriptionPlaceholder":"...","node.content.transcribe":"","node.content.transcribing":"...","node.content.convertingVideo":"...","node.content.recommendedFrames":"","node.content.shotType":"","node.content.shotType.ws":"WS ()","node.content.shotType.ms":"MS ()","node.content.shotType.cu":"CU ()","node.content.shotType.ecu":"ECU ()","node.content.shotType.ls":"LS ()","node.content.characterDetail":"","node.content.noCharDesc":"","node.content.includeGeneralCharDesc":"","node.content.includeFullCharDesc":"","node.content.safeGeneration":"","node.content.shotFilter":"","node.content.shotFilter.all":"","node.content.shotFilter.wideOnly":"","instruction.desc.shot_filter_all":" (WS, MS, CU, ECU, LS)","instruction.desc.shot_filter_wide":" (WS, MS, LS)","node.content.anthroEnabled":"","node.content.subscribeEnhancement":"","node.content.thinkingEnabled":"","node.content.scenelessMode":"","instruction.desc.sceneless_mode":"","instruction.sceneless_mode":"","node.content.microActionBreakdown":"","node.content.microActionBreakdownInfo":"","node.content.commercialSafe":"","instruction.desc.commercial_safe":"","node.content.findStack":"...","node.content.spm_stack.priming":"1. ","node.content.spm_stack.physics":"2. ","node.content.spm_stack.hierarchy":"3. ","node.content.spm_stack.construction":"4. "},nw={"genre.general":"","genre.comedy":"","genre.drama":"","genre.action":"","genre.scifi":"","genre.fantasy":"","genre.horror":"","genre.thriller":"","genre.childrens_animation":"","genre.shorts_story":" (Shorts)","genre.scientific_historical":"","character_generator.promptPlaceholder":"","idea_generator.randomTheme":"","idea_generator.randomCombination":"","idea_generator.themePlaceholder":"","idea_generator.initialMessage":"{buttonName}","idea_generator.ideaPlaceholder":"...","idea_generator.format.general":"","idea_generator.format.childrens":"","idea_generator.format.adventure":"","idea_generator.format.fantasy":" / ","idea_generator.format.detective":"","idea_generator.format.scifi":"","idea_generator.format.horror":"","idea_generator.format.historical":"","gender.male":"","gender.female":"","node.content.autoDownload":"","node.content.downloadSelected":"","node.content.intonation":"","intonation.standard":"","intonation.cheerful":"","intonation.angry":"","intonation.sad":"","intonation.excited":"","intonation.announcer":"","intonation.whispering":"","node.content.sceneMode":"","node.content.connectNarratorData":"","node.content.sceneModeActive":"","speech_synthesizer.mode.simple":"","speech_synthesizer.mode.scene":"","speech_synthesizer.multiSpeaker":"","speech_synthesizer.speaker1Name":" 1 ","speech_synthesizer.speaker2Name":" 2 ","speech_synthesizer.multiSpeakerHint":"......","speech_synthesizer.ssmlHint":" SSML ","youtube_analytics.authorName":"","youtube_analytics.videoTitle":"","youtube_analytics.views":"","youtube_analytics.addToChannel":"","youtube_analytics.noIncomingData":"","youtube_analytics.videoAdded":"","youtube_analytics.dragDrop":"","youtube_analytics.thumbnailUpdated":"","youtube_analytics.statsTrend":"","youtube_analytics.currentChannel":"","youtube_analytics.growth":"","youtube_analytics.allChannels":"","youtube_analytics.saveDisk":"","youtube_analytics.saveCatalog":"","youtube_analytics.loadDisk":"","youtube_analytics.analyzing":"...","youtube_analytics.askAI":" AI","youtube_analytics.clickForAdvice":" AI","youtube_analytics.dailyNotes":"","youtube_analytics.logDailyStats":"","youtube_analytics.subscribers":"","youtube_analytics.totalViews":"","youtube_analytics.updateStats":"","youtube_analytics.history":"","youtube_analytics.noHistory":"","youtube_analytics.noNotes":"","youtube_analytics.noVideos":"","youtube_analytics.loadedFromDisk":"","youtube_analytics.loadFailed":"","youtube_analytics.savedToDisk":"","youtube_title_generator.mode.title":"","youtube_title_generator.mode.channel":"","youtube_title_generator.ideaPlaceholder":"...","youtube_title_generator.channelIdeaPlaceholder":"...","youtube_title_generator.title":"","youtube_title_generator.description":"","youtube_title_generator.tags":"","youtube_title_generator.channelName":"","youtube_title_generator.channelDescription":"","youtube_title_generator.channelKeywords":"","youtube_title_generator.channelHandle":" (@)","music_idea_generator.mode.lyrics":"","music_idea_generator.mode.music_prompt":"","music_idea_generator.ideaPlaceholder":"...","music_idea_generator.songTitle":"","music_idea_generator.songTitlePlaceholder":"...","music_idea_generator.lyricsPlaceholder":"...","music_idea_generator.musicPromptPlaceholder":"AI ...","chat.mode.general":"","chat.mode.script":"","chat.mode.prompt":"","chat.mode.youtube":"YouTube "},ow={"catalog.title":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.analysis":"","catalog.tabs.final_prompts":"","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"","catalog.empty.title":"","catalog.empty.description":"","catalog.loadFromFile":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","library.loadFromFile":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+)","group.button.create":" ({count})"},rw={"dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.label":"","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.reset.title":"","dialog.reset.message":"","dialog.exit.title":"","dialog.exit.message":"","dialog.settings.title":"","dialog.settings.apiKeyLabel":"Gemini API ","dialog.settings.apiKeyPlaceholder":"","dialog.settings.getApiKeyLink":" Google AI Studio  API ","dialog.settings.useFreeKey":" () ","dialog.settings.save":"","dialog.settings.close":"","dialog.apiKey.title":"API ","dialog.apiKey.description":" Gemini API ","dialog.apiKey.keyExists":"API ","dialog.apiKey.clear":"","dialog.apiKey.save":"","dialog.apiKey.update":"","dialog.apiKey.useFreeKey":" ()","dialog.permission.title":"","dialog.permission.description":"","dialog.permission.decline":"","dialog.permission.allow":"","alert.groupSaved":' "{groupTitle}" ',"toast.groupSavedToDisk":' "{groupTitle}" ',"alert.confirmDelete":"","alert.invalidCatalogFile":"","alert.loadCatalogFailed":"","alert.confirmLoadProject":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":' "{itemName}" ',"dialog.confirmDelete.folderMessage":' "{itemName}" ',"dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmClear.title":"","dialog.confirmClear.message":"","toast.copied":"","toast.pasted":"","toast.cleared":"","toast.resetComplete":"","toast.projectSaved":"","toast.saveFailed":"","toast.connectionsCut":"","toast.charSaved":"","toast.charLoaded":"","toast.videoPasted":"","toast.savedToCatalog":"","toast.apiKeySaved":"API ","toast.apiKeyCleared":"API ","toast.projectLoaded":"","alert.batchMismatch":" {scene} "},aw={"instruction.desc.safe_gen":" AI  'teenager', 'intimate'  'revealing'  'young person', 'artistic composition'  'stylized' ","instruction.desc.layered_no_style":"1. [ ( ->  -> )] -> 2. [ ( ->  -> )] -> 3. []"},iw={"instruction.sg_inputs":"","instruction.desc.sg_inputs":"/","instruction.core_director":"","instruction.desc.core_director":"","instruction.sg_thinking":"","instruction.desc.sg_thinking":"","instruction.sg_improve_input":"","instruction.desc.sg_improve_input":"","instruction.sg_exposition":"","instruction.desc.sg_exposition":"","instruction.sg_delayed_reveal":"","instruction.desc.sg_delayed_reveal":" ->  ->  -> ","instruction.sg_metaphor":"","instruction.desc.sg_metaphor":"","instruction.sg_pacing":"","instruction.desc.sg_pacing":"","instruction.sg_subtext":"","instruction.desc.sg_subtext":"","instruction.desc.sg_frame_estimation":"","instruction.rule_visuals":"","instruction.desc.rule_visuals":" '' ''","instruction.sg_visual_dna":" DNA","instruction.desc.sg_visual_dna":" LookDev ","instruction.rule_flow":"","instruction.desc.rule_flow":"","instruction.rule_atmosphere":"","instruction.desc.rule_atmosphere":"","instruction.sg_visual_style":"","instruction.desc.sg_visual_style":" '{style}' ","instruction.char_detailed_style":"","instruction.desc.char_detailed_style":"","instruction.sg_genre":"","instruction.desc.sg_genre":"{genre}","instruction.char_smart_concept":"","instruction.desc.char_smart_concept":"AI  / ","instruction.char_no_dupes":"","instruction.desc.char_no_dupes":"","instruction.create_secondary_chars":"","instruction.desc.create_secondary_chars":"","instruction.create_key_items":"","instruction.desc.create_key_items":" >2  ''","instruction.char_secondary_ok":"","instruction.desc.char_secondary_ok":"","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"","instruction.sg_no_chars":"","instruction.desc.sg_no_chars":" / ","instruction.sg_detailed_plot":"","instruction.desc.sg_detailed_plot":"","instruction.sg_subscribe":"","instruction.desc.sg_subscribe":"","instruction.char_gray_bg":"","instruction.desc.char_gray_bg":"', full body character concept on a gray background'","instruction.char_no_new":"","instruction.desc.char_no_new":"","instruction.sg_new_chars":"","instruction.desc.sg_new_chars":"","instruction.sg_living_world":"","instruction.desc.sg_living_world_simple":"","instruction.desc.sg_living_world_anthro":"","instruction.sg_simple_actions":"","instruction.desc.sg_simple_actions":"/","instruction.commercial_safe":"","instruction.desc.commercial_safe":" (Disney, Pixar ) "},sw={"instruction.ana_role":"","instruction.desc.ana_role":" AI ","instruction.ana_cinema":"","instruction.desc.ana_cinema":"Wide Shot, Close-up, Dutch Angle, Bokeh","instruction.ana_cinema_wide":" ()","instruction.desc.ana_cinema_wide":"Wide Shot, Long Shot. ","instruction.ana_anthro_logic":"Anthro ","instruction.desc.ana_anthro_logic":"","instruction.ana_subscribe_logic":"","instruction.desc.ana_subscribe_logic":" 3D ","instruction.rule_hierarchy":"","instruction.desc.rule_hierarchy":"1.  (/)2. 3. 4. ","instruction.rule_living_world":"","instruction.desc.rule_living_world":"","instruction.desc.rule_living_world_anthro":" ()","instruction.rule_persistence":"","instruction.desc.rule_persistence":"","instruction.rule_mandatory_bg":"","instruction.desc.rule_mandatory_bg":"","instruction.desc.rule_mandatory_bg_wide":"","instruction.shot_filter_wide":"","instruction.desc.shot_filter_wide":" Wide, Long,  Medium  Close-up (CU/ECU)","instruction.storyboard_rules":"","instruction.desc.storyboard_rules":" WS/LS, MS  CU/ECU ","instruction.storyboard_rules_wide":" ()","instruction.desc.storyboard_rules_wide":" Wide, Long  Establishing","instruction.tech_directives":"","instruction.desc.tech_directives":" (WS, MS, CU)","instruction.tech_directives_wide":" ()","instruction.desc.tech_directives_wide":" WS, MS, LS CU/ECU","instruction.use_aliases":"","instruction.desc.use_aliases":" Character-N ","instruction.action_phase_breakdown":"","instruction.desc.action_phase_breakdown":"","instruction.desc.action_phase_breakdown_wide":"","instruction.batch_processing":"","instruction.desc.batch_processing":"","instruction.ana_prompt_lang":"","instruction.desc.ana_prompt_lang":"","instruction.extended_visuals":"","instruction.desc.extended_visuals":" (Wide, MS, CU, Detail)","instruction.extended_visuals_wide":" ()","instruction.desc.extended_visuals_wide":"/","instruction.desc.target_lang":"","instruction.rule_isolation":"","instruction.desc.rule_isolation":"","instruction.sensory_saturation":"","instruction.desc.sensory_saturation":"","instruction.ana_no_pov":" POV","instruction.desc.ana_no_pov":' "POV"  ""  (, )',"instruction.desc.static_frame_logic":' ("walking")',"instruction.desc.anatomical_posing":"","instruction.desc.motion_dynamics":"Image Prompt = 100% Video Prompt = ","instruction.desc.anatomical_strictness":' "" [] []',"instruction.desc.prop_consistency":' ("") ("") ',"instruction.desc.subject_hierarchy":"1. /2. 3. ","instruction.inputs_data":"","instruction.desc.inputs_data":""},lw={"instruction.inputs":"","instruction.desc.inputs":"","instruction.role":"","instruction.desc.role":"","instruction.layered":"","instruction.desc.layered":"[] -> [] -> [] + [] -> []","instruction.desc.layered_no_char":"[] -> []","instruction.visuals":"","instruction.desc.visuals":"8k ","instruction.process_whole_scene":"","instruction.desc.process_whole_scene":"","instruction.video":"","instruction.desc.video":"[] () [][][]","instruction.stateless":"","instruction.desc.stateless":"","instruction.rule_static":"","instruction.desc.rule_static":"","instruction.atmosphere_fix":"","instruction.desc.atmosphere_fix":"","instruction.subject_focus":"","instruction.desc.subject_focus":"1. 2. 3. AI ","instruction.always_env":"","instruction.desc.always_env":"","instruction.pm_anthro":"Anthro ","instruction.desc.pm_anthro":' "anthropomorphic" /',"instruction.pm_subscribe":"","instruction.desc.pm_subscribe":' "SUBSCRIBE"  ()',"instruction.strict_char_index":"","instruction.desc.strict_char_index":" (Character-N) ","instruction.no_names":"","instruction.desc.no_names":" ID `[Character-N]`","instruction.general_char_desc":"","instruction.desc.general_char_desc":"","instruction.full_char_desc":"","instruction.desc.full_char_desc":"","instruction.formatting":"","instruction.desc.formatting":"","instruction.anatomical_strictness":"","instruction.desc.anatomical_strictness":' ""',"instruction.img_vid_consistency":"->","instruction.desc.img_vid_consistency":"Image Prompt = /Video Prompt = /","instruction.desc.prop_enhancement":' ( "" -> "")',"instruction.no_pov":" POV","instruction.desc.no_pov":" POV  ()"},cw={"instruction.music_role":"","instruction.desc.music_role":"","instruction.music_input":"","instruction.desc.music_input":"","instruction.music_creative":"","instruction.desc.music_creative":" AI ","instruction.music_lyrics":"","instruction.desc.music_lyrics":"/","instruction.music_prompt_rule":"AI ","instruction.desc.music_prompt_rule":"Suno/Udio  (BPM, , ) 1000 ","instruction.music_format":"JSON ","instruction.desc.music_format":" JSON "},dw={"instruction.yt_role":"YouTube ","instruction.desc.yt_role":"SEO, CTR ","instruction.yt_input":"","instruction.desc.yt_input":"","instruction.yt_title_mode":"","instruction.desc.yt_title_mode":"//","instruction.yt_channel_mode":"","instruction.desc.yt_channel_mode":"","instruction.yt_format":"JSON ","instruction.desc.yt_format":" JSON "},uw={...aw,...iw,...sw,...lw,...cw,...dw},pw={...Qb,...ew,...tw,...nw,...ow,...rw,...uw},Td={en:h1,ru:k1,es:H1,uz:J1,de:db,fr:Sb,it:Fb,pt:Zb,zh:pw,sys:{}},jl=[{code:"en",name:"English",englishName:"English",label:"EN"},{code:"ru",name:"",englishName:"Russian",label:"RU"},{code:"es",name:"Espaol",englishName:"Spanish",label:"ES"},{code:"de",name:"Deutsch",englishName:"German",label:"DE"},{code:"fr",name:"Franais",englishName:"French",label:"FR"},{code:"it",name:"Italiano",englishName:"Italian",label:"IT"},{code:"pt",name:"Portugus",englishName:"Portuguese",label:"PT"},{code:"uz",name:"Ozbek",englishName:"Uzbek",label:"UZ"},{code:"zh",name:"",englishName:"Chinese",label:"ZH"},{code:"sys",name:"System (Keys)",englishName:"System",label:"SYS"}],hw=Object.keys(Td),Mf=x.createContext(void 0),Bt=()=>{const e=x.useContext(Mf);if(e===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return e},mw=(e,t,n)=>{if(e==="sys")return t;const r=Td[e],a=Td.en;let i=(r==null?void 0:r[t])||a[t]||t;return n&&typeof i=="string"&&Object.keys(n).forEach(s=>{i=i.replace(`{${s}}`,String(n[s]))}),i},Ci=(e,t)=>{const n={[C.SCRIPT_GENERATOR]:680,[C.SCRIPT_ANALYZER]:680,[C.SCRIPT_PROMPT_MODIFIER]:680,[C.CHARACTER_GENERATOR]:680,[C.CHARACTER_ANALYZER]:460,[C.CHARACTER_CARD]:460,[C.TEXT_INPUT]:460,[C.PROMPT_PROCESSOR]:460,[C.PROMPT_ANALYZER]:460,[C.IMAGE_GENERATOR]:400,[C.IMAGE_PREVIEW]:300,[C.GEMINI_CHAT]:400,[C.TRANSLATOR]:380,[C.ERROR_ANALYZER]:380,[C.NOTE]:440,[C.DATA_READER]:380,[C.SPEECH_SYNTHESIZER]:680,[C.NARRATOR_TEXT_GENERATOR]:680,[C.IDEA_GENERATOR]:680,[C.AUDIO_TRANSCRIBER]:400,[C.YOUTUBE_TITLE_GENERATOR]:680,[C.MUSIC_IDEA_GENERATOR]:680,[C.YOUTUBE_ANALYTICS]:680,[C.IMAGE_EDITOR]:800,[C.REROUTE_DOT]:60},r={[C.SCRIPT_GENERATOR]:800,[C.SCRIPT_ANALYZER]:800,[C.SCRIPT_PROMPT_MODIFIER]:800,[C.CHARACTER_GENERATOR]:800,[C.CHARACTER_ANALYZER]:500,[C.CHARACTER_CARD]:1e3,[C.TEXT_INPUT]:280,[C.PROMPT_PROCESSOR]:280,[C.PROMPT_ANALYZER]:1e3,[C.IMAGE_GENERATOR]:520,[C.IMAGE_PREVIEW]:340,[C.GEMINI_CHAT]:640,[C.TRANSLATOR]:640,[C.ERROR_ANALYZER]:280,[C.NOTE]:640,[C.DATA_READER]:280,[C.SPEECH_SYNTHESIZER]:800,[C.NARRATOR_TEXT_GENERATOR]:800,[C.IDEA_GENERATOR]:800,[C.AUDIO_TRANSCRIBER]:480,[C.YOUTUBE_TITLE_GENERATOR]:800,[C.MUSIC_IDEA_GENERATOR]:800,[C.YOUTUBE_ANALYTICS]:800,[C.IMAGE_EDITOR]:600,[C.REROUTE_DOT]:40};let a="";return e===C.MUSIC_IDEA_GENERATOR?a=JSON.stringify({generateLyrics:!0,verseCount:2,idea:"",targetLanguages:{ru:!0,en:!1},generatedLyrics:{},generatedMusicPrompts:{},generatedTitles:{},model:"gemini-3-flash-preview"}):e===C.YOUTUBE_TITLE_GENERATOR?a=JSON.stringify({mode:"title",idea:"",targetLanguages:{ru:!0,en:!1},generatedTitleOutputs:{},generatedChannelOutputs:{}}):e===C.YOUTUBE_ANALYTICS?a=JSON.stringify({channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}],activeChannelId:"default"}):e===C.SCRIPT_GENERATOR&&(a=JSON.stringify({prompt:"",scenes:[],detailedCharacters:[]})),{width:n[e]||200,height:r[e]||150,title:t(`node.title.${e.toLowerCase()}`),value:a}},gw=(e,t)=>{const[n,r]=x.useState(e),a=x.useRef(t),i=x.useCallback((y,b,S,_,v)=>{a.current+=1;const f=`node-${a.current}-${Date.now()}`,T=Ci(y,S),A={id:f,type:y,position:b,title:v||T.title,value:_||T.value,width:T.width,height:T.height};return r(I=>[...I,A]),f},[]),s=x.useCallback(y=>{r(b=>b.filter(S=>S.id!==y))},[]),l=x.useCallback((y,b)=>{r(S=>S.map(_=>_.id===y?{..._,value:b}:_))},[]),c=x.useCallback(y=>{const b=n.find(S=>S.id===y);b&&navigator.clipboard.writeText(b.value)},[n]),d=x.useCallback(async y=>{try{const b=await navigator.clipboard.readText();r(S=>S.map(_=>_.id===y?{..._,value:b}:_))}catch(b){console.error(b)}},[]),h=x.useCallback(y=>{r(b=>b.map(S=>S.id===y?{...S,isCollapsed:!S.isCollapsed}:S))},[]),g=x.useCallback(y=>{const b=n.find(v=>v.id===y);if(!b)return"";a.current+=1;const S=`node-${a.current}-${Date.now()}`,_={...b,id:S,position:{x:b.position.x+50,y:b.position.y+50}};return r(v=>[...v,_]),S},[n]),m=x.useCallback((y,b)=>{const S=n.find(T=>T.id===y);if(!S)return"";a.current+=1;const _=`node-${a.current}-${Date.now()}`,v=Ci(S.type,b),f={...S,id:_,position:{x:S.position.x+50,y:S.position.y+50},value:v.value,title:S.title};return r(T=>[...T,f]),_},[n]),w=x.useCallback(y=>{r(b=>b.map(S=>S.id===y?{...S,areOutputHandlesHidden:!S.areOutputHandlesHidden}:S))},[]);return{nodes:n,setNodes:r,nodeIdCounter:a,handleAddNode:i,handleDeleteNode:s,handleValueChange:l,handleCopyNodeValue:c,handlePasteNodeValue:d,handleToggleNodeCollapse:h,handleDuplicateNode:g,handleDuplicateNodeEmpty:m,handleToggleNodeOutputVisibility:w}},fw=e=>{const[t,n]=x.useState(()=>e.map((s,l)=>({...s,id:s.id||`initial-conn-${Date.now()}-${l}`}))),r=x.useCallback(s=>{n(l=>{if(l.some(d=>d.fromNodeId===s.fromNodeId&&d.toNodeId===s.toNodeId&&d.fromHandleId===s.fromHandleId))return l;const c={...s,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return[...l,c]})},[]),a=x.useCallback(s=>{n(l=>l.filter(c=>c.fromNodeId!==s&&c.toNodeId!==s))},[]),i=x.useCallback(s=>{n(l=>l.filter(c=>c.id!==s))},[]);return{connections:t,setConnections:n,addConnection:r,removeConnectionsByNodeId:a,removeConnectionById:i}},yw=(e={scale:1,translate:{x:0,y:0}})=>{const[t,n]=x.useState(e),[r,a]=x.useState(null),[i,s]=x.useState({x:0,y:0}),[l,c]=x.useState({x:0,y:0}),d=x.useCallback((v,f)=>{const T=Math.max(.2,Math.min(v,2)),A=(f.x-t.translate.x)/t.scale,I=(f.y-t.translate.y)/t.scale,M=f.x-A*T,N=f.y-I*T;n({scale:T,translate:{x:M,y:N}})},[t.scale,t.translate.x,t.translate.y,n]),h=x.useCallback(v=>{v.preventDefault();const f=1.1,T=v.deltaY<0?t.scale*f:t.scale/f;d(T,{x:v.clientX,y:v.clientY})},[t.scale,d]),g=x.useCallback(v=>{a({startPoint:{x:v.clientX,y:v.clientY},startTranslate:t.translate})},[t.translate]),m=x.useCallback(()=>a(null),[]),w=x.useCallback(v=>{if(!r||r.initialDistance)return;const f=v.clientX-r.startPoint.x,T=v.clientY-r.startPoint.y;n(A=>({...A,translate:{x:r.startTranslate.x+f,y:r.startTranslate.y+T}}))},[r,n]),y=x.useCallback(v=>{const f={x:(v.clientX-t.translate.x)/t.scale,y:(v.clientY-t.translate.y)/t.scale};s(f),c({x:v.clientX,y:v.clientY})},[t]),b=x.useCallback(v=>{if(v.preventDefault(),v.touches.length===1)a({startPoint:{x:v.touches[0].clientX,y:v.touches[0].clientY},startTranslate:t.translate});else if(v.touches.length===2){const f=Math.hypot(v.touches[0].clientX-v.touches[1].clientX,v.touches[0].clientY-v.touches[1].clientY),T={x:(v.touches[0].clientX+v.touches[1].clientX)/2,y:(v.touches[0].clientY+v.touches[1].clientY)/2};a({startPoint:T,startTranslate:t.translate,initialDistance:f,initialScale:t.scale})}},[t.translate,t.scale]),S=x.useCallback(v=>{if(v.preventDefault(),!!r){if(v.touches.length===1&&r.initialDistance===void 0){const f=v.touches[0].clientX-r.startPoint.x,T=v.touches[0].clientY-r.startPoint.y;n(A=>({...A,translate:{x:r.startTranslate.x+f,y:r.startTranslate.y+T}}))}else if(v.touches.length===2&&r.initialDistance!==void 0&&r.initialScale!==void 0){const f=Math.hypot(v.touches[0].clientX-v.touches[1].clientX,v.touches[0].clientY-v.touches[1].clientY),T={x:(v.touches[0].clientX+v.touches[1].clientX)/2,y:(v.touches[0].clientY+v.touches[1].clientY)/2},A=f/r.initialDistance*r.initialScale,I=Math.max(.2,Math.min(A,2)),M=(r.startPoint.x-r.startTranslate.x)/r.initialScale,N=(r.startPoint.y-r.startTranslate.y)/r.initialScale,k=T.x-M*I,E=T.y-N*I;n({scale:I,translate:{x:k,y:E}})}}},[r,n]),_=x.useCallback(v=>{v.touches.length===1?a({startPoint:{x:v.touches[0].clientX,y:v.touches[0].clientY},startTranslate:t.translate}):a(null)},[t.translate]);return{viewTransform:t,setViewTransform:n,isPanning:r,pointerPosition:i,clientPointerPosition:l,handleWheel:h,startPanning:g,stopPanning:m,pan:w,updatePointerPosition:y,setZoom:d,handleCanvasTouchStart:b,handleCanvasTouchMove:S,handleCanvasTouchEnd:_}},xw=({nodes:e,connections:t,groups:n,viewTransform:r,nodeIdCounter:a,setNodes:i,setConnections:s,setGroups:l,setViewTransform:c,activeTabName:d,onLoadProject:h,addToast:g,setGlobalError:m,onAddNode:w,handleAddGroupFromTemplate:y})=>{const b=x.useRef(null),{t:S}=Bt(),_=x.useCallback(()=>{try{const A={type:"script-modifier-canvas",nodes:e,connections:t,groups:n,viewTransform:r,nodeIdCounter:a.current},I=JSON.stringify(A,null,2),M=new Blob([I],{type:"application/json"}),N=URL.createObjectURL(M),k=document.createElement("a"),E=new Date,P=E.getFullYear(),L=String(E.getMonth()+1).padStart(2,"0"),H=String(E.getDate()).padStart(2,"0"),$=String(E.getHours()).padStart(2,"0"),U=String(E.getMinutes()).padStart(2,"0"),O=String(E.getSeconds()).padStart(2,"0"),D=`${P}-${L}-${H}_${$}-${U}-${O}`,z=d.replace(/ /g,"_").replace(/[^a-zA-Z0-9_.-]/g,"");return k.href=N,k.download=`Script-Modifier-${z}-${D}.json`,k.click(),URL.revokeObjectURL(N),k.remove(),null}catch(A){return console.error("Failed to save canvas:",A),"Could not save canvas state."}},[e,t,n,r,a,d]),v=x.useCallback(()=>{var A;(A=b.current)==null||A.click()},[]),f=x.useCallback(A=>{var I,M;try{if(!A)throw new Error("File content is empty.");let N;try{N=JSON.parse(A)}catch{throw new Error("Invalid JSON format.")}if(N.type==="prompt-modifier-canvas"||N.type==="prompt-modifier-project"){m(S("error.promptModifierFile"));return}if(N.type==="script-modifier-project"){if(h){h(N);return}return}if((N.type==="scriptModifierGroup"||N.type==="group")&&y){const P={x:(-r.translate.x+window.innerWidth/2)/r.scale,y:(-r.translate.y+window.innerHeight/2)/r.scale};y(N,P),g(S("toast.pasted"),"success");return}if(N.type&&w){const P={x:(-r.translate.x+window.innerWidth/2)/r.scale,y:(-r.translate.y+window.innerHeight/2)/r.scale};let L=null,H=N;switch(N.type){case"script-generator-data":L=C.SCRIPT_GENERATOR,H={scenes:N.scenes};break;case"script-analyzer-data":L=C.SCRIPT_ANALYZER,H={scenes:N.scenes};break;case"script-prompt-modifier-data":L=C.SCRIPT_PROMPT_MODIFIER,H={finalPrompts:N.finalPrompts};break;case"youtube-title-data":L=C.YOUTUBE_TITLE_GENERATOR;break;case"youtube-analytics-data":L=C.YOUTUBE_ANALYTICS;break;case"music-idea-data":L=C.MUSIC_IDEA_GENERATOR;break;case"character-generator-data":L=C.CHARACTER_GENERATOR,H={characters:N.characters};break;case"character-card":L=C.CHARACTER_CARD;break}if(L){w(L,P,JSON.stringify(H),N.title),g(S("toast.pasted"),"success");return}}const k=N.type==="script-modifier-canvas",E=!N.type&&Array.isArray(N.nodes)&&Array.isArray(N.connections);if(!k&&!E)throw new Error(S("error.invalidFileType"));if(Array.isArray(N.nodes)&&Array.isArray(N.connections)&&((I=N.viewTransform)!=null&&I.scale)&&((M=N.viewTransform)!=null&&M.translate)&&typeof N.nodeIdCounter=="number"){i(N.nodes);const P=N.connections.map((L,H)=>({...L,id:L.id||`loaded-conn-${Date.now()}-${H}`}));s(P),l(N.groups||[]),c(N.viewTransform),a.current=N.nodeIdCounter,g(S("toast.canvasLoaded"),"success")}else throw new Error(S("error.invalidFileType"))}catch(N){N.message===S("error.invalidFileType")||N.message===S("error.promptModifierFile")?m(N.message):m(`${S("error.fileReadError")}: ${N.message}`)}},[a,s,l,i,c,h,g,m,S,y,r,w]),T=x.useCallback(A=>{var N;const I=(N=A.target.files)==null?void 0:N[0];if(!I)return;const M=new FileReader;M.onload=k=>{var P;const E=(P=k.target)==null?void 0:P.result;E&&f(E),A.target&&(A.target.value="")},M.readAsText(I)},[f]);return{fileInputRef:b,handleSaveCanvas:_,handleLoadCanvas:v,handleFileChange:T,loadStateFromFileContent:f}},vw=e=>{const[t,n]=x.useState(e),r=x.useRef(0),a=x.useCallback((s,l)=>{if(s.length===0)return;let c=1/0,d=1/0,h=-1/0,g=-1/0;s.forEach(b=>{c=Math.min(c,b.position.x),d=Math.min(d,b.position.y),h=Math.max(h,b.position.x+b.width);const S=b.isCollapsed?40:b.height;g=Math.max(g,b.position.y+S)});const m=30,w=70;r.current++;const y={id:`group-${r.current}-${Date.now()}`,title:l||`Group ${r.current}`,position:{x:c-m,y:d-w},width:h-c+m*2,height:g-d+w+m,nodeIds:s.map(b=>b.id)};n(b=>[...b,y])},[]),i=x.useCallback(s=>{n(l=>l.filter(c=>c.id!==s))},[]);return{groups:t,setGroups:n,addGroup:a,removeGroup:i}},jr=420,Oo={"1:1":1,"16:9":2,"9:16":3},Ga=(e,t)=>{switch(e.type){case C.TEXT_INPUT:case C.PROMPT_PROCESSOR:case C.TRANSLATOR:case C.PROMPT_ANALYZER:case C.CHARACTER_ANALYZER:case C.CHARACTER_GENERATOR:case C.SCRIPT_GENERATOR:case C.SCRIPT_ANALYZER:case C.SCRIPT_PROMPT_MODIFIER:case C.ERROR_ANALYZER:case C.CHARACTER_CARD:case C.NARRATOR_TEXT_GENERATOR:case C.IDEA_GENERATOR:case C.AUDIO_TRANSCRIBER:case C.YOUTUBE_TITLE_GENERATOR:case C.MUSIC_IDEA_GENERATOR:case C.YOUTUBE_ANALYTICS:return"text";case C.IMAGE_GENERATOR:return"image";case C.REROUTE_DOT:try{return JSON.parse(e.value||"{}").type||null}catch{return null}default:return null}},Kr=(e,t)=>{switch(e.type){case C.PROMPT_PROCESSOR:case C.TRANSLATOR:case C.PROMPT_ANALYZER:case C.CHARACTER_ANALYZER:case C.CHARACTER_GENERATOR:case C.IMAGE_GENERATOR:case C.SCRIPT_GENERATOR:case C.SCRIPT_ANALYZER:case C.SCRIPT_PROMPT_MODIFIER:case C.ERROR_ANALYZER:case C.DATA_READER:case C.SPEECH_SYNTHESIZER:case C.NARRATOR_TEXT_GENERATOR:case C.YOUTUBE_TITLE_GENERATOR:case C.MUSIC_IDEA_GENERATOR:case C.YOUTUBE_ANALYTICS:return"text";case C.IMAGE_PREVIEW:return"image";case C.REROUTE_DOT:return null;default:return null}},In=20,Gs=40,_h=(e,t)=>e.map(n=>{const r=t.filter(y=>n.nodeIds.includes(y.id));if(r.length===0)return n;const a=30,i=70;let s=1/0,l=1/0,c=-1/0,d=-1/0;r.forEach(y=>{s=Math.min(s,y.position.x),l=Math.min(l,y.position.y),c=Math.max(c,y.position.x+y.width);const b=y.isCollapsed?Gs:y.height;d=Math.max(d,y.position.y+b)});const h=s-a,g=l-i,m=c-s+a*2,w=d-l+i+a;return n.position.x===h&&n.position.y===g&&n.width===m&&n.height===w?n:{...n,position:{x:h,y:g},width:m,height:w}}),bw=({nodes:e,setNodes:t,groups:n,setGroups:r,addConnection:a,connections:i,setConnections:s,viewTransform:l,updatePointerPosition:c,pan:d,isPanning:h,startPanning:g,stopPanning:m,isSnapToGrid:w,onAddNode:y,removeConnectionsByNodeId:b,setZoom:S,triggerClearSelections:_,t:v,clientPointerPosition:f,clientPointerPositionRef:T,handleExtractNodeFromGroup:A,isQuickAddOpen:I,handleCloseAddNodeMenus:M,openRadialMenu:N,onConnectionReleased:k})=>{const[E,P]=x.useState("edit"),[L,H]=x.useState(null),[$,U]=x.useState(null),[O,D]=x.useState(null),[z,G]=x.useState(null),[F,K]=x.useState(null),[ae,Y]=x.useState([]),[ge,W]=x.useState(null),[le,X]=x.useState(null),[Te,pe]=x.useState(!1),[ue,Oe]=x.useState(!1),[he,ye]=x.useState(!1),[j,q]=x.useState(!1),[Q,J]=x.useState(null),[oe,B]=x.useState(null),fe=x.useRef(e);x.useEffect(()=>{fe.current=e},[e]);const ie=x.useCallback(()=>{pe(!1),Oe(!1),ye(!1),q(!1),X(null),B(null)},[]);x.useEffect(()=>{const ne=_e=>{const Ie=_e.target;Ie.tagName==="INPUT"||Ie.tagName==="TEXTAREA"||(_e.key==="Shift"&&!_e.repeat&&pe(!0),_e.key==="Control"&&!_e.repeat&&Oe(!0),_e.key==="Alt"&&!_e.repeat&&ye(!0),_e.code==="KeyZ"&&!_e.repeat&&q(!0))},xe=_e=>{_e.key==="Shift"&&(pe(!1),le&&X(null)),_e.key==="Control"&&Oe(!1),_e.key==="Alt"&&(ye(!1),B(null)),_e.code==="KeyZ"&&q(!1)};return window.addEventListener("keydown",ne),window.addEventListener("keyup",xe),window.addEventListener("blur",ie),()=>{window.removeEventListener("keydown",ne),window.removeEventListener("keyup",xe),window.removeEventListener("blur",ie)}},[le,ie]);const Z=j?"zoom":E==="edit"?ue&&he?"reroute":ue?"cutter":Te?"selection":"edit":E;x.useEffect(()=>{if(O&&F){const ne=e.find(xe=>xe.id===F);if(ne&&ne.id!==O.fromNodeId){if(ne.type===C.SCRIPT_PROMPT_MODIFIER){const _e=Kr(ne);if(O.fromType===_e){J({nodeId:ne.id});return}}if(ne.type===C.REROUTE_DOT){i.some(Ie=>Ie.toNodeId===F)||J({nodeId:ne.id});return}const xe=Kr(ne);if(O.fromType&&O.fromType===xe){J({nodeId:ne.id,handleId:void 0});return}}}J(null)},[O,F,e,i]);const ee=x.useCallback(()=>{Y([]),_()},[_]),R=x.useCallback((ne,xe,_e,Ie)=>{if(I&&M(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;const me=ae.includes(ne);let Ee=[...ae];Ie||E==="selection"?me?Ee=Ee.filter(It=>It!==ne):Ee.push(ne):me||(Ee=[ne],_()),Y(Ee);const Ae=Ee.includes(ne)?Ee:[ne],Ke=new Map,mt=(xe-l.translate.x)/l.scale,Nt=(_e-l.translate.y)/l.scale;e.forEach(It=>{Ae.includes(It.id)&&Ke.set(It.id,{x:mt-It.position.x,y:Nt-It.position.y})}),H({type:"node",id:ne,offsets:Ke})},[I,M,Z,ae,E,_,l,e]),be=x.useCallback((ne,xe)=>{if(ne.altKey){ne.preventDefault(),ne.stopPropagation(),A(xe);return}ne.preventDefault(),ne.stopPropagation(),R(xe,ne.clientX,ne.clientY,ne.shiftKey)},[R,A]),Le=x.useCallback((ne,xe)=>{if(ne.stopPropagation(),ne.touches.length===1){const _e=ne.touches[0];R(xe,_e.clientX,_e.clientY,!1)}},[R]),je=x.useCallback((ne,xe)=>{if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;ne.preventDefault(),ne.stopPropagation();const _e=n.find(Ae=>Ae.id===xe);if(!_e)return;const Ie=new Map,me=(ne.clientX-l.translate.x)/l.scale,Ee=(ne.clientY-l.translate.y)/l.scale;Ie.set(xe,{x:me-_e.position.x,y:Ee-_e.position.y}),e.forEach(Ae=>{_e.nodeIds.includes(Ae.id)&&Ie.set(Ae.id,{x:me-Ae.position.x,y:Ee-Ae.position.y})}),H({type:"group",id:xe,offsets:Ie})},[e,n,l,Z]),Ue=x.useCallback((ne,xe)=>{if(ne.touches.length!==1)return;ne.stopPropagation();const _e=ne.touches[0];if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;const Ie=n.find(Ke=>Ke.id===xe);if(!Ie)return;const me=new Map,Ee=(_e.clientX-l.translate.x)/l.scale,Ae=(_e.clientY-l.translate.y)/l.scale;me.set(xe,{x:Ee-Ie.position.x,y:Ae-Ie.position.y}),e.forEach(Ke=>{Ie.nodeIds.includes(Ke.id)&&me.set(Ke.id,{x:Ee-Ke.position.x,y:Ae-Ke.position.y})}),H({type:"group",id:xe,offsets:me})},[e,n,l,Z]),Fe=x.useCallback((ne,xe)=>{if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;ne.preventDefault(),ne.stopPropagation(),document.activeElement instanceof HTMLElement&&document.activeElement.blur();const _e=e.find(Ie=>Ie.id===xe);_e&&U({nodeId:xe,startPosition:{x:ne.clientX,y:ne.clientY},startSize:{width:_e.width,height:_e.height}})},[e,Z]),ot=x.useCallback((ne,xe)=>{if(ne.touches.length!==1)return;ne.stopPropagation();const _e=ne.touches[0];if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;const Ie=e.find(me=>me.id===xe);Ie&&U({nodeId:xe,startPosition:{x:_e.clientX,y:_e.clientY},startSize:{width:Ie.width,height:Ie.height}})},[e,Z]),at=x.useCallback((ne,xe,_e)=>{if(Z!=="edit"&&Z!=="reroute")return;const Ie=e.find(Ae=>Ae.id===ne);if(!Ie)return;const me=Ga(Ie),Ee={x:(_e.left+_e.width/2-l.translate.x)/l.scale,y:(_e.top+_e.height/2-l.translate.y)/l.scale};D({fromNodeId:ne,fromPoint:Ee,fromHandleId:xe,fromType:me})},[Z,l,e]),rt=x.useCallback((ne,xe,_e)=>{ne.preventDefault(),ne.stopPropagation(),at(xe,_e,ne.currentTarget.getBoundingClientRect())},[at]),Ce=x.useCallback((ne,xe,_e)=>{ne.touches.length===1&&(ne.stopPropagation(),at(xe,_e,ne.currentTarget.getBoundingClientRect()))},[at]),ve=x.useCallback(ne=>{b(ne)},[b]),Ge=x.useCallback(ne=>({x:(ne.clientX-l.translate.x)/l.scale,y:(ne.clientY-l.translate.y)/l.scale}),[l.scale,l.translate.x,l.translate.y]),ce=x.useCallback(ne=>{if(I&&M(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),ne.target!==ne.currentTarget)return;if(ne.currentTarget.focus(),Z==="zoom"){ne.preventDefault(),ne.stopPropagation(),G({startX:ne.clientX,startScale:l.scale,pivot:{x:ne.clientX,y:ne.clientY}});return}const xe=Ge(ne);if(Z==="selection"){ne.preventDefault(),ne.stopPropagation();const _e=xe;X({start:_e,end:_e}),!ne.shiftKey&&E!=="selection"&&(Y([]),_())}else(Z==="edit"||Z==="cutter"||Z==="reroute")&&(ne.preventDefault(),ne.stopPropagation(),g(ne),Y([]),_())},[I,M,E,Te,Z,Ge,g,_,l.scale]),He=x.useCallback((ne,xe)=>{const _e=Math.min(ne.x,xe.x),Ie=Math.min(ne.y,xe.y),me=Math.abs(ne.x-xe.x),Ee=Math.abs(ne.y-xe.y);return{x:_e,y:Ie,width:me,height:Ee}},[]),V=(ne,xe)=>ne.x<xe.x+xe.width&&ne.x+ne.width>xe.x&&ne.y<xe.y+xe.height&&ne.y+ne.height>xe.y,re=x.useCallback(ne=>{if(c(ne),z){const xe=ne.clientX-z.startX,_e=Math.pow(1.005,xe),Ie=z.startScale*_e,me=z.pivot;S(Ie,me);return}if(h){d(ne);return}if(le){const xe=Ge(ne);X(_e=>_e?{..._e,end:xe}:null);return}if(L){const xe=(ne.clientX-l.translate.x)/l.scale,_e=(ne.clientY-l.translate.y)/l.scale;if(L.type==="node"){t(Ae=>{const Ke=Ae.map(mt=>{const Nt=L.offsets.get(mt.id);if(Nt){let It=xe-Nt.x,kt=_e-Nt.y;return w&&(It=Math.round(It/In)*In,kt=Math.round(kt/In)*In),{...mt,position:{x:It,y:kt}}}return mt});return r(mt=>_h(mt,Ke)),Ke});const Ie=L.id,me=e.find(Ae=>Ae.id===Ie),Ee=L.offsets.get(Ie);if(me&&Ee){const Ae={x:xe-Ee.x,y:_e-Ee.y},Ke=me.isCollapsed?Gs:me.height,mt={x:Ae.x+me.width/2,y:Ae.y+Ke/2};if(he){const Ve=n.find(qe=>qe.nodeIds.includes(Ie));if(Ve&&(mt.x<Ve.position.x||mt.x>Ve.position.x+Ve.width||mt.y<Ve.position.y||mt.y>Ve.position.y+Ve.height)){B(Ie),W(null);return}}B(null);let Nt=null;const It=me.width,kt=Ke,xt=It*.05,Dt=kt*.05,Mt=Ae.x+xt,hn=Ae.x+It-xt,an=Ae.y+Dt,we=Ae.y+kt-Dt;for(const Ve of n){if(Ve.nodeIds.includes(Ie))continue;const qe=Ve.position.x,it=Ve.position.x+Ve.width,lt=Ve.position.y,Lt=Ve.position.y+Ve.height;if(Mt<it&&hn>qe&&an<Lt&&we>lt){Nt=Ve.id;break}}W(Nt)}}else if(L.type==="group"){const Ie=L.offsets.get(L.id);if(Ie){let me=xe-Ie.x,Ee=_e-Ie.y;w&&(me=Math.round(me/In)*In,Ee=Math.round(Ee/In)*In),r(Ae=>Ae.map(Ke=>Ke.id===L.id?{...Ke,position:{x:me,y:Ee}}:Ke))}t(me=>me.map(Ee=>{const Ae=L.offsets.get(Ee.id);if(Ae){let Ke=xe-Ae.x,mt=_e-Ae.y;return w&&(Ke=Math.round(Ke/In)*In,mt=Math.round(mt/In)*In),{...Ee,position:{x:Ke,y:mt}}}return Ee}))}}else if($){const{nodeId:xe,startPosition:_e,startSize:Ie}=$,me=e.find(kt=>kt.id===xe);if(!me)return;let Ee=200,Ae=150;switch(me.type){case C.TEXT_INPUT:Ee=460,Ae=280;break;case C.PROMPT_PROCESSOR:Ee=460,Ae=280;break;case C.PROMPT_ANALYZER:Ee=460,Ae=1e3;break;case C.CHARACTER_ANALYZER:Ee=460,Ae=500;break;case C.CHARACTER_GENERATOR:Ee=680,Ae=800;break;case C.IMAGE_GENERATOR:Ee=400,Ae=520;break;case C.IMAGE_PREVIEW:Ee=300,Ae=340;break;case C.CHARACTER_CARD:Ee=460,Ae=1e3;break;case C.GEMINI_CHAT:Ee=400,Ae=640;break;case C.TRANSLATOR:Ee=380,Ae=640;break;case C.SCRIPT_GENERATOR:Ee=680,Ae=800;break;case C.SCRIPT_ANALYZER:Ee=680,Ae=800;break;case C.SCRIPT_PROMPT_MODIFIER:Ee=680,Ae=800;break;case C.ERROR_ANALYZER:Ee=380,Ae=280;break;case C.DATA_READER:Ee=380,Ae=280;break;case C.NOTE:Ee=440,Ae=640;break;case C.SPEECH_SYNTHESIZER:Ee=680,Ae=800;break;case C.NARRATOR_TEXT_GENERATOR:Ee=680,Ae=800;break;case C.IDEA_GENERATOR:Ee=680,Ae=800;break;case C.REROUTE_DOT:Ee=60,Ae=40;break;case C.AUDIO_TRANSCRIBER:Ee=400,Ae=480;break;case C.YOUTUBE_TITLE_GENERATOR:Ee=680,Ae=800;break;case C.YOUTUBE_ANALYTICS:Ee=680,Ae=800;break;default:Ee=200,Ae=150}const Ke=(ne.clientX-_e.x)/l.scale,mt=(ne.clientY-_e.y)/l.scale;let Nt=Math.max(Ee,Ie.width+Ke),It=Math.max(Ae,Ie.height+mt);w&&(Nt=Math.round(Nt/In)*In,It=Math.round(It/In)*In),t(kt=>{const xt=kt.map(Dt=>Dt.id===xe?{...Dt,width:Nt,height:It}:Dt);return r(Dt=>_h(Dt,xt)),xt})}},[L,$,l,d,c,t,r,e,n,le,Ge,w,S,h,z,he]),ze=x.useCallback(ne=>{if(z&&G(null),le){const xe=He(le.start,le.end);if(xe.width>5||xe.height>5){const _e=e.filter(Ie=>{const me=Ie.isCollapsed?Gs:Ie.height,Ee={x:Ie.position.x,y:Ie.position.y,width:Ie.width,height:me};return V(Ee,xe)}).map(Ie=>Ie.id);"shiftKey"in ne&&ne.shiftKey?Y(Ie=>Array.from(new Set([...Ie,..._e]))):Y(_e)}X(null)}if(O)if(Q){let xe={...Q};const _e=e.find(me=>me.id===Q.nodeId);if(_e&&_e.type===C.SCRIPT_GENERATOR){const me=_e.position.y*l.scale+l.translate.y,Ee=95*l.scale,Ae=330*l.scale,Ke=f.y-me,mt=(Ee+Ae)/2;Ke<mt?xe.handleId="prompt":xe.handleId="characters"}if(_e&&_e.type===C.SCRIPT_ANALYZER&&(xe.handleId=void 0),_e&&_e.type===C.SCRIPT_PROMPT_MODIFIER){const me=_e.position.y*l.scale+l.translate.y,Ee=_e.height*l.scale;f.y-me<Ee/2?xe.handleId="all-script-analyzer-data":xe.handleId="style"}let Ie=!0;if(_e&&_e.type===C.REROUTE_DOT&&(i.some(me=>me.toNodeId===_e.id)?Ie=!1:t(me=>me.map(Ee=>Ee.id===_e.id?{...Ee,value:JSON.stringify({type:O.fromType})}:Ee))),Ie){const me=e.find(Ee=>Ee.id===O.fromNodeId);if(me){const Ee={x:O.fromPoint.x-me.position.x,y:O.fromPoint.y-me.position.y};a({fromNodeId:O.fromNodeId,toNodeId:xe.nodeId,fromHandleId:O.fromHandleId,toHandleId:xe.handleId,fromPointOffset:Ee},me)}}}else{let xe,_e;"clientX"in ne?(xe=ne.clientX,_e=ne.clientY):"changedTouches"in ne&&ne.changedTouches.length>0&&(xe=ne.changedTouches[0].clientX,_e=ne.changedTouches[0].clientY),xe!==void 0&&_e!==void 0&&k(O,{x:xe,y:_e})}oe?(A(oe),B(null)):(L||$)&&r(xe=>{let _e=xe;const Ie=new Set;if(L&&ge){const me=Array.from(L.offsets.keys()),Ee=new Set(me);xe.forEach(Ke=>{Ke.nodeIds.some(mt=>Ee.has(mt))&&Ie.add(Ke.id)}),Ie.add(ge),_e=xe.map(Ke=>({...Ke,nodeIds:Ke.nodeIds.filter(mt=>!Ee.has(mt))}));const Ae=_e.find(Ke=>Ke.id===ge);Ae&&(Ae.nodeIds=[...new Set([...Ae.nodeIds,...me])])}else{if(L){const me=Array.from(L.offsets.keys());xe.forEach(Ee=>{Ee.nodeIds.some(Ae=>me.includes(Ae))&&Ie.add(Ee.id)})}if($){const me=$.nodeId,Ee=xe.find(Ae=>Ae.nodeIds.includes(me));Ee&&Ie.add(Ee.id)}}if(Ie.size>0){let me=[..._e];return Ie.forEach(Ee=>{const Ae=me.findIndex(Nt=>Nt.id===Ee);if(Ae===-1)return;const Ke=me[Ae],mt=fe.current.filter(Nt=>Ke.nodeIds.includes(Nt.id));if(mt.length>0){let kt=1/0,xt=1/0,Dt=-1/0,Mt=-1/0;mt.forEach(an=>{kt=Math.min(kt,an.position.x),xt=Math.min(xt,an.position.y),Dt=Math.max(Dt,an.position.x+an.width);const we=an.isCollapsed?Gs:an.height;Mt=Math.max(Mt,an.position.y+we)});const hn={...Ke,position:{x:kt-30,y:xt-70},width:Dt-kt+30*2,height:Mt-xt+70+30};me[Ae]=hn}else me=me.filter(Nt=>Nt.id!==Ee)}),me}return _e}),H(null),U(null),D(null),m(),W(null)},[z,le,He,e,O,Q,l,f.y,a,t,oe,A,L,$,r,n,ge,m,Y,i,k]);return x.useEffect(()=>{const ne=me=>re(me),xe=me=>ze(me),_e=me=>re(me.touches[0]),Ie=me=>ze(me.changedTouches[0]);return(L||$||O||h||z||le)&&(window.addEventListener("mousemove",ne),window.addEventListener("mouseup",xe),window.addEventListener("touchmove",_e),window.addEventListener("touchend",Ie)),()=>{window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",xe),window.removeEventListener("touchmove",_e),window.removeEventListener("touchend",Ie)}},[L,$,O,h,re,ze,z,le]),{activeTool:E,effectiveTool:Z,setActiveTool:P,draggingInfo:L,resizingInfo:$,connectingInfo:O,dollyZoomingInfo:z,hoveredNodeId:F,setHoveredNodeId:K,selectedNodeIds:ae,setSelectedNodeIds:Y,deselectAllNodes:ee,handleNodeMouseDown:be,handleGroupMouseDown:je,handleNodeResizeMouseDown:Fe,handleStartConnection:rt,handleNodeClick:ve,hoveredGroupIdForDrop:ge,handleCanvasMouseDown:ce,selectionRect:le,connectionTarget:Q,isAltDown:he,extractionTarget:oe,handleNodeTouchStart:Le,handleGroupTouchStart:Ue,handleNodeResizeTouchStart:ot,handleStartConnectionTouchStart:Ce}},ww=()=>{const[e,t]=x.useState(!1),[n,r]=x.useState(!1),[a,i]=x.useState({x:0,y:0}),[s,l]=x.useState(!1),[c,d]=x.useState(!1),[h,g]=x.useState({x:0,y:0}),[m,w]=x.useState(!1),[y,b]=x.useState({x:0,y:0}),[S,_]=x.useState(!1),[v,f]=x.useState(!1),[T,A]=x.useState(null),I=x.useCallback(D=>{d(!0),g(D)},[]),M=x.useCallback(()=>{d(!1)},[]),N=x.useCallback(D=>{w(!0),b(D)},[]),k=x.useCallback(()=>{w(!1)},[]),E=x.useCallback(()=>{_(D=>!D)},[]),P=x.useCallback(()=>{f(D=>!D)},[]),L=x.useCallback(D=>{t(!0),i(D)},[]),H=x.useCallback(D=>{r(!0),i(D)},[]),$=x.useCallback(()=>{t(!1),v||r(!1),M(),S||k()},[M,k,S,v]),U=x.useCallback(()=>l(D=>!D),[]),O=x.useCallback(()=>l(!1),[]);return{isQuickSearchOpen:e,isQuickAddOpen:n,quickAddPosition:a,openQuickSearchMenu:L,openQuickAddMenu:H,handleCloseAddNodeMenus:$,isCatalogOpen:s,handleToggleCatalog:U,handleCloseCatalog:O,isRadialMenuOpen:c,radialMenuPosition:h,openRadialMenu:I,closeRadialMenu:M,isContextMenuOpen:m,contextMenuPosition:y,openContextMenu:N,closeContextMenu:k,isContextMenuPinned:S,toggleContextMenuPin:E,isQuickAddPinned:v,toggleQuickAddPin:P,connectionMenu:T,setConnectionMenu:A}},Ch="group-catalog-items",Sh=[{id:"default-base-script-chain-1",type:Ze.GROUP,name:"Base Script Chain",parentId:null,category:"GROUP",nodes:[{id:"node-2-1761968471575",type:C.SCRIPT_GENERATOR,position:{x:0,y:0},value:'{"prompt":"","targetLanguage":"en","characterType":"simple","useExistingCharacters":false,"narratorEnabled":true,"narratorMode":"normal","summary":"","detailedCharacters":[],"scenes":[],"uiState":{"isSummaryCollapsed":false,"collapsedCharacters":[],"collapsedScenes":[]}}',title:" ",width:700,height:800},{id:"node-3-1761968527117",type:C.SCRIPT_ANALYZER,position:{x:780,y:0},value:'{"characters":[],"scenes":[],"targetLanguage":"en"}',title:" ",width:680,height:800},{id:"node-4-1761968532886",type:C.SCRIPT_PROMPT_MODIFIER,position:{x:1540,y:0},value:'{"finalPrompts":[],"targetLanguage":"en","startFrameNumber":null,"styleOverride":""}',title:" ",width:680,height:800}],connections:[{fromNodeId:"node-2-1761968471575",toNodeId:"node-3-1761968527117",fromHandleId:"all-script-parts",id:"conn-1761968530829-ctj2uh91t"},{fromNodeId:"node-3-1761968527117",toNodeId:"node-4-1761968532886",fromHandleId:"all-script-analyzer-data",toHandleId:"all-script-analyzer-data",id:"conn-1761968536068-rm7n9lqr1"}]}],Th=e=>{switch(e){case Ze.GROUP:return"groups";case Ze.CHARACTERS:return"characters";case Ze.SCRIPT:return"scripts";case Ze.ANALYSIS:return"analysis";case Ze.FINAL_PROMPTS:return"final_prompts";case Ze.YOUTUBE:return"youtube";case Ze.MUSIC:return"music";default:return"groups"}},_w=e=>{const[t,n]=x.useState(()=>{try{const N=localStorage.getItem(Ch);return N?JSON.parse(N):Sh}catch(N){return console.error("Failed to load group catalog from storage",N),Sh}}),[r,a]=x.useState([null]),[i,s]=x.useState(Ze.GROUP),l=x.useRef(null),c=r[r.length-1],d=N=>{try{localStorage.setItem(Ch,JSON.stringify(N))}catch(k){console.error("Failed to save group catalog to storage",k)}},h=x.useMemo(()=>{let N=t.filter(k=>k.parentId===c);return i&&(N=N.filter(k=>k.type===Ze.FOLDER?!k.category||k.category===i:k.type===i)),N.sort((k,E)=>k.type===E.type?k.name.localeCompare(E.name):k.type===Ze.FOLDER?-1:1)},[t,c,i]),g=x.useMemo(()=>{const N=[];let k=c;for(;k;){const E=t.find(P=>P.id===k&&P.type===Ze.FOLDER);if(E)N.push({id:E.id,name:E.name}),k=E.parentId;else break}return[{id:null,name:e("catalog.title")},...N.reverse()]},[c,t,e]),m=x.useCallback(N=>{const k=r.findIndex(E=>E===N);k>-1?a(E=>E.slice(0,k+1)):a(E=>[...E,N])},[r]),w=x.useCallback(()=>{a(N=>N.length>1?N.slice(0,-1):N)},[]),y=x.useCallback(N=>{if(N!==Ze.FOLDER)return;const k={id:`cat-item-${Date.now()}`,type:N,name:e("library.actions.newFolder"),parentId:c,category:i||void 0};n(E=>{const P=[...E,k];return d(P),P})},[c,e,i]),b=x.useCallback((N,k,E)=>{const P=k.filter(G=>N.nodeIds.includes(G.id));if(P.length===0)return;const L=new Set(P.map(G=>G.id)),H=E.filter(G=>L.has(G.fromNodeId)&&L.has(G.toNodeId)),$=JSON.parse(JSON.stringify(P)),U=JSON.parse(JSON.stringify(H)),O=Math.min(...$.map(G=>G.position.x)),D=Math.min(...$.map(G=>G.position.y));$.forEach(G=>{G.position.x-=O,G.position.y-=D});const z={id:`catalog-item-${Date.now()}`,type:Ze.GROUP,name:N.title,parentId:c,category:Ze.GROUP,nodes:$,connections:U};n(G=>{const F=[...G,z];return d(F),F})},[c]),S=x.useCallback((N,k,E)=>{const P={id:`catalog-item-${Date.now()}`,type:N,name:k,parentId:c,category:N,data:E};n(L=>{const H=[...L,P];return d(H),H})},[c]),_=x.useCallback((N,k)=>{!k||!k.trim()||n(E=>{const P=E.map(L=>L.id===N?{...L,name:k.trim()}:L);return d(P),P})},[]),v=x.useCallback(N=>{n(k=>{const E=new Set([N]),P=k.find(H=>H.id===N);if((P==null?void 0:P.type)===Ze.FOLDER){const H=[N];for(;H.length>0;){const $=H.shift();for(const U of k)U.parentId===$&&(E.add(U.id),U.type===Ze.FOLDER&&H.push(U.id))}}const L=k.filter(H=>!E.has(H.id));return d(L),L})},[]),f=x.useCallback(N=>{const k=t.find(K=>K.id===N);if(!k)return;let E;if(k.type===Ze.FOLDER){const K=ae=>{const Y=t.find(W=>W.id===ae);if(!Y)return null;const ge=t.filter(W=>W.parentId===ae);return{name:Y.name,type:"folder",category:Y.category,children:ge.map(W=>W.type===Ze.FOLDER?K(W.id):{...W,id:void 0,parentId:void 0,type:W.type===Ze.GROUP?"scriptModifierGroup":W.type})}};E=K(N)}else E={...k,id:void 0,parentId:void 0,type:k.type===Ze.GROUP?"scriptModifierGroup":k.type};const P=Th(k.category||k.type),H=JSON.stringify({appName:"Script_modifier",catalogContext:P,root:E},null,2),$=new Blob([H],{type:"application/json"}),U=URL.createObjectURL($),O=document.createElement("a");O.href=U;const z=new Date().toISOString().split("T")[0],G=k.name.replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_"),F=`Catalog_${P}_${G}_${z}.json`;O.download=F,O.click(),URL.revokeObjectURL(U),O.remove()},[t]),T=x.useCallback(N=>{var P;const k=(P=N.target.files)==null?void 0:P[0];if(!k)return;const E=new FileReader;E.onload=L=>{var H;try{const $=(H=L.target)==null?void 0:H.result,U=JSON.parse($);if(U.appName!=="Script_modifier")throw new Error("File does not belong to Script Modifier application.");const O=Th(i);if(U.catalogContext&&U.catalogContext!==O)throw new Error(`File belongs to '${U.catalogContext}' tab, but you are currently in '${O}'.`);const D=U.root;if(!D)throw new Error("Invalid file structure: 'root' object missing.");const z=[],G=(F,K)=>{const ae=`cat-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!F.name||!F.type)return;let Y;const ge=String(F.type).toLowerCase();if(ge==="folder")Y=Ze.FOLDER;else if(F.type==="scriptModifierGroup"||ge==="group")Y=Ze.GROUP;else{const X=Object.values(Ze).find(Te=>Te===F.type);if(X)Y=X;else{const Te=F.type.toUpperCase(),pe=Object.values(Ze).find(ue=>ue===Te);if(pe)Y=pe;else return}}const W=F.category||i||void 0,le={id:ae,type:Y,name:F.name,parentId:K,category:W,nodes:F.nodes,connections:F.connections,data:F.data};z.push(le),Y===Ze.FOLDER&&Array.isArray(F.children)&&F.children.forEach(X=>G(X,ae))};G(D,c),n(F=>{const K=[...F,...z];return d(K),K})}catch($){alert(`${e("alert.loadCatalogFailed")}: ${$.message}`)}finally{N.target&&(N.target.value="")}},E.readAsText(k)},[e,c,i]),A=x.useCallback(()=>{var N;(N=l.current)==null||N.click()},[]),I=x.useCallback((N,k)=>{n(E=>{const P=E.find(H=>H.id===N);if(!P||P.parentId===k)return E;if(P.type===Ze.FOLDER){let H=k;for(;H;){if(H===N)return E;const $=E.find(U=>U.id===H);H=$?$.parentId:null}}const L=E.map(H=>H.id===N?{...H,parentId:k}:H);return d(L),L})},[]),M=x.useCallback(N=>{n(N),d(N)},[]);return{catalogItems:t,currentCatalogItems:h,catalogPath:g,navigateCatalogBack:w,navigateCatalogToFolder:m,createCatalogItem:y,saveGroupToCatalog:b,saveGenericItemToCatalog:S,renameCatalogItem:_,deleteCatalogItem:v,saveCatalogItemToDisk:f,catalogFileInputRef:l,handleCatalogFileChange:T,triggerLoadFromFile:A,moveCatalogItem:I,activeCategory:i,setActiveCategory:s,importCatalog:M}},Cw=e=>{const[t,n]=x.useState(null),[r,a]=x.useState(!1),[i,s]=x.useState(!1);x.useEffect(()=>{let d;return(async()=>{try{d=await navigator.permissions.query({name:e}),n(d.state),d.state==="prompt"&&!i&&a(!0),d.onchange=()=>{n(d.state),d.state!=="prompt"&&a(!1)}}catch(g){console.warn(`Permission API for '${e}' not supported.`,g),n("granted")}})(),()=>{d&&(d.onchange=null)}},[e,i]);const l=x.useCallback(async()=>{try{await navigator.clipboard.readText()}catch(d){d instanceof DOMException&&d.name==="NotAllowedError"&&n("denied"),console.error("Clipboard read failed:",d)}finally{a(!1)}},[]),c=x.useCallback(()=>{a(!1),s(!0)},[]);return{showDialog:r,requestPermission:l,declinePermission:c}},Eh="prompt-library-items",Nh="root",kh=[{id:"folder-1",type:Yt.FOLDER,name:"Basic Prompts",parentId:null},{id:"prompt-1",type:Yt.PROMPT,name:"Fill background",parentId:"folder-1",content:"Fill the white background with the surroundings"},{id:"prompt-2",type:Yt.PROMPT,name:"Remove all watermarks",parentId:"folder-1",content:"Remove all watermarks, logos, text overlays, and advertisement banners from the image. Restore the original background naturally, blending colors and textures smoothly. Keep all other visual elements unchanged and realistic."},{id:"prompt-3",type:Yt.PROMPT,name:"Character concept",parentId:"folder-1",content:"Create a character concept based on the provided image. The character is standing full-length against a gray background."}],Sw=e=>{const[t,n]=x.useState(()=>{try{const A=localStorage.getItem(Eh);return A?JSON.parse(A):kh}catch(A){return console.error("Failed to load prompt library from storage",A),kh}}),[r,a]=x.useState([null]),i=x.useRef(null),s=r[r.length-1],l=A=>{try{localStorage.setItem(Eh,JSON.stringify(A))}catch(I){console.error("Failed to save prompt library to storage",I)}},c=x.useMemo(()=>t.filter(A=>A.parentId===s).sort((A,I)=>A.type===I.type?A.name.localeCompare(I.name):A.type===Yt.FOLDER?-1:1),[t,s]),d=x.useMemo(()=>{const A=[];let I=s;for(;I;){const M=t.find(N=>N.id===I);if(M)A.push(M),I=M.parentId;else break}return[{id:Nh,type:Yt.FOLDER,name:e("catalog.tabs.library"),parentId:null},...A.reverse()]},[s,t,e]),h=x.useCallback(A=>{const I=A===Nh?null:A,M=r.findIndex(N=>N===I);M>-1?a(N=>N.slice(0,M+1)):a(N=>[...N,I])},[r]),g=x.useCallback(()=>{a(A=>A.length>1?A.slice(0,-1):A)},[]),m=x.useCallback(A=>{const I=A===Yt.FOLDER?e("library.actions.newFolder"):e("library.actions.newPrompt"),M={id:`lib-item-${Date.now()}`,type:A,name:I,parentId:s,content:A===Yt.PROMPT?"":void 0};n(N=>{const k=[...N,M];return l(k),k})},[s,e]),w=x.useCallback((A,I)=>{n(M=>{const N=M.map(k=>k.id===A?{...k,...I}:k);return l(N),N})},[]),y=x.useCallback(A=>{n(I=>{const M=new Set([A]),N=[A];for(;N.length>0;){const E=N.shift();for(const P of I)P.parentId===E&&(M.add(P.id),P.type===Yt.FOLDER&&N.push(P.id))}const k=I.filter(E=>!M.has(E.id));return l(k),k})},[]),b=x.useCallback(A=>{let I,M,N;if(A.type===Yt.PROMPT)I=A.content||"",M=`${A.name.replace(/ /g,"_")}.txt`,N="text/plain";else{const L=H=>{const $=t.find(O=>O.id===H);if(!$)return null;const U=t.filter(O=>O.parentId===H);return{name:$.name,type:"folder",children:U.map(O=>O.type===Yt.FOLDER?L(O.id):{name:O.name,type:"prompt",content:O.content||""})}};I=JSON.stringify(L(A.id),null,2),M=`${A.name.replace(/ /g,"_")}_library_export.json`,N="application/json"}const k=new Blob([I],{type:N}),E=URL.createObjectURL(k),P=document.createElement("a");P.href=E,P.download=M,P.click(),URL.revokeObjectURL(E),P.remove()},[t]),S=x.useCallback(A=>{try{if(!A)throw new Error("File content is empty.");const I=JSON.parse(A);if(I.type!=="folder"||!I.name||!Array.isArray(I.children))throw new Error(e("alert.invalidCatalogFile"));const M=[],N=(k,E)=>{const P=`lib-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!k.name||!k.type)return;const L=k.type==="folder"?Yt.FOLDER:Yt.PROMPT,H={id:P,type:L,name:k.name,parentId:E,content:L===Yt.PROMPT?k.content||"":void 0};M.push(H),L===Yt.FOLDER&&Array.isArray(k.children)&&k.children.forEach($=>N($,P))};N(I,s),n(k=>{const E=[...k,...M];return l(E),E})}catch(I){alert(`${e("alert.loadCatalogFailed")}: ${I.message}`)}},[s,n,e]),_=x.useCallback(A=>{var N;const I=(N=A.target.files)==null?void 0:N[0];if(!I)return;const M=new FileReader;M.onload=k=>{var P;const E=(P=k.target)==null?void 0:P.result;S(E),A.target&&(A.target.value="")},M.onerror=()=>{alert("Error reading the selected file.")},M.readAsText(I)},[S]),v=x.useCallback(()=>{var A;(A=i.current)==null||A.click()},[]),f=x.useCallback((A,I)=>{n(M=>{const N=M.find(E=>E.id===A);if(!N||N.parentId===I)return M;if(N.type===Yt.FOLDER){let E=I;for(;E;){if(E===A)return M;const P=M.find(L=>L.id===E);E=P?P.parentId:null}}const k=M.map(E=>E.id===A?{...E,parentId:I}:E);return l(k),k})},[]),T=x.useCallback(A=>{n(A),l(A)},[]);return{libraryItems:t,currentLibraryItems:c,currentPath:d,navigateBack:g,navigateToFolder:h,createLibraryItem:m,updateLibraryItem:w,deleteLibraryItem:y,saveLibraryItemToDisk:b,libraryFileInputRef:i,handleLibraryFileChange:_,triggerLoadLibraryFromFile:v,moveLibraryItem:f,importLibrary:T}},Tw=({t:e,setGroups:t,renameCatalogItem:n,updateLibraryItem:r,libraryItems:a,deleteLibraryItem:i,setNodes:s,setConnections:l,nodeIdCounter:c,geminiContext:d,currentCatalogItems:h,deleteCatalogItem:g,saveDataToCatalog:m})=>{const[w,y]=x.useState(null),[b,S]=x.useState(null),[_,v]=x.useState(null),[f,T]=x.useState(!1),[A,I]=x.useState([]),M=x.useCallback((G,F="info",K)=>{const ae=Date.now()+Math.random(),Y=K?A:A.slice(-4);I([...Y,{id:ae,message:G,type:F,position:K}])},[A]),N=x.useCallback(G=>{I(F=>F.filter(K=>K.id!==G))},[]),k=x.useCallback(()=>{d.error&&navigator.clipboard.writeText(d.error).then(()=>{T(!0)})},[d.error]),E=x.useCallback((G,F)=>{y({type:"group",id:G,currentTitle:F})},[]),P=x.useCallback((G,F)=>{const K=h.find(ae=>ae.id===G);K&&y({type:"catalog",id:G,currentTitle:K.name})},[h]),L=x.useCallback((G,F)=>{y({type:"library",id:G,currentTitle:F})},[]),H=x.useCallback((G,F)=>{y({type:"node",id:G,currentTitle:F})},[]),$=G=>{if(!w||!G||!G.trim()){y(null);return}if(w.type==="catalog"&&w.id.startsWith("save-node:")){const F=w.id.split(":");F.length===3&&m&&m(F[1],F[2],G.trim())}else w.type==="group"?t(F=>F.map(K=>K.id===w.id?{...K,title:G.trim()}:K)):w.type==="catalog"?n(w.id,G.trim()):w.type==="library"?r(w.id,{name:G.trim()}):w.type==="node"&&s(F=>F.map(K=>K.id===w.id?{...K,title:G.trim()}:K));y(null)},U=(G,F)=>{b&&r(b.id,{name:G.trim(),content:F}),S(null)},O=x.useCallback(G=>{const F=h.find(K=>K.id===G);F&&v({title:e("dialog.confirmDelete.title"),message:e("dialog.confirmDelete.message",{itemName:F.name}),onConfirm:()=>g(G)})},[h,e,g]),D=x.useCallback(G=>{const F=a.find(ae=>ae.id===G);if(!F)return;const K=F.type===Yt.FOLDER?e("dialog.confirmDelete.folderMessage",{itemName:F.name}):e("dialog.confirmDelete.message",{itemName:F.name});v({title:e("dialog.confirmDelete.title"),message:K,onConfirm:()=>i(G)})},[a,i,e]),z=x.useCallback(()=>{v({title:e("dialog.confirmClear.title"),message:e("dialog.confirmClear.message"),onConfirm:()=>{s([]),l([]),t([]),c.current=0}})},[e,s,l,t,c]);return{renameInfo:w,setRenameInfo:y,promptEditInfo:b,setPromptEditInfo:S,confirmInfo:_,setConfirmInfo:v,isErrorCopied:f,handleCopyError:k,toasts:A,addToast:M,removeToast:N,handleRenameGroup:E,handleRenameCatalogItem:P,handleRenameLibraryItem:L,handleRenameNode:H,confirmRename:$,confirmPromptEdit:U,handleDeleteCatalogItem:O,handleDeleteLibraryItem:D,handleClearCanvas:z}},Ew=({isQuickSearchOpen:e,handleToggleCatalog:t,openQuickSearchMenu:n,openQuickAddMenu:r,clientPointerPosition:a,clientPointerPositionRef:i,onAddNode:s,handleCloseAddNodeMenus:l,loadStateFromFileContent:c,activeTool:d,setActiveTool:h,isSnapToGrid:g,setIsSnapToGrid:m,lineStyle:w,setLineStyle:y,selectedNodeIds:b,copyNodeValue:S,geminiContext:_,addCharacterCardFromFile:v,addImagePreviewNodeFromFile:f,viewTransform:T,nodes:A,handlePasteFromClipboard:I,handleAddGroupFromTemplate:M,catalogItems:N,handleToggleNodeCollapse:k,handleNodeDoubleClick:E,deleteNodeAndConnections:P,setSelectedNodeIds:L,handleGroupSelection:H,handleDuplicateNode:$,handleDuplicateNodeEmpty:U,t:O,contextMenuSlots:D,handleValueChange:z,handleSaveProject:G,handleLoadProject:F,addToast:K})=>{const[ae,Y]=x.useState(!1),ge=x.useCallback(pe=>{const ue=i.current;if(!ue)return;const Oe={x:(ue.x-T.translate.x)/T.scale,y:(ue.y-T.translate.y)/T.scale};s(pe,Oe,void 0),l()},[i,s,l,T]),W=pe=>{pe.target===pe.currentTarget&&r({x:pe.clientX,y:pe.clientY})},le=x.useCallback(pe=>{pe.preventDefault(),pe.stopPropagation();const ue=Array.from(pe.dataTransfer.types);(ue.includes("Files")||ue.includes("application/prompt-modifier-drag-item"))&&Y(!0)},[]),X=x.useCallback(pe=>{pe.preventDefault(),pe.stopPropagation(),Y(!1)},[]),Te=x.useCallback(async pe=>{var ye;pe.preventDefault(),pe.stopPropagation(),Y(!1);const ue={x:(pe.clientX-T.translate.x)/T.scale,y:(pe.clientY-T.translate.y)/T.scale},Oe=pe.dataTransfer.getData("application/prompt-modifier-drag-item");if(Oe)try{const{type:j,itemId:q}=JSON.parse(Oe),Q=N.find(ie=>ie.id===q);if(!Q)return;if(j==="catalog-group"){Q.nodes&&Q.connections&&M({name:Q.name,nodes:Q.nodes,connections:Q.connections},ue);return}const J=Q.data;if(!J)return;let oe=null,B=J,fe;if(J.title&&(fe=J.title),J.type==="script-generator-data")oe=C.SCRIPT_GENERATOR,B={scenes:J.scenes};else if(J.type==="script-analyzer-data")oe=C.SCRIPT_ANALYZER,B={scenes:J.scenes};else if(J.type==="script-prompt-modifier-data")oe=C.SCRIPT_PROMPT_MODIFIER,B={finalPrompts:J.finalPrompts,sceneContexts:J.sceneContexts||{}};else if(J.type==="youtube-title-data")oe=C.YOUTUBE_TITLE_GENERATOR,B=J;else if(J.type==="youtube-analytics-data")oe=C.YOUTUBE_ANALYTICS,B=J;else if(J.type==="music-idea-data")oe=C.MUSIC_IDEA_GENERATOR,B=J;else if(J.type==="character-generator-data")oe=C.CHARACTER_GENERATOR,B={characters:J.characters};else if(J.type==="character-card")oe=C.CHARACTER_CARD,B={...J,id:J.id||`char-card-${Date.now()}`,index:J.index||J.alias||"Character-1"},delete B.alias,fe||(fe=J.nodeTitle||J.name);else switch(j){case"catalog-data-characters":oe=C.CHARACTER_GENERATOR,Array.isArray(J)?B={characters:J}:J.name&&(oe=C.CHARACTER_CARD,B={...J,id:J.id||`char-card-${Date.now()}`,index:J.index||J.alias||"Character-1"},delete B.alias);break;case"catalog-data-script":oe=C.SCRIPT_GENERATOR,B={scenes:J};break;case"catalog-data-analysis":oe=C.SCRIPT_ANALYZER,B={scenes:J};break;case"catalog-data-final_prompts":oe=C.SCRIPT_PROMPT_MODIFIER,B={finalPrompts:J};break;case"catalog-data-youtube":oe=C.YOUTUBE_TITLE_GENERATOR,B=J;break;case"catalog-data-music":oe=C.MUSIC_IDEA_GENERATOR,B=J;break}oe&&s(oe,ue,JSON.stringify(B),fe)}catch(j){console.error("Failed to handle catalog drop:",j)}const he=(ye=pe.dataTransfer.files)==null?void 0:ye[0];if(he){if(he.type.startsWith("image/")&&!he.name.endsWith(".json")){const j={...ue,x:ue.x-150,y:ue.y-170};f(he,j);return}if(he.type.startsWith("audio/")||he.type.startsWith("video/")){const j=new FileReader;j.onload=q=>{var oe;const Q=((oe=q.target)==null?void 0:oe.result).split(",")[1],J=JSON.stringify({audioBase64:Q,mimeType:he.type,fileName:he.name,transcription:"",segments:[]});s(C.AUDIO_TRANSCRIBER,ue,J)},j.onerror=()=>{K(O("error.fileReadError"),"info")},j.readAsDataURL(he);return}if(he.type==="application/json"||he.name.endsWith(".json")){const j=await he.text();let q;try{q=JSON.parse(j)}catch{_.setError("Error loading file: Invalid JSON format.");return}if(q&&(q.type==="prompt-modifier-canvas"||q.type==="prompt-modifier-project")){_.setError(O("error.promptModifierFile"));return}if(q&&q.type==="script-modifier-project"){F(q);return}if(q&&(q.type==="group"||q.type==="scriptModifierGroup")){M(q,ue);return}if(q&&(q.type==="character-card"||Array.isArray(q)&&q.length>0&&q[0].type==="character-card")){const Q={...ue,x:ue.x-220,y:ue.y-400};v(q,Q);return}if(q&&q.type){let Q=null,J=q;const oe=q.title;switch(q.type){case"script-generator-data":Q=C.SCRIPT_GENERATOR,J={scenes:q.scenes};break;case"script-analyzer-data":Q=C.SCRIPT_ANALYZER,J={scenes:q.scenes};break;case"script-prompt-modifier-data":Q=C.SCRIPT_PROMPT_MODIFIER,J={finalPrompts:q.finalPrompts,sceneContexts:q.sceneContexts||{}};break;case"youtube-title-data":Q=C.YOUTUBE_TITLE_GENERATOR;break;case"youtube-analytics-data":Q=C.YOUTUBE_ANALYTICS;break;case"music-idea-data":Q=C.MUSIC_IDEA_GENERATOR;break;case"character-generator-data":Q=C.CHARACTER_GENERATOR,J={characters:q.characters};break}if(Q){s(Q,ue,JSON.stringify(J),oe);return}}try{c(j)}catch{}}}},[c,_,v,T,f,M,N,s,F,O]);return x.useEffect(()=>{const pe=async ue=>{var j;const Oe=ue.target;if(Oe.tagName==="INPUT"||Oe.tagName==="TEXTAREA")return;ue.preventDefault();const ye=(j=ue.clipboardData)==null?void 0:j.getData("text");if(ye)try{const q=JSON.parse(ye);if(Array.isArray(q)&&q.length>0&&q[0].type==="character-card"){const Q=i.current;if(Q){const J={x:(Q.x-T.translate.x)/T.scale,y:(Q.y-T.translate.y)/T.scale};v(q,J),K(O("toast.pasted"),"success",Q);return}}}catch{}await I()};return window.addEventListener("paste",pe),()=>window.removeEventListener("paste",pe)},[I,v,T,i,O,K]),x.useEffect(()=>{const pe=ue=>{var q;const Oe=ue.target,he=Oe.tagName==="INPUT"||Oe.tagName==="TEXTAREA";if(ue.code==="Escape"&&he&&((q=document.activeElement)==null||q.blur()),ue.ctrlKey||ue.metaKey){if(ue.code==="KeyC"&&!he&&b.length>0){ue.preventDefault();const Q=b[b.length-1];S(Q),K(O("toast.copied"),"success",i.current);return}if(ue.code==="KeyD"&&!he&&b.length>0){ue.preventDefault();const Q=[];b.forEach(J=>{const oe=$(J);oe&&Q.push(oe)}),L(Q);return}if(ue.code==="KeyA"){if(he)return;ue.preventDefault();const Q=A.map(J=>J.id);L(Q);return}if(ue.shiftKey&&ue.code==="KeyC"){ue.preventDefault(),ge(C.CHARACTER_CARD);return}if(ue.shiftKey&&ue.code==="KeyS"&&!he){ue.preventDefault(),G();return}}if(ue.code==="KeyF"&&!ue.shiftKey&&!ue.ctrlKey&&!ue.metaKey&&!ue.altKey&&!he){ue.preventDefault(),n(i.current);return}if(ue.code==="Space"&&!ue.ctrlKey&&!ue.metaKey&&!ue.altKey&&!ue.isComposing&&!he){ue.preventDefault(),r(i.current);return}if(he||ue.repeat)return;if(ue.key>="1"&&ue.key<="8"&&!ue.shiftKey&&!ue.ctrlKey&&!ue.altKey&&!ue.metaKey){const Q=parseInt(ue.key)-1;if(D&&D[Q]){ue.preventDefault(),ge(D[Q]);return}}if(ue.code==="KeyD"&&!ue.ctrlKey&&!ue.metaKey&&!ue.altKey&&!ue.shiftKey){if(b.length>0){ue.preventDefault();const Q=[];b.forEach(J=>{const oe=U(J);oe&&Q.push(oe)}),L(Q)}return}if(ue.altKey&&ue.code==="KeyA"){ue.preventDefault(),L([]);return}if(ue.shiftKey&&ue.code==="KeyE"){ue.preventDefault(),y(Q=>Q==="orthogonal"?"spaghetti":"orthogonal");return}if(ue.shiftKey&&ue.code==="KeyW"){ue.preventDefault(),m(Q=>!Q);return}if((ue.code==="Delete"||ue.code==="KeyX")&&b.length>0){ue.preventDefault(),b.forEach(Q=>P(Q)),L([]);return}if(ue.code==="KeyG"&&!ue.shiftKey&&!ue.ctrlKey&&!ue.altKey&&!ue.metaKey){ue.preventDefault(),H();return}if(ue.code==="KeyH"&&!ue.shiftKey&&!ue.ctrlKey&&!ue.altKey&&!ue.metaKey){ue.preventDefault(),b.forEach(k);return}const ye=ue.code;switch(ye){case"KeyV":case"KeyC":case"KeyS":case"KeyR":!ue.shiftKey&&!ue.ctrlKey&&!ue.altKey&&(ue.preventDefault(),ye==="KeyV"&&h("edit"),ye==="KeyC"&&h("cutter"),ye==="KeyS"&&h("selection"),ye==="KeyR"&&h("reroute"));break}let j=null;if(ue.shiftKey&&!ue.ctrlKey&&!ue.metaKey&&!ue.altKey)switch(ye){case"KeyA":j=C.IDEA_GENERATOR;break;case"KeyC":j=C.CHARACTER_GENERATOR;break;case"KeyS":j=C.SCRIPT_GENERATOR;break;case"KeyD":j=C.SCRIPT_ANALYZER;break;case"KeyF":j=C.SCRIPT_PROMPT_MODIFIER;break;case"KeyR":j=C.DATA_READER;break;case"KeyG":j=C.NARRATOR_TEXT_GENERATOR;break;case"KeyN":j=C.SPEECH_SYNTHESIZER;break;case"KeyB":j=C.AUDIO_TRANSCRIBER;break;case"KeyT":j=C.YOUTUBE_TITLE_GENERATOR;break;case"KeyY":j=C.YOUTUBE_ANALYTICS;break;case"KeyM":j=C.MUSIC_IDEA_GENERATOR;break}else if(!ue.shiftKey&&!ue.ctrlKey&&!ue.metaKey&&!ue.altKey)switch(ye){case"KeyT":j=C.TEXT_INPUT;break;case"KeyA":j=C.PROMPT_ANALYZER;break;case"KeyP":j=C.PROMPT_PROCESSOR;break;case"KeyM":j=C.GEMINI_CHAT;break;case"KeyL":j=C.TRANSLATOR;break;case"KeyN":j=C.NOTE;break;case"KeyO":j=C.IMAGE_GENERATOR;break;case"KeyI":j=C.IMAGE_PREVIEW;break}j&&(ue.preventDefault(),ge(j))};return window.addEventListener("keydown",pe),()=>window.removeEventListener("keydown",pe)},[H,h,ge,b,P,L,k,S,m,y,e,t,A,_,$,U,E,O,D,G,K,i,n,r]),{isDraggingOverCanvas:ae,handleCanvasDoubleClick:W,handleDragOver:le,handleDragLeave:X,handleDrop:Te}},Nw=({nodes:e,connections:t,groups:n,addNodeFromHook:r,t:a,clientPointerPosition:i,clientPointerPositionRef:s,viewTransform:l,setCreationLine:c,setLastAddedNodeId:d,handleDeleteNode:h,removeConnectionsByNodeId:g,addConnection:m,handleValueChange:w,nodeIdCounter:y,setNodes:b,setConnections:S,addGroup:_,selectedNodeIds:v,setSelectedNodeIds:f,removeGroup:T,saveGroupToCatalog:A,catalogItems:I,currentCatalogItems:M,handleCloseCatalog:N,geminiContext:k,addToast:E,setGroups:P,handleDuplicateNode:L,handleDuplicateNodeEmpty:H,saveGenericItemToCatalog:$})=>{const U=x.useCallback((j,q,Q,J)=>{const oe=r(j,q,a,Q,J);return d(oe),setTimeout(()=>{d(B=>B===oe?null:B)},1500),oe},[r,a,d]),O=x.useCallback(j=>{const q={x:window.innerWidth/2,y:window.innerHeight/2},Q={x:(q.x-l.translate.x)/l.scale,y:(q.y-l.translate.y)/l.scale};c({start:s.current,end:q}),setTimeout(()=>c(null),700),U(j,Q,void 0)},[s,l,U,c]),D=x.useCallback(j=>{const q=e.find(Q=>Q.id===j);if(q&&q.type===C.REROUTE_DOT){const Q=t.find(oe=>oe.toNodeId===j),J=t.filter(oe=>oe.fromNodeId===j);Q&&J.length>0&&J.map(B=>({fromNodeId:Q.fromNodeId,fromHandleId:Q.fromHandleId,toNodeId:B.toNodeId,toHandleId:B.toHandleId})).forEach(B=>{const fe=e.find(ie=>ie.id===B.fromNodeId);fe&&m(B,fe)})}h(j),g(j)},[e,t,h,g,m]),z=x.useCallback((j,q)=>{const Q=t.find(R=>R.id===j);if(!Q)return;const J=e.find(R=>R.id===Q.fromNodeId);if(!J)return;y.current+=1;const oe=`node-${y.current}-${Date.now()}`,B=Ga(J,Q.fromHandleId),fe={x:(q.clientX-l.translate.x)/l.scale,y:(q.clientY-l.translate.y)/l.scale},ie={id:oe,type:C.REROUTE_DOT,position:{x:fe.x-30,y:fe.y-20},value:JSON.stringify({type:B}),title:a("node.title.reroute_dot"),width:60,height:40},Z={id:`conn-${Date.now()}-1-${Math.random().toString(36).substr(2,9)}`,fromNodeId:Q.fromNodeId,toNodeId:oe,fromHandleId:Q.fromHandleId},ee={id:`conn-${Date.now()}-2-${Math.random().toString(36).substr(2,9)}`,fromNodeId:oe,toNodeId:Q.toNodeId,toHandleId:Q.toHandleId};b(R=>[...R,ie]),S(R=>[...R.filter(be=>be.id!==j),Z,ee])},[t,e,a,b,S,y,l]),G=x.useCallback(()=>{if(v.length>1){const j=e.filter(q=>v.includes(q.id));_(j),f([])}},[v,e,_,f]),F=x.useCallback((j,q)=>{if(q.shiftKey){const Q=n.find(J=>J.id===j);Q&&Q.nodeIds.forEach(J=>D(J))}T(j)},[n,D,T]),K=x.useCallback(j=>{const q=n.find(Q=>Q.id===j);q&&(A(q,e,t),E(a("alert.groupSaved",{groupTitle:q.title}),"success"))},[n,e,t,A,a,E]),ae=x.useCallback(async j=>{const q=n.find(ee=>ee.id===j);if(!q)return;const Q=e.filter(ee=>q.nodeIds.includes(ee.id));if(Q.length===0)return;const J=new Set(Q.map(ee=>ee.id)),oe=t.filter(ee=>J.has(ee.fromNodeId)&&J.has(ee.toNodeId)),B=JSON.parse(JSON.stringify(Q)),fe=Math.min(...B.map(ee=>ee.position.x)),ie=Math.min(...B.map(ee=>ee.position.y));B.forEach(ee=>{ee.position.x-=fe,ee.position.y-=ie});const Z={type:"scriptModifierGroup",name:q.title,nodes:B,connections:oe};try{await navigator.clipboard.writeText(JSON.stringify(Z,null,2)),E(a("toast.copied"),"success")}catch(ee){console.error("Failed to copy group:",ee),E("Failed to copy group","info")}},[n,e,t,a,E]),Y=x.useCallback((j,q)=>{if(!j.nodes||j.nodes.length===0)return;const Q=new Map,J=[];let oe=1/0,B=1/0;j.nodes.length>0?j.nodes.forEach(ie=>{oe=Math.min(oe,ie.position.x),B=Math.min(B,ie.position.y)}):(oe=0,B=0),j.nodes.forEach(ie=>{y.current++;const Z=`node-${y.current}-${Date.now()}`;Q.set(ie.id,Z),J.push({...ie,id:Z,position:{x:q.x+(ie.position.x-oe),y:q.y+(ie.position.y-B)}})});const fe=(j.connections||[]).map(ie=>({...ie,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fromNodeId:Q.get(ie.fromNodeId),toNodeId:Q.get(ie.toNodeId)})).filter(ie=>ie.fromNodeId&&ie.toNodeId);b(ie=>[...ie,...J]),S(ie=>[...ie,...fe]),_(J,j.name)},[y,b,S,_]),ge=x.useCallback(j=>{const q=n.find(ie=>ie.id===j);if(!q)return;const Q=e.filter(ie=>q.nodeIds.includes(ie.id));if(Q.length===0)return;const J=new Set(Q.map(ie=>ie.id)),oe=t.filter(ie=>J.has(ie.fromNodeId)&&J.has(ie.toNodeId)),B={x:q.position.x+50,y:q.position.y+50},fe={name:q.title+" (Copy)",nodes:Q,connections:oe};Y(fe,B),E(a("toast.pasted"),"success")},[n,e,t,Y,a,E]),W=x.useCallback((j,q,Q)=>{const J=e.find(B=>B.id===j);if(!J)return;let oe={};try{const B=JSON.parse(J.value||"{}");switch(q){case Ze.CHARACTERS:J.type===C.CHARACTER_GENERATOR?oe={type:"character-generator-data",characters:B.characters||[]}:J.type===C.CHARACTER_CARD&&(oe=(Array.isArray(B)?B:[B]).map(Z=>{const ee={},R=["1:1","16:9","9:16"];Z.imageSources&&Object.keys(Z.imageSources).forEach(Le=>{const je=Z.imageSources[Le];je&&(ee[Le]=je.startsWith("data:image")?je:`data:image/png;base64,${je}`)});let be=null;return Z.selectedRatio&&ee[Z.selectedRatio]?be=ee[Z.selectedRatio]:Z.image?be=Z.image.startsWith("data:image")?Z.image:`data:image/png;base64,${Z.image}`:Z.imageBase64&&(be=Z.imageBase64.startsWith("data:image")?Z.imageBase64:`data:image/png;base64,${Z.imageBase64}`),be&&!ee["1:1"]&&(ee["1:1"]=be),R.forEach(Le=>{ee[Le]||(ee[Le]=null)}),{type:"character-card",nodeTitle:J.title,id:Z.id||`char-card-${Date.now()}-${Math.random()}`,name:Z.name,index:Z.index||Z.alias||"Entity-1",image:be,selectedRatio:Z.selectedRatio||"1:1",prompt:Z.prompt||"",fullDescription:Z.fullDescription||"",imageSources:ee,additionalPrompt:Z.additionalPrompt,targetLanguage:Z.targetLanguage,isOutput:Z.isOutput}}));break;case Ze.SCRIPT:oe={type:"script-generator-data",scenes:B.scenes||[]};break;case Ze.ANALYSIS:oe={type:"script-analyzer-data",scenes:B.scenes||[],visualStyle:B.visualStyle||""};break;case Ze.FINAL_PROMPTS:oe={type:"script-prompt-modifier-data",finalPrompts:B.finalPrompts||[],usedCharacters:B.usedCharacters||[]};break;case Ze.YOUTUBE:J.type===C.YOUTUBE_TITLE_GENERATOR?oe={type:"youtube-title-data",generatedTitleOutputs:B.generatedTitleOutputs,generatedChannelOutputs:B.generatedChannelOutputs}:J.type===C.YOUTUBE_ANALYTICS&&(oe={type:"youtube-analytics-data",...B});break;case Ze.MUSIC:oe={type:"music-idea-data",idea:B.idea,generatedLyrics:B.generatedLyrics,generatedMusicPrompts:B.generatedMusicPrompts,generatedTitles:B.generatedTitles};break;default:oe=B}}catch(B){console.error("Failed to parse node value for catalog save",B);return}Array.isArray(oe)?oe.length>0&&(oe[0].nodeTitle=J.title):oe.title=J.title,$(q,Q,oe),E(a("toast.savedToCatalog"),"success")},[e,$,a,E]),le=x.useCallback(j=>{const q=n.find(ce=>ce.id===j);if(!q)return;const Q=e.filter(ce=>q.nodeIds.includes(ce.id));if(Q.length===0)return;const J=new Set(Q.map(ce=>ce.id)),oe=t.filter(ce=>J.has(ce.fromNodeId)&&J.has(ce.toNodeId)),B=JSON.parse(JSON.stringify(Q)),fe=Math.min(...B.map(ce=>ce.position.x)),ie=Math.min(...B.map(ce=>ce.position.y));B.forEach(ce=>{ce.position.x-=fe,ce.position.y-=ie});const Z={type:"scriptModifierGroup",name:q.title,nodes:B,connections:JSON.parse(JSON.stringify(oe))},ee=JSON.stringify(Z,null,2),R=new Blob([ee],{type:"application/json"}),be=URL.createObjectURL(R),Le=document.createElement("a");Le.href=be;const je=new Date,Ue=je.getFullYear(),Fe=String(je.getMonth()+1).padStart(2,"0"),ot=String(je.getDate()).padStart(2,"0"),at=String(je.getHours()).padStart(2,"0"),rt=String(je.getMinutes()).padStart(2,"0"),Ce=String(je.getSeconds()).padStart(2,"0"),ve=`${Ue}-${Fe}-${ot}_${at}-${rt}-${Ce}`,Ge=q.title.replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_");Le.download=`${Ge}_Script_Modifier_Group_${ve}.json`,Le.click(),URL.revokeObjectURL(be),Le.remove(),E(a("toast.groupSavedToDisk",{groupTitle:q.title}),"success")},[n,e,t,a,E]),X=x.useCallback(j=>{const q=I.find(J=>J.id===j)||M.find(J=>J.id===j);if(!q)return;const Q={x:(-l.translate.x+window.innerWidth/2)/l.scale,y:(-l.translate.y+window.innerHeight/2)/l.scale};q.type===Ze.GROUP&&q.nodes&&q.connections&&Y({name:q.name,nodes:q.nodes,connections:q.connections},Q),N()},[I,M,l,Y,N]),Te=x.useCallback(j=>{const q=e.find(Q=>Q.id===j);(q==null?void 0:q.type)===C.SCRIPT_ANALYZER?k.handleApplyAliasesForScriptAnalyzer(j):(q==null?void 0:q.type)===C.CHARACTER_GENERATOR&&k.handleApplyAliasesForCharacterGenerator(j)},[e,k]),pe=x.useCallback((j,q)=>{if(!j||!q)return;y.current++;const Q=`node-${y.current}-${Date.now()}`,J={};j.imageBase64&&(J["1:1"]=j.imageBase64);const oe=JSON.stringify([{id:`char-card-${Date.now()}`,name:j.name||"New Entity",index:j.index||j.alias||"Entity-1",imageSources:J,selectedRatio:"1:1",prompt:j.prompt||"",fullDescription:j.fullDescription||"",isOutput:!0}]),B={id:Q,type:C.CHARACTER_CARD,position:{x:q.position.x+q.width+60,y:q.position.y},value:oe,title:j.name||a("node.title.character_card"),width:460,height:1e3};b(fe=>[...fe,B])},[y,b,a]),ue=x.useCallback((j,q)=>{const Q=ie=>{const Z={};ie.imageSources&&Object.keys(ie.imageSources).forEach(R=>{const be=ie.imageSources[R];typeof be=="string"&&be.startsWith("data:image")?Z[R]=be.split(",")[1]:Z[R]=be});let ee=ie.image;return typeof ee=="string"&&ee.startsWith("data:image")&&(ee=ee.split(",")[1]),Z["1:1"]||(Z["1:1"]=ee),{id:ie.id||`char-card-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:ie.name||"Loaded Entity",index:ie.index||ie.alias||"Entity-1",imageSources:Z,selectedRatio:ie.selectedRatio||"1:1",prompt:ie.prompt||"",additionalPrompt:ie.additionalPrompt||"Full body character concept on a gray background",fullDescription:ie.fullDescription||"",targetLanguage:ie.targetLanguage||"en",isOutput:!!ie.isOutput,isDescriptionCollapsed:!!ie.isDescriptionCollapsed}};let J=[],oe=a("node.title.character_card");if(Array.isArray(j))J=j.map(Q),J.length>0&&j[0].nodeTitle?oe=j[0].nodeTitle:J.length>1&&(oe=`${a("node.title.character_card")} (${J.length})`);else{if(j.type!=="character-card"&&!j.name)return;J=[Q(j)],oe=j.title||j.nodeTitle||j.name||a("node.title.character_card")}y.current++;const fe={id:`node-${y.current}-${Date.now()}`,type:C.CHARACTER_CARD,position:q,value:JSON.stringify(J),title:oe,width:Math.max(460,J.length*420),height:1e3};b(ie=>[...ie,fe])},[y,b,a]),Oe=x.useCallback((j,q)=>{const Q=new FileReader;Q.onload=J=>{var B;const oe=(B=J.target)==null?void 0:B.result;if(oe){const fe=oe.split(",")[1];y.current++;const ie=`node-${y.current}-${Date.now()}`,Z=JSON.stringify({imageBase64:fe}),ee=j.name.replace(/\.[^/.]+$/,"")||a("node.title.image_preview"),R={id:ie,type:C.IMAGE_PREVIEW,position:q,value:Z,title:ee,width:300,height:340};b(be=>[...be,R])}},Q.readAsDataURL(j)},[y,b,a]),he=x.useCallback(async()=>{try{const j=await navigator.clipboard.read().catch(()=>[]),q={x:(s.current.x-l.translate.x)/l.scale,y:(s.current.y-l.translate.y)/l.scale};if(v.length===1){const J=e.find(oe=>oe.id===v[0]);if(J&&J.type===C.YOUTUBE_ANALYTICS)for(const oe of j){const B=oe.types.find(fe=>fe.startsWith("image/"))}}if(v.length===1){const J=e.find(oe=>oe.id===v[0]);if(J&&J.type===C.CHARACTER_CARD){for(const oe of j)if(oe.types.includes("text/plain")){const fe=await(await oe.getType("text/plain")).text();try{const ie=JSON.parse(fe);let Z=ie;if(Array.isArray(ie)&&ie.length>0&&(Z=ie[0]),Z.type==="character-card"||Z.name&&Z.fullDescription){const ee=JSON.parse(J.value||"[]"),R=Array.isArray(ee)?ee:[ee],be={...Z,id:`char-card-${Date.now()}`,index:Z.index||Z.alias||`Entity-${R.length+1}`};delete be.alias,Z.imageSources&&(Object.keys(Z.imageSources).forEach(je=>{Z.imageSources[je]&&Z.imageSources[je].startsWith("data:image")&&(Z.imageSources[je]=Z.imageSources[je].split(",")[1])}),be.imageSources=Z.imageSources);const Le=[...R,be];w(J.id,JSON.stringify(Le)),b(je=>je.map(Ue=>Ue.id===J.id?{...Ue,width:Le.length*420}:Ue)),E(a("toast.charLoaded"),"success",s.current);return}}catch{}}}}for(const J of j){const oe=J.types.find(B=>B.startsWith("image/"));if(oe){const B=await J.getType(oe),fe=new File([B],"pasted_image.png",{type:oe});Oe(fe,q),E(a("toast.pasted"),"success",s.current);return}}const Q=await navigator.clipboard.readText().catch(()=>"");if(Q){if(Q.startsWith("data:image/")&&Q.includes("base64,")){const J=Q.split(",")[1],oe=JSON.stringify({imageBase64:J});y.current++;const fe={id:`node-${y.current}-${Date.now()}`,type:C.IMAGE_PREVIEW,position:q,value:oe,title:a("node.title.image_preview"),width:300,height:340};b(ie=>[...ie,fe]),E(a("toast.pasted"),"success",s.current);return}try{const J=JSON.parse(Q);if(J.type==="group"||J.type==="scriptModifierGroup"){Y(J,q),E(a("toast.pasted"),"success",s.current);return}if(Array.isArray(J)&&J.length>0&&(J[0].type==="character-card"||J[0].name)){ue(J,q),E(a("toast.charLoaded"),"success",s.current);return}if(J.type==="character-card"||J.name&&J.fullDescription){ue(J,q),E(a("toast.charLoaded"),"success",s.current);return}if(J.type==="youtube-analytics-data"){U(C.YOUTUBE_ANALYTICS,q,Q,J.title),E(a("toast.pasted"),"success",s.current);return}if(J.type==="music-idea-data"){U(C.MUSIC_IDEA_GENERATOR,q,Q,J.title),E(a("toast.pasted"),"success",s.current);return}if(J.imageBase64&&typeof J.imageBase64=="string"){y.current++;const B={id:`node-${y.current}-${Date.now()}`,type:C.IMAGE_PREVIEW,position:q,value:Q,title:a("node.title.image_preview"),width:300,height:340};b(fe=>[...fe,B]),E(a("toast.pasted"),"success",s.current);return}}catch{}U(C.TEXT_INPUT,q,Q),E(a("toast.pasted"),"success",s.current);return}}catch(j){console.error("Failed to read clipboard contents: ",j),k.setError("Could not read from clipboard. Permission might be denied.")}},[s,l,U,k,v,e,w,E,a,ue,Y,b,Oe,y]),ye=x.useCallback(j=>H(j,a),[H,a]);return{onAddNode:U,handleAddNodeFromToolbar:O,deleteNodeAndConnections:D,handleSplitConnection:z,handleGroupSelection:G,handleRemoveGroup:F,handleSaveGroupToCatalog:K,handleSaveGroupToDisk:le,handleCopyGroup:ae,handleDuplicateGroup:ge,handleAddGroupFromCatalog:X,handleApplyAliases:Te,handleDetachCharacter:pe,addCharacterCardFromFile:ue,addImagePreviewNodeFromFile:Oe,handlePasteFromClipboard:he,handleAddGroupFromTemplate:Y,handleDuplicateNode:L,handleDuplicateNodeEmpty:ye,saveDataToCatalog:W}},Ah=40,Lf=(e,t)=>{const n=new Map;let r;try{r=JSON.parse(e.value||"{}")}catch{r={summary:"",detailedCharacters:[],scenes:[]}}const{summary:a="",detailedCharacters:i=[],scenes:s=[]}=r,l=[];l.push({handleId:"all-script-parts",title:t("node.content.allScriptParts")}),s.some(m=>m.narratorText&&m.narratorText.trim()!=="")&&l.push({handleId:"all-narrator-text",title:t("node.content.allNarratorData")}),a&&l.push({handleId:"summary",title:t("node.content.summary")}),i.forEach((m,w)=>{const y=m.id||`char-idx-${w}`;l.push({handleId:`character-${y}`,title:m.name||"Character"})}),[...s].sort((m,w)=>m.sceneNumber-w.sceneNumber).forEach((m,w)=>{const y=`scene-${w}`;l.push({handleId:y,title:m.title||`Scene ${w+1}`})});const h=e.height-Ah,g=l.length;return g===0||l.forEach(({handleId:m,title:w},y)=>{const b=Ah+h/(g+1)*(y+1);n.set(m,{y:b,title:w})}),n},un=40,oa=12,ra=10,kw=({nodes:e,connections:t,selectedNodeIds:n,dollyZoomingInfo:r,draggingInfo:a,effectiveTool:i,isPanning:s,t:l,selectionRect:c})=>{const d=x.useMemo(()=>{const y=new Map;return t.forEach(b=>{y.has(b.toNodeId)||y.set(b.toNodeId,new Set),y.get(b.toNodeId).add(b.toHandleId)}),y},[t]),h=x.useMemo(()=>{if(n.length<=1)return null;const y=e.filter(T=>n.includes(T.id));let b=1/0,S=1/0,_=-1/0;return y.forEach(T=>{b=Math.min(b,T.position.x),S=Math.min(S,T.position.y),_=Math.max(_,T.position.x+T.width)}),b===1/0?null:{x:(b+_)/2,y:S-60}},[n,e]),g=()=>r?"var(--cursor-zoom-in)":a||s?"grabbing":i==="zoom"?"var(--cursor-zoom-in)":i==="selection"?"crosshair":["edit","cutter","reroute"].includes(i)?"grab":"default",m=x.useCallback((y,b,S)=>{const _={x:0,y:0},v={x:0,y:0};if(_.x=y.position.x+y.width,y.isCollapsed){let f=[];const T=Ga(y);if(y.type===C.PROMPT_ANALYZER){let I=[];try{I=JSON.parse(y.value||"{}").characters||[]}catch{}f=["environment",...Array.from({length:Math.max(1,I.length)},(N,k)=>`character-${k}`),"action","style"].map(N=>({handleId:N}))}else if(y.type===C.CHARACTER_ANALYZER)f=[{handleId:"character"},{handleId:"clothing"}];else if(y.type===C.SCRIPT_GENERATOR){f.push({handleId:"all-script-parts"});let I={};try{I=JSON.parse(y.value||"{}")}catch{}(I.scenes||[]).some(k=>k.narratorText&&k.narratorText.trim()!=="")&&f.push({handleId:"all-narrator-text"})}else y.type===C.CHARACTER_CARD?f=[{handleId:"all-characters"},{handleId:"primary-character"}]:(T!==null||y.type===C.REROUTE_DOT)&&(f=[{handleId:void 0}]);const A=f.findIndex(I=>I.handleId===S.fromHandleId);_.y=y.position.y+(A>=0?(A+1)*(un/(f.length+1)):un/2)}else switch(y.type){case C.PROMPT_ANALYZER:{let f=[];try{f=JSON.parse(y.value||"{}").characters||[]}catch{}const T=Math.max(1,f.length),A=3+T,M=["environment",...Array.from({length:T},(P,L)=>`character-${L}`),"action","style"].indexOf(S.fromHandleId||""),N=un+oa,E=y.height-oa-40-8-N;_.y=y.position.y+N+E/A*(M+.5);break}case C.CHARACTER_ANALYZER:{const T=["character","clothing"].indexOf(S.fromHandleId||""),A=un+oa,M=y.height-oa-40-8-A;_.y=y.position.y+A+M/2*(T+.5);break}case C.CHARACTER_GENERATOR:{let f=[];try{f=JSON.parse(y.value||"{}").characters||[]}catch{}const T=[];f.forEach((N,k)=>{T.push({handleId:N.id?`character-${N.id}`:`character-${k}`})});const A=T.length,I=y.height-un,M=T.findIndex(N=>N.handleId===S.fromHandleId);M!==-1?_.y=y.position.y+un+I/(A+1)*(M+1):_.y=y.position.y+y.height/2;break}case C.SCRIPT_GENERATOR:{const T=Lf(y,l).get(S.fromHandleId||"all-script-parts");_.y=T?y.position.y+T.y:y.position.y+y.height/2;break}case C.SCRIPT_ANALYZER:{let f={characters:[],scenes:[]};try{f=JSON.parse(y.value||"{}")}catch{}const{characters:T=[],scenes:A=[]}=f,I=[];I.push({handleId:"all-script-analyzer-data"}),A.some(k=>k.narratorText)&&I.push({handleId:"all-narrator-data"}),T.forEach((k,E)=>{const P=k.id||`char-idx-${E}`;I.push({handleId:`character-${P}`})});const N=I.findIndex(k=>k.handleId===S.fromHandleId);if(N!==-1){const k=y.height-un;_.y=y.position.y+un+k/(I.length+1)*(N+1)}else _.y=y.position.y+y.height/2;break}case C.SCRIPT_PROMPT_MODIFIER:{let f={finalPrompts:[]};try{f=JSON.parse(y.value||"{}")}catch{}const{finalPrompts:T=[]}=f,A=S.fromHandleId||"",I=T.findIndex(M=>`final-prompt-${M.frameNumber}`===A);if(I!==-1){const M=T.length,k=(y.height-un)/(M+1)*(I+1);_.y=y.position.y+un+k}else _.y=y.position.y+y.height/2;break}case C.NARRATOR_TEXT_GENERATOR:{let f={};try{f=JSON.parse(y.value||"{}").targetLanguages||{}}catch{}const T=Object.entries(f).filter(([,I])=>I).map(([I])=>I),A=T.indexOf(S.fromHandleId||"");if(A!==-1){const I=T.length,M=60,N=96,k=40,E=8,P=M+E+N+E+k,L=un+oa+P+E,$=y.height-oa-L;let U;if($<=20*I){const D=y.height-L;U=L+D/(I+1)*(A+1)}else U=L+$/I*(A+.5);const O=Math.max(un+ra,Math.min(U,y.height-ra));_.y=y.position.y+O}else _.y=y.position.y+y.height/2;break}case C.YOUTUBE_TITLE_GENERATOR:{let f={};try{f=JSON.parse(y.value||"{}").targetLanguages||{}}catch{}const T=Object.entries(f).filter(([,I])=>I).map(([I])=>I),A=T.indexOf(S.fromHandleId||"");if(A!==-1){const I=T.length,M=y.height-un,N=un+M/(I+1)*(A+1),k=Math.max(un+ra,Math.min(N,y.height-ra));_.y=y.position.y+k}else _.y=y.position.y+y.height/2;break}case C.CHARACTER_CARD:{const f=[{handleId:"all-characters"},{handleId:"primary-character"}],T=y.height-un,A=f.length,I=f.findIndex(M=>M.handleId===S.fromHandleId);if(I!==-1){const M=un+T/(A+1)*(I+1),N=Math.max(un+ra,Math.min(M,y.height-ra));_.y=y.position.y+N}else _.y=y.position.y+y.height/2;break}default:_.y=y.position.y+y.height/2}if(v.x=b.position.x,b.isCollapsed){let f=[];b.type===C.SCRIPT_GENERATOR?f=[{handleId:"prompt"},{handleId:"characters"}]:b.type===C.SCRIPT_PROMPT_MODIFIER?f=[{handleId:"all-script-analyzer-data"},{handleId:"style"}]:b.type===C.SCRIPT_ANALYZER?f=[{handleId:void 0}]:(Kr(b)!==null||b.type===C.REROUTE_DOT)&&(f=[{handleId:void 0}]);const T=f.findIndex(A=>A.handleId===S.toHandleId);v.y=b.position.y+(T>=0?(T+1)*(un/(f.length+1)):un/2)}else{let f;const T=(A,I,M)=>{const N=A&&I[A]?I[A]:M;return b.position.y+b.height*N};switch(b.type){case C.SCRIPT_GENERATOR:S.toHandleId==="prompt"?f=b.position.y+95:S.toHandleId==="characters"?f=b.position.y+330:f=b.position.y+b.height/2;break;case C.SCRIPT_PROMPT_MODIFIER:f=T(S.toHandleId,{"all-script-analyzer-data":1/3,style:2/3},1/3);break;case C.SCRIPT_ANALYZER:f=b.position.y+b.height/2;break;default:f=b.position.y+b.height/2}v.y=f}return{start:_,end:v}},[e,l]),w=x.useMemo(()=>{if(!c)return null;const{start:y,end:b}=c,S=Math.min(y.x,b.x),_=Math.min(y.y,b.y),v=Math.abs(y.x-b.x),f=Math.abs(y.y-b.y);return{x:S,y:_,width:v,height:f}},[c]);return{connectedInputs:d,groupButtonPosition:h,getCanvasCursor:g,getConnectionPoints:m,selectionRect:w}};var Aw={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Iw,Pw;function Rw(){return{geminiUrl:Iw,vertexUrl:Pw}}function Mw(e,t,n,r){var a,i;if(!(e!=null&&e.baseUrl)){const s=Rw();return t?(a=s.vertexUrl)!==null&&a!==void 0?a:n:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Xo{}function Ye(e,t){const n=/\{([^}]+)\}/g;return e.replace(n,(r,a)=>{if(Object.prototype.hasOwnProperty.call(t,a)){const i=t[a];return i!=null?String(i):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function p(e,t,n){for(let i=0;i<t.length-1;i++){const s=t[i];if(s.endsWith("[]")){const l=s.slice(0,-2);if(!(l in e))if(Array.isArray(n))e[l]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(e[l])){const c=e[l];if(Array.isArray(n))for(let d=0;d<c.length;d++){const h=c[d];p(h,t.slice(i+1),n[d])}else for(const d of c)p(d,t.slice(i+1),n)}return}else if(s.endsWith("[0]")){const l=s.slice(0,-3);l in e||(e[l]=[{}]);const c=e[l];p(c[0],t.slice(i+1),n);return}(!e[s]||typeof e[s]!="object")&&(e[s]={}),e=e[s]}const r=t[t.length-1],a=e[r];if(a!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===a)return;if(typeof a=="object"&&typeof n=="object"&&a!==null&&n!==null)Object.assign(a,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(e,n):e[r]=n}function u(e,t,n=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let r=0;r<t.length;r++){if(typeof e!="object"||e===null)return n;const a=t[r];if(a.endsWith("[]")){const i=a.slice(0,-2);if(i in e){const s=e[i];return Array.isArray(s)?s.map(l=>u(l,t.slice(r+1),n)):n}else return n}else e=e[a]}return e}catch(r){if(r instanceof TypeError)return n;throw r}}function Lw(e,t){for(const[n,r]of Object.entries(t)){const a=n.split("."),i=r.split("."),s=new Set;let l=-1;for(let c=0;c<a.length;c++)if(a[c]==="*"){l=c;break}if(l!==-1&&i.length>l)for(let c=l;c<i.length;c++){const d=i[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}Ed(e,a,i,0,s)}}function Ed(e,t,n,r,a){if(r>=t.length||typeof e!="object"||e===null)return;const i=t[r];if(i.endsWith("[]")){const s=i.slice(0,-2),l=e;if(s in l&&Array.isArray(l[s]))for(const c of l[s])Ed(c,t,n,r+1,a)}else if(i==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const s=e,l=Object.keys(s).filter(d=>!d.startsWith("_")&&!a.has(d)),c={};for(const d of l)c[d]=s[d];for(const[d,h]of Object.entries(c)){const g=[];for(const m of n.slice(r))m==="*"?g.push(d):g.push(m);p(s,g,h)}for(const d of l)delete s[d]}}else{const s=e;i in s&&Ed(s[i],t,n,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Du(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jw(e){const t={},n=u(e,["operationName"]);n!=null&&p(t,["operationName"],n);const r=u(e,["resourceName"]);return r!=null&&p(t,["_url","resourceName"],r),t}function Dw(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response","generateVideoResponse"]);return s!=null&&p(t,["response"],Fw(s)),t}function Ow(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],zw(s)),t}function Fw(e){const t={},n=u(e,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Gw(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function zw(e){const t={},n=u(e,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Uw(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function Gw(e){const t={},n=u(e,["video"]);return n!=null&&p(t,["video"],Yw(n)),t}function Uw(e){const t={},n=u(e,["_self"]);return n!=null&&p(t,["video"],qw(n)),t}function Hw(e){const t={},n=u(e,["operationName"]);return n!=null&&p(t,["_url","operationName"],n),t}function Bw(e){const t={},n=u(e,["operationName"]);return n!=null&&p(t,["_url","operationName"],n),t}function Vw(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],$w(s)),t}function $w(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["parent"]);r!=null&&p(t,["parent"],r);const a=u(e,["documentName"]);return a!=null&&p(t,["documentName"],a),t}function jf(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],Ww(s)),t}function Ww(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["parent"]);r!=null&&p(t,["parent"],r);const a=u(e,["documentName"]);return a!=null&&p(t,["documentName"],a),t}function Yw(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["uri"],n);const r=u(e,["encodedVideo"]);r!=null&&p(t,["videoBytes"],Du(r));const a=u(e,["encoding"]);return a!=null&&p(t,["mimeType"],a),t}function qw(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["uri"],n);const r=u(e,["bytesBase64Encoded"]);r!=null&&p(t,["videoBytes"],Du(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ih;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Ih||(Ih={}));var Ph;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(Ph||(Ph={}));var Rh;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(Rh||(Rh={}));var pt;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(pt||(pt={}));var Mh;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Mh||(Mh={}));var Lh;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Lh||(Lh={}));var jh;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(jh||(jh={}));var Dh;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Dh||(Dh={}));var Oh;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Oh||(Oh={}));var Fh;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(Fh||(Fh={}));var zh;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(zh||(zh={}));var Gh;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(Gh||(Gh={}));var Uh;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(Uh||(Uh={}));var Hh;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})(Hh||(Hh={}));var Bh;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Bh||(Bh={}));var Vh;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Vh||(Vh={}));var $h;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})($h||($h={}));var Wh;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(Wh||(Wh={}));var Yh;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Yh||(Yh={}));var Ui;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(Ui||(Ui={}));var qh;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(qh||(qh={}));var Kh;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Kh||(Kh={}));var Jh;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Jh||(Jh={}));var Nd;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Nd||(Nd={}));var Xh;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Xh||(Xh={}));var Zh;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Zh||(Zh={}));var Qh;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(Qh||(Qh={}));var em;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(em||(em={}));var tm;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(tm||(tm={}));var nm;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(nm||(nm={}));var om;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(om||(om={}));var rm;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(rm||(rm={}));var am;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(am||(am={}));var im;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(im||(im={}));var sm;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(sm||(sm={}));var lm;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(lm||(lm={}));var cm;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(cm||(cm={}));var dm;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(dm||(dm={}));var um;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(um||(um={}));var pm;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(pm||(pm={}));var hm;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(hm||(hm={}));var mm;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(mm||(mm={}));var gm;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"})(gm||(gm={}));var fm;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(fm||(fm={}));var ym;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(ym||(ym={}));var xm;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"})(xm||(xm={}));var vm;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(vm||(vm={}));var bm;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(bm||(bm={}));var wm;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(wm||(wm={}));var _m;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(_m||(_m={}));var Cm;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Cm||(Cm={}));var Sm;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(Sm||(Sm={}));var Tm;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Tm||(Tm={}));var Em;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Em||(Em={}));var Nm;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(Nm||(Nm={}));var ba;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(ba||(ba={}));class kd{constructor(t){const n={};for(const r of t.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=t}json(){return this.responseInternal.json()}}class ii{get text(){var t,n,r,a,i,s,l,c;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const g=[];for(const m of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[w,y]of Object.entries(m))w!=="text"&&w!=="thought"&&w!=="thoughtSignature"&&(y!==null||y!==void 0)&&g.push(w);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;h=!0,d+=m.text}}return g.length>0&&console.warn(`there are non-text parts ${g} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var t,n,r,a,i,s,l,c;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const g of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[m,w]of Object.entries(g))m!=="inlineData"&&(w!==null||w!==void 0)&&h.push(m);g.inlineData&&typeof g.inlineData.data=="string"&&(d+=atob(g.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var t,n,r,a,i,s,l,c;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,n,r,a,i,s,l,c,d;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(g=>g.executableCode).map(g=>g.executableCode).filter(g=>g!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,n,r,a,i,s,l,c,d;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(g=>g.codeExecutionResult).map(g=>g.codeExecutionResult).filter(g=>g!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class km{}class Am{}class Kw{}class Jw{}class Xw{}class Zw{}class Im{}class Pm{}class Rm{}class Qw{}class hl{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const r=new hl;let a;const i=t;return n?a=Ow(i):a=Dw(i),Object.assign(r,a),r}}class Mm{}class Lm{}class jm{}class Dm{}class e_{}class t_{}class n_{}class Ou{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const r=new Ou,i=Vw(t);return Object.assign(r,i),r}}class o_{}class r_{}class a_{}class Om{}class i_{get text(){var t,n,r;let a="",i=!1;const s=[];for(const l of(r=(n=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(l))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;i=!0,a+=l.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?a:void 0}get data(){var t,n,r;let a="";const i=[];for(const s of(r=(n=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[l,c]of Object.entries(s))l!=="inlineData"&&c!==null&&i.push(l);s.inlineData&&typeof s.inlineData.data=="string"&&(a+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class s_{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Fu{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const r=new Fu,i=jf(t);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Et(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const n=t.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Df(e,t){const n=Et(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function Of(e){return Array.isArray(e)?e.map(t=>ml(t)):[ml(e)]}function ml(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function Ff(e){const t=ml(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function zf(e){const t=ml(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Fm(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Gf(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>Fm(t)):[Fm(e)]}function Ad(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function zm(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function Gm(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function jn(e){if(e==null)throw new Error("ContentUnion is required");return Ad(e)?e:{role:"user",parts:Gf(e)}}function zu(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(n=>{const r=jn(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(e.isVertexAI()){const n=jn(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(t)?t.map(n=>jn(n)):[jn(t)]}function ho(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(zm(e)||Gm(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[jn(e)]}const t=[],n=[],r=Ad(e[0]);for(const a of e){const i=Ad(a);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)t.push(a);else{if(zm(a)||Gm(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(a)}}return r||t.push({role:"user",parts:Gf(n)}),t}function l_(e,t){e.includes("null")&&(t.nullable=!0);const n=e.filter(r=>r!=="null");if(n.length===1)t.type=Object.values(pt).includes(n[0].toUpperCase())?n[0].toUpperCase():pt.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const r of n)t.anyOf.push({type:Object.values(pt).includes(r.toUpperCase())?r.toUpperCase():pt.TYPE_UNSPECIFIED})}}function ka(e){const t={},n=["items"],r=["anyOf"],a=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=e.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(t.nullable=!0,e=i[1]):i[1].type==="null"&&(t.nullable=!0,e=i[0])),e.type instanceof Array&&l_(e.type,t);for(const[s,l]of Object.entries(e))if(l!=null)if(s=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;t.type=Object.values(pt).includes(l.toUpperCase())?l.toUpperCase():pt.TYPE_UNSPECIFIED}else if(n.includes(s))t[s]=ka(l);else if(r.includes(s)){const c=[];for(const d of l){if(d.type=="null"){t.nullable=!0;continue}c.push(ka(d))}t[s]=c}else if(a.includes(s)){const c={};for(const[d,h]of Object.entries(l))c[d]=ka(h);t[s]=c}else{if(s==="additionalProperties")continue;t[s]=l}return t}function Gu(e){return ka(e)}function Uu(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function Hu(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Ua(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=ka(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=ka(t.response));return e}function Ha(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function c_(e,t,n,r=1){const a=!t.startsWith(`${n}/`)&&t.split("/").length===r;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:a?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t:a?`${n}/${t}`:t}function Zo(e,t){if(typeof t!="string")throw new Error("name must be a string");return c_(e,t,"cachedContents")}function Uf(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function Er(e){return Du(e)}function d_(e){return e!=null&&typeof e=="object"&&"name"in e}function u_(e){return e!=null&&typeof e=="object"&&"video"in e}function p_(e){return e!=null&&typeof e=="object"&&"uri"in e}function Hf(e){var t;let n;if(d_(e)&&(n=e.name),!(p_(e)&&(n=e.uri,n===void 0))&&!(u_(e)&&(n=(t=e.video)===null||t===void 0?void 0:t.uri,n===void 0))){if(typeof e=="string"&&(n=e),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const a=n.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${n}`);n=a[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Bf(e,t){let n;return e.isVertexAI()?n=t?"publishers/google/models":"models":n=t?"models":"tunedModels",n}function Vf(e){for(const t of["models","tunedModels","publisherModels"])if(h_(e,t))return e[t];return[]}function h_(e,t){return e!==null&&typeof e=="object"&&t in e}function m_(e,t={}){const n=e,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}function g_(e,t={}){const n=[],r=new Set;for(const a of e){const i=a.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=m_(a,t);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function $f(e,t){let n;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,a=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function f_(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function Wf(e){if(typeof e!="object"||e===null)return{};const t=e,n=t.inlinedResponses;if(typeof n!="object"||n===null)return e;const a=n.inlinedResponses;if(!Array.isArray(a)||a.length===0)return e;let i=!1;for(const s of a){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){i=!0;break}}return i&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function Ba(e,t){const n=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Yf(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function y_(e){const t={},n=u(e,["responsesFile"]);n!=null&&p(t,["fileName"],n);const r=u(e,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>X_(s))),p(t,["inlinedResponses"],i)}const a=u(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["inlinedEmbedContentResponses"],i)}return t}function x_(e){const t={},n=u(e,["predictionsFormat"]);n!=null&&p(t,["format"],n);const r=u(e,["gcsDestination","outputUriPrefix"]);r!=null&&p(t,["gcsUri"],r);const a=u(e,["bigqueryDestination","outputUri"]);return a!=null&&p(t,["bigqueryUri"],a),t}function v_(e){const t={},n=u(e,["format"]);n!=null&&p(t,["predictionsFormat"],n);const r=u(e,["gcsUri"]);r!=null&&p(t,["gcsDestination","outputUriPrefix"],r);const a=u(e,["bigqueryUri"]);if(a!=null&&p(t,["bigqueryDestination","outputUri"],a),u(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(u(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Us(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata","displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["metadata","state"]);a!=null&&p(t,["state"],Yf(a));const i=u(e,["metadata","createTime"]);i!=null&&p(t,["createTime"],i);const s=u(e,["metadata","endTime"]);s!=null&&p(t,["endTime"],s);const l=u(e,["metadata","updateTime"]);l!=null&&p(t,["updateTime"],l);const c=u(e,["metadata","model"]);c!=null&&p(t,["model"],c);const d=u(e,["metadata","output"]);return d!=null&&p(t,["dest"],y_(Wf(d))),t}function Id(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["state"]);a!=null&&p(t,["state"],Yf(a));const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["createTime"]);s!=null&&p(t,["createTime"],s);const l=u(e,["startTime"]);l!=null&&p(t,["startTime"],l);const c=u(e,["endTime"]);c!=null&&p(t,["endTime"],c);const d=u(e,["updateTime"]);d!=null&&p(t,["updateTime"],d);const h=u(e,["model"]);h!=null&&p(t,["model"],h);const g=u(e,["inputConfig"]);g!=null&&p(t,["src"],b_(g));const m=u(e,["outputConfig"]);m!=null&&p(t,["dest"],x_(Wf(m)));const w=u(e,["completionStats"]);return w!=null&&p(t,["completionStats"],w),t}function b_(e){const t={},n=u(e,["instancesFormat"]);n!=null&&p(t,["format"],n);const r=u(e,["gcsSource","uris"]);r!=null&&p(t,["gcsUri"],r);const a=u(e,["bigquerySource","inputUri"]);return a!=null&&p(t,["bigqueryUri"],a),t}function w_(e,t){const n={};if(u(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(u(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=u(t,["fileName"]);r!=null&&p(n,["fileName"],r);const a=u(t,["inlinedRequests"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>J_(e,s))),p(n,["requests","requests"],i)}return n}function __(e){const t={},n=u(e,["format"]);n!=null&&p(t,["instancesFormat"],n);const r=u(e,["gcsUri"]);r!=null&&p(t,["gcsSource","uris"],r);const a=u(e,["bigqueryUri"]);if(a!=null&&p(t,["bigquerySource","inputUri"],a),u(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function C_(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function S_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Ba(e,r)),n}function T_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Ba(e,r)),n}function E_(e){const t={},n=u(e,["content"]);n!=null&&p(t,["content"],n);const r=u(e,["citationMetadata"]);r!=null&&p(t,["citationMetadata"],N_(r));const a=u(e,["tokenCount"]);a!=null&&p(t,["tokenCount"],a);const i=u(e,["finishReason"]);i!=null&&p(t,["finishReason"],i);const s=u(e,["avgLogprobs"]);s!=null&&p(t,["avgLogprobs"],s);const l=u(e,["groundingMetadata"]);l!=null&&p(t,["groundingMetadata"],l);const c=u(e,["index"]);c!=null&&p(t,["index"],c);const d=u(e,["logprobsResult"]);d!=null&&p(t,["logprobsResult"],d);const h=u(e,["safetyRatings"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(w=>w)),p(t,["safetyRatings"],m)}const g=u(e,["urlContextMetadata"]);return g!=null&&p(t,["urlContextMetadata"],g),t}function N_(e){const t={},n=u(e,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),p(t,["citations"],r)}return t}function qf(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>rC(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function k_(e,t){const n={},r=u(e,["displayName"]);if(t!==void 0&&r!=null&&p(t,["batch","displayName"],r),u(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function A_(e,t){const n={},r=u(e,["displayName"]);t!==void 0&&r!=null&&p(t,["displayName"],r);const a=u(e,["dest"]);return t!==void 0&&a!=null&&p(t,["outputConfig"],v_(f_(a))),n}function Um(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["src"]);a!=null&&p(n,["batch","inputConfig"],w_(e,$f(e,a)));const i=u(t,["config"]);return i!=null&&k_(i,n),n}function I_(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["model"],Et(e,r));const a=u(t,["src"]);a!=null&&p(n,["inputConfig"],__($f(e,a)));const i=u(t,["config"]);return i!=null&&A_(i,n),n}function P_(e,t){const n={},r=u(e,["displayName"]);return t!==void 0&&r!=null&&p(t,["batch","displayName"],r),n}function R_(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["src"]);a!=null&&p(n,["batch","inputConfig"],z_(e,a));const i=u(t,["config"]);return i!=null&&P_(i,n),n}function M_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Ba(e,r)),n}function L_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Ba(e,r)),n}function j_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);return i!=null&&p(t,["error"],i),t}function D_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);return i!=null&&p(t,["error"],i),t}function O_(e,t){const n={},r=u(t,["contents"]);if(r!=null){let i=zu(e,r);Array.isArray(i)&&(i=i.map(s=>s)),p(n,["requests[]","request","content"],i)}const a=u(t,["config"]);return a!=null&&(p(n,["_self"],F_(a,n)),Lw(n,{"requests[].*":"requests[].request.*"})),n}function F_(e,t){const n={},r=u(e,["taskType"]);t!==void 0&&r!=null&&p(t,["requests[]","taskType"],r);const a=u(e,["title"]);t!==void 0&&a!=null&&p(t,["requests[]","title"],a);const i=u(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&p(t,["requests[]","outputDimensionality"],i),u(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function z_(e,t){const n={},r=u(t,["fileName"]);r!=null&&p(n,["file_name"],r);const a=u(t,["inlinedRequests"]);return a!=null&&p(n,["requests"],O_(e,a)),n}function G_(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function U_(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function H_(e){const t={},n=u(e,["mode"]);n!=null&&p(t,["mode"],n);const r=u(e,["allowedFunctionNames"]);if(r!=null&&p(t,["allowedFunctionNames"],r),u(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function B_(e,t,n){const r={},a=u(t,["systemInstruction"]);n!==void 0&&a!=null&&p(n,["systemInstruction"],qf(jn(a)));const i=u(t,["temperature"]);i!=null&&p(r,["temperature"],i);const s=u(t,["topP"]);s!=null&&p(r,["topP"],s);const l=u(t,["topK"]);l!=null&&p(r,["topK"],l);const c=u(t,["candidateCount"]);c!=null&&p(r,["candidateCount"],c);const d=u(t,["maxOutputTokens"]);d!=null&&p(r,["maxOutputTokens"],d);const h=u(t,["stopSequences"]);h!=null&&p(r,["stopSequences"],h);const g=u(t,["responseLogprobs"]);g!=null&&p(r,["responseLogprobs"],g);const m=u(t,["logprobs"]);m!=null&&p(r,["logprobs"],m);const w=u(t,["presencePenalty"]);w!=null&&p(r,["presencePenalty"],w);const y=u(t,["frequencyPenalty"]);y!=null&&p(r,["frequencyPenalty"],y);const b=u(t,["seed"]);b!=null&&p(r,["seed"],b);const S=u(t,["responseMimeType"]);S!=null&&p(r,["responseMimeType"],S);const _=u(t,["responseSchema"]);_!=null&&p(r,["responseSchema"],Gu(_));const v=u(t,["responseJsonSchema"]);if(v!=null&&p(r,["responseJsonSchema"],v),u(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const f=u(t,["safetySettings"]);if(n!==void 0&&f!=null){let H=f;Array.isArray(H)&&(H=H.map($=>aC($))),p(n,["safetySettings"],H)}const T=u(t,["tools"]);if(n!==void 0&&T!=null){let H=Ha(T);Array.isArray(H)&&(H=H.map($=>sC(Ua($)))),p(n,["tools"],H)}const A=u(t,["toolConfig"]);if(n!==void 0&&A!=null&&p(n,["toolConfig"],iC(A)),u(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const I=u(t,["cachedContent"]);n!==void 0&&I!=null&&p(n,["cachedContent"],Zo(e,I));const M=u(t,["responseModalities"]);M!=null&&p(r,["responseModalities"],M);const N=u(t,["mediaResolution"]);N!=null&&p(r,["mediaResolution"],N);const k=u(t,["speechConfig"]);if(k!=null&&p(r,["speechConfig"],Uu(k)),u(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const E=u(t,["thinkingConfig"]);E!=null&&p(r,["thinkingConfig"],E);const P=u(t,["imageConfig"]);P!=null&&p(r,["imageConfig"],K_(P));const L=u(t,["enableEnhancedCivicAnswers"]);return L!=null&&p(r,["enableEnhancedCivicAnswers"],L),r}function V_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>E_(d))),p(t,["candidates"],c)}const a=u(e,["modelVersion"]);a!=null&&p(t,["modelVersion"],a);const i=u(e,["promptFeedback"]);i!=null&&p(t,["promptFeedback"],i);const s=u(e,["responseId"]);s!=null&&p(t,["responseId"],s);const l=u(e,["usageMetadata"]);return l!=null&&p(t,["usageMetadata"],l),t}function $_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Ba(e,r)),n}function W_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Ba(e,r)),n}function Y_(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function q_(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function K_(e){const t={},n=u(e,["aspectRatio"]);n!=null&&p(t,["aspectRatio"],n);const r=u(e,["imageSize"]);if(r!=null&&p(t,["imageSize"],r),u(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function J_(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["request","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let l=ho(a);Array.isArray(l)&&(l=l.map(c=>qf(c))),p(n,["request","contents"],l)}const i=u(t,["metadata"]);i!=null&&p(n,["metadata"],i);const s=u(t,["config"]);return s!=null&&p(n,["request","generationConfig"],B_(e,s,u(n,["request"],{}))),n}function X_(e){const t={},n=u(e,["response"]);n!=null&&p(t,["response"],V_(n));const r=u(e,["error"]);return r!=null&&p(t,["error"],r),t}function Z_(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);if(t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),u(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Q_(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);t!==void 0&&a!=null&&p(t,["_query","pageToken"],a);const i=u(e,["filter"]);return t!==void 0&&i!=null&&p(t,["_query","filter"],i),n}function eC(e){const t={},n=u(e,["config"]);return n!=null&&Z_(n,t),t}function tC(e){const t={},n=u(e,["config"]);return n!=null&&Q_(n,t),t}function nC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["operations"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>Us(s))),p(t,["batchJobs"],i)}return t}function oC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["batchPredictionJobs"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>Id(s))),p(t,["batchJobs"],i)}return t}function rC(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],G_(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],U_(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],C_(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function aC(e){const t={},n=u(e,["category"]);if(n!=null&&p(t,["category"],n),u(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=u(e,["threshold"]);return r!=null&&p(t,["threshold"],r),t}function iC(e){const t={},n=u(e,["functionCallingConfig"]);n!=null&&p(t,["functionCallingConfig"],H_(n));const r=u(e,["retrievalConfig"]);return r!=null&&p(t,["retrievalConfig"],r),t}function sC(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],Y_(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],q_(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var qo;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})(qo||(qo={}));class Zr{constructor(t,n,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(t,r,a)}init(t,n,r){var a,i;this.nameInternal=t,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(a=s.config)===null||a===void 0?void 0:a.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lC extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Zr(qo.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(t){const n=Um(this.apiClient,t),r=n._url,a=Ye("{model}:batchGenerateContent",r),l=n.batch.inputConfig.requests,c=l.requests,d=[];for(const h of c){const g=Object.assign({},h);if(g.systemInstruction){const m=g.systemInstruction;delete g.systemInstruction;const w=g.request;w.systemInstruction=m,g.request=w}d.push(g)}return l.requests=d,delete n.config,delete n._url,delete n._query,{path:a,body:n}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,n){const r=n?Object.assign({},n):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const i=this.getGcsUri(t),s=this.getBigqueryUri(t);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${a}`;else if(s)r.dest=`${s}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=I_(this.apiClient,t);return l=Ye("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Id(h))}else{const d=Um(this.apiClient,t);return l=Ye("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Us(h))}}async createEmbeddingsInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=R_(this.apiClient,t);return i=Ye("{model}:asyncBatchEmbedContent",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>Us(c))}}async get(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=W_(this.apiClient,t);return l=Ye("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Id(h))}else{const d=$_(this.apiClient,t);return l=Ye("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Us(h))}}async cancel(t){var n,r,a,i;let s="",l={};if(this.apiClient.isVertexAI()){const c=T_(this.apiClient,t);s=Ye("batchPredictionJobs/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=S_(this.apiClient,t);s=Ye("batches/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=tC(t);return l=Ye("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=oC(h),m=new Om;return Object.assign(m,g),m})}else{const d=eC(t);return l=Ye("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=nC(h),m=new Om;return Object.assign(m,g),m})}}async delete(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=L_(this.apiClient,t);return l=Ye("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>D_(h))}else{const d=M_(this.apiClient,t);return l=Ye("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>j_(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cC(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function Hm(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>RC(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function dC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);t!==void 0&&a!=null&&p(t,["expireTime"],a);const i=u(e,["displayName"]);t!==void 0&&i!=null&&p(t,["displayName"],i);const s=u(e,["contents"]);if(t!==void 0&&s!=null){let h=ho(s);Array.isArray(h)&&(h=h.map(g=>Hm(g))),p(t,["contents"],h)}const l=u(e,["systemInstruction"]);t!==void 0&&l!=null&&p(t,["systemInstruction"],Hm(jn(l)));const c=u(e,["tools"]);if(t!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(g=>LC(g))),p(t,["tools"],h)}const d=u(e,["toolConfig"]);if(t!==void 0&&d!=null&&p(t,["toolConfig"],MC(d)),u(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function uC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);t!==void 0&&a!=null&&p(t,["expireTime"],a);const i=u(e,["displayName"]);t!==void 0&&i!=null&&p(t,["displayName"],i);const s=u(e,["contents"]);if(t!==void 0&&s!=null){let g=ho(s);Array.isArray(g)&&(g=g.map(m=>m)),p(t,["contents"],g)}const l=u(e,["systemInstruction"]);t!==void 0&&l!=null&&p(t,["systemInstruction"],jn(l));const c=u(e,["tools"]);if(t!==void 0&&c!=null){let g=c;Array.isArray(g)&&(g=g.map(m=>jC(m))),p(t,["tools"],g)}const d=u(e,["toolConfig"]);t!==void 0&&d!=null&&p(t,["toolConfig"],d);const h=u(e,["kmsKeyName"]);return t!==void 0&&h!=null&&p(t,["encryption_spec","kmsKeyName"],h),n}function pC(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["model"],Df(e,r));const a=u(t,["config"]);return a!=null&&dC(a,n),n}function hC(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["model"],Df(e,r));const a=u(t,["config"]);return a!=null&&uC(a,n),n}function mC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Zo(e,r)),n}function gC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Zo(e,r)),n}function fC(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function yC(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function xC(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function vC(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function bC(e){const t={},n=u(e,["mode"]);n!=null&&p(t,["mode"],n);const r=u(e,["allowedFunctionNames"]);if(r!=null&&p(t,["allowedFunctionNames"],r),u(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function wC(e){const t={};if(u(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=u(e,["description"]);n!=null&&p(t,["description"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["parameters"]);a!=null&&p(t,["parameters"],a);const i=u(e,["parametersJsonSchema"]);i!=null&&p(t,["parametersJsonSchema"],i);const s=u(e,["response"]);s!=null&&p(t,["response"],s);const l=u(e,["responseJsonSchema"]);return l!=null&&p(t,["responseJsonSchema"],l),t}function _C(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Zo(e,r)),n}function CC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Zo(e,r)),n}function SC(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function TC(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function EC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function NC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function kC(e){const t={},n=u(e,["config"]);return n!=null&&EC(n,t),t}function AC(e){const t={},n=u(e,["config"]);return n!=null&&NC(n,t),t}function IC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["cachedContents"],i)}return t}function PC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["cachedContents"],i)}return t}function RC(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],xC(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],vC(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],cC(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function MC(e){const t={},n=u(e,["functionCallingConfig"]);n!=null&&p(t,["functionCallingConfig"],bC(n));const r=u(e,["retrievalConfig"]);return r!=null&&p(t,["retrievalConfig"],r),t}function LC(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],SC(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],TC(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}function jC(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(m=>wC(m))),p(t,["functionDeclarations"],g)}const r=u(e,["retrieval"]);r!=null&&p(t,["retrieval"],r);const a=u(e,["googleSearchRetrieval"]);a!=null&&p(t,["googleSearchRetrieval"],a);const i=u(e,["computerUse"]);if(i!=null&&p(t,["computerUse"],i),u(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=u(e,["codeExecution"]);s!=null&&p(t,["codeExecution"],s);const l=u(e,["enterpriseWebSearch"]);l!=null&&p(t,["enterpriseWebSearch"],l);const c=u(e,["googleMaps"]);c!=null&&p(t,["googleMaps"],c);const d=u(e,["googleSearch"]);d!=null&&p(t,["googleSearch"],d);const h=u(e,["urlContext"]);return h!=null&&p(t,["urlContext"],h),t}function DC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);return t!==void 0&&a!=null&&p(t,["expireTime"],a),n}function OC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);return t!==void 0&&a!=null&&p(t,["expireTime"],a),n}function FC(e,t){const n={},r=u(t,["name"]);r!=null&&p(n,["_url","name"],Zo(e,r));const a=u(t,["config"]);return a!=null&&DC(a,n),n}function zC(e,t){const n={},r=u(t,["name"]);r!=null&&p(n,["_url","name"],Zo(e,r));const a=u(t,["config"]);return a!=null&&OC(a,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GC extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Zr(qo.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=hC(this.apiClient,t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=pC(this.apiClient,t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=CC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=_C(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=gC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=yC(h),m=new jm;return Object.assign(m,g),m})}else{const d=mC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=fC(h),m=new jm;return Object.assign(m,g),m})}}async update(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=zC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=FC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=AC(t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=PC(h),m=new Dm;return Object.assign(m,g),m})}else{const d=kC(t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=IC(h),m=new Dm;return Object.assign(m,g),m})}}}function gl(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function Bm(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ft(e){return this instanceof ft?(this.v=e,this):new ft(e)}function To(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(w){return function(y){return Promise.resolve(y).then(w,g)}}function l(w,y){r[w]&&(a[w]=function(b){return new Promise(function(S,_){i.push([w,b,S,_])>1||c(w,b)})},y&&(a[w]=y(a[w])))}function c(w,y){try{d(r[w](y))}catch(b){m(i[0][3],b)}}function d(w){w.value instanceof ft?Promise.resolve(w.value.v).then(h,g):m(i[0][2],w)}function h(w){c("next",w)}function g(w){c("throw",w)}function m(w,y){w(y),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Eo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Bm=="function"?Bm(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=e[i]&&function(s){return new Promise(function(l,c){s=e[i](s),a(l,c,s.done,s.value)})}}function a(i,s,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function UC(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return n===void 0?!1:Kf(n)}function Kf(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function HC(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function Vm(e){if(e===void 0||e.length===0)return[];const t=[],n=e.length;let r=0;for(;r<n;)if(e[r].role==="user")t.push(e[r]),r++;else{const a=[];let i=!0;for(;r<n&&e[r].role==="model";)a.push(e[r]),i&&!Kf(e[r])&&(i=!1),r++;i?t.push(...a):t.pop()}return t}class BC{constructor(t,n){this.modelsModule=t,this.apiClient=n}create(t){return new VC(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class VC{constructor(t,n,r,a={},i=[]){this.apiClient=t,this.modelsModule=n,this.model=r,this.config=a,this.history=i,this.sendPromise=Promise.resolve(),HC(i)}async sendMessage(t){var n;await this.sendPromise;const r=jn(t.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=t.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var i,s,l;const c=await a,d=(s=(i=c.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,h=c.automaticFunctionCallingHistory,g=this.getHistory(!0).length;let m=[];h!=null&&(m=(l=h.slice(g))!==null&&l!==void 0?l:[]);const w=d?[d]:[];this.recordHistory(r,w,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(t){var n;await this.sendPromise;const r=jn(t.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=t.config)!==null&&n!==void 0?n:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const i=await a;return this.processStreamResponse(i,r)}getHistory(t=!1){const n=t?Vm(this.history):this.history;return structuredClone(n)}processStreamResponse(t,n){return To(this,arguments,function*(){var a,i,s,l,c,d;const h=[];try{for(var g=!0,m=Eo(t),w;w=yield ft(m.next()),a=w.done,!a;g=!0){l=w.value,g=!1;const y=l;if(UC(y)){const b=(d=(c=y.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;b!==void 0&&h.push(b)}yield yield ft(y)}}catch(y){i={error:y}}finally{try{!g&&!a&&(s=m.return)&&(yield ft(s.call(m)))}finally{if(i)throw i.error}}this.recordHistory(n,h)})}recordHistory(t,n,r){let a=[];n.length>0&&n.every(i=>i.role!==void 0)?a=n:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Vm(r)):this.history.push(t),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Dl extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Dl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $C(e){const t={},n=u(e,["file"]);return n!=null&&p(t,["file"],n),t}function WC(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function YC(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","file"],Hf(n)),t}function qC(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function KC(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","file"],Hf(n)),t}function JC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function XC(e){const t={},n=u(e,["config"]);return n!=null&&JC(n,t),t}function ZC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["files"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["files"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class QC extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Zr(qo.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(n=>n)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=XC(t);return i=Ye("files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=ZC(c),h=new o_;return Object.assign(h,d),h})}}async createInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=$C(t);return i=Ye("upload/v1beta/files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=WC(c),h=new r_;return Object.assign(h,d),h})}}async get(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=KC(t);return i=Ye("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=YC(t);return i=Ye("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=qC(c),h=new a_;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Hs(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function eS(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>fS(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function tS(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function nS(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function oS(e){const t={};if(u(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=u(e,["description"]);n!=null&&p(t,["description"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["parameters"]);a!=null&&p(t,["parameters"],a);const i=u(e,["parametersJsonSchema"]);i!=null&&p(t,["parametersJsonSchema"],i);const s=u(e,["response"]);s!=null&&p(t,["response"],s);const l=u(e,["responseJsonSchema"]);return l!=null&&p(t,["responseJsonSchema"],l),t}function rS(e){const t={},n=u(e,["modelSelectionConfig"]);n!=null&&p(t,["modelConfig"],n);const r=u(e,["responseJsonSchema"]);r!=null&&p(t,["responseJsonSchema"],r);const a=u(e,["audioTimestamp"]);a!=null&&p(t,["audioTimestamp"],a);const i=u(e,["candidateCount"]);i!=null&&p(t,["candidateCount"],i);const s=u(e,["enableAffectiveDialog"]);s!=null&&p(t,["enableAffectiveDialog"],s);const l=u(e,["frequencyPenalty"]);l!=null&&p(t,["frequencyPenalty"],l);const c=u(e,["logprobs"]);c!=null&&p(t,["logprobs"],c);const d=u(e,["maxOutputTokens"]);d!=null&&p(t,["maxOutputTokens"],d);const h=u(e,["mediaResolution"]);h!=null&&p(t,["mediaResolution"],h);const g=u(e,["presencePenalty"]);g!=null&&p(t,["presencePenalty"],g);const m=u(e,["responseLogprobs"]);m!=null&&p(t,["responseLogprobs"],m);const w=u(e,["responseMimeType"]);w!=null&&p(t,["responseMimeType"],w);const y=u(e,["responseModalities"]);y!=null&&p(t,["responseModalities"],y);const b=u(e,["responseSchema"]);b!=null&&p(t,["responseSchema"],b);const S=u(e,["routingConfig"]);S!=null&&p(t,["routingConfig"],S);const _=u(e,["seed"]);_!=null&&p(t,["seed"],_);const v=u(e,["speechConfig"]);v!=null&&p(t,["speechConfig"],v);const f=u(e,["stopSequences"]);f!=null&&p(t,["stopSequences"],f);const T=u(e,["temperature"]);T!=null&&p(t,["temperature"],T);const A=u(e,["thinkingConfig"]);A!=null&&p(t,["thinkingConfig"],A);const I=u(e,["topK"]);I!=null&&p(t,["topK"],I);const M=u(e,["topP"]);if(M!=null&&p(t,["topP"],M),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function aS(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function iS(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function sS(e,t){const n={},r=u(e,["generationConfig"]);t!==void 0&&r!=null&&p(t,["setup","generationConfig"],r);const a=u(e,["responseModalities"]);t!==void 0&&a!=null&&p(t,["setup","generationConfig","responseModalities"],a);const i=u(e,["temperature"]);t!==void 0&&i!=null&&p(t,["setup","generationConfig","temperature"],i);const s=u(e,["topP"]);t!==void 0&&s!=null&&p(t,["setup","generationConfig","topP"],s);const l=u(e,["topK"]);t!==void 0&&l!=null&&p(t,["setup","generationConfig","topK"],l);const c=u(e,["maxOutputTokens"]);t!==void 0&&c!=null&&p(t,["setup","generationConfig","maxOutputTokens"],c);const d=u(e,["mediaResolution"]);t!==void 0&&d!=null&&p(t,["setup","generationConfig","mediaResolution"],d);const h=u(e,["seed"]);t!==void 0&&h!=null&&p(t,["setup","generationConfig","seed"],h);const g=u(e,["speechConfig"]);t!==void 0&&g!=null&&p(t,["setup","generationConfig","speechConfig"],Hu(g));const m=u(e,["thinkingConfig"]);t!==void 0&&m!=null&&p(t,["setup","generationConfig","thinkingConfig"],m);const w=u(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&p(t,["setup","generationConfig","enableAffectiveDialog"],w);const y=u(e,["systemInstruction"]);t!==void 0&&y!=null&&p(t,["setup","systemInstruction"],eS(jn(y)));const b=u(e,["tools"]);if(t!==void 0&&b!=null){let I=Ha(b);Array.isArray(I)&&(I=I.map(M=>xS(Ua(M)))),p(t,["setup","tools"],I)}const S=u(e,["sessionResumption"]);t!==void 0&&S!=null&&p(t,["setup","sessionResumption"],yS(S));const _=u(e,["inputAudioTranscription"]);t!==void 0&&_!=null&&p(t,["setup","inputAudioTranscription"],_);const v=u(e,["outputAudioTranscription"]);t!==void 0&&v!=null&&p(t,["setup","outputAudioTranscription"],v);const f=u(e,["realtimeInputConfig"]);t!==void 0&&f!=null&&p(t,["setup","realtimeInputConfig"],f);const T=u(e,["contextWindowCompression"]);t!==void 0&&T!=null&&p(t,["setup","contextWindowCompression"],T);const A=u(e,["proactivity"]);if(t!==void 0&&A!=null&&p(t,["setup","proactivity"],A),u(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function lS(e,t){const n={},r=u(e,["generationConfig"]);t!==void 0&&r!=null&&p(t,["setup","generationConfig"],rS(r));const a=u(e,["responseModalities"]);t!==void 0&&a!=null&&p(t,["setup","generationConfig","responseModalities"],a);const i=u(e,["temperature"]);t!==void 0&&i!=null&&p(t,["setup","generationConfig","temperature"],i);const s=u(e,["topP"]);t!==void 0&&s!=null&&p(t,["setup","generationConfig","topP"],s);const l=u(e,["topK"]);t!==void 0&&l!=null&&p(t,["setup","generationConfig","topK"],l);const c=u(e,["maxOutputTokens"]);t!==void 0&&c!=null&&p(t,["setup","generationConfig","maxOutputTokens"],c);const d=u(e,["mediaResolution"]);t!==void 0&&d!=null&&p(t,["setup","generationConfig","mediaResolution"],d);const h=u(e,["seed"]);t!==void 0&&h!=null&&p(t,["setup","generationConfig","seed"],h);const g=u(e,["speechConfig"]);t!==void 0&&g!=null&&p(t,["setup","generationConfig","speechConfig"],Hu(g));const m=u(e,["thinkingConfig"]);t!==void 0&&m!=null&&p(t,["setup","generationConfig","thinkingConfig"],m);const w=u(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&p(t,["setup","generationConfig","enableAffectiveDialog"],w);const y=u(e,["systemInstruction"]);t!==void 0&&y!=null&&p(t,["setup","systemInstruction"],jn(y));const b=u(e,["tools"]);if(t!==void 0&&b!=null){let M=Ha(b);Array.isArray(M)&&(M=M.map(N=>vS(Ua(N)))),p(t,["setup","tools"],M)}const S=u(e,["sessionResumption"]);t!==void 0&&S!=null&&p(t,["setup","sessionResumption"],S);const _=u(e,["inputAudioTranscription"]);t!==void 0&&_!=null&&p(t,["setup","inputAudioTranscription"],_);const v=u(e,["outputAudioTranscription"]);t!==void 0&&v!=null&&p(t,["setup","outputAudioTranscription"],v);const f=u(e,["realtimeInputConfig"]);t!==void 0&&f!=null&&p(t,["setup","realtimeInputConfig"],f);const T=u(e,["contextWindowCompression"]);t!==void 0&&T!=null&&p(t,["setup","contextWindowCompression"],T);const A=u(e,["proactivity"]);t!==void 0&&A!=null&&p(t,["setup","proactivity"],A);const I=u(e,["explicitVadSignal"]);return t!==void 0&&I!=null&&p(t,["setup","explicitVadSignal"],I),n}function cS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["setup","model"],Et(e,r));const a=u(t,["config"]);return a!=null&&p(n,["config"],sS(a,n)),n}function dS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["setup","model"],Et(e,r));const a=u(t,["config"]);return a!=null&&p(n,["config"],lS(a,n)),n}function uS(e){const t={},n=u(e,["musicGenerationConfig"]);return n!=null&&p(t,["musicGenerationConfig"],n),t}function pS(e){const t={},n=u(e,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),p(t,["weightedPrompts"],r)}return t}function hS(e){const t={},n=u(e,["media"]);if(n!=null){let d=Of(n);Array.isArray(d)&&(d=d.map(h=>Hs(h))),p(t,["mediaChunks"],d)}const r=u(e,["audio"]);r!=null&&p(t,["audio"],Hs(zf(r)));const a=u(e,["audioStreamEnd"]);a!=null&&p(t,["audioStreamEnd"],a);const i=u(e,["video"]);i!=null&&p(t,["video"],Hs(Ff(i)));const s=u(e,["text"]);s!=null&&p(t,["text"],s);const l=u(e,["activityStart"]);l!=null&&p(t,["activityStart"],l);const c=u(e,["activityEnd"]);return c!=null&&p(t,["activityEnd"],c),t}function mS(e){const t={},n=u(e,["media"]);if(n!=null){let d=Of(n);Array.isArray(d)&&(d=d.map(h=>h)),p(t,["mediaChunks"],d)}const r=u(e,["audio"]);r!=null&&p(t,["audio"],zf(r));const a=u(e,["audioStreamEnd"]);a!=null&&p(t,["audioStreamEnd"],a);const i=u(e,["video"]);i!=null&&p(t,["video"],Ff(i));const s=u(e,["text"]);s!=null&&p(t,["text"],s);const l=u(e,["activityStart"]);l!=null&&p(t,["activityStart"],l);const c=u(e,["activityEnd"]);return c!=null&&p(t,["activityEnd"],c),t}function gS(e){const t={},n=u(e,["setupComplete"]);n!=null&&p(t,["setupComplete"],n);const r=u(e,["serverContent"]);r!=null&&p(t,["serverContent"],r);const a=u(e,["toolCall"]);a!=null&&p(t,["toolCall"],a);const i=u(e,["toolCallCancellation"]);i!=null&&p(t,["toolCallCancellation"],i);const s=u(e,["usageMetadata"]);s!=null&&p(t,["usageMetadata"],bS(s));const l=u(e,["goAway"]);l!=null&&p(t,["goAway"],l);const c=u(e,["sessionResumptionUpdate"]);c!=null&&p(t,["sessionResumptionUpdate"],c);const d=u(e,["voiceActivityDetectionSignal"]);return d!=null&&p(t,["voiceActivityDetectionSignal"],d),t}function fS(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],tS(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],nS(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],Hs(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function yS(e){const t={},n=u(e,["handle"]);if(n!=null&&p(t,["handle"],n),u(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function xS(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],aS(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],iS(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}function vS(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(m=>oS(m))),p(t,["functionDeclarations"],g)}const r=u(e,["retrieval"]);r!=null&&p(t,["retrieval"],r);const a=u(e,["googleSearchRetrieval"]);a!=null&&p(t,["googleSearchRetrieval"],a);const i=u(e,["computerUse"]);if(i!=null&&p(t,["computerUse"],i),u(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=u(e,["codeExecution"]);s!=null&&p(t,["codeExecution"],s);const l=u(e,["enterpriseWebSearch"]);l!=null&&p(t,["enterpriseWebSearch"],l);const c=u(e,["googleMaps"]);c!=null&&p(t,["googleMaps"],c);const d=u(e,["googleSearch"]);d!=null&&p(t,["googleSearch"],d);const h=u(e,["urlContext"]);return h!=null&&p(t,["urlContext"],h),t}function bS(e){const t={},n=u(e,["promptTokenCount"]);n!=null&&p(t,["promptTokenCount"],n);const r=u(e,["cachedContentTokenCount"]);r!=null&&p(t,["cachedContentTokenCount"],r);const a=u(e,["candidatesTokenCount"]);a!=null&&p(t,["responseTokenCount"],a);const i=u(e,["toolUsePromptTokenCount"]);i!=null&&p(t,["toolUsePromptTokenCount"],i);const s=u(e,["thoughtsTokenCount"]);s!=null&&p(t,["thoughtsTokenCount"],s);const l=u(e,["totalTokenCount"]);l!=null&&p(t,["totalTokenCount"],l);const c=u(e,["promptTokensDetails"]);if(c!=null){let w=c;Array.isArray(w)&&(w=w.map(y=>y)),p(t,["promptTokensDetails"],w)}const d=u(e,["cacheTokensDetails"]);if(d!=null){let w=d;Array.isArray(w)&&(w=w.map(y=>y)),p(t,["cacheTokensDetails"],w)}const h=u(e,["candidatesTokensDetails"]);if(h!=null){let w=h;Array.isArray(w)&&(w=w.map(y=>y)),p(t,["responseTokensDetails"],w)}const g=u(e,["toolUsePromptTokensDetails"]);if(g!=null){let w=g;Array.isArray(w)&&(w=w.map(y=>y)),p(t,["toolUsePromptTokensDetails"],w)}const m=u(e,["trafficType"]);return m!=null&&p(t,["trafficType"],m),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wS(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function _S(e){const t={},n=u(e,["content"]);n!=null&&p(t,["content"],n);const r=u(e,["citationMetadata"]);r!=null&&p(t,["citationMetadata"],CS(r));const a=u(e,["tokenCount"]);a!=null&&p(t,["tokenCount"],a);const i=u(e,["finishReason"]);i!=null&&p(t,["finishReason"],i);const s=u(e,["avgLogprobs"]);s!=null&&p(t,["avgLogprobs"],s);const l=u(e,["groundingMetadata"]);l!=null&&p(t,["groundingMetadata"],l);const c=u(e,["index"]);c!=null&&p(t,["index"],c);const d=u(e,["logprobsResult"]);d!=null&&p(t,["logprobsResult"],d);const h=u(e,["safetyRatings"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(w=>w)),p(t,["safetyRatings"],m)}const g=u(e,["urlContextMetadata"]);return g!=null&&p(t,["urlContextMetadata"],g),t}function CS(e){const t={},n=u(e,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),p(t,["citations"],r)}return t}function SS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let i=ho(a);Array.isArray(i)&&(i=i.map(s=>s)),p(n,["contents"],i)}return n}function TS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),p(t,["tokensInfo"],a)}return t}function ES(e){const t={},n=u(e,["values"]);n!=null&&p(t,["values"],n);const r=u(e,["statistics"]);return r!=null&&p(t,["statistics"],NS(r)),t}function NS(e){const t={},n=u(e,["truncated"]);n!=null&&p(t,["truncated"],n);const r=u(e,["token_count"]);return r!=null&&p(t,["tokenCount"],r),t}function Ol(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>DT(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function kS(e){const t={},n=u(e,["controlType"]);n!=null&&p(t,["controlType"],n);const r=u(e,["enableControlImageComputation"]);return r!=null&&p(t,["computeControl"],r),t}function AS(e){const t={};if(u(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(u(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(u(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function IS(e,t){const n={},r=u(e,["systemInstruction"]);t!==void 0&&r!=null&&p(t,["systemInstruction"],jn(r));const a=u(e,["tools"]);if(t!==void 0&&a!=null){let s=a;Array.isArray(s)&&(s=s.map(l=>Qf(l))),p(t,["tools"],s)}const i=u(e,["generationConfig"]);return t!==void 0&&i!=null&&p(t,["generationConfig"],wT(i)),n}function PS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>Ol(l))),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&AS(i),n}function RS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>l)),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&IS(i,n),n}function MS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["totalTokens"]);r!=null&&p(t,["totalTokens"],r);const a=u(e,["cachedContentTokenCount"]);return a!=null&&p(t,["cachedContentTokenCount"],a),t}function LS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["totalTokens"]);return r!=null&&p(t,["totalTokens"],r),t}function jS(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Et(e,r)),n}function DS(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Et(e,r)),n}function OS(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function FS(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function zS(e,t){const n={},r=u(e,["outputGcsUri"]);t!==void 0&&r!=null&&p(t,["parameters","storageUri"],r);const a=u(e,["negativePrompt"]);t!==void 0&&a!=null&&p(t,["parameters","negativePrompt"],a);const i=u(e,["numberOfImages"]);t!==void 0&&i!=null&&p(t,["parameters","sampleCount"],i);const s=u(e,["aspectRatio"]);t!==void 0&&s!=null&&p(t,["parameters","aspectRatio"],s);const l=u(e,["guidanceScale"]);t!==void 0&&l!=null&&p(t,["parameters","guidanceScale"],l);const c=u(e,["seed"]);t!==void 0&&c!=null&&p(t,["parameters","seed"],c);const d=u(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&p(t,["parameters","safetySetting"],d);const h=u(e,["personGeneration"]);t!==void 0&&h!=null&&p(t,["parameters","personGeneration"],h);const g=u(e,["includeSafetyAttributes"]);t!==void 0&&g!=null&&p(t,["parameters","includeSafetyAttributes"],g);const m=u(e,["includeRaiReason"]);t!==void 0&&m!=null&&p(t,["parameters","includeRaiReason"],m);const w=u(e,["language"]);t!==void 0&&w!=null&&p(t,["parameters","language"],w);const y=u(e,["outputMimeType"]);t!==void 0&&y!=null&&p(t,["parameters","outputOptions","mimeType"],y);const b=u(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&p(t,["parameters","outputOptions","compressionQuality"],b);const S=u(e,["addWatermark"]);t!==void 0&&S!=null&&p(t,["parameters","addWatermark"],S);const _=u(e,["labels"]);t!==void 0&&_!=null&&p(t,["labels"],_);const v=u(e,["editMode"]);t!==void 0&&v!=null&&p(t,["parameters","editMode"],v);const f=u(e,["baseSteps"]);return t!==void 0&&f!=null&&p(t,["parameters","editConfig","baseSteps"],f),n}function GS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["referenceImages"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>HT(c))),p(n,["instances[0]","referenceImages"],l)}const s=u(t,["config"]);return s!=null&&zS(s,n),n}function US(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Fl(i))),p(t,["generatedImages"],a)}return t}function HS(e,t){const n={},r=u(e,["taskType"]);t!==void 0&&r!=null&&p(t,["requests[]","taskType"],r);const a=u(e,["title"]);t!==void 0&&a!=null&&p(t,["requests[]","title"],a);const i=u(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&p(t,["requests[]","outputDimensionality"],i),u(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function BS(e,t){const n={},r=u(e,["taskType"]);t!==void 0&&r!=null&&p(t,["instances[]","task_type"],r);const a=u(e,["title"]);t!==void 0&&a!=null&&p(t,["instances[]","title"],a);const i=u(e,["outputDimensionality"]);t!==void 0&&i!=null&&p(t,["parameters","outputDimensionality"],i);const s=u(e,["mimeType"]);t!==void 0&&s!=null&&p(t,["instances[]","mimeType"],s);const l=u(e,["autoTruncate"]);return t!==void 0&&l!=null&&p(t,["parameters","autoTruncate"],l),n}function VS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let l=zu(e,a);Array.isArray(l)&&(l=l.map(c=>c)),p(n,["requests[]","content"],l)}const i=u(t,["config"]);i!=null&&HS(i,n);const s=u(t,["model"]);return s!==void 0&&p(n,["requests[]","model"],Et(e,s)),n}function $S(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let s=zu(e,a);Array.isArray(s)&&(s=s.map(l=>l)),p(n,["instances[]","content"],s)}const i=u(t,["config"]);return i!=null&&BS(i,n),n}function WS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["embeddings"],i)}const a=u(e,["metadata"]);return a!=null&&p(t,["metadata"],a),t}function YS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>ES(s))),p(t,["embeddings"],i)}const a=u(e,["metadata"]);return a!=null&&p(t,["metadata"],a),t}function qS(e){const t={},n=u(e,["endpoint"]);n!=null&&p(t,["name"],n);const r=u(e,["deployedModelId"]);return r!=null&&p(t,["deployedModelId"],r),t}function KS(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function JS(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function XS(e){const t={},n=u(e,["mode"]);n!=null&&p(t,["mode"],n);const r=u(e,["allowedFunctionNames"]);if(r!=null&&p(t,["allowedFunctionNames"],r),u(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function ZS(e){const t={};if(u(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=u(e,["description"]);n!=null&&p(t,["description"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["parameters"]);a!=null&&p(t,["parameters"],a);const i=u(e,["parametersJsonSchema"]);i!=null&&p(t,["parametersJsonSchema"],i);const s=u(e,["response"]);s!=null&&p(t,["response"],s);const l=u(e,["responseJsonSchema"]);return l!=null&&p(t,["responseJsonSchema"],l),t}function QS(e,t,n){const r={},a=u(t,["systemInstruction"]);n!==void 0&&a!=null&&p(n,["systemInstruction"],Ol(jn(a)));const i=u(t,["temperature"]);i!=null&&p(r,["temperature"],i);const s=u(t,["topP"]);s!=null&&p(r,["topP"],s);const l=u(t,["topK"]);l!=null&&p(r,["topK"],l);const c=u(t,["candidateCount"]);c!=null&&p(r,["candidateCount"],c);const d=u(t,["maxOutputTokens"]);d!=null&&p(r,["maxOutputTokens"],d);const h=u(t,["stopSequences"]);h!=null&&p(r,["stopSequences"],h);const g=u(t,["responseLogprobs"]);g!=null&&p(r,["responseLogprobs"],g);const m=u(t,["logprobs"]);m!=null&&p(r,["logprobs"],m);const w=u(t,["presencePenalty"]);w!=null&&p(r,["presencePenalty"],w);const y=u(t,["frequencyPenalty"]);y!=null&&p(r,["frequencyPenalty"],y);const b=u(t,["seed"]);b!=null&&p(r,["seed"],b);const S=u(t,["responseMimeType"]);S!=null&&p(r,["responseMimeType"],S);const _=u(t,["responseSchema"]);_!=null&&p(r,["responseSchema"],Gu(_));const v=u(t,["responseJsonSchema"]);if(v!=null&&p(r,["responseJsonSchema"],v),u(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const f=u(t,["safetySettings"]);if(n!==void 0&&f!=null){let H=f;Array.isArray(H)&&(H=H.map($=>BT($))),p(n,["safetySettings"],H)}const T=u(t,["tools"]);if(n!==void 0&&T!=null){let H=Ha(T);Array.isArray(H)&&(H=H.map($=>JT(Ua($)))),p(n,["tools"],H)}const A=u(t,["toolConfig"]);if(n!==void 0&&A!=null&&p(n,["toolConfig"],KT(A)),u(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const I=u(t,["cachedContent"]);n!==void 0&&I!=null&&p(n,["cachedContent"],Zo(e,I));const M=u(t,["responseModalities"]);M!=null&&p(r,["responseModalities"],M);const N=u(t,["mediaResolution"]);N!=null&&p(r,["mediaResolution"],N);const k=u(t,["speechConfig"]);if(k!=null&&p(r,["speechConfig"],Uu(k)),u(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const E=u(t,["thinkingConfig"]);E!=null&&p(r,["thinkingConfig"],E);const P=u(t,["imageConfig"]);P!=null&&p(r,["imageConfig"],ET(P));const L=u(t,["enableEnhancedCivicAnswers"]);return L!=null&&p(r,["enableEnhancedCivicAnswers"],L),r}function eT(e,t,n){const r={},a=u(t,["systemInstruction"]);n!==void 0&&a!=null&&p(n,["systemInstruction"],jn(a));const i=u(t,["temperature"]);i!=null&&p(r,["temperature"],i);const s=u(t,["topP"]);s!=null&&p(r,["topP"],s);const l=u(t,["topK"]);l!=null&&p(r,["topK"],l);const c=u(t,["candidateCount"]);c!=null&&p(r,["candidateCount"],c);const d=u(t,["maxOutputTokens"]);d!=null&&p(r,["maxOutputTokens"],d);const h=u(t,["stopSequences"]);h!=null&&p(r,["stopSequences"],h);const g=u(t,["responseLogprobs"]);g!=null&&p(r,["responseLogprobs"],g);const m=u(t,["logprobs"]);m!=null&&p(r,["logprobs"],m);const w=u(t,["presencePenalty"]);w!=null&&p(r,["presencePenalty"],w);const y=u(t,["frequencyPenalty"]);y!=null&&p(r,["frequencyPenalty"],y);const b=u(t,["seed"]);b!=null&&p(r,["seed"],b);const S=u(t,["responseMimeType"]);S!=null&&p(r,["responseMimeType"],S);const _=u(t,["responseSchema"]);_!=null&&p(r,["responseSchema"],Gu(_));const v=u(t,["responseJsonSchema"]);v!=null&&p(r,["responseJsonSchema"],v);const f=u(t,["routingConfig"]);f!=null&&p(r,["routingConfig"],f);const T=u(t,["modelSelectionConfig"]);T!=null&&p(r,["modelConfig"],T);const A=u(t,["safetySettings"]);if(n!==void 0&&A!=null){let O=A;Array.isArray(O)&&(O=O.map(D=>D)),p(n,["safetySettings"],O)}const I=u(t,["tools"]);if(n!==void 0&&I!=null){let O=Ha(I);Array.isArray(O)&&(O=O.map(D=>Qf(Ua(D)))),p(n,["tools"],O)}const M=u(t,["toolConfig"]);n!==void 0&&M!=null&&p(n,["toolConfig"],M);const N=u(t,["labels"]);n!==void 0&&N!=null&&p(n,["labels"],N);const k=u(t,["cachedContent"]);n!==void 0&&k!=null&&p(n,["cachedContent"],Zo(e,k));const E=u(t,["responseModalities"]);E!=null&&p(r,["responseModalities"],E);const P=u(t,["mediaResolution"]);P!=null&&p(r,["mediaResolution"],P);const L=u(t,["speechConfig"]);L!=null&&p(r,["speechConfig"],Uu(L));const H=u(t,["audioTimestamp"]);H!=null&&p(r,["audioTimestamp"],H);const $=u(t,["thinkingConfig"]);$!=null&&p(r,["thinkingConfig"],$);const U=u(t,["imageConfig"]);if(U!=null&&p(r,["imageConfig"],NT(U)),u(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function $m(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>Ol(l))),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&p(n,["generationConfig"],QS(e,i,n)),n}function Wm(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>l)),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&p(n,["generationConfig"],eT(e,i,n)),n}function Ym(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>_S(d))),p(t,["candidates"],c)}const a=u(e,["modelVersion"]);a!=null&&p(t,["modelVersion"],a);const i=u(e,["promptFeedback"]);i!=null&&p(t,["promptFeedback"],i);const s=u(e,["responseId"]);s!=null&&p(t,["responseId"],s);const l=u(e,["usageMetadata"]);return l!=null&&p(t,["usageMetadata"],l),t}function qm(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>h)),p(t,["candidates"],d)}const a=u(e,["createTime"]);a!=null&&p(t,["createTime"],a);const i=u(e,["modelVersion"]);i!=null&&p(t,["modelVersion"],i);const s=u(e,["promptFeedback"]);s!=null&&p(t,["promptFeedback"],s);const l=u(e,["responseId"]);l!=null&&p(t,["responseId"],l);const c=u(e,["usageMetadata"]);return c!=null&&p(t,["usageMetadata"],c),t}function tT(e,t){const n={};if(u(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=u(e,["numberOfImages"]);t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r);const a=u(e,["aspectRatio"]);t!==void 0&&a!=null&&p(t,["parameters","aspectRatio"],a);const i=u(e,["guidanceScale"]);if(t!==void 0&&i!=null&&p(t,["parameters","guidanceScale"],i),u(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=u(e,["safetyFilterLevel"]);t!==void 0&&s!=null&&p(t,["parameters","safetySetting"],s);const l=u(e,["personGeneration"]);t!==void 0&&l!=null&&p(t,["parameters","personGeneration"],l);const c=u(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&p(t,["parameters","includeSafetyAttributes"],c);const d=u(e,["includeRaiReason"]);t!==void 0&&d!=null&&p(t,["parameters","includeRaiReason"],d);const h=u(e,["language"]);t!==void 0&&h!=null&&p(t,["parameters","language"],h);const g=u(e,["outputMimeType"]);t!==void 0&&g!=null&&p(t,["parameters","outputOptions","mimeType"],g);const m=u(e,["outputCompressionQuality"]);if(t!==void 0&&m!=null&&p(t,["parameters","outputOptions","compressionQuality"],m),u(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const w=u(e,["imageSize"]);if(t!==void 0&&w!=null&&p(t,["parameters","sampleImageSize"],w),u(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function nT(e,t){const n={},r=u(e,["outputGcsUri"]);t!==void 0&&r!=null&&p(t,["parameters","storageUri"],r);const a=u(e,["negativePrompt"]);t!==void 0&&a!=null&&p(t,["parameters","negativePrompt"],a);const i=u(e,["numberOfImages"]);t!==void 0&&i!=null&&p(t,["parameters","sampleCount"],i);const s=u(e,["aspectRatio"]);t!==void 0&&s!=null&&p(t,["parameters","aspectRatio"],s);const l=u(e,["guidanceScale"]);t!==void 0&&l!=null&&p(t,["parameters","guidanceScale"],l);const c=u(e,["seed"]);t!==void 0&&c!=null&&p(t,["parameters","seed"],c);const d=u(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&p(t,["parameters","safetySetting"],d);const h=u(e,["personGeneration"]);t!==void 0&&h!=null&&p(t,["parameters","personGeneration"],h);const g=u(e,["includeSafetyAttributes"]);t!==void 0&&g!=null&&p(t,["parameters","includeSafetyAttributes"],g);const m=u(e,["includeRaiReason"]);t!==void 0&&m!=null&&p(t,["parameters","includeRaiReason"],m);const w=u(e,["language"]);t!==void 0&&w!=null&&p(t,["parameters","language"],w);const y=u(e,["outputMimeType"]);t!==void 0&&y!=null&&p(t,["parameters","outputOptions","mimeType"],y);const b=u(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&p(t,["parameters","outputOptions","compressionQuality"],b);const S=u(e,["addWatermark"]);t!==void 0&&S!=null&&p(t,["parameters","addWatermark"],S);const _=u(e,["labels"]);t!==void 0&&_!=null&&p(t,["labels"],_);const v=u(e,["imageSize"]);t!==void 0&&v!=null&&p(t,["parameters","sampleImageSize"],v);const f=u(e,["enhancePrompt"]);return t!==void 0&&f!=null&&p(t,["parameters","enhancePrompt"],f),n}function oT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["config"]);return i!=null&&tT(i,n),n}function rT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["config"]);return i!=null&&nT(i,n),n}function aT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>yT(s))),p(t,["generatedImages"],i)}const a=u(e,["positivePromptSafetyAttributes"]);return a!=null&&p(t,["positivePromptSafetyAttributes"],Xf(a)),t}function iT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Fl(s))),p(t,["generatedImages"],i)}const a=u(e,["positivePromptSafetyAttributes"]);return a!=null&&p(t,["positivePromptSafetyAttributes"],Zf(a)),t}function sT(e,t){const n={},r=u(e,["numberOfVideos"]);if(t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r),u(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=u(e,["durationSeconds"]);if(t!==void 0&&a!=null&&p(t,["parameters","durationSeconds"],a),u(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=u(e,["aspectRatio"]);t!==void 0&&i!=null&&p(t,["parameters","aspectRatio"],i);const s=u(e,["resolution"]);t!==void 0&&s!=null&&p(t,["parameters","resolution"],s);const l=u(e,["personGeneration"]);if(t!==void 0&&l!=null&&p(t,["parameters","personGeneration"],l),u(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=u(e,["negativePrompt"]);t!==void 0&&c!=null&&p(t,["parameters","negativePrompt"],c);const d=u(e,["enhancePrompt"]);if(t!==void 0&&d!=null&&p(t,["parameters","enhancePrompt"],d),u(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=u(e,["lastFrame"]);t!==void 0&&h!=null&&p(t,["instances[0]","lastFrame"],zl(h));const g=u(e,["referenceImages"]);if(t!==void 0&&g!=null){let m=g;Array.isArray(m)&&(m=m.map(w=>cE(w))),p(t,["instances[0]","referenceImages"],m)}if(u(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(u(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function lT(e,t){const n={},r=u(e,["numberOfVideos"]);t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r);const a=u(e,["outputGcsUri"]);t!==void 0&&a!=null&&p(t,["parameters","storageUri"],a);const i=u(e,["fps"]);t!==void 0&&i!=null&&p(t,["parameters","fps"],i);const s=u(e,["durationSeconds"]);t!==void 0&&s!=null&&p(t,["parameters","durationSeconds"],s);const l=u(e,["seed"]);t!==void 0&&l!=null&&p(t,["parameters","seed"],l);const c=u(e,["aspectRatio"]);t!==void 0&&c!=null&&p(t,["parameters","aspectRatio"],c);const d=u(e,["resolution"]);t!==void 0&&d!=null&&p(t,["parameters","resolution"],d);const h=u(e,["personGeneration"]);t!==void 0&&h!=null&&p(t,["parameters","personGeneration"],h);const g=u(e,["pubsubTopic"]);t!==void 0&&g!=null&&p(t,["parameters","pubsubTopic"],g);const m=u(e,["negativePrompt"]);t!==void 0&&m!=null&&p(t,["parameters","negativePrompt"],m);const w=u(e,["enhancePrompt"]);t!==void 0&&w!=null&&p(t,["parameters","enhancePrompt"],w);const y=u(e,["generateAudio"]);t!==void 0&&y!=null&&p(t,["parameters","generateAudio"],y);const b=u(e,["lastFrame"]);t!==void 0&&b!=null&&p(t,["instances[0]","lastFrame"],ko(b));const S=u(e,["referenceImages"]);if(t!==void 0&&S!=null){let f=S;Array.isArray(f)&&(f=f.map(T=>dE(T))),p(t,["instances[0]","referenceImages"],f)}const _=u(e,["mask"]);t!==void 0&&_!=null&&p(t,["instances[0]","mask"],lE(_));const v=u(e,["compressionQuality"]);return t!==void 0&&v!=null&&p(t,["parameters","compressionQuality"],v),n}function cT(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response","generateVideoResponse"]);return s!=null&&p(t,["response"],hT(s)),t}function dT(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],mT(s)),t}function uT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["image"]);i!=null&&p(n,["instances[0]","image"],zl(i));const s=u(t,["video"]);s!=null&&p(n,["instances[0]","video"],ey(s));const l=u(t,["source"]);l!=null&&gT(l,n);const c=u(t,["config"]);return c!=null&&sT(c,n),n}function pT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["image"]);i!=null&&p(n,["instances[0]","image"],ko(i));const s=u(t,["video"]);s!=null&&p(n,["instances[0]","video"],ty(s));const l=u(t,["source"]);l!=null&&fT(l,n);const c=u(t,["config"]);return c!=null&&lT(c,n),n}function hT(e){const t={},n=u(e,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>vT(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function mT(e){const t={},n=u(e,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>bT(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function gT(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["image"]);t!==void 0&&a!=null&&p(t,["instances[0]","image"],zl(a));const i=u(e,["video"]);return t!==void 0&&i!=null&&p(t,["instances[0]","video"],ey(i)),n}function fT(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["image"]);t!==void 0&&a!=null&&p(t,["instances[0]","image"],ko(a));const i=u(e,["video"]);return t!==void 0&&i!=null&&p(t,["instances[0]","video"],ty(i)),n}function yT(e){const t={},n=u(e,["_self"]);n!=null&&p(t,["image"],kT(n));const r=u(e,["raiFilteredReason"]);r!=null&&p(t,["raiFilteredReason"],r);const a=u(e,["_self"]);return a!=null&&p(t,["safetyAttributes"],Xf(a)),t}function Fl(e){const t={},n=u(e,["_self"]);n!=null&&p(t,["image"],Jf(n));const r=u(e,["raiFilteredReason"]);r!=null&&p(t,["raiFilteredReason"],r);const a=u(e,["_self"]);a!=null&&p(t,["safetyAttributes"],Zf(a));const i=u(e,["prompt"]);return i!=null&&p(t,["enhancedPrompt"],i),t}function xT(e){const t={},n=u(e,["_self"]);n!=null&&p(t,["mask"],Jf(n));const r=u(e,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),p(t,["labels"],a)}return t}function vT(e){const t={},n=u(e,["video"]);return n!=null&&p(t,["video"],iE(n)),t}function bT(e){const t={},n=u(e,["_self"]);return n!=null&&p(t,["video"],sE(n)),t}function wT(e){const t={},n=u(e,["modelSelectionConfig"]);n!=null&&p(t,["modelConfig"],n);const r=u(e,["responseJsonSchema"]);r!=null&&p(t,["responseJsonSchema"],r);const a=u(e,["audioTimestamp"]);a!=null&&p(t,["audioTimestamp"],a);const i=u(e,["candidateCount"]);i!=null&&p(t,["candidateCount"],i);const s=u(e,["enableAffectiveDialog"]);s!=null&&p(t,["enableAffectiveDialog"],s);const l=u(e,["frequencyPenalty"]);l!=null&&p(t,["frequencyPenalty"],l);const c=u(e,["logprobs"]);c!=null&&p(t,["logprobs"],c);const d=u(e,["maxOutputTokens"]);d!=null&&p(t,["maxOutputTokens"],d);const h=u(e,["mediaResolution"]);h!=null&&p(t,["mediaResolution"],h);const g=u(e,["presencePenalty"]);g!=null&&p(t,["presencePenalty"],g);const m=u(e,["responseLogprobs"]);m!=null&&p(t,["responseLogprobs"],m);const w=u(e,["responseMimeType"]);w!=null&&p(t,["responseMimeType"],w);const y=u(e,["responseModalities"]);y!=null&&p(t,["responseModalities"],y);const b=u(e,["responseSchema"]);b!=null&&p(t,["responseSchema"],b);const S=u(e,["routingConfig"]);S!=null&&p(t,["routingConfig"],S);const _=u(e,["seed"]);_!=null&&p(t,["seed"],_);const v=u(e,["speechConfig"]);v!=null&&p(t,["speechConfig"],v);const f=u(e,["stopSequences"]);f!=null&&p(t,["stopSequences"],f);const T=u(e,["temperature"]);T!=null&&p(t,["temperature"],T);const A=u(e,["thinkingConfig"]);A!=null&&p(t,["thinkingConfig"],A);const I=u(e,["topK"]);I!=null&&p(t,["topK"],I);const M=u(e,["topP"]);if(M!=null&&p(t,["topP"],M),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function _T(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Et(e,r)),n}function CT(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Et(e,r)),n}function ST(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function TT(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function ET(e){const t={},n=u(e,["aspectRatio"]);n!=null&&p(t,["aspectRatio"],n);const r=u(e,["imageSize"]);if(r!=null&&p(t,["imageSize"],r),u(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function NT(e){const t={},n=u(e,["aspectRatio"]);n!=null&&p(t,["aspectRatio"],n);const r=u(e,["imageSize"]);r!=null&&p(t,["imageSize"],r);const a=u(e,["outputMimeType"]);a!=null&&p(t,["imageOutputOptions","mimeType"],a);const i=u(e,["outputCompressionQuality"]);return i!=null&&p(t,["imageOutputOptions","compressionQuality"],i),t}function kT(e){const t={},n=u(e,["bytesBase64Encoded"]);n!=null&&p(t,["imageBytes"],Er(n));const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function Jf(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["gcsUri"],n);const r=u(e,["bytesBase64Encoded"]);r!=null&&p(t,["imageBytes"],Er(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}function zl(e){const t={};if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=u(e,["imageBytes"]);n!=null&&p(t,["bytesBase64Encoded"],Er(n));const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function ko(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["gcsUri"],n);const r=u(e,["imageBytes"]);r!=null&&p(t,["bytesBase64Encoded"],Er(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}function AT(e,t,n){const r={},a=u(t,["pageSize"]);n!==void 0&&a!=null&&p(n,["_query","pageSize"],a);const i=u(t,["pageToken"]);n!==void 0&&i!=null&&p(n,["_query","pageToken"],i);const s=u(t,["filter"]);n!==void 0&&s!=null&&p(n,["_query","filter"],s);const l=u(t,["queryBase"]);return n!==void 0&&l!=null&&p(n,["_url","models_url"],Bf(e,l)),r}function IT(e,t,n){const r={},a=u(t,["pageSize"]);n!==void 0&&a!=null&&p(n,["_query","pageSize"],a);const i=u(t,["pageToken"]);n!==void 0&&i!=null&&p(n,["_query","pageToken"],i);const s=u(t,["filter"]);n!==void 0&&s!=null&&p(n,["_query","filter"],s);const l=u(t,["queryBase"]);return n!==void 0&&l!=null&&p(n,["_url","models_url"],Bf(e,l)),r}function PT(e,t){const n={},r=u(t,["config"]);return r!=null&&AT(e,r,n),n}function RT(e,t){const n={},r=u(t,["config"]);return r!=null&&IT(e,r,n),n}function MT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["_self"]);if(a!=null){let i=Vf(a);Array.isArray(i)&&(i=i.map(s=>Pd(s))),p(t,["models"],i)}return t}function LT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["_self"]);if(a!=null){let i=Vf(a);Array.isArray(i)&&(i=i.map(s=>Rd(s))),p(t,["models"],i)}return t}function jT(e){const t={},n=u(e,["maskMode"]);n!=null&&p(t,["maskMode"],n);const r=u(e,["segmentationClasses"]);r!=null&&p(t,["maskClasses"],r);const a=u(e,["maskDilation"]);return a!=null&&p(t,["dilation"],a),t}function Pd(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);a!=null&&p(t,["description"],a);const i=u(e,["version"]);i!=null&&p(t,["version"],i);const s=u(e,["_self"]);s!=null&&p(t,["tunedModelInfo"],XT(s));const l=u(e,["inputTokenLimit"]);l!=null&&p(t,["inputTokenLimit"],l);const c=u(e,["outputTokenLimit"]);c!=null&&p(t,["outputTokenLimit"],c);const d=u(e,["supportedGenerationMethods"]);d!=null&&p(t,["supportedActions"],d);const h=u(e,["temperature"]);h!=null&&p(t,["temperature"],h);const g=u(e,["maxTemperature"]);g!=null&&p(t,["maxTemperature"],g);const m=u(e,["topP"]);m!=null&&p(t,["topP"],m);const w=u(e,["topK"]);w!=null&&p(t,["topK"],w);const y=u(e,["thinking"]);return y!=null&&p(t,["thinking"],y),t}function Rd(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);a!=null&&p(t,["description"],a);const i=u(e,["versionId"]);i!=null&&p(t,["version"],i);const s=u(e,["deployedModels"]);if(s!=null){let g=s;Array.isArray(g)&&(g=g.map(m=>qS(m))),p(t,["endpoints"],g)}const l=u(e,["labels"]);l!=null&&p(t,["labels"],l);const c=u(e,["_self"]);c!=null&&p(t,["tunedModelInfo"],ZT(c));const d=u(e,["defaultCheckpointId"]);d!=null&&p(t,["defaultCheckpointId"],d);const h=u(e,["checkpoints"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(m=>m)),p(t,["checkpoints"],g)}return t}function DT(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],KS(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],JS(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],wS(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function OT(e){const t={},n=u(e,["productImage"]);return n!=null&&p(t,["image"],ko(n)),t}function FT(e,t){const n={},r=u(e,["numberOfImages"]);t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r);const a=u(e,["baseSteps"]);t!==void 0&&a!=null&&p(t,["parameters","baseSteps"],a);const i=u(e,["outputGcsUri"]);t!==void 0&&i!=null&&p(t,["parameters","storageUri"],i);const s=u(e,["seed"]);t!==void 0&&s!=null&&p(t,["parameters","seed"],s);const l=u(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&p(t,["parameters","safetySetting"],l);const c=u(e,["personGeneration"]);t!==void 0&&c!=null&&p(t,["parameters","personGeneration"],c);const d=u(e,["addWatermark"]);t!==void 0&&d!=null&&p(t,["parameters","addWatermark"],d);const h=u(e,["outputMimeType"]);t!==void 0&&h!=null&&p(t,["parameters","outputOptions","mimeType"],h);const g=u(e,["outputCompressionQuality"]);t!==void 0&&g!=null&&p(t,["parameters","outputOptions","compressionQuality"],g);const m=u(e,["enhancePrompt"]);t!==void 0&&m!=null&&p(t,["parameters","enhancePrompt"],m);const w=u(e,["labels"]);return t!==void 0&&w!=null&&p(t,["labels"],w),n}function zT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["source"]);a!=null&&UT(a,n);const i=u(t,["config"]);return i!=null&&FT(i,n),n}function GT(e){const t={},n=u(e,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Fl(a))),p(t,["generatedImages"],r)}return t}function UT(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["personImage"]);t!==void 0&&a!=null&&p(t,["instances[0]","personImage","image"],ko(a));const i=u(e,["productImages"]);if(t!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>OT(l))),p(t,["instances[0]","productImages"],s)}return n}function HT(e){const t={},n=u(e,["referenceImage"]);n!=null&&p(t,["referenceImage"],ko(n));const r=u(e,["referenceId"]);r!=null&&p(t,["referenceId"],r);const a=u(e,["referenceType"]);a!=null&&p(t,["referenceType"],a);const i=u(e,["maskImageConfig"]);i!=null&&p(t,["maskImageConfig"],jT(i));const s=u(e,["controlImageConfig"]);s!=null&&p(t,["controlImageConfig"],kS(s));const l=u(e,["styleImageConfig"]);l!=null&&p(t,["styleImageConfig"],l);const c=u(e,["subjectImageConfig"]);return c!=null&&p(t,["subjectImageConfig"],c),t}function Xf(e){const t={},n=u(e,["safetyAttributes","categories"]);n!=null&&p(t,["categories"],n);const r=u(e,["safetyAttributes","scores"]);r!=null&&p(t,["scores"],r);const a=u(e,["contentType"]);return a!=null&&p(t,["contentType"],a),t}function Zf(e){const t={},n=u(e,["safetyAttributes","categories"]);n!=null&&p(t,["categories"],n);const r=u(e,["safetyAttributes","scores"]);r!=null&&p(t,["scores"],r);const a=u(e,["contentType"]);return a!=null&&p(t,["contentType"],a),t}function BT(e){const t={},n=u(e,["category"]);if(n!=null&&p(t,["category"],n),u(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=u(e,["threshold"]);return r!=null&&p(t,["threshold"],r),t}function VT(e){const t={},n=u(e,["image"]);return n!=null&&p(t,["image"],ko(n)),t}function $T(e,t){const n={},r=u(e,["mode"]);t!==void 0&&r!=null&&p(t,["parameters","mode"],r);const a=u(e,["maxPredictions"]);t!==void 0&&a!=null&&p(t,["parameters","maxPredictions"],a);const i=u(e,["confidenceThreshold"]);t!==void 0&&i!=null&&p(t,["parameters","confidenceThreshold"],i);const s=u(e,["maskDilation"]);t!==void 0&&s!=null&&p(t,["parameters","maskDilation"],s);const l=u(e,["binaryColorThreshold"]);t!==void 0&&l!=null&&p(t,["parameters","binaryColorThreshold"],l);const c=u(e,["labels"]);return t!==void 0&&c!=null&&p(t,["labels"],c),n}function WT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["source"]);a!=null&&qT(a,n);const i=u(t,["config"]);return i!=null&&$T(i,n),n}function YT(e){const t={},n=u(e,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>xT(a))),p(t,["generatedMasks"],r)}return t}function qT(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["image"]);t!==void 0&&a!=null&&p(t,["instances[0]","image"],ko(a));const i=u(e,["scribbleImage"]);return t!==void 0&&i!=null&&p(t,["instances[0]","scribble"],VT(i)),n}function KT(e){const t={},n=u(e,["functionCallingConfig"]);n!=null&&p(t,["functionCallingConfig"],XS(n));const r=u(e,["retrievalConfig"]);return r!=null&&p(t,["retrievalConfig"],r),t}function JT(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],ST(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],TT(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}function Qf(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(m=>ZS(m))),p(t,["functionDeclarations"],g)}const r=u(e,["retrieval"]);r!=null&&p(t,["retrieval"],r);const a=u(e,["googleSearchRetrieval"]);a!=null&&p(t,["googleSearchRetrieval"],a);const i=u(e,["computerUse"]);if(i!=null&&p(t,["computerUse"],i),u(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=u(e,["codeExecution"]);s!=null&&p(t,["codeExecution"],s);const l=u(e,["enterpriseWebSearch"]);l!=null&&p(t,["enterpriseWebSearch"],l);const c=u(e,["googleMaps"]);c!=null&&p(t,["googleMaps"],c);const d=u(e,["googleSearch"]);d!=null&&p(t,["googleSearch"],d);const h=u(e,["urlContext"]);return h!=null&&p(t,["urlContext"],h),t}function XT(e){const t={},n=u(e,["baseModel"]);n!=null&&p(t,["baseModel"],n);const r=u(e,["createTime"]);r!=null&&p(t,["createTime"],r);const a=u(e,["updateTime"]);return a!=null&&p(t,["updateTime"],a),t}function ZT(e){const t={},n=u(e,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&p(t,["baseModel"],n);const r=u(e,["createTime"]);r!=null&&p(t,["createTime"],r);const a=u(e,["updateTime"]);return a!=null&&p(t,["updateTime"],a),t}function QT(e,t){const n={},r=u(e,["displayName"]);t!==void 0&&r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);t!==void 0&&a!=null&&p(t,["description"],a);const i=u(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&p(t,["defaultCheckpointId"],i),n}function eE(e,t){const n={},r=u(e,["displayName"]);t!==void 0&&r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);t!==void 0&&a!=null&&p(t,["description"],a);const i=u(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&p(t,["defaultCheckpointId"],i),n}function tE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","name"],Et(e,r));const a=u(t,["config"]);return a!=null&&QT(a,n),n}function nE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["config"]);return a!=null&&eE(a,n),n}function oE(e,t){const n={},r=u(e,["outputGcsUri"]);t!==void 0&&r!=null&&p(t,["parameters","storageUri"],r);const a=u(e,["safetyFilterLevel"]);t!==void 0&&a!=null&&p(t,["parameters","safetySetting"],a);const i=u(e,["personGeneration"]);t!==void 0&&i!=null&&p(t,["parameters","personGeneration"],i);const s=u(e,["includeRaiReason"]);t!==void 0&&s!=null&&p(t,["parameters","includeRaiReason"],s);const l=u(e,["outputMimeType"]);t!==void 0&&l!=null&&p(t,["parameters","outputOptions","mimeType"],l);const c=u(e,["outputCompressionQuality"]);t!==void 0&&c!=null&&p(t,["parameters","outputOptions","compressionQuality"],c);const d=u(e,["enhanceInputImage"]);t!==void 0&&d!=null&&p(t,["parameters","upscaleConfig","enhanceInputImage"],d);const h=u(e,["imagePreservationFactor"]);t!==void 0&&h!=null&&p(t,["parameters","upscaleConfig","imagePreservationFactor"],h);const g=u(e,["labels"]);t!==void 0&&g!=null&&p(t,["labels"],g);const m=u(e,["numberOfImages"]);t!==void 0&&m!=null&&p(t,["parameters","sampleCount"],m);const w=u(e,["mode"]);return t!==void 0&&w!=null&&p(t,["parameters","mode"],w),n}function rE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Et(e,r));const a=u(t,["image"]);a!=null&&p(n,["instances[0]","image"],ko(a));const i=u(t,["upscaleFactor"]);i!=null&&p(n,["parameters","upscaleConfig","upscaleFactor"],i);const s=u(t,["config"]);return s!=null&&oE(s,n),n}function aE(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Fl(i))),p(t,["generatedImages"],a)}return t}function iE(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["uri"],n);const r=u(e,["encodedVideo"]);r!=null&&p(t,["videoBytes"],Er(r));const a=u(e,["encoding"]);return a!=null&&p(t,["mimeType"],a),t}function sE(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["uri"],n);const r=u(e,["bytesBase64Encoded"]);r!=null&&p(t,["videoBytes"],Er(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}function lE(e){const t={},n=u(e,["image"]);n!=null&&p(t,["_self"],ko(n));const r=u(e,["maskMode"]);return r!=null&&p(t,["maskMode"],r),t}function cE(e){const t={},n=u(e,["image"]);n!=null&&p(t,["image"],zl(n));const r=u(e,["referenceType"]);return r!=null&&p(t,["referenceType"],r),t}function dE(e){const t={},n=u(e,["image"]);n!=null&&p(t,["image"],ko(n));const r=u(e,["referenceType"]);return r!=null&&p(t,["referenceType"],r),t}function ey(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["uri"],n);const r=u(e,["videoBytes"]);r!=null&&p(t,["encodedVideo"],Er(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["encoding"],a),t}function ty(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["gcsUri"],n);const r=u(e,["videoBytes"]);r!=null&&p(t,["bytesBase64Encoded"],Er(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uE(e,t){const n={},r=u(e,["displayName"]);return t!==void 0&&r!=null&&p(t,["displayName"],r),n}function pE(e){const t={},n=u(e,["config"]);return n!=null&&uE(n,t),t}function hE(e,t){const n={},r=u(e,["force"]);return t!==void 0&&r!=null&&p(t,["_query","force"],r),n}function mE(e){const t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],n);const r=u(e,["config"]);return r!=null&&hE(r,t),t}function gE(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],n),t}function fE(e,t){const n={},r=u(e,["customMetadata"]);if(t!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["customMetadata"],i)}const a=u(e,["chunkingConfig"]);return t!==void 0&&a!=null&&p(t,["chunkingConfig"],a),n}function yE(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],vE(s)),t}function xE(e){const t={},n=u(e,["fileSearchStoreName"]);n!=null&&p(t,["_url","file_search_store_name"],n);const r=u(e,["fileName"]);r!=null&&p(t,["fileName"],r);const a=u(e,["config"]);return a!=null&&fE(a,t),t}function vE(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["parent"]);r!=null&&p(t,["parent"],r);const a=u(e,["documentName"]);return a!=null&&p(t,["documentName"],a),t}function bE(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function wE(e){const t={},n=u(e,["config"]);return n!=null&&bE(n,t),t}function _E(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["fileSearchStores"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["fileSearchStores"],i)}return t}function ny(e,t){const n={},r=u(e,["mimeType"]);t!==void 0&&r!=null&&p(t,["mimeType"],r);const a=u(e,["displayName"]);t!==void 0&&a!=null&&p(t,["displayName"],a);const i=u(e,["customMetadata"]);if(t!==void 0&&i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),p(t,["customMetadata"],l)}const s=u(e,["chunkingConfig"]);return t!==void 0&&s!=null&&p(t,["chunkingConfig"],s),n}function CE(e){const t={},n=u(e,["fileSearchStoreName"]);n!=null&&p(t,["_url","file_search_store_name"],n);const r=u(e,["config"]);return r!=null&&ny(r,t),t}function SE(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const TE="Content-Type",EE="X-Server-Timeout",NE="User-Agent",Md="x-goog-api-client",kE="1.34.0",AE=`google-genai-sdk/${kE}`,IE="v1beta1",PE="v1beta";class RE{constructor(t){var n,r;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:IE,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:PE,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&r.push(t.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),n=new URL(t);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,n,r){const a=[this.getRequestUrlInternal(n)];return r&&a.push(this.getBaseResourcePath()),t!==""&&a.push(t),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,n,r);if(t.queryParams)for(const[s,l]of Object.entries(t.queryParams))a.searchParams.append(s,String(l));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,n,a.toString(),t.abortSignal),this.unaryApiCall(a,i,t.httpMethod)}patchHttpOptions(t,n){const r=JSON.parse(JSON.stringify(t));for(const[a,i]of Object.entries(n))typeof i=="object"?r[a]=Object.assign(Object.assign({},r[a]),i):i!==void 0&&(r[a]=i);return r}async requestStream(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,n,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,n,a.toString(),t.abortSignal),this.streamApiCall(a,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,n,r,a){if(n&&n.timeout||a){const i=new AbortController,s=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const l=setTimeout(()=>i.abort(),n.timeout);l&&typeof l.unref=="function"&&l.unref()}a&&a.addEventListener("abort",()=>{i.abort()}),t.signal=s}return n&&n.extraBody!==null&&ME(t,n.extraBody),t.headers=await this.getHeadersInternal(n,r),t}async unaryApiCall(t,n,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await Km(a),new kd(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(t,n,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await Km(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(t){return To(this,arguments,function*(){var r;const a=(r=t==null?void 0:t.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let s="";const l="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:h}=yield ft(a.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const g=i.decode(h,{stream:!0});try{const y=JSON.parse(g);if("error"in y){const b=JSON.parse(JSON.stringify(y.error)),S=b.status,_=b.code,v=`got status: ${S}. ${JSON.stringify(y)}`;if(_>=400&&_<600)throw new Dl({message:v,status:_})}}catch(y){if(y.name==="ApiError")throw y}s+=g;let m=-1,w=0;for(;;){m=-1,w=0;for(const S of c){const _=s.indexOf(S);_!==-1&&(m===-1||_<m)&&(m=_,w=S.length)}if(m===-1)break;const y=s.substring(0,m);s=s.substring(m+w);const b=y.trim();if(b.startsWith(l)){const S=b.substring(l.length).trim();try{const _=new Response(S,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield ft(new kd(_))}catch(_){throw new Error(`exception parsing stream chunk ${S}. ${_}`)}}}}}finally{a.releaseLock()}})}async apiCall(t,n){return fetch(t,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const t={},n=AE+" "+this.clientOptions.userAgentExtra;return t[NE]=n,t[Md]=n,t[TE]="application/json",t}async getHeadersInternal(t,n){const r=new Headers;if(t&&t.headers){for(const[a,i]of Object.entries(t.headers))r.append(a,i);t.timeout&&t.timeout>0&&r.append(EE,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(t){var n;let r="";return typeof t=="string"&&(r=t.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(t,n){var r;const a={};n!=null&&(a.mimeType=n.mimeType,a.name=n.name,a.displayName=n.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const i=this.clientOptions.uploader,s=await i.stat(t);a.sizeBytes=String(s.size);const l=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=l;const c={file:a},d=this.getFileName(t),h=Ye("upload/v1beta/files",c._url),g=await this.fetchUploadUrl(h,a.sizeBytes,a.mimeType,d,c,n==null?void 0:n.httpOptions);return i.upload(t,g,this)}async uploadFileToFileSearchStore(t,n,r){var a;const i=this.clientOptions.uploader,s=await i.stat(n),l=String(s.size),c=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:s.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${t}:uploadToFileSearchStore`,h=this.getFileName(n),g={};r!=null&&ny(r,g);const m=await this.fetchUploadUrl(d,l,c,h,g,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(n,m,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,n,r,a,i,s){var l;let c={};s?c=s:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const d=await this.request({path:t,body:JSON.stringify(i),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Km(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const n=e.status;let r;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?r=await e.json():r={error:{message:await e.text(),code:e.status,status:e.statusText}};const a=JSON.stringify(r);throw n>=400&&n<600?new Dl({message:a,status:n}):new Error(a)}}function ME(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof e.body=="string"&&e.body.length>0)try{const i=JSON.parse(e.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))n=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const l=Object.assign({},i);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],h=l[c];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?l[c]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),l[c]=d)}return l}const a=r(n,t);e.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const LE="mcp_used/unknown";let jE=!1;function oy(e){for(const t of e)if(DE(t)||typeof t=="object"&&"inputSchema"in t)return!0;return jE}function ry(e){var t;const n=(t=e[Md])!==null&&t!==void 0?t:"";e[Md]=(n+` ${LE}`).trimStart()}function DE(e){return e!==null&&typeof e=="object"&&e instanceof Bu}function OE(e){return To(this,arguments,function*(n,r=100){let a,i=0;for(;i<r;){const s=yield ft(n.listTools({cursor:a}));for(const l of s.tools)yield yield ft(l),i++;if(!s.nextCursor)break;a=s.nextCursor}})}class Bu{constructor(t=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=n}static create(t,n){return new Bu(t,n)}async initialize(){var t,n,r,a;if(this.mcpTools.length>0)return;const i={},s=[];for(const h of this.mcpClients)try{for(var l=!0,c=(n=void 0,Eo(OE(h))),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const g=a;s.push(g);const m=g.name;if(i[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);i[m]=h}}catch(g){n={error:g}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),g_(this.mcpTools,this.config)}async callTool(t){await this.initialize();const n=[];for(const r of t)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await a.callTool({name:r.name,arguments:r.args},void 0,i);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function FE(e,t,n){const r=new s_;let a;n.data instanceof Blob?a=JSON.parse(await n.data.text()):a=JSON.parse(n.data),Object.assign(r,a),t(r)}class zE{constructor(t,n,r){this.apiClient=t,this.auth=n,this.webSocketFactory=r}async connect(t){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=HE(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),c=`${a}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const h=new Promise(f=>{d=f}),g=t.callbacks,m=function(){d({})},w=this.apiClient,y={onopen:m,onmessage:f=>{FE(w,g.onmessage,f)},onerror:(n=g==null?void 0:g.onerror)!==null&&n!==void 0?n:function(f){},onclose:(r=g==null?void 0:g.onclose)!==null&&r!==void 0?r:function(f){}},b=this.webSocketFactory.create(c,UE(s),y);b.connect(),await h;const v={setup:{model:Et(this.apiClient,t.model)}};return b.send(JSON.stringify(v)),new GE(b,this.apiClient)}}class GE{constructor(t,n){this.conn=t,this.apiClient=n}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=pS(t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const n=uS(t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(t){const n={playbackControl:t};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(ba.PLAY)}pause(){this.sendPlaybackControl(ba.PAUSE)}stop(){this.sendPlaybackControl(ba.STOP)}resetContext(){this.sendPlaybackControl(ba.RESET_CONTEXT)}close(){this.conn.close()}}function UE(e){const t={};return e.forEach((n,r)=>{t[r]=n}),t}function HE(e){const t=new Headers;for(const[n,r]of Object.entries(e))t.append(n,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const BE="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function VE(e,t,n){const r=new i_;let a;n.data instanceof Blob?a=await n.data.text():n.data instanceof ArrayBuffer?a=new TextDecoder().decode(n.data):a=n.data;const i=JSON.parse(a);if(e.isVertexAI()){const s=gS(i);Object.assign(r,s)}else Object.assign(r,i);t(r)}class $E{constructor(t,n,r){this.apiClient=t,this.auth=n,this.webSocketFactory=r,this.music=new zE(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var n,r,a,i,s,l;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const g=this.apiClient.getHeaders();t.config&&t.config.tools&&oy(t.config.tools)&&ry(g);const m=KE(g);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,h);else{const k=this.apiClient.getApiKey();let E="BidiGenerateContent",P="key";k!=null&&k.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),E="BidiGenerateContentConstrained",P="access_token"),h=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${E}?${P}=${k}`}let w=()=>{};const y=new Promise(k=>{w=k}),b=t.callbacks,S=function(){var k;(k=b==null?void 0:b.onopen)===null||k===void 0||k.call(b),w({})},_=this.apiClient,v={onopen:S,onmessage:k=>{VE(_,b.onmessage,k)},onerror:(n=b==null?void 0:b.onerror)!==null&&n!==void 0?n:function(k){},onclose:(r=b==null?void 0:b.onclose)!==null&&r!==void 0?r:function(k){}},f=this.webSocketFactory.create(h,qE(m),v);f.connect(),await y;let T=Et(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){const k=this.apiClient.getProject(),E=this.apiClient.getLocation();T=`projects/${k}/locations/${E}/`+T}let A={};this.apiClient.isVertexAI()&&((a=t.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[Ui.AUDIO]}:t.config.responseModalities=[Ui.AUDIO]),!((i=t.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const I=(l=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[],M=[];for(const k of I)if(this.isCallableTool(k)){const E=k;M.push(await E.tool())}else M.push(k);M.length>0&&(t.config.tools=M);const N={model:T,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?A=dS(this.apiClient,N):A=cS(this.apiClient,N),delete A.config,f.send(JSON.stringify(A)),new YE(f,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const WE={turnComplete:!0};class YE{constructor(t,n){this.conn=t,this.apiClient=n}tLiveClientContent(t,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=ho(n.turns),t.isVertexAI()||(r=r.map(a=>Ol(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(t,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!t.isVertexAI()&&!("id"in i))throw new Error(BE)}return{toolResponse:{functionResponses:r}}}sendClientContent(t){t=Object.assign(Object.assign({},WE),t);const n=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendRealtimeInput(t){let n={};this.apiClient.isVertexAI()?n={realtimeInput:mS(t)}:n={realtimeInput:hS(t)},this.conn.send(JSON.stringify(n))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function qE(e){const t={};return e.forEach((n,r)=>{t[r]=n}),t}function KE(e){const t=new Headers;for(const[n,r]of Object.entries(e))t.append(n,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jm=10;function Xm(e){var t,n,r;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let a=!1;for(const s of(n=e==null?void 0:e.tools)!==null&&n!==void 0?n:[])if(Aa(s)){a=!0;break}if(!a)return!0;const i=(r=e==null?void 0:e.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Aa(e){return"callTool"in e&&typeof e.callTool=="function"}function JE(e){var t,n,r;return(r=(n=(t=e.config)===null||t===void 0?void 0:t.tools)===null||n===void 0?void 0:n.some(a=>Aa(a)))!==null&&r!==void 0?r:!1}function Zm(e){var t;const n=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((r,a)=>{if(Aa(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(a)}),n}function Qm(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class XE extends Xo{constructor(t){super(),this.apiClient=t,this.generateContent=async n=>{var r,a,i,s,l;const c=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!JE(n)||Xm(n.config))return await this.generateContentInternal(c);const d=Zm(n);if(d.length>0){const b=d.map(S=>`tools[${S}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${b}.`)}let h,g;const m=ho(c.contents),w=(i=(a=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&i!==void 0?i:Jm;let y=0;for(;y<w&&(h=await this.generateContentInternal(c),!(!h.functionCalls||h.functionCalls.length===0));){const b=h.candidates[0].content,S=[];for(const _ of(l=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[])if(Aa(_)){const f=await _.callTool(h.functionCalls);S.push(...f)}y++,g={role:"user",parts:S},c.contents=ho(c.contents),c.contents.push(b),c.contents.push(g),Qm(c.config)&&(m.push(b),m.push(g))}return Qm(c.config)&&(h.automaticFunctionCallingHistory=m),h},this.generateContentStream=async n=>{var r,a,i,s,l;if(this.maybeMoveToResponseJsonSchem(n),Xm(n.config)){const g=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(g)}const c=Zm(n);if(c.length>0){const g=c.map(m=>`tools[${m}]`).join(", ");throw new Error(`Incompatible tools found at ${g}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(a=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||a===void 0?void 0:a.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,h=(l=(s=n==null?void 0:n.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(d&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var a;let i;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((a=c==null?void 0:c.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?i=c==null?void 0:c.safetyAttributes:s.push(c);let l;return i?l={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:l={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},l}),this.list=async n=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Zr(qo.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(s),s)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const a={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async n=>{var r,a,i,s,l,c;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((a=n.video)===null||a===void 0)&&a.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((s=(i=n.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((c=(l=n.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var n,r,a;const i=(n=t.config)===null||n===void 0?void 0:n.tools;if(!i)return t;const s=await Promise.all(i.map(async c=>Aa(c)?await c.tool():c)),l={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:s})};if(l.config.tools=s,t.config&&t.config.tools&&oy(t.config.tools)){const c=(a=(r=t.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),ry(d),l.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(t){var n,r,a;const i=new Map;for(const s of(r=(n=t.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(Aa(s)){const l=s,c=await l.tool();for(const d of(a=c.functionDeclarations)!==null&&a!==void 0?a:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,l)}}return i}async processAfcStream(t){var n,r,a;const i=(a=(r=(n=t.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Jm;let s=!1,l=0;const c=await this.initAfcToolsMap(t);return function(d,h,g){return To(this,arguments,function*(){for(var m,w,y,b,S,_;l<i;){s&&(l++,s=!1);const A=yield ft(d.processParamsMaybeAddMcpUsage(g)),I=yield ft(d.generateContentStreamInternal(A)),M=[],N=[];try{for(var v=!0,f=(w=void 0,Eo(I)),T;T=yield ft(f.next()),m=T.done,!m;v=!0){b=T.value,v=!1;const k=b;if(yield yield ft(k),k.candidates&&(!((S=k.candidates[0])===null||S===void 0)&&S.content)){N.push(k.candidates[0].content);for(const E of(_=k.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(l<i&&E.functionCall){if(!E.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(E.functionCall.name)){const P=yield ft(h.get(E.functionCall.name).callTool([E.functionCall]));M.push(...P)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${E.functionCall.name}`)}}}}catch(k){w={error:k}}finally{try{!v&&!m&&(y=f.return)&&(yield ft(y.call(f)))}finally{if(w)throw w.error}}if(M.length>0){s=!0;const k=new ii;k.candidates=[{content:{role:"user",parts:M}}],yield yield ft(k);const E=[];E.push(...N),E.push({role:"user",parts:M});const P=ho(g.contents).concat(E);g.contents=P}else break}})}(this,c,t)}async generateContentInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Wm(this.apiClient,t);return l=Ye("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=qm(h),m=new ii;return Object.assign(m,g),m})}else{const d=$m(this.apiClient,t);return l=Ye("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=Ym(h),m=new ii;return Object.assign(m,g),m})}}async generateContentStreamInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Wm(this.apiClient,t);return l=Ye("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(g){return To(this,arguments,function*(){var m,w,y,b;try{for(var S=!0,_=Eo(g),v;v=yield ft(_.next()),m=v.done,!m;S=!0){b=v.value,S=!1;const f=b,T=qm(yield ft(f.json()));T.sdkHttpResponse={headers:f.headers};const A=new ii;Object.assign(A,T),yield yield ft(A)}}catch(f){w={error:f}}finally{try{!S&&!m&&(y=_.return)&&(yield ft(y.call(_)))}finally{if(w)throw w.error}}})})}else{const d=$m(this.apiClient,t);return l=Ye("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(g){return To(this,arguments,function*(){var m,w,y,b;try{for(var S=!0,_=Eo(g),v;v=yield ft(_.next()),m=v.done,!m;S=!0){b=v.value,S=!1;const f=b,T=Ym(yield ft(f.json()));T.sdkHttpResponse={headers:f.headers};const A=new ii;Object.assign(A,T),yield yield ft(A)}}catch(f){w={error:f}}finally{try{!S&&!m&&(y=_.return)&&(yield ft(y.call(_)))}finally{if(w)throw w.error}}})})}}async embedContent(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=$S(this.apiClient,t);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=YS(h),m=new km;return Object.assign(m,g),m})}else{const d=VS(this.apiClient,t);return l=Ye("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=WS(h),m=new km;return Object.assign(m,g),m})}}async generateImagesInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=rT(this.apiClient,t);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=iT(h),m=new Am;return Object.assign(m,g),m})}else{const d=oT(this.apiClient,t);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=aT(h),m=new Am;return Object.assign(m,g),m})}}async editImageInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=GS(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=US(c),h=new Kw;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=rE(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=aE(c),h=new Jw;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=zT(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=GT(c),h=new Xw;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=WT(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=YT(c),h=new Zw;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=CT(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Rd(h))}else{const d=_T(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Pd(h))}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=RT(this.apiClient,t);return l=Ye("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=LT(h),m=new Im;return Object.assign(m,g),m})}else{const d=PT(this.apiClient,t);return l=Ye("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=MT(h),m=new Im;return Object.assign(m,g),m})}}async update(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=nE(this.apiClient,t);return l=Ye("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Rd(h))}else{const d=tE(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Pd(h))}}async delete(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=DS(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=FS(h),m=new Pm;return Object.assign(m,g),m})}else{const d=jS(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=OS(h),m=new Pm;return Object.assign(m,g),m})}}async countTokens(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=RS(this.apiClient,t);return l=Ye("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=LS(h),m=new Rm;return Object.assign(m,g),m})}else{const d=PS(this.apiClient,t);return l=Ye("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=MS(h),m=new Rm;return Object.assign(m,g),m})}}async computeTokens(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=SS(this.apiClient,t);return i=Ye("{model}:computeTokens",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=TS(c),h=new Qw;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=pT(this.apiClient,t);return l=Ye("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{const g=dT(h),m=new hl;return Object.assign(m,g),m})}else{const d=uT(this.apiClient,t);return l=Ye("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const g=cT(h),m=new hl;return Object.assign(m,g),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ZE extends Xo{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const n=t.operation,r=t.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(t){const n=t.operation,r=t.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Bw(t);return l=Ye("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{const d=Hw(t);return l=Ye("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=jw(t);return i=Ye("{resourceName}:fetchPredictOperation",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function QE(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function eN(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>cN(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function tN(e,t,n){const r={},a=u(t,["expireTime"]);n!==void 0&&a!=null&&p(n,["expireTime"],a);const i=u(t,["newSessionExpireTime"]);n!==void 0&&i!=null&&p(n,["newSessionExpireTime"],i);const s=u(t,["uses"]);n!==void 0&&s!=null&&p(n,["uses"],s);const l=u(t,["liveConnectConstraints"]);n!==void 0&&l!=null&&p(n,["bidiGenerateContentSetup"],lN(e,l));const c=u(t,["lockAdditionalFields"]);return n!==void 0&&c!=null&&p(n,["fieldMask"],c),r}function nN(e,t){const n={},r=u(t,["config"]);return r!=null&&p(n,["config"],tN(e,r,n)),n}function oN(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function rN(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function aN(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function iN(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function sN(e,t){const n={},r=u(e,["generationConfig"]);t!==void 0&&r!=null&&p(t,["setup","generationConfig"],r);const a=u(e,["responseModalities"]);t!==void 0&&a!=null&&p(t,["setup","generationConfig","responseModalities"],a);const i=u(e,["temperature"]);t!==void 0&&i!=null&&p(t,["setup","generationConfig","temperature"],i);const s=u(e,["topP"]);t!==void 0&&s!=null&&p(t,["setup","generationConfig","topP"],s);const l=u(e,["topK"]);t!==void 0&&l!=null&&p(t,["setup","generationConfig","topK"],l);const c=u(e,["maxOutputTokens"]);t!==void 0&&c!=null&&p(t,["setup","generationConfig","maxOutputTokens"],c);const d=u(e,["mediaResolution"]);t!==void 0&&d!=null&&p(t,["setup","generationConfig","mediaResolution"],d);const h=u(e,["seed"]);t!==void 0&&h!=null&&p(t,["setup","generationConfig","seed"],h);const g=u(e,["speechConfig"]);t!==void 0&&g!=null&&p(t,["setup","generationConfig","speechConfig"],Hu(g));const m=u(e,["thinkingConfig"]);t!==void 0&&m!=null&&p(t,["setup","generationConfig","thinkingConfig"],m);const w=u(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&p(t,["setup","generationConfig","enableAffectiveDialog"],w);const y=u(e,["systemInstruction"]);t!==void 0&&y!=null&&p(t,["setup","systemInstruction"],eN(jn(y)));const b=u(e,["tools"]);if(t!==void 0&&b!=null){let I=Ha(b);Array.isArray(I)&&(I=I.map(M=>uN(Ua(M)))),p(t,["setup","tools"],I)}const S=u(e,["sessionResumption"]);t!==void 0&&S!=null&&p(t,["setup","sessionResumption"],dN(S));const _=u(e,["inputAudioTranscription"]);t!==void 0&&_!=null&&p(t,["setup","inputAudioTranscription"],_);const v=u(e,["outputAudioTranscription"]);t!==void 0&&v!=null&&p(t,["setup","outputAudioTranscription"],v);const f=u(e,["realtimeInputConfig"]);t!==void 0&&f!=null&&p(t,["setup","realtimeInputConfig"],f);const T=u(e,["contextWindowCompression"]);t!==void 0&&T!=null&&p(t,["setup","contextWindowCompression"],T);const A=u(e,["proactivity"]);if(t!==void 0&&A!=null&&p(t,["setup","proactivity"],A),u(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function lN(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["setup","model"],Et(e,r));const a=u(t,["config"]);return a!=null&&p(n,["config"],sN(a,n)),n}function cN(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],oN(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],rN(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],QE(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function dN(e){const t={},n=u(e,["handle"]);if(n!=null&&p(t,["handle"],n),u(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function uN(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],aN(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],iN(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pN(e){const t=[];for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const r=e[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(i=>`${n}.${i}`);t.push(...a)}else t.push(n)}return t.join(",")}function hN(e,t){let n=null;const r=e.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(e.bidiGenerateContentSetup=i,n=i):delete e.bidiGenerateContentSetup}else r!==void 0&&delete e.bidiGenerateContentSetup;const a=e.fieldMask;if(n){const i=pN(n);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];a.length>0&&(l=a.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];i&&c.push(i),l.length>0&&c.push(...l),c.length>0?e.fieldMask=c.join(","):delete e.fieldMask}else delete e.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?e.fieldMask=a.join(","):delete e.fieldMask;return e}class mN extends Xo{constructor(t){super(),this.apiClient=t}async create(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=nN(this.apiClient,t);i=Ye("auth_tokens",l._url),s=l._query,delete l.config,delete l._url,delete l._query;const c=hN(l,t.config);return a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gN(e,t){const n={},r=u(e,["force"]);return t!==void 0&&r!=null&&p(t,["_query","force"],r),n}function fN(e){const t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],n);const r=u(e,["config"]);return r!=null&&gN(r,t),t}function yN(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],n),t}function xN(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function vN(e){const t={},n=u(e,["parent"]);n!=null&&p(t,["_url","parent"],n);const r=u(e,["config"]);return r!=null&&xN(r,t),t}function bN(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["documents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["documents"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wN extends Xo{constructor(t){super(),this.apiClient=t,this.list=async n=>new Zr(qo.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=yN(t);return i=Ye("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var n,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=fN(t);a=Ye("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=vN(t);return i=Ye("{parent}/documents",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=bN(c),h=new e_;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _N extends Xo{constructor(t,n=new wN(t)){super(),this.apiClient=t,this.documents=n,this.list=async(r={})=>new Zr(qo.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=pE(t);return i=Ye("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async get(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=gE(t);return i=Ye("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var n,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=mE(t);a=Ye("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=wE(t);return i=Ye("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=_E(c),h=new t_;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=CE(t);return i=Ye("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=SE(c),h=new n_;return Object.assign(h,d),h})}}async importFile(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=xE(t);return i=Ye("{file_search_store_name}:importFile",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=yE(c),h=new Ou;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ay=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return ay=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const CN=()=>ay();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ld(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const jd=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fo extends Error{}class Gn extends fo{constructor(t,n,r,a){super(`${Gn.makeMessage(t,n,r)}`),this.status=t,this.headers=a,this.error=n}static makeMessage(t,n,r){const a=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,n,r,a){if(!t||!a)return new Gl({message:r,cause:jd(n)});const i=n;return t===400?new sy(t,i,r,a):t===401?new ly(t,i,r,a):t===403?new cy(t,i,r,a):t===404?new dy(t,i,r,a):t===409?new uy(t,i,r,a):t===422?new py(t,i,r,a):t===429?new hy(t,i,r,a):t>=500?new my(t,i,r,a):new Gn(t,i,r,a)}}class Dd extends Gn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Gl extends Gn{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class iy extends Gl{constructor({message:t}={}){super({message:t??"Request timed out."})}}class sy extends Gn{}class ly extends Gn{}class cy extends Gn{}class dy extends Gn{}class uy extends Gn{}class py extends Gn{}class hy extends Gn{}class my extends Gn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const SN=/^[a-z][a-z0-9+.-]*:/i,TN=e=>SN.test(e);let Od=e=>(Od=Array.isArray,Od(e));const EN=Od;let NN=EN;const eg=NN;function kN(e){if(!e)return!0;for(const t in e)return!1;return!0}function AN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const IN=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new fo(`${e} must be an integer`);if(t<0)throw new fo(`${e} must be a positive integer`);return t},PN=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const RN=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sa="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function MN(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const LN=()=>{var e,t,n,r,a;const i=MN();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sa,"X-Stainless-OS":ng(Deno.build.os),"X-Stainless-Arch":tg(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sa,"X-Stainless-OS":ng((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":tg((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(a=globalThis.process.version)!==null&&a!==void 0?a:"unknown"};const s=jN();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function jN(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:t,version:`${a}.${i}.${s}`}}}return null}const tg=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",ng=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let ys;const DN=()=>ys??(ys=LN());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ON(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function gy(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function FN(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return gy({start(){},async pull(n){const{done:r,value:a}=await t.next();r?n.close():n.enqueue(a)},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}function fy(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function zN(e){var t,n;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((n=(t=e[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(t));return}const r=e.getReader(),a=r.cancel();r.releaseLock(),await a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const GN=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yy=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,n=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ec(e,t,n){return yy(),new File(e,t??"unknown_file",n)}function UN(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const HN=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xy=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",BN=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&xy(e),VN=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function $N(e,t,n){if(yy(),e=await e,BN(e))return e instanceof File?e:Ec([await e.arrayBuffer()],e.name);if(VN(e)){const a=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Ec(await Fd(a),t,n)}const r=await Fd(e);if(t||(t=UN(e)),!(n!=null&&n.type)){const a=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof a=="string"&&(n=Object.assign(Object.assign({},n),{type:a}))}return Ec(r,t,n)}async function Fd(e){var t,n,r,a,i;let s=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(xy(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else if(HN(e))try{for(var l=!0,c=Eo(e),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const h=a;s.push(...await Fd(h))}}catch(h){n={error:h}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}else{const h=(i=e==null?void 0:e.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof e}${h?`; constructor: ${h}`:""}${WN(e)}`)}return s}function WN(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vy{constructor(t){this._client=t}}vy._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function by(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const og=Object.freeze(Object.create(null)),YN=(e=by)=>function(n,...r){if(n.length===1)return n[0];let a=!1;const i=[],s=n.reduce((h,g,m)=>{var w,y,b;/[?#]/.test(g)&&(a=!0);const S=r[m];let _=(a?encodeURIComponent:e)(""+S);return m!==r.length&&(S==null||typeof S=="object"&&S.toString===((b=Object.getPrototypeOf((y=Object.getPrototypeOf((w=S.hasOwnProperty)!==null&&w!==void 0?w:og))!==null&&y!==void 0?y:og))===null||b===void 0?void 0:b.toString))&&(_=S+"",i.push({start:h.length+g.length,length:_.length,error:`Value of type ${Object.prototype.toString.call(S).slice(8,-1)} is not a valid path parameter`})),h+g+(m===r.length?"":_)},""),l=s.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(l))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((h,g)=>h.start-g.start),i.length>0){let h=0;const g=i.reduce((m,w)=>{const y=" ".repeat(w.start-h),b="^".repeat(w.length);return h=w.start+w.length,m+y+b},"");throw new fo(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${s}
${g}`)}return s},xs=YN(by);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wy extends vy{create(t,n){var r;const{api_version:a=this._client.apiVersion}=t,i=gl(t,["api_version"]);if("model"in i&&"agent_config"in i)throw new fo("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new fo("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(xs`/${a}/interactions`,Object.assign(Object.assign({body:i},n),{stream:(r=t.stream)!==null&&r!==void 0?r:!1}))}delete(t,n={},r){const{api_version:a=this._client.apiVersion}=n??{};return this._client.delete(xs`/${a}/interactions/${t}`,r)}cancel(t,n={},r){const{api_version:a=this._client.apiVersion}=n??{};return this._client.post(xs`/${a}/interactions/${t}/cancel`,r)}get(t,n={},r){var a;const i=n??{},{api_version:s=this._client.apiVersion}=i,l=gl(i,["api_version"]);return this._client.get(xs`/${s}/interactions/${t}`,Object.assign(Object.assign({query:l},r),{stream:(a=n==null?void 0:n.stream)!==null&&a!==void 0?a:!1}))}}wy._key=Object.freeze(["interactions"]);class _y extends wy{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qN(e){let t=0;for(const a of e)t+=a.length;const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return n}let vs;function Vu(e){let t;return(vs??(t=new globalThis.TextEncoder,vs=t.encode.bind(t)))(e)}let bs;function rg(e){let t;return(bs??(t=new globalThis.TextDecoder,bs=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ul{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Vu(t):t;this.buffer=qN([this.buffer,n]);const r=[];let a;for(;(a=KN(this.buffer,this.carriageReturnIndex))!=null;){if(a.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=a.index;continue}if(this.carriageReturnIndex!=null&&(a.index!==this.carriageReturnIndex+1||a.carriage)){r.push(rg(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?a.preceding-1:a.preceding,s=rg(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(a.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}Ul.NEWLINE_CHARS=new Set([`
`,"\r"]);Ul.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function KN(e,t){for(let a=t??0;a<e.length;a++){if(e[a]===10)return{preceding:a,index:a+1,carriage:!1};if(e[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function JN(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fl={off:0,error:200,warn:300,info:400,debug:500},ag=(e,t,n)=>{if(e){if(AN(fl,e))return e;On(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(fl))}`)}};function hi(){}function ws(e,t,n){return!t||fl[e]>fl[n]?hi:t[e].bind(t)}const XN={error:hi,warn:hi,info:hi,debug:hi};let ig=new WeakMap;function On(e){var t;const n=e.logger,r=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!n)return XN;const a=ig.get(n);if(a&&a[0]===r)return a[1];const i={error:ws("error",n,r),warn:ws("warn",n,r),info:ws("info",n,r),debug:ws("debug",n,r)};return ig.set(n,[r,i]),i}const Dr=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,n])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wa{constructor(t,n,r){this.iterator=t,this.controller=n,this.client=r}static fromSSEResponse(t,n,r){let a=!1;const i=r?On(r):console;function s(){return To(this,arguments,function*(){var c,d,h,g;if(a)throw new fo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let m=!1;try{try{for(var w=!0,y=Eo(ZN(t,n)),b;b=yield ft(y.next()),c=b.done,!c;w=!0){g=b.value,w=!1;const S=g;if(!m)if(S.data.startsWith("[DONE]")){m=!0;continue}else try{yield yield ft(JSON.parse(S.data))}catch(_){throw i.error("Could not parse message into JSON:",S.data),i.error("From chunk:",S.raw),_}}}catch(S){d={error:S}}finally{try{!w&&!c&&(h=y.return)&&(yield ft(h.call(y)))}finally{if(d)throw d.error}}m=!0}catch(S){if(Ld(S))return yield ft(void 0);throw S}finally{m||n.abort()}})}return new wa(s,n,r)}static fromReadableStream(t,n,r){let a=!1;function i(){return To(this,arguments,function*(){var c,d,h,g;const m=new Ul,w=fy(t);try{for(var y=!0,b=Eo(w),S;S=yield ft(b.next()),c=S.done,!c;y=!0){g=S.value,y=!1;const _=g;for(const v of m.decode(_))yield yield ft(v)}}catch(_){d={error:_}}finally{try{!y&&!c&&(h=b.return)&&(yield ft(h.call(b)))}finally{if(d)throw d.error}}for(const _ of m.flush())yield yield ft(_)})}function s(){return To(this,arguments,function*(){var c,d,h,g;if(a)throw new fo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let m=!1;try{try{for(var w=!0,y=Eo(i()),b;b=yield ft(y.next()),c=b.done,!c;w=!0){g=b.value,w=!1;const S=g;m||S&&(yield yield ft(JSON.parse(S)))}}catch(S){d={error:S}}finally{try{!w&&!c&&(h=y.return)&&(yield ft(h.call(y)))}finally{if(d)throw d.error}}m=!0}catch(S){if(Ld(S))return yield ft(void 0);throw S}finally{m||n.abort()}})}return new wa(s,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){const s=r.next();t.push(s),n.push(s)}return i.shift()}});return[new wa(()=>a(t),this.controller,this.client),new wa(()=>a(n),this.controller,this.client)]}toReadableStream(){const t=this;let n;return gy({async start(){n=t[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await n.next();if(i)return r.close();const s=Vu(JSON.stringify(a)+`
`);r.enqueue(s)}catch(a){r.error(a)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function ZN(e,t){return To(this,arguments,function*(){var r,a,i,s;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new fo("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new fo("Attempted to iterate over a response with no body");const l=new ek,c=new Ul,d=fy(e.body);try{for(var h=!0,g=Eo(QN(d)),m;m=yield ft(g.next()),r=m.done,!r;h=!0){s=m.value,h=!1;const w=s;for(const y of c.decode(w)){const b=l.decode(y);b&&(yield yield ft(b))}}}catch(w){a={error:w}}finally{try{!h&&!r&&(i=g.return)&&(yield ft(i.call(g)))}finally{if(a)throw a.error}}for(const w of c.flush()){const y=l.decode(w);y&&(yield yield ft(y))}})}function QN(e){return To(this,arguments,function*(){var n,r,a,i;let s=new Uint8Array;try{for(var l=!0,c=Eo(e),d;d=yield ft(c.next()),n=d.done,!n;l=!0){i=d.value,l=!1;const h=i;if(h==null)continue;const g=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?Vu(h):h;let m=new Uint8Array(s.length+g.length);m.set(s),m.set(g,s.length),s=m;let w;for(;(w=JN(s))!==-1;)yield yield ft(s.slice(0,w)),s=s.slice(w)}}catch(h){r={error:h}}finally{try{!l&&!n&&(a=c.return)&&(yield ft(a.call(c)))}finally{if(r)throw r.error}}s.length>0&&(yield yield ft(s))})}class ek{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,a]=tk(t,":");return a.startsWith(" ")&&(a=a.substring(1)),n==="event"?this.event=a:n==="data"&&this.data.push(a),null}}function tk(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nk(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:a,startTime:i}=t,s=await(async()=>{var l;if(t.options.stream)return On(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):wa.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;const c=n.headers.get("content-type"),d=(l=c==null?void 0:c.split(";")[0])===null||l===void 0?void 0:l.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await n.json():await n.text()})();return On(e).debug(`[${r}] response parsed`,Dr({retryOfRequestLogID:a,url:n.url,status:n.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $u extends Promise{constructor(t,n,r=nk){super(a=>{a(null)}),this.responsePromise=n,this.parseResponse=r,this.client=t}_thenUnwrap(t){return new $u(this.client,this.responsePromise,async(n,r)=>t(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cy=Symbol("brand.privateNullableHeaders");function*ok(e){if(!e)return;if(Cy in e){const{values:r,nulls:a}=e;yield*r.entries();for(const i of a)yield[i,null];return}let t=!1,n;e instanceof Headers?n=e.entries():eg(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let r of n){const a=r[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const i=eg(r[1])?r[1]:[r[1]];let s=!1;for(const l of i)l!==void 0&&(t&&!s&&(s=!0,yield[a,null]),yield[a,l])}}const si=e=>{const t=new Headers,n=new Set;for(const r of e){const a=new Set;for(const[i,s]of ok(r)){const l=i.toLowerCase();a.has(l)||(t.delete(i),a.add(l)),s===null?(t.delete(i),n.add(l)):(t.append(i,s),n.delete(l))}}return{[Cy]:!0,values:t,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Nc=e=>{var t,n,r,a,i,s;if(typeof globalThis.process<"u")return(r=(n=(t=Aw)===null||t===void 0?void 0:t[e])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(a=globalThis.Deno.env)===null||a===void 0?void 0:a.get)===null||i===void 0?void 0:i.call(a,e))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Sy;class Hl{constructor(t){var n,r,a,i,s,l,c,{baseURL:d=Nc("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(n=Nc("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:g="v1beta"}=t,m=gl(t,["baseURL","apiKey","apiVersion"]);const w=Object.assign(Object.assign({apiKey:h,apiVersion:g},m),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=w.baseURL,this.timeout=(r=w.timeout)!==null&&r!==void 0?r:Hl.DEFAULT_TIMEOUT,this.logger=(a=w.logger)!==null&&a!==void 0?a:console;const y="warn";this.logLevel=y,this.logLevel=(s=(i=ag(w.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:ag(Nc("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:y,this.fetchOptions=w.fetchOptions,this.maxRetries=(l=w.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(c=w.fetch)!==null&&c!==void 0?c:ON(),this.encoder=GN,this._options=w,this.apiKey=h,this.apiVersion=g,this.clientAdapter=w.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const n=si([t.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return si([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return si([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new fo(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${sa}`}defaultIdempotencyKey(){return`stainless-node-retry-${CN()}`}makeStatusError(t,n,r,a){return Gn.generate(t,n,r,a)}buildURL(t,n,r){const a=!this.baseURLOverridden()&&r||this.baseURL,i=TN(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return kN(s)||(n=Object.assign(Object.assign({},s),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const n=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(t,{url:n,options:r}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(a=>Object.assign({method:t,path:n},a)))}request(t,n=null){return new $u(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,r){var a,i,s;const l=await t,c=(a=l.maxRetries)!==null&&a!==void 0?a:this.maxRetries;n==null&&(n=c),await this.prepareOptions(l);const{req:d,url:h,timeout:g}=await this.buildRequest(l,{retryCount:c-n});await this.prepareRequest(d,{url:h,options:l});const m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),w=r===void 0?"":`, retryOf: ${r}`,y=Date.now();if(On(this).debug(`[${m}] sending request`,Dr({retryOfRequestLogID:r,method:l.method,url:h,options:l,headers:d.headers})),!((i=l.signal)===null||i===void 0)&&i.aborted)throw new Dd;const b=new AbortController,S=await this.fetchWithTimeout(h,d,g,b).catch(jd),_=Date.now();if(S instanceof globalThis.Error){const f=`retrying, ${n} attempts remaining`;if(!((s=l.signal)===null||s===void 0)&&s.aborted)throw new Dd;const T=Ld(S)||/timed? ?out/i.test(String(S)+("cause"in S?String(S.cause):""));if(n)return On(this).info(`[${m}] connection ${T?"timed out":"failed"} - ${f}`),On(this).debug(`[${m}] connection ${T?"timed out":"failed"} (${f})`,Dr({retryOfRequestLogID:r,url:h,durationMs:_-y,message:S.message})),this.retryRequest(l,n,r??m);throw On(this).info(`[${m}] connection ${T?"timed out":"failed"} - error; no more retries left`),On(this).debug(`[${m}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Dr({retryOfRequestLogID:r,url:h,durationMs:_-y,message:S.message})),T?new iy:new Gl({cause:S})}const v=`[${m}${w}] ${d.method} ${h} ${S.ok?"succeeded":"failed"} with status ${S.status} in ${_-y}ms`;if(!S.ok){const f=await this.shouldRetry(S);if(n&&f){const k=`retrying, ${n} attempts remaining`;return await zN(S.body),On(this).info(`${v} - ${k}`),On(this).debug(`[${m}] response error (${k})`,Dr({retryOfRequestLogID:r,url:S.url,status:S.status,headers:S.headers,durationMs:_-y})),this.retryRequest(l,n,r??m,S.headers)}const T=f?"error; no more retries left":"error; not retryable";On(this).info(`${v} - ${T}`);const A=await S.text().catch(k=>jd(k).message),I=PN(A),M=I?void 0:A;throw On(this).debug(`[${m}] response error (${T})`,Dr({retryOfRequestLogID:r,url:S.url,status:S.status,headers:S.headers,message:M,durationMs:Date.now()-y})),this.makeStatusError(S.status,I,M,S.headers)}return On(this).info(v),On(this).debug(`[${m}] response start`,Dr({retryOfRequestLogID:r,url:S.url,status:S.status,headers:S.headers,durationMs:_-y})),{response:S,options:l,controller:b,requestLogID:m,retryOfRequestLogID:r,startTime:y}}async fetchWithTimeout(t,n,r,a){const i=n||{},{signal:s,method:l}=i,c=gl(i,["signal","method"]);s&&s.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),r),h=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,g=Object.assign(Object.assign(Object.assign({signal:a.signal},h?{duplex:"half"}:{}),{method:"GET"}),c);l&&(g.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,g)}finally{clearTimeout(d)}}async shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r,a){var i;let s;const l=a==null?void 0:a.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(s=d)}const c=a==null?void 0:a.get("retry-after");if(c&&!s){const d=parseFloat(c);Number.isNaN(d)?s=Date.parse(c)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=t.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,d)}return await RN(s),this.makeRequest(t,n-1,r)}calculateDefaultRetryTimeoutMillis(t,n){const i=n-t,s=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return s*l*1e3}async buildRequest(t,{retryCount:n=0}={}){var r,a,i;const s=Object.assign({},t),{method:l,path:c,query:d,defaultBaseURL:h}=s,g=this.buildURL(c,d,h);"timeout"in s&&IN("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:m,body:w}=this.buildBody({options:s}),y=await this.buildHeaders({options:t,method:l,bodyHeaders:m,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:y},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&w instanceof globalThis.ReadableStream&&{duplex:"half"}),w&&{body:w}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:g,timeout:s.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:r,retryCount:a}){let i={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=t.idempotencyKey);const s=await this.authHeaders(t);let l=si([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),DN()),this._options.defaultHeaders,r,t.headers,s]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=si([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:FN(t)}:this.encoder({body:t,headers:r})}}Hl.DEFAULT_TIMEOUT=6e4;class Cn extends Hl{constructor(){super(...arguments),this.interactions=new _y(this)}}Sy=Cn;Cn.GeminiNextGenAPIClient=Sy;Cn.GeminiNextGenAPIClientError=fo;Cn.APIError=Gn;Cn.APIConnectionError=Gl;Cn.APIConnectionTimeoutError=iy;Cn.APIUserAbortError=Dd;Cn.NotFoundError=dy;Cn.ConflictError=uy;Cn.RateLimitError=hy;Cn.BadRequestError=sy;Cn.AuthenticationError=ly;Cn.InternalServerError=my;Cn.PermissionDeniedError=cy;Cn.UnprocessableEntityError=py;Cn.toFile=$N;Cn.Interactions=_y;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rk(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function ak(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function ik(e,t){const n={},r=u(e,["sdkHttpResponse"]);return r!=null&&p(n,["sdkHttpResponse"],r),n}function sk(e,t){const n={},r=u(e,["sdkHttpResponse"]);return r!=null&&p(n,["sdkHttpResponse"],r),n}function lk(e,t,n){const r={};if(u(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=u(e,["tunedModelDisplayName"]);if(t!==void 0&&a!=null&&p(t,["displayName"],a),u(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=u(e,["epochCount"]);t!==void 0&&i!=null&&p(t,["tuningTask","hyperparameters","epochCount"],i);const s=u(e,["learningRateMultiplier"]);if(s!=null&&p(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),u(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(u(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(u(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=u(e,["batchSize"]);t!==void 0&&l!=null&&p(t,["tuningTask","hyperparameters","batchSize"],l);const c=u(e,["learningRate"]);if(t!==void 0&&c!=null&&p(t,["tuningTask","hyperparameters","learningRate"],c),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(u(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function ck(e,t,n){const r={};let a=u(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const w=u(e,["validationDataset"]);t!==void 0&&w!=null&&p(t,["supervisedTuningSpec"],sg(w))}else if(a==="PREFERENCE_TUNING"){const w=u(e,["validationDataset"]);t!==void 0&&w!=null&&p(t,["preferenceOptimizationSpec"],sg(w))}const i=u(e,["tunedModelDisplayName"]);t!==void 0&&i!=null&&p(t,["tunedModelDisplayName"],i);const s=u(e,["description"]);t!==void 0&&s!=null&&p(t,["description"],s);let l=u(n,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const w=u(e,["epochCount"]);t!==void 0&&w!=null&&p(t,["supervisedTuningSpec","hyperParameters","epochCount"],w)}else if(l==="PREFERENCE_TUNING"){const w=u(e,["epochCount"]);t!==void 0&&w!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],w)}let c=u(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const w=u(e,["learningRateMultiplier"]);t!==void 0&&w!=null&&p(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],w)}else if(c==="PREFERENCE_TUNING"){const w=u(e,["learningRateMultiplier"]);t!==void 0&&w!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],w)}let d=u(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const w=u(e,["exportLastCheckpointOnly"]);t!==void 0&&w!=null&&p(t,["supervisedTuningSpec","exportLastCheckpointOnly"],w)}else if(d==="PREFERENCE_TUNING"){const w=u(e,["exportLastCheckpointOnly"]);t!==void 0&&w!=null&&p(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],w)}let h=u(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const w=u(e,["adapterSize"]);t!==void 0&&w!=null&&p(t,["supervisedTuningSpec","hyperParameters","adapterSize"],w)}else if(h==="PREFERENCE_TUNING"){const w=u(e,["adapterSize"]);t!==void 0&&w!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],w)}if(u(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(u(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const g=u(e,["labels"]);t!==void 0&&g!=null&&p(t,["labels"],g);const m=u(e,["beta"]);return t!==void 0&&m!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","beta"],m),r}function dk(e,t){const n={},r=u(e,["baseModel"]);r!=null&&p(n,["baseModel"],r);const a=u(e,["preTunedModel"]);a!=null&&p(n,["preTunedModel"],a);const i=u(e,["trainingDataset"]);i!=null&&wk(i);const s=u(e,["config"]);return s!=null&&lk(s,n),n}function uk(e,t){const n={},r=u(e,["baseModel"]);r!=null&&p(n,["baseModel"],r);const a=u(e,["preTunedModel"]);a!=null&&p(n,["preTunedModel"],a);const i=u(e,["trainingDataset"]);i!=null&&_k(i,n,t);const s=u(e,["config"]);return s!=null&&ck(s,n,t),n}function pk(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function hk(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function mk(e,t,n){const r={},a=u(e,["pageSize"]);t!==void 0&&a!=null&&p(t,["_query","pageSize"],a);const i=u(e,["pageToken"]);t!==void 0&&i!=null&&p(t,["_query","pageToken"],i);const s=u(e,["filter"]);return t!==void 0&&s!=null&&p(t,["_query","filter"],s),r}function gk(e,t,n){const r={},a=u(e,["pageSize"]);t!==void 0&&a!=null&&p(t,["_query","pageSize"],a);const i=u(e,["pageToken"]);t!==void 0&&i!=null&&p(t,["_query","pageToken"],i);const s=u(e,["filter"]);return t!==void 0&&s!=null&&p(t,["_query","filter"],s),r}function fk(e,t){const n={},r=u(e,["config"]);return r!=null&&mk(r,n),n}function yk(e,t){const n={},r=u(e,["config"]);return r!=null&&gk(r,n),n}function xk(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["nextPageToken"]);a!=null&&p(n,["nextPageToken"],a);const i=u(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Ty(l))),p(n,["tuningJobs"],s)}return n}function vk(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["nextPageToken"]);a!=null&&p(n,["nextPageToken"],a);const i=u(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>zd(l))),p(n,["tuningJobs"],s)}return n}function bk(e,t){const n={},r=u(e,["name"]);r!=null&&p(n,["model"],r);const a=u(e,["name"]);return a!=null&&p(n,["endpoint"],a),n}function wk(e,t){const n={};if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=u(e,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),p(n,["examples","examples"],a)}return n}function _k(e,t,n){const r={};let a=u(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const s=u(e,["gcsUri"]);t!==void 0&&s!=null&&p(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(a==="PREFERENCE_TUNING"){const s=u(e,["gcsUri"]);t!==void 0&&s!=null&&p(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=u(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=u(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&p(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=u(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&p(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(u(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function Ty(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["name"]);a!=null&&p(n,["name"],a);const i=u(e,["state"]);i!=null&&p(n,["state"],Uf(i));const s=u(e,["createTime"]);s!=null&&p(n,["createTime"],s);const l=u(e,["tuningTask","startTime"]);l!=null&&p(n,["startTime"],l);const c=u(e,["tuningTask","completeTime"]);c!=null&&p(n,["endTime"],c);const d=u(e,["updateTime"]);d!=null&&p(n,["updateTime"],d);const h=u(e,["description"]);h!=null&&p(n,["description"],h);const g=u(e,["baseModel"]);g!=null&&p(n,["baseModel"],g);const m=u(e,["_self"]);return m!=null&&p(n,["tunedModel"],bk(m)),n}function zd(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["name"]);a!=null&&p(n,["name"],a);const i=u(e,["state"]);i!=null&&p(n,["state"],Uf(i));const s=u(e,["createTime"]);s!=null&&p(n,["createTime"],s);const l=u(e,["startTime"]);l!=null&&p(n,["startTime"],l);const c=u(e,["endTime"]);c!=null&&p(n,["endTime"],c);const d=u(e,["updateTime"]);d!=null&&p(n,["updateTime"],d);const h=u(e,["error"]);h!=null&&p(n,["error"],h);const g=u(e,["description"]);g!=null&&p(n,["description"],g);const m=u(e,["baseModel"]);m!=null&&p(n,["baseModel"],m);const w=u(e,["tunedModel"]);w!=null&&p(n,["tunedModel"],w);const y=u(e,["preTunedModel"]);y!=null&&p(n,["preTunedModel"],y);const b=u(e,["supervisedTuningSpec"]);b!=null&&p(n,["supervisedTuningSpec"],b);const S=u(e,["preferenceOptimizationSpec"]);S!=null&&p(n,["preferenceOptimizationSpec"],S);const _=u(e,["tuningDataStats"]);_!=null&&p(n,["tuningDataStats"],_);const v=u(e,["encryptionSpec"]);v!=null&&p(n,["encryptionSpec"],v);const f=u(e,["partnerModelTuningSpec"]);f!=null&&p(n,["partnerModelTuningSpec"],f);const T=u(e,["customBaseModel"]);T!=null&&p(n,["customBaseModel"],T);const A=u(e,["experiment"]);A!=null&&p(n,["experiment"],A);const I=u(e,["labels"]);I!=null&&p(n,["labels"],I);const M=u(e,["outputUri"]);M!=null&&p(n,["outputUri"],M);const N=u(e,["pipelineJob"]);N!=null&&p(n,["pipelineJob"],N);const k=u(e,["serviceAccount"]);k!=null&&p(n,["serviceAccount"],k);const E=u(e,["tunedModelDisplayName"]);E!=null&&p(n,["tunedModelDisplayName"],E);const P=u(e,["veoTuningSpec"]);return P!=null&&p(n,["veoTuningSpec"],P),n}function Ck(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["name"]);a!=null&&p(n,["name"],a);const i=u(e,["metadata"]);i!=null&&p(n,["metadata"],i);const s=u(e,["done"]);s!=null&&p(n,["done"],s);const l=u(e,["error"]);return l!=null&&p(n,["error"],l),n}function sg(e,t){const n={},r=u(e,["gcsUri"]);r!=null&&p(n,["validationDatasetUri"],r);const a=u(e,["vertexDatasetResource"]);return a!=null&&p(n,["validationDatasetUri"],a),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Sk extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Zr(qo.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const a={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=n.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},n),{preTunedModel:a});return i.baseModel=void 0,await this.tuneInternal(i)}else{const a=Object.assign({},n);return await this.tuneInternal(a)}else{const a=Object.assign({},n),i=await this.tuneMldevInternal(a);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:Nd.JOB_STATE_QUEUED}}}}async getInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=hk(t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>zd(h))}else{const d=pk(t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>Ty(h))}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=yk(t);return l=Ye("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=vk(h),m=new Mm;return Object.assign(m,g),m})}else{const d=fk(t);return l=Ye("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=xk(h),m=new Mm;return Object.assign(m,g),m})}}async cancel(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=ak(t);return l=Ye("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=sk(h),m=new Lm;return Object.assign(m,g),m})}else{const d=rk(t);return l=Ye("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=ik(h),m=new Lm;return Object.assign(m,g),m})}}async tuneInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=uk(t,t);return i=Ye("tuningJobs",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>zd(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=dk(t);return i=Ye("tunedModels",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>Ck(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Tk{async download(t,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Ek=1024*1024*8,Nk=3,kk=1e3,Ak=2,yl="x-goog-upload-status";async function Ik(e,t,n){var r;const a=await Ey(e,t,n),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[yl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function Pk(e,t,n){var r;const a=await Ey(e,t,n),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[yl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=jf(i),l=new Fu;return Object.assign(l,s),l}async function Ey(e,t,n){var r,a;let i=0,s=0,l=new kd(new Response),c="upload";for(i=e.size;s<i;){const d=Math.min(Ek,i-s),h=e.slice(s,s+d);s+d>=i&&(c+=", finalize");let g=0,m=kk;for(;g<Nk&&(l=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[yl]));)g++,await Mk(m),m=m*Ak;if(s+=d,((a=l==null?void 0:l.headers)===null||a===void 0?void 0:a[yl])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function Rk(e){return{size:e.size,type:e.type}}function Mk(e){return new Promise(t=>setTimeout(t,e))}class Lk{async upload(t,n,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Ik(t,n,r)}async uploadToFileSearchStore(t,n,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Pk(t,n,r)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Rk(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jk{create(t,n,r){return new Dk(t,n,r)}}class Dk{constructor(t,n,r){this.url=t,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lg="x-goog-api-key";class Ok{constructor(t){this.apiKey=t}async addAuthHeaders(t,n){if(t.get(lg)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(lg,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fk="gl-node/";class zk{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new Cn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=n.interactions,this._interactions}constructor(t){var n;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=t.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=t.apiKey;const r=Mw(t.httpOptions,t.vertexai,void 0,void 0);r&&(t.httpOptions?t.httpOptions.baseUrl=r:t.httpOptions={baseUrl:r}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const a=new Ok(this.apiKey);this.apiClient=new RE({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Fk+"web",uploader:new Lk,downloader:new Tk}),this.models=new XE(this.apiClient),this.live=new $E(this.apiClient,a,new jk),this.batches=new lC(this.apiClient),this.chats=new BC(this.models,this.apiClient),this.caches=new GC(this.apiClient),this.files=new QC(this.apiClient),this.operations=new ZE(this.apiClient),this.authTokens=new mN(this.apiClient),this.tunings=new Sk(this.apiClient),this.fileSearchStores=new _N(this.apiClient)}}const Kt=()=>{const e=localStorage.getItem("gemini-api-key"),t=e&&e.trim()!==""?e:null;if(!t)throw console.error("Script Modifier: API Key is missing. Please enter it in the application settings."),new Error("API Key not found. Please set it in Settings.");return new zk({apiKey:t})},Jt=async(e,t=3,n=1e3)=>{try{return await e()}catch(r){if(t>0&&(r.status===429||r.status>=500))return await new Promise(a=>setTimeout(a,n)),Jt(e,t-1,n*2);throw r}},yo=e=>{if(!e)return"{}";let t=e.replace(/```json\n?/g,"").replace(/```\n?/g,"");const n=t.indexOf("["),r=t.lastIndexOf("]"),a=t.indexOf("{"),i=t.lastIndexOf("}");let s=-1,l=-1;return n!==-1&&(a===-1||n<a)?r!==-1&&r>n&&(s=n,l=r+1):a!==-1&&i!==-1&&i>a&&(s=a,l=i+1),s!==-1&&l!==-1?t.substring(s,l):t.trim()},qi=(e,t=null)=>{const n=yo(e);try{return JSON.parse(n)}catch(r){const a=n.replace(/([{,]\s*)([a-zA-Z0-9_]+?)\s*:/g,'$1"$2":');try{return JSON.parse(a)}catch{const s=a.replace(/,\s*([\]}])/g,"$1");try{return JSON.parse(s)}catch{if(console.error("JSON Parse failed after fixes:",r),t!==null)return t;throw r}}}},Wu=`**MASTER CONSTRUCTION ALGORITHM (Unified Flow):**

Construct the final prompt as a **SINGLE, SEAMLESS BLOCK of descriptive text**. 

**CRITICAL GROUPING BAN:** You are FORBIDDEN from grouping subjects grammatically (e.g. 'Entity-1 and Entity-2 are running'). You MUST describe them SEQUENTIALLY.

**MANDATORY SEQUENCE:**
1. **[Master Set Design/Background]**
2. **[Subject 1: FULL BODY POSE & ACTION]** (Even if not fully visible)
3. *...interaction connector...*
4. **[Subject 2: FULL BODY POSE & ACTION]**
5. **[Specific Focus/Detail]** (If Close-Up)
6. **[Technical/Camera]**.

**LOGIC:**
- **Environment:** Establish the physical set first. 
- **Invisible Context:** You MUST describe the full posture (kneeling, running, slumped) BEFORE describing facial details, otherwise the AI generates a T-Pose.
- **Technical:** End with lens/angle.`,Yu=`**MASTER CONSTRUCTION ALGORITHM (No Entity Vis):**

Construct the final prompt as a **SINGLE, SEAMLESS BLOCK of descriptive text**. 

**CRITICAL GROUPING BAN:** You are FORBIDDEN from grouping subjects (e.g., 'Entity-1 and Entity-2 are running' is WRONG). You MUST iterate through them individually.

**MANDATORY SEQUENCE:**
1. **[Master Set Design/Background]**
2. **[Index-1] + [FULL BODY POSE & ACTION]**
3. *...spatial relation...*
4. **[Index-2] + [FULL BODY POSE & ACTION]**
5. **[Specific Focus/Detail]**
6. **[Technical/Camera]**.

**MANDATORY:** You MUST describe the physical body geometry (e.g., 'knees bent at 90 degrees', 'arms outstretched', 'jaw dropped') for EACH index separately.`,te={INPUTS:{id:"inputs",label:"Inputs",text:"Source Data: Script Frames, Entity Visuals, Scene Style, Master Set Design (Context)."},ROLE:{id:"role_artist",label:"Role",text:"You are a Lead Keyframe Technical Director and AI Prompt Engineer. Your task is to generate a RAW TECHNICAL IMAGE PROMPT for a STATIC frame. Do not write introductory text. Do not use literary devices or abbreviations. Output ONLY the prompt content."},NO_POV:{id:"no_pov",label:"No POV",text:"**CRITICAL NEGATIVE CONSTRAINT: NO POV SHOTS.** You are strictly FORBIDDEN from generating 'Point of View', 'POV', or 'First Person' shots. The camera must ALWAYS be external to the subject. Do not use phrases like 'seen through eyes', 'view from', or 'hands entering frame'. Describe the scene from an objective, third-person cinematic angle."},STATIC_STATE:{id:"rule_static",label:"Static Only",text:"**CRITICAL RULE: NO NARRATIVE TRANSITIONS.** Do not use words like 'suddenly', 'instantly', 'begins to', 'changed', 'transitioned'. Describe the current visual STATE. Describe physical anatomy and stance."},ATMOSPHERIC_FIX:{id:"rule_atmosphere",label:"Fixed Atmosphere",text:"ATMOSPHERIC ANCHOR: Describe the current mood as a physical property of the air and light (e.g., fog density, light color, particulate matter). Do not describe how it 'became' this way."},STATELESS:{id:"rule_stateless",label:"Self-Contained",text:`**CRITICAL RULE: VISUAL STATELESSNESS.** You are strictly FORBIDDEN from using referential literary shortcuts. Every prompt is an independent technical document. DO NOT use words like 'same', 'opposite', 'continues', 'there', 'before', 'also'. You MUST fully redescribe the setting for every single frame as if the previous one never existed.

**MANDATORY ACTION RESET:** You must also fully redescribe the ACTION of EVERY entity from scratch. Describe the action hierarchy from **General to Specific**: 1. Full Body Posture. 2. Limb Action. 3. Facial Expression. Never abbreviate or omit the subject's physical state.`},SUBJECT_FOCUS:{id:"rule_subject_detail",label:"Invisible Context",text:`**CRITICAL: INVISIBLE BODY CONTEXT.** The Image Generator assumes a T-Pose if you don't describe the body. 
**RULE:** Even for Close-Ups (CU/ECU) of a face or object, you **MUST** describe the full body pose of the subject FIRST.
- **WRONG:** 'Close-up of Entity-1 smiling'. (Result: Floating head or T-Pose).
- **RIGHT:** 'Entity-1 is leaning forward over a table, shoulders hunched, weight on elbows. Close-up of Entity-1 smiling'.
*Always anchor the detail to a full physical posture.*`},STRICT_CHAR_INDEX:{id:"strict_char_index",label:"Entity Index",text:"Entities are identified by their index (Entity-N). Map these to the provided visual profiles perfectly."},GENERAL_CHAR_DESC:{id:"general_char_desc",label:"General Detail",text:"Summarize and incorporate a CONCISE, GENERAL version of the visual prompt from the character's profile."},FULL_CHAR_DESC:{id:"full_char_desc",label:"Full Detail",text:"Incorporate the FULL and DETAILED visual prompt from the entity's profile exactly as written."},NO_NAMES:{id:"rule_no_names",label:"No Names (English Tags)",text:"**CRITICAL: ABSOLUTE NAME BAN & BRACKETS.** You are strictly FORBIDDEN from including character names in the output. You MUST refer to characters ONLY by their Entity Index ID **enclosed in square brackets** (e.g., `[Entity-1]`, `[Entity-2]`). \n**ENGLISH TAGS ONLY:** The tag inside the brackets MUST remain in English (e.g., `[Entity-1]`), even if the rest of the prompt is in another language. DO NOT translate 'Entity'."},ALWAYS_ENV:{id:"rule_always_env",label:"Mandatory Set Design",text:`**CRITICAL RULE: MANDATORY SET DESIGN INJECTION.** The provided 'Global Scene Context' is the **PHYSICAL TRUTH**. You MUST incorporate its specific details (Furniture type/color, Floor texture, Wall material, Lighting source) into the environment layer of EVERY prompt.

**HIERARCHY:**
1. **SET DESIGN:** Establish the room/location details from the Context FIRST.
2. **DEPTH:** Then describe Far -> Mid -> Near elements.

*Do not hallucinate a generic background. Use the specific one provided.*`},LAYERED_CONSTRUCTION:{id:"rule_layers",label:"Layered",text:`**MASTER CONSTRUCTION ALGORITHM (Unified Flow):**

Construct the final prompt as a **SINGLE, SEAMLESS BLOCK of descriptive text**. 

**CRITICAL GROUPING BAN:** You are FORBIDDEN from grouping subjects (e.g. '[Entity-1] and [Entity-2]'). Describe them SEQUENTIALLY.

**STRUCTURE:**
1. **[Style]**
2. **[Master Set Design/Background]**
3. **[Subject 1 Visuals] + [Subject 1 FULL BODY POSE & ACTION]**
4. **[Subject 2 Visuals] + [Subject 2 FULL BODY POSE & ACTION]**
5. **[Specific Focus/Detail]** (If Close-Up)
6. **[Technical/Camera]**.

**LOGIC:**
- **Environment:** Start with the specific physical set details.
- **Subjects:** For EACH index, explicitly describe body geometry (e.g. 'kneeling', 'reaching', 'twisted torso') BEFORE describing face or details.
- **Technical:** End with lens, angle, and quality tags.`},VISUAL_SATURATION:{id:"rule_saturation",label:"Saturation",text:"Use technical descriptors: anamorphic flares, chromatic aberration, ray-tracing, sub-surface scattering."},PROCESS_WHOLE_SCENE:{id:"process_whole_scene",label:"Batch Scene",text:"Analyze all frames of a scene together for visual consistency."},GENERATE_VIDEO_PROMPT:{id:"generate_video",label:"Video Prompt",text:`Generate separate technical video prompt: 
**STRICT FORMATTING RULES:**
1. **SUBJECTS & ACTIONS:** DO NOT use names. Use ONLY Index in brackets (e.g. \`[Entity-1]\`). Format: \`[Entity-Index] (A detailed visual description of appearance, outfit, textures, and species) performs [Detailed Action]\`. 
2. **VISUAL DETAIL:** The visual description inside the video prompt MUST be extensive enough for the video model to understand the entity without external context.
3. **DYNAMICS:** Dynamics: [Describe environment motion, wind, light shifts].
4. **CAMERA:** Camera: [Movement].`},BREAK_PARAGRAPHS:{id:"break_paragraphs",label:"Formatting",text:`**FORMATTING OVERRIDE:**
Ignore the 'seamless block' rule. You MUST structure the output into distinct sections using explicit headers and line breaks:

**ENVIRONMENT:** [Set Design & Description]
**INTERACTION:** [Entities & Action Description]
**TECHNICAL:** [Camera & Style]`},ANTHRO_REINFORCEMENT:{id:"pm_anthro",label:"Anthro Detail",text:"**ANTHROPOMORPHIC ENFORCEMENT:** You MUST explicitly insert the word 'anthropomorphic' before the species name in BOTH the final 'imagePrompt' AND the 'videoPrompt'. Emphasize animal textures (fur, scales, etc.) and correct anatomical blending in all output fields."},SUBSCRIBE_REINFORCEMENT:{id:"pm_subscribe",label:"Legible Text",text:"**TEXT RENDERING ENHANCEMENT:** If the scene involves 'Subscribe' or 'Like', ensure the text is visible and legible. Use keywords: 'text label', 'signboard', 'neon typography', 'legible font', 'bold letters', 'typographic composition'."},ANATOMICAL_STRICTNESS:{id:"anatomical_strictness",label:"Anatomy Logic",text:`**CRITICAL: INDIVIDUAL PHYSICS.** Treat every entity as a separate 3D object.
1. **NO SHARED VERBS:** Never say 'they looked'. Say '[Entity-1] looked left, [Entity-2] looked right'.
2. **LIMB PLACEMENT:** Describe the exact position of arms and legs for EACH entity separately. 
3. **EMOTION:** Assign a specific facial muscle description to EACH entity (e.g. '[Entity-1] brow furrowed', '[Entity-2] smiling broadly').`},PROP_ENHANCEMENT:{id:"prop_enhancement",label:"Prop Materiality",text:"**PROP MATERIALITY & TEXTURE:** Amplify the physical presence of specific objects mentioned in the input. If the input specifies an object, you must describe the *interaction of light* with that specific material. **MANDATORY:** You must preserve the specific Object Type and Color defined in the input. Do not randomize objects."},IMG_VID_CONSISTENCY:{id:"img_vid_consistency",label:"Img-Vid Flow",text:`**RULE: START-TO-MOTION CONTINUITY.** The 'imagePrompt' describes the **INITIAL STATIC STATE (Frame 0/Start Frame)**. The 'videoPrompt' describes the **IMMEDIATE ACTION** occurring *after* that frame. 
- **Image:** Describe potential energy/static setup.
- **Video:** Describe the kinetic release/movement.

Do not describe the movement in the image prompt (keep it static). Do not describe the static setup in the video prompt (describe the evolution).`}},We={INPUTS_DATA:{id:"sg_inputs",text:"Source Data: Concept/Idea, Character Profiles."},CORE:{id:"core_director",text:`You are NOT a cameraman. You are a PHYSICAL OBSERVER. 
**YOUR GOAL:** Describe the PHYSICAL REALITY of the scene.
**FORBIDDEN:** Metaphors, invisible feelings, and abstract summaries.
**REQUIRED:** Physical muscle movements, contact between surfaces, light hitting textures.`},ANALYSIS:{id:"sg_thinking",label:"Visual Logic",text:"LOGIC: Before writing, visualize the set. Where is the light coming from? What objects are present? If a character is performing an action, what specific tools are they using? Describe the physics of the scene."},IMPROVE_CONCEPT:{id:"sg_improve_input",label:"Creative Expansion",text:`**CRITICAL RULE: THE PROMPT IS SACRED.** 
1. **PRESERVATION:** You must incorporate EVERY visual detail, object, color, and specific action mentioned in the user's input. Do not skip "small" details like smells or background items.
2. **EXPANSION:** After preserving the original details, you MUST flesh them out with cinematic lighting, texture, and micro-movements.`},ANTI_COMPRESSION:{id:"sg_anti_compression",text:`**CRITICAL: ZERO OMISSION POLICY.** 
You are strictly FORBIDDEN from summarizing, compressing, or omitting details. 
- If the input lists specific items (e.g., 'rabbits, foxes, deer'), you MUST list them all.
- If the input describes a background room (e.g., 'living room with fireplace'), you MUST describe it.
**RULE: The output description MUST be longer and more detailed than the input.**`},STYLE_EXPANSION:{text:`**CRITICAL: VISUAL STYLE GENERATION.** 
You have been provided with a target 'Visual Style'. 
In the JSON output field \`visualStyle\`, you must **NOT** simply repeat this name. 
**YOU MUST EXPAND IT** into a full, detailed technical prompt for an image generator (Midjourney/Stable Diffusion). 
**Define the lens, film stock, rendering engine, and artistic technique based on the input style.**`},EXPOSITION:{id:"sg_exposition",label:"Atmospheric Entry",text:"**MANDATORY OPENING BEAT:** Every scene description MUST start with 2-3 sentences establishing the location, mood, and lighting **BEFORE** the main character acts. Establish the world first."},DELAYED_REVEAL:{id:"sg_delayed_reveal",label:"Progressive Detail",text:"**SEQUENCE:** Describe the environment -> Then the action -> Then the character's reaction. Do not rush to the face."},VISUAL_METAPHOR:{id:"sg_metaphor",label:"Visual Proxies",text:"**VISUAL PROXIES FOR EMOTION:** Do not write abstract emotional states. Describe physical symptoms of that emotion (posture, facial muscle tension, sweat, breath visibility)."},PACING_RHYTHM:{id:"sg_pacing",label:"Action Atomization",text:`**CRITICAL: ACTION ATOMIZATION.** Never summarize an activity. Break it down into physical steps. 
**Expand every verb into a sequence of constituent motions.**`},SUBTEXT:{id:"sg_subtext",label:"Subtext",text:"SUBTEXT: Visual actions should tell the story. Use physical interactions with the environment to convey internal state."},FRAME_ESTIMATION:{text:`**CRITICAL: REALISTIC FRAME COUNT.** Analyze the 'Visual Density' of the scene description to set 'recommendedFrames'. Be conservative. Do not hallucinate length.
- **LOW DENSITY (Dialogue/Simple Action):** 2-5 Frames.
- **MID DENSITY (Interaction/Activity):** 6-10 Frames.
- **HIGH DENSITY (Complex Action/Montage):** 11-16 Frames.`},VISUALS_FIRST:{id:"rule_visuals",label:"Physics Only",text:"Describe Physics, not Vibes. Describe the behavior of light, particles, and textures."},VISUAL_DNA:{id:"sg_visual_dna",label:"Visual DNA",text:"**LIGHTING & TEXTURE:** Every scene description MUST include specific references to: 1. Light sources. 2. Surface textures and materials."},SEAMLESS_FLOW:{id:"rule_flow",label:"Continuity",text:"Ensure objects established in the beginning remain present throughout the scene description unless removed."},ATMOSPHERE:{id:"rule_atmosphere",label:"Atmosphere",text:"PARTICLE EFFECTS & SENSES: Mention airborne elements if applicable: dust, smoke, steam, snow, rain. Preserve described smells and sounds by converting them into visual cues (e.g. 'steam rising from cinnamon buns')."},NO_CAMERA_DIRECTIVES:{text:`**STRICT BAN ON CAMERA TERMS:** You are FORBIDDEN from using words like 'Camera', 'Shot', 'Pan', 'Zoom', 'Close-up', 'Wide', 'Angle'. 
Describe the **Subject** and the **Environment**, never the lens.`},OBJECT_AGENCY:{text:`**CRITICAL PHYSICS RULE:** Inanimate objects DO NOT MOVE ON THEIR OWN. 
ALWAYS attribute action to a character's body part unless it is falling via gravity.`},LIVING_WORLD:{text:"BACKGROUND: If the scene is not a close-up, briefly describe what is behind the character. Don't leave it as 'background'."},SCENELESS_MODE:{text:"**MODE: ASSET LIST.** Generate a sequential list of visual assets/locations based on the input. Focus purely on the visual description."},SIMPLE_ACTIONS:{text:"Keep poses stable and renderable. Avoid blurring motion."},COMMERCIAL_SAFE:{id:"commercial_safe",text:"**NO BRANDS:** Replace specific brands with generic physical descriptions."},STRICT_NAME_PERSISTENCE:{text:"**CRITICAL ENTITY NAMING RULE:** When referring to a character, key item, or object from the provided list, you MUST use ONLY the Index format: `Entity-N`. \n**FORBIDDEN:** Do NOT include the character/object name or parenthesis (e.g., `Nick Wilde (Outfit) - Entity-2` is WRONG).\n**REQUIRED:** Use `Entity-2` only.\nThis applies to `description` and `narratorText`."},SCENE_CHARACTERS_LIST:{text:'**CRITICAL JSON REQUIREMENT:** For every scene object, you MUST include a `characters` field. This array must contain the strings of the indices of ALL entities (characters/items) present in that specific scene (e.g., `["Entity-1", "Entity-3"]`).'}},vt={SMART_CONCEPT:{id:"char_smart_concept",text:"VISUAL LOGIC: Determine if the entity is a sentient character or a static object/item. If it's a CHARACTER: append ', full body character concept on a gray background'. If it's an OBJECT/ITEM: append ', centered object concept, fill the frame, macro focus, on a gray background'. Never mix these two styles."},MAIN_CHAR_LOGIC:{id:"create_main_chars",text:"MAIN CHARACTER GENERATION: You MUST generate detailed profiles for the MAIN protagonists/antagonists based on the story concept. Do not generate generic background characters here. Focus on the core cast."},SECONDARY_CHARS:{id:"create_secondary_chars",text:'You MAY generate new secondary characters if the plot requires it. \n**OUTFIT CHANGES:** If a main character changes outfit, you MUST generate a NEW entity entry for them. \n**NAMING RULE FOR OUTFIT CHANGES:** You MUST append the look name in parentheses. Format: `"Name (Look Name)"` (e.g., `"Batman (Tuxedo)"`). This allows the system to distinguish it from the original.'},KEY_ITEMS_LOGIC:{id:"create_key_items",text:`KEY ITEM GENERATION RULE: You MUST generate a specific object/item as a separate entry in the 'detailedCharacters' array if it is visually significant. 

**MANDATORY FIELDS FOR ITEMS:**
1. **name**: Name of the item.
2. **fullDescription**: Detailed physical description (Materials, colors, state of wear).
3. **prompt**: A precise visual prompt for image generation.`},NO_DUPLICATES:{id:"char_no_dupes",text:'CRITICAL: Do NOT output an entity in `detailedCharacters` if it exactly matches the name of an entity in the Input List. \n**EXCEPTION:** If the character has a new outfit/look, you MUST create a new entry with the format `"Name (Look Name)"`. This distinction is required to create a new card.'},DETAILED_STYLE:{id:"char_detailed_style",label:"Stylized Detail",text:"CHARACTER PROMPT MASTERING: For the 'prompt' field of each entity, generate an extremely detailed visual description. You MUST infuse this description with the 'visualStyle' technical parameters. Describe textures of skin/clothing, eye reflections, and surface shaders that match the chosen aesthetic."}},Se={INPUTS:{id:"inputs_data",text:"Source Data: Script Summary, Entity Profiles, Scene Texts."},ROLE:{id:"ana_role",text:"You are a world-class Film Director and Cinematographer (DoP). Your task is to write precise technical instructions for an AI Image Generator and an AI Video Generator. Each frame must be described repeatedly and in detail, independently of the previous one, while maintaining the context of previous frames. Do not use literary abbreviations or devices."},NO_POV:{text:`**CRITICAL NEGATIVE CONSTRAINT: NO POV/FIRST-PERSON.** You are strictly FORBIDDEN from generating 'Point of View' shots. The camera must ALWAYS be an external observer. 
1. **FORBIDDEN PHRASES:** 'looking down at', 'seen through eyes', 'view from', 'my hands'. 
2. **CORRECTION:** Describe the subject's position relative to the environment and the camera angle (e.g., 'Close-up high angle', 'Side view'). 
3. **CAMERA:** Always position the camera as a Third-Person observer (Over-the-Shoulder, Side, Front, High Angle).`},CINEMATOGRAPHY:{id:"ana_cinema",text:"Use professional terms for framing, lighting and PERSPECTIVE. \n**CRITICAL FORMATTING RULE:** Determine the Shot Type (WS, CU, etc.) and put it **ONLY** in the `shotType` JSON field. \n**FORBIDDEN:** Do NOT write 'Wide Shot', 'Close-up', or 'WS' inside the `imagePrompt` text. The `imagePrompt` must contain ONLY the visual description of the scene content."},CINEMATOGRAPHY_WIDE:{id:"ana_cinema_wide",text:`Use professional terms for framing and spatial geometry. 
1. **FRAMING:** Wide Shot, Long Shot, Establishing Shot. (NO Close-ups). 
2. **ANGLES:** Aerial, Bird's Eye, Worm's Eye, Low Angle, Side Tracking. 
3. **PERSPECTIVE:** Full Body Side View, Full Body Rear View, Distant Frontal.`},STATIC_FRAME_LOGIC:{id:"static_frame_logic",label:"Strict Static",text:`**CRITICAL: STATIC FRAME RULE.** You are writing instructions for an AI Image Generator, NOT a novel for humans. Describe a single MICRO-SECOND frozen in time. 
1. **BAN PROGRESSIVE VERBS:** Forbidden words: 'walking', 'swaying', 'crashing', 'moving', 'begins to'. 
2. **USE STATE DESCRIPTORS:** Describe the suspended physical state of elements (e.g., 'frozen', 'suspended', 'leaning', 'angled'). 
3. **ADJECTIVE OVER VERB:** Focus on color, texture, and geometry.`},ANATOMICAL_POSING:{id:"anatomical_posing",label:"Anatomical Posing",text:`**CRITICAL: ANATOMICAL RIGGING.** Do not use abstract literary actions. You MUST describe the GEOMETRY of the body.
1. **HIERARCHY:** Describe General Posture -> Specific Limb Placement -> Facial Muscle State.
2. **PRECISION:** Specify the angle and direction of limbs relative to the torso.`},ANATOMICAL_STRICTNESS:{id:"anatomical_strictness",label:"Anatomy Logic",text:`**CRITICAL: LIMB BUDGET & LOGIC.** You act as a 3D Rigger. An entity has only 2 hands (unless specified otherwise).
1. **CALCULATE:** If a hand is holding an object, it CANNOT be doing something else. 
2. **SEPARATE:** Forbidden to use plural 'Arms' or 'Hands' if they do different things. 
3. **SYNTAX:** Explicitly describe: 'Left Hand [State/Action], Right Hand [State/Action]'. 
4. **ELIMINATE HALLUCINATIONS:** Ensure the pose is physically possible.`},PROP_CONSISTENCY:{id:"prop_consistency",label:"Object Specificity",text:`**CRITICAL: OBJECT SPECIFICITY & LOCK.** When an entity interacts with an item, you MUST assign it concrete Visual Attributes immediately: **Color, Material, Texture**. 
1. **BAN GENERIC NOUNS:** Never write just the object name. 
2. **REQUIREMENT:** Define the material properties (e.g., 'cracked black plastic', 'glossy white fiberglass'). 
3. **LOCK:** Once defined, this specific description (Color/Material) MUST be repeated in EVERY subsequent frame where the object appears.`},SUBJECT_HIERARCHY:{id:"subject_hierarchy",label:"Context Anchoring",text:`**CRITICAL: INVISIBLE CONTEXT & INTERACTION.** Even for Close-Ups or details, you MUST explicitly state the entity's FULL BODY ACTION, even if it is out of frame.
**FORMAT:** \`[Subject] + [FULL BODY POSTURE] + [Specific Detail]\`.
**EXAMPLE:** Instead of 'Close-up of boots sinking in snow', write: 'Entity-2 is leaning forward, dragging a heavy weight, muscles tensed. Close-up of boots sinking deep into the snow'.
*Never describe a part without the action of the whole.*`},MOTION_DYNAMICS:{id:"motion_dynamics",label:"Motion Dynamics",text:`**DYNAMICS SEPARATION:** 
- The 'imagePrompt' MUST be 100% static (Frozen). 
- The 'videoPrompt' (Dynamics) field is the ONLY place for movement. Describe the flow of time here.`},HIERARCHY:{id:"rule_hierarchy",text:`**MASTER FRAMING ALGORITHM (General-to-Specific):** For EVERY single frame, you must construct the description in this strict order:
1. **GLOBAL CONTEXT:** Location, Weather, Lighting.
2. **FULL POSTURE & INTERACTION:** Describe the entity's full body state AND what they are interacting with (e.g., 'dragging Entity-3'), regardless of shot size.
3. **DETAILED PROP:** Describe the object involved in the interaction (Material/Texture).
4. **FOCUS DETAIL:** The specific detail visible in the shot (e.g., 'rubber soles crushing snow').

*Ensure the causal link between the action (dragging) and the detail (boots sinking) is explicit.*`},STATE_PERSISTENCE:{id:"rule_persistence",text:"SCENE-WIDE CHRONOLOGICAL PERSISTENCE: Maintain a persistent global state for the entire scene. Every frame is part of a single physical space. Track the exact position, pose, and status of every entity and object, even when they are off-camera. If an object is moved, it stays moved. Ensure total continuity across the sequence."},RULE_ISOLATION:{id:"rule_isolation",label:"Zero Context",text:"**CRITICAL RULE: ZERO CONTEXT ASSUMPTION.** The image generator DOES NOT know the previous frame exists. You cannot say 'it continues' or 'she does the same'. You MUST re-describe everything. DO NOT ASSUME CONTEXT. REPEAT IT."},SENSORY_SATURATION:{id:"sensory_saturation",label:"Anti-Brevity",text:"**CRITICAL RULE: ANTI-BREVITY & SENSORY DETAIL**. You are forbidden from being concise. Expand every description. Describe textures, lighting interaction, and physical weight. Minimum 15 words per action description."},MANDATORY_BG:{id:"rule_mandatory_bg",text:`**CRITICAL: DETAILED SET DESIGN & CONTEXT.** The scene context is NOT just a background; it is a physical set. 
1. **LOCATION & GEOMETRY:** Define if Indoors/Outdoors. Define room shape, ceiling height, and boundaries.
2. **FURNITURE & PROPS:** You MUST describe the SIZE, COLOR, MATERIAL, and POSITION of every major object (e.g., NOT 'a sofa', BUT 'a massive L-shaped crimson velvet sofa in the corner'). Describe specific floor textures (e.g., 'worn beige wool carpet').
3. **LIGHTING & PALETTE:** Define the exact light source (window, lamp, neon), temperature (warm/cold), intensity (dim/bright), and the overall color palette of the scene.

**RULE:** This detailed environment MUST be established in the \`sceneContext\` and referenced in EVERY frame, even Close-Ups.`},MANDATORY_BG_WIDE:{text:"**CRITICAL RULE: MANDATORY GLOBAL BACKGROUND.** The 'environmentPrompt' field can NEVER be empty. Since you are generating WIDE SHOTS only, you must provide a comprehensive description of the geography, horizon, and weather, and spatial layout in every frame. Ensure the environment feels vast and grounded."},LIVING_WORLD:{id:"rule_living_world",text:"If public place, describe background extras/silhouettes consistent with the world context."},BATCH_PROCESSING:{id:"batch_processing",text:"Analyze all provided scenes as a continuous sequence to maintain narrative and visual consistency."},USE_ALIASES:{id:"use_aliases",text:"**CRITICAL: ENGLISH INDEXING.** When referring to characters in any field (imagePrompt, environmentPrompt, etc.), ALWAYS use the English format `Entity-N` (e.g. `Entity-1`). \n**NEVER translate 'Entity'** (e.g. NO '-1', NO 'Entidad-1'). \nAll other descriptive text must be in the Target Language."},CHARACTER_ARRAY_INTEGRITY:{id:"character_array_integrity",text:'**CRITICAL JSON RULE: CHARACTER ARRAY INTEGRITY.** The `characters` array in the JSON output MUST list the Index string of **EVERY** entity mentioned in the `imagePrompt`, `videoPrompt`, or `environmentPrompt` for that frame. \n**VIOLATION:** Describing interaction between Entity-1 and Entity-2 but only listing `["Entity-1"]`. \n**CORRECTION:** List `["Entity-1", "Entity-2"]` if both are visually present or interacting.'},EXTENDED_VISUALS:{id:"extended_visuals",text:`**EXTENDED VISUAL EXPANSION (ANTI-COMPRESSION):** The AI has a tendency to summarize. YOU MUST RESIST THIS. Decompose every single script sentence into 3-5 visual frames. 
- **EXPLODE TIME:** Break actions into constituent parts. 
- **MINIMUM FLOOR:** The 'recommendedFrames' from input is your ABSOLUTE MINIMUM. You must aim to EXCEED it. Use shot diversity: Wide, Medium, Close-up, and Detail/Macro.`},EXTENDED_VISUALS_WIDE:{id:"extended_visuals_wide",text:"**EXTENDED VISUAL EXPANSION (WIDE):** Decompose scenes into a rich sequence of shots strictly maintaining the WIDE-ONLY constraint. The 'recommendedFrames' input is your MINIMUM floor. EXCEED it by adding Establishing Shots, Environmental Transitions, and Medium interactions. Do NOT use Close-ups or Macro shots. Focus on spatial relationships and atmosphere."},ACTION_PHASE_BREAKDOWN:{id:"action_phase_breakdown",text:`**CRITICAL: ATOMIC DECOMPOSITION & LOOP PREVENTION.** 
1. Split every significant movement into distinct phases: **Preparation** (wind-up), **Initiation** (start), **Apex** (peak), **Reaction** (follow-through). 
2. **NO LOOPS:** You are FORBIDDEN from repeating the exact same prompt to fill a quota. Focus on DIFFERENT aspects for subsequent frames.`},STORYBOARD_RULES:{id:"storyboard_rules",text:`**CRITICAL RULE: DYNAMIC CAMERA ANGLES & SIZES.** Never repeat the same composition twice in a row. You MUST combine Shot Size with Camera Angle/Position.
1. **VARY ANGLES:** Use Front View, Side Profile, Rear View, Over-the-Shoulder, Low Angle, High Angle, Overhead/Bird's Eye.
2. **VARY DEPTH:** Wide, Medium, Close-up.`},STORYBOARD_RULES_WIDE:{id:"storyboard_rules_wide",text:`**RULE: WIDE SHOT DIVERSITY.** You are strictly limited to WIDE angles, so you MUST vary the CAMERA POSITION to keep it interesting. **NEVER** use a static eye-level front shot twice in a row.
- **MANDATORY ANGLES:** Alternate between: Frontal Wide, Full Body Side View, Full Body Rear View, Low Angle Wide, High Angle Wide, Aerial/Drone.
Ensure every frame captures the full context of the environment.`},TECHNICAL_DIRECTIVES:{id:"tech_directives",text:"STRICT TECHNICAL TERMINOLOGY. For 'shotType', use ONLY abbreviations: WS, MS, CU, ECU, LS. Do NOT write full names."},TECHNICAL_DIRECTIVES_WIDE:{id:"tech_directives_wide",text:"STRICT TECHNICAL TERMINOLOGY. For 'shotType', use ONLY abbreviations: WS, MS, LS. Do NOT use CU or ECU."},ANTHRO_LOGIC:{id:"ana_anthro_logic",text:"**ANTHROPOMORPHIC SPECIES RULE:** Treat all entities as Anthropomorphic Animals unless specified otherwise. In the 'description' field, you MUST explicitly append the species to the entity index/name. Describe animal-specific traits: tail position, ear movements, fur, and muzzle expressions. **CRITICAL:** This rule extends to the background. Any extras or crowds must also be described as specific animal species. Do NOT include humans in the background."},SUBSCRIBE_LOGIC:{id:"ana_subscribe_logic",text:`**SUBSCRIBE CTA VISUALIZATION:** If a scene involves a 'Subscribe' or 'Like' call-to-action (breaking the fourth wall), you MUST visualize it diegetically. 
1. Entities should hold physical signs or tablets displaying the text. 
2. Or interact with giant 3D floating letters. 
3. Ensure the text is described as large, legible, and integrated into the environment.`},SHOT_FILTER_WIDE:{id:"shot_filter_wide",text:`**ULTRA-STRICT CINEMATOGRAPHY FILTER:** For ALL generated frames, you are ABSOLUTELY FORBIDDEN from using Close-Up (CU), Extreme Close-Up (ECU), or Detail shots. 

**TRANSLATION PROTOCOL:** If the script describes a detail (e.g., 'a tear rolling down a cheek'), you MUST TRANSLATE it into a Full Body pose within a Wide Shot (e.g., 'Wide Shot: Character slumps shoulders, head low, body language conveys grief').

**RULE:** Use ONLY Wide Shots (WS), Long Shots (LS), or Medium Shots (MS). Reject the impulse to zoom in.`}},Ko={text:"CRITICAL SAFETY CONSTRAINT: Strictly avoid any words that trigger AI safety filters. DO NOT use terms like 'teenager', 'intimate', 'erotic', 'sensual', 'sexy', or 'revealing'. Instead, use 'young adult', 'young person', 'artistic composition', 'emotional atmosphere', or 'professional cinematography'. Focus on narrative importance and abstract beauty. If describing clothing, use 'modest', 'professional', or 'stylized' descriptors. Ensure the content remains within PG-13 artistic boundaries."},Un=e=>({ru:"Russian",en:"English",es:"Spanish",fr:"French",de:"German",it:"Italian",pt:"Portuguese",zh:"Chinese",ja:"Japanese",ko:"Korean",uz:"Uzbek",tr:"Turkish",sys:"English"})[e]||"English",Gk=async(e,t,n,r,a,i,s,l,c,d,h)=>{const g=Kt(),m=Un(t),w=[];if(w.push("You are an expert Character Designer and Prop Master for film production. Your goal is to analyze the story concept and existing cast to generate necessary additional entities (Main Characters, Secondary Characters, and Key Items)."),w.push(`${We.INPUTS_DATA.text} "${e}"`),r&&r.length>0){const S=r.map(_=>`- **Name:** ${_.name}
  **Index:** ${_.index}
  **Description:** ${_.fullDescription}`).join(`

`);w.push(`EXISTING CAST (Do NOT duplicate these unless updating look): 
${S}`)}else w.push("No existing cast provided.");w.push(`**OUTPUT LANGUAGE:** Character names can remain in their original language/English, but descriptions must be in ${m}.`),a.generateMainChars&&w.push(vt.MAIN_CHAR_LOGIC.text),c?w.push(vt.SECONDARY_CHARS.text):w.push("Do NOT generate secondary characters unless absolutely necessary for the main plot."),d?w.push(vt.KEY_ITEMS_LOGIC.text):w.push("Do NOT generate key items."),w.push(vt.NO_DUPLICATES.text),w.push(vt.SMART_CONCEPT.text),s==="custom"&&l?(w.push(`TARGET VISUAL STYLE: ${l}`),w.push(vt.DETAILED_STYLE.text)):s&&s!=="none"&&(w.push(`TARGET VISUAL STYLE: ${s}`),w.push(vt.DETAILED_STYLE.text)),w.push("Return JSON object with key: 'detailedCharacters' (array of objects with keys: 'name', 'fullDescription', 'prompt', 'index' (optional - will be assigned automatically if missing)).");const y=w.join(`

`),b=await Jt(()=>g.models.generateContent({model:i,contents:y,config:{responseMimeType:"application/json",thinkingConfig:h?{thinkingBudget:4e3}:void 0}}));return qi(b.text||"{}")},Uk=async(e,t,n,r,a,i,s,l,c,d,h,g,m,w,y,b)=>{const S=Kt(),_=Un(t),v=[];if(v.push(We.CORE.text),v.push(`**OUTPUT LANGUAGE:** You MUST write the 'summary', scene 'title', 'description', and 'narratorText' strictly in ${_}.`),v.push(`${We.INPUTS_DATA.text} "${e}"`),v.push(We.IMPROVE_CONCEPT.text),v.push(We.ANTI_COMPRESSION.text),g?v.push(We.SCENELESS_MODE.text):(v.push(We.ANALYSIS.text),b&&v.push(We.EXPOSITION.text),v.push(We.DELAYED_REVEAL.text),v.push(We.VISUALS_FIRST.text),v.push(We.SEAMLESS_FLOW.text),v.push(We.ATMOSPHERE.text),v.push(We.VISUAL_METAPHOR.text),v.push(We.PACING_RHYTHM.text),v.push(We.SUBTEXT.text),v.push(We.NO_CAMERA_DIRECTIVES.text),v.push(We.OBJECT_AGENCY.text)),v.push(We.FRAME_ESTIMATION.text),s.safeGeneration&&v.push(Ko.text),w&&v.push(We.COMMERCIAL_SAFE.text),m&&v.push(We.SIMPLE_ACTIONS.text),v.push(We.STRICT_NAME_PERSISTENCE.text),v.push(We.SCENE_CHARACTERS_LIST.text),i&&i.length>0){const A=i.map(I=>`- **Name:** ${I.name}
  **Index:** ${I.index}
  **Description:** ${I.fullDescription}`).join(`

`);v.push(`**CAST LIST (LOCKED):**
${A}`),v.push('**CRITICAL RULE: NO NEW CHARACTERS.** You must write the script using ONLY the entities listed above. If the story requires a generic person, describe them as "a waiter" or "a guard" without capitalization or index. Do not add them to the character list.')}else s.noCharacters;c==="custom"&&d?(v.push(`TARGET VISUAL STYLE NAME: ${d}`),v.push(We.STYLE_EXPANSION.text)):c&&c!=="none"&&(v.push(`TARGET VISUAL STYLE NAME: ${c}`),v.push(We.STYLE_EXPANSION.text)),v.push(We.VISUAL_DNA.text),s.includeSubscribeScene&&!g&&v.push("Include a scene breaking the fourth wall asking to subscribe/like."),r&&v.push(`Include Narrator voiceover. Style: ${a}.`),s.numberOfScenes&&v.push(`Generate exactly ${s.numberOfScenes} scenes.`),n==="anthro"&&v.push("Characters must be Anthropomorphic animals."),g&&v.push(We.LIVING_WORLD.text),v.push(`REMINDER: Output Language MUST be ${_}.`),v.push('REMINDER: Use entity format: "Entity-Index" (e.g. "Entity-1").'),v.push("Return JSON with keys: 'summary', 'visualStyle', 'scenes' (array of objects with 'title', 'description', 'recommendedFrames', 'narratorText', 'characters' (array of strings)). Note: 'detailedCharacters' should be omitted or empty in this response as we are using the locked list.");const f=v.join(`

`),T=await Jt(()=>S.models.generateContent({model:l,contents:f,config:{responseMimeType:"application/json",thinkingConfig:h?{thinkingBudget:16e3}:void 0}}));return qi(T.text||"{}")},cg=async(e,t,n,r,a,i)=>{const s=Kt(),l=Un(r),c=[];c.push(Se.ROLE.text),c.push(Se.INPUTS.text),c.push(Se.NO_POV.text);let d="";a.minFrames?d=`
**CRITICAL FRAME COUNT ENFORCEMENT:**
For EVERY scene, you MUST generate a MINIMUM of ${a.minFrames} frames. This is a HARD CONSTRAINT. You are FORBIDDEN from generating fewer. If the action seems short, you MUST use "slow motion" descriptions and break actions into micro-details (e.g., 'Hand reaching', 'Fingers touching', 'Grip tightening') to satisfy the frame count. DO NOT MERGE ACTIONS.`:a.framesPerScene?d=`
**FRAME COUNT GOAL:** Target approximately ${a.framesPerScene} frames per scene. Decompose actions to fill this quota.`:d=`
**FRAME COUNT:** Respect the 'recommendedFrames' provided in the scene input. Try to match it exactly by decomposing actions.`,c.push(d),a.professionalStoryboard&&(c.push(Se.STORYBOARD_RULES.text),c.push(Se.TECHNICAL_DIRECTIVES.text)),c.push(Se.MANDATORY_BG.text),c.push(Se.BATCH_PROCESSING.text),a.extendedAnalysis&&c.push(Se.EXTENDED_VISUALS.text),c.push(Se.ACTION_PHASE_BREAKDOWN.text),c.push(Se.USE_ALIASES.text),c.push(Se.CHARACTER_ARRAY_INTEGRITY.text),c.push(`**TARGET LANGUAGE:** The entire analysis (sceneContext, imagePrompt, environmentPrompt, videoPrompt) MUST be written in **${l}**. 
**EXCEPTION:** The Character Tags must remain in English: 'Entity-1', 'Entity-2'. Do not translate the word 'Entity' to ${l}.`);const h=e.map(y=>{const b=y.characters?`Participating Entities: [${y.characters.join(", ")}]`:"";return`SCENE ${y.sceneNumber} (Rec Frames: ${y.recommendedFrames}): ${y.title}
${b}
${y.description}
${y.narratorText||""}`}).join(`

`),g=t.map(y=>`${y.name} (Index: ${y.index||y.alias}): ${y.fullDescription}`).join(`
`),m=`
        ${c.join(`

`)}
        
        SUMMARY: ${n}
        
        ENTITIES / CHARACTERS:
        ${g}
        
        SCENES TO ANALYZE:
        ${h}
        
        Return JSON array of scene objects.
        Each scene object MUST contain:
        1. "sceneNumber": (integer)
        2. "sceneContext": (string in ${l}) **VISUAL MANIFEST.** You MUST describe: Location type (In/Out), Furniture (Specific Size/Color/Material/Position), Flooring/Walls, Lighting (Temp/Source/Intensity), and overall Color Palette. This context will be applied to every frame.
        3. "frames": (array of frame objects)
        
        Each frame object has: 'frameNumber', 'imagePrompt' (in ${l}), 'environmentPrompt' (in ${l}), 'videoPrompt' (in ${l}), 'characters' (array of indices e.g. "Entity-1"), 'shotType', 'duration' (integer, seconds, e.g. 2).
    `,w=await Jt(()=>s.models.generateContent({model:i,contents:m,config:{responseMimeType:"application/json"}}));return qi(w.text||"[]")},Hk=async(e,t,n,r,a,i="",s={},l=[],c=[],d={charDescMode:"general"})=>{const h=Kt(),g=Un(r),m=[],w=c.includes(te.VISUAL_SATURATION.id);d.safeGeneration&&m.push(Ko.text),m.push(te.ROLE.text),m.push(te.NO_POV.text),m.push(te.STATIC_STATE.text),m.push(te.ATMOSPHERIC_FIX.text),m.push(te.STATELESS.text),m.push(te.SUBJECT_FOCUS.text),m.push(te.STRICT_CHAR_INDEX.text),m.push(te.ALWAYS_ENV.text),c.includes(te.ANTHRO_REINFORCEMENT.id)&&m.push(te.ANTHRO_REINFORCEMENT.text),c.includes(te.SUBSCRIBE_REINFORCEMENT.id)&&m.push(te.SUBSCRIBE_REINFORCEMENT.text),c.includes(te.IMG_VID_CONSISTENCY.id)&&m.push(te.IMG_VID_CONSISTENCY.text),c.includes(te.PROP_ENHANCEMENT.id)&&m.push(te.PROP_ENHANCEMENT.text),d.charDescMode==="general"?(m.push(te.GENERAL_CHAR_DESC.text),m.push("**CHARACTER VISUAL INTEGRATION:** Summarize the visual prompt from the character's profile. Merge details naturally.")):d.charDescMode==="full"&&(m.push(te.FULL_CHAR_DESC.text),m.push("**CHARACTER VISUAL INTEGRATION:** Use FULL visual profiles.")),c.includes(te.LAYERED_CONSTRUCTION.id)&&(d.charDescMode==="none"?m.push(Yu):w?m.push(te.LAYERED_CONSTRUCTION.text):m.push(Wu)),c.includes(te.VISUAL_SATURATION.id)&&m.push(te.VISUAL_SATURATION.text),c.includes(te.NO_NAMES.id)&&m.push(te.NO_NAMES.text),c.includes(te.BREAK_PARAGRAPHS.id)&&m.push(te.BREAK_PARAGRAPHS.text),m.push(`**OUTPUT LANGUAGE:** The final image and video prompts MUST be written in **${g}**. 
**EXCEPTION:** The Character Tags inside square brackets must remain in English: '[Entity-1]', '[Entity-2]'. Do not translate the word 'Entity'.`);const y=c.includes(te.GENERATE_VIDEO_PROMPT.id);y?(m.push(te.GENERATE_VIDEO_PROMPT.text),m.push('Return JSON: { "imagePrompt": "...", "videoPrompt": "..." }')):m.push("Return ONLY the final image prompt string.");const b=l.length>0?l.map(f=>s[f]?`[${f}]: ${s[f]}`:null).filter(Boolean):n,S=b.length>0?`Use ONLY these character profiles relevant to this frame:
${b.map(f=>`- ${f}`).join(`
`)}`:"No specific characters in this frame.",_=w?`**VISUAL STYLE:** ${a||"Cinematic realism"}`:"",v=`
        ${m.join(`

`)}

        **INPUTS:**
        - **MASTER SCENE SET DESIGN (MANDATORY CONTEXT):** "${i.replace(/`/g,"")}"
        ${_}
        - **Entities / Characters:** ${S.replace(/`/g,"")}
        - **Frame Action & Subject Detail:** ${e.replace(/`/g,"")}
        - **Frame World Context (MANDATORY BACKGROUND):** ${t.replace(/`/g,"")}
    `;try{const T=((await Jt(()=>h.models.generateContent({model:"gemini-2.5-flash",contents:v,config:{...y?{responseMimeType:"application/json"}:{},thinkingConfig:d.thinkingEnabled?{thinkingBudget:16e3}:void 0}}))).text??"").trim();if(y)try{return qi(T)}catch{return{imagePrompt:T,videoPrompt:""}}return T}catch(f){throw console.error("Error modifying script prompt:",f),f}},Bk=async(e,t,n,r,a,i,s=[],l={charDescMode:"general"})=>{const c=Kt(),d=Un(r),h=[],g=s.includes(te.VISUAL_SATURATION.id);l.safeGeneration&&h.push(Ko.text),h.push(te.ROLE.text),h.push(te.NO_POV.text),h.push(te.STATIC_STATE.text),h.push(te.ATMOSPHERIC_FIX.text),h.push(te.STATELESS.text),h.push(te.SUBJECT_FOCUS.text),h.push(te.STRICT_CHAR_INDEX.text),h.push(te.ALWAYS_ENV.text),s.includes(te.ANTHRO_REINFORCEMENT.id)&&h.push(te.ANTHRO_REINFORCEMENT.text),s.includes(te.SUBSCRIBE_REINFORCEMENT.id)&&h.push(te.SUBSCRIBE_REINFORCEMENT.text),s.includes(te.IMG_VID_CONSISTENCY.id)&&h.push(te.IMG_VID_CONSISTENCY.text),s.includes(te.PROP_ENHANCEMENT.id)&&h.push(te.PROP_ENHANCEMENT.text),l.charDescMode==="general"?(h.push(te.GENERAL_CHAR_DESC.text),h.push("**CHARACTER VISUAL INTEGRATION:** Summarize the visual prompt from the character's profile. Merge details naturally.")):l.charDescMode==="full"&&(h.push(te.FULL_CHAR_DESC.text),h.push("**CHARACTER VISUAL INTEGRATION:** Use FULL visual profiles.")),s.includes(te.LAYERED_CONSTRUCTION.id)&&(l.charDescMode==="none"?h.push(Yu):g?h.push(te.LAYERED_CONSTRUCTION.text):h.push(Wu)),s.includes(te.VISUAL_SATURATION.id)&&h.push(te.VISUAL_SATURATION.text),s.includes(te.NO_NAMES.id)&&h.push(te.NO_NAMES.text),s.includes(te.BREAK_PARAGRAPHS.id)&&h.push(te.BREAK_PARAGRAPHS.text),h.push(`**OUTPUT LANGUAGE:** The final image and video prompts MUST be written in **${d}**. 
**EXCEPTION:** The Character Tags inside square brackets must remain in English: '[Entity-1]', '[Entity-2]'. Do not translate the word 'Entity'.`),s.includes(te.GENERATE_VIDEO_PROMPT.id)?(h.push(te.GENERATE_VIDEO_PROMPT.text),h.push('Return JSON array: [{ "imagePrompt": "...", "videoPrompt": "..." }]')):h.push("Return JSON array of strings (image prompts only)."),h.push('**STRICT JSON SYNTAX:** Ensure all keys (e.g. "imagePrompt") are double-quoted. Do NOT use trailing commas. Escape any quotes inside strings.');const w=new Set;t.forEach(v=>{v.characters&&Array.isArray(v.characters)&&v.characters.forEach(f=>w.add(f))});const y=Array.from(w).map(v=>n[v]?`[${v}]: ${n[v]}`:null).filter(Boolean).join(`

`),b=t.map((v,f)=>{const T=(v.characters||[]).join(", ");return`FRAME_${f}:
        // Shot Type removed to prevent AI from shortcutting descriptions
        - Subject Detail & Action: ${(v.imagePrompt||"").replace(/`/g,"")}
        - World Context (MANDATORY): ${(v.environmentPrompt||"").replace(/`/g,"")}
        - Active Characters: ${T||"None"}
        `}).join(`

`),S=g?`**STYLE DEFINITION:** ${a||"Cinematic realism"}`:"",_=`
        ${h.join(`

`)}

        **MASTER SCENE SET DESIGN (MANDATORY CONTEXT):** "${e.replace(/`/g,"")}"
        ${S}
        
        **SCENE CAST VISUAL PROFILES (REFERENCE):**
        ${y||"No specific characters in this scene."}

        **FRAMES TO PROCESS:**
        ${b}
    `;try{const v=await Jt(()=>c.models.generateContent({model:i,contents:_,config:{responseMimeType:"application/json",thinkingConfig:l.thinkingEnabled?{thinkingBudget:16e3}:void 0}}));return qi(v.text||"[]")}catch(v){throw console.error("Error batch modifying scene:",v),v}},dg=async(e,t)=>{const n=Kt(),r=`Modify text:
Original: ${e}
Instructions: ${t}`;return(await Jt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:r}))).text||""},Vk=async(e,t)=>{const n=Kt(),a=`You are a professional Script Doctor and Visual Director.
    Significantly ENRICH, EXPAND, and DIVERSIFY the given story concept in ${Un(t)}.
    
    CRITICAL OUTPUT RULES:
    1. **Visual Focus:** Use vivid, descriptive language suitable for AI image generation (lighting, colors, textures, atmosphere).
    2. **Detail:** Add specific details about the setting, characters, and mood.
    3. **Expansion:** Flesh out the premise into a robust narrative foundation.
    4. **Output:** Return ONLY the improved concept text. DO NOT include prefixes like "Title:".

    Raw Concept: "${e}"`;return((await Jt(()=>n.models.generateContent({model:"gemini-3-flash-preview",contents:a}))).text||"").trim()},$k=async(e,t,n,r,a,i)=>{const s=Kt(),l=n==="ru"?"  ,  ":"on a gray background, character concept",c=Un(n),d=`You are a creative character designer. Generate ${t} distinct characters based on the user's prompt. Language: ${c}. Type: ${r}. Style: ${i||a}. 
    
    IMPORTANT: For the "fullDescription" field, strictly use the following Markdown headers to separate sections, regardless of the target language (translate header titles if appropriate for ${c} but keep structure):
    #### Appearance
    #### Personality
    #### Clothing
    
    Ensure all three sections are present and detailed.

    For the "prompt" field, generate a detailed visual description for image generation and APPEND: ", ${l}".

    Return JSON array.`,h=await Jt(()=>s.models.generateContent({model:"gemini-3-pro-preview",contents:e,config:{systemInstruction:d,responseMimeType:"application/json",responseSchema:{type:pt.OBJECT,properties:{characters:{type:pt.ARRAY,items:{type:pt.OBJECT,properties:{name:{type:pt.STRING},fullDescription:{type:pt.STRING},prompt:{type:pt.STRING,description:"Visual generation prompt for this character"}},required:["name","fullDescription","prompt"]}}}}}}));return JSON.parse(yo(h.text||"{}")).characters||[]},Wk=async e=>{const t=Kt(),n=`Analyze the character description and separate it into: Character (physical appearance) and Clothing.
    Description: "${e}"
    Return JSON.`,r=await Jt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(r.text||"{}"))},Yk=async(e,t="1:1")=>{var a,i,s;const n=Kt(),r=await Jt(()=>n.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:e}]},config:{imageConfig:{aspectRatio:t}}}));if((s=(i=(a=r.candidates)==null?void 0:a[0])==null?void 0:i.content)!=null&&s.parts){for(const l of r.candidates[0].content.parts)if(l.inlineData&&l.inlineData.data)return l.inlineData.data}throw new Error("No image generated")},qk=async e=>{const t=Kt();return(await Jt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/png",data:e}},{text:"Extract all text from this image."}]}}))).text||""},Kk=async e=>{const t=Kt(),n=`Analyze this image (a screenshot of a YouTube video row). 
    Extract the Video Title.
    Also generate a short description (1-2 sentences) describing the video content based on the title and thumbnail visual elements.
    If visible, also extract:
    - Views count (as a number)
    - Upload date (as a string)
    
    Return JSON: { "title": string, "description": string, "views"?: number, "uploadDate"?: string }`,r=await Jt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/png",data:e}},{text:n}]},config:{responseMimeType:"application/json",responseSchema:{type:pt.OBJECT,properties:{title:{type:pt.STRING},description:{type:pt.STRING},views:{type:pt.NUMBER,nullable:!0},uploadDate:{type:pt.STRING,nullable:!0}},required:["title","description"]}}}));return JSON.parse(yo(r.text||"{}"))},Jk=async e=>{const t=Kt(),n=`Enhance and combine these prompts into a detailed image generation prompt: ${e.join(`
`)}`;return(await Jt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n}))).text||""},Xk=async(e,t)=>{const n=Kt(),r=`Translate the following text to ${t}:

${e}`;return(await Jt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:r}))).text||""},Zk=async e=>{const t=Kt(),n=`Fix grammar and spelling errors in the following text:

${e}`;return(await Jt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n}))).text||""},Qk=async e=>{const t=Kt(),n=`Analyze the following prompt and split it into these components: Environment, Characters (array of names/descriptions), Action, Style.
    Prompt: "${e}"
    Return JSON.`,r=await Jt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(r.text||"{}"))},Gd=async(e,t,n,r)=>{var c,d,h,g,m,w;const a=Kt();let i;r&&r.speakers&&r.speakers.length===2?i={multiSpeakerVoiceConfig:{speakerVoiceConfigs:[{speaker:r.speakers[0].name,voiceConfig:{prebuiltVoiceConfig:{voiceName:r.speakers[0].voice}}},{speaker:r.speakers[1].name,voiceConfig:{prebuiltVoiceConfig:{voiceName:r.speakers[1].voice}}}]}}:i={voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};const s={responseModalities:[Ui.AUDIO],speechConfig:i};return((w=(m=(g=(h=(d=(c=(await Jt(()=>a.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:{parts:[{text:e}]},config:s}))).candidates)==null?void 0:c[0])==null?void 0:d.content)==null?void 0:h.parts)==null?void 0:g[0])==null?void 0:m.inlineData)==null?void 0:w.data)||""},eA=async(e,t,n,r)=>{const a=Kt(),i=`Generate narrator text for: ${e}. Role: ${t}. Languages: ${JSON.stringify(n)}. Use SSML: ${r}. Return JSON with keys matching language codes (ru, en).`,s=await Jt(()=>a.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(s.text||"{}"))},tA=async(e,t)=>{const n=Kt(),r=await Jt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:t,data:e}},{text:"Transcribe this audio. Return a JSON array of segments. Each segment must have: startTime (format HH:MM:SS,mmm), endTime (format HH:MM:SS,mmm), and text."}]},config:{responseMimeType:"application/json",responseSchema:{type:pt.ARRAY,items:{type:pt.OBJECT,properties:{startTime:{type:pt.STRING},endTime:{type:pt.STRING},text:{type:pt.STRING}},required:["startTime","endTime","text"]}}}}));return yo(r.text||"[]")},Wt={ROLE:{id:"music_role",text:"You are a professional Music Producer, Composer, and Lyricist. Your task is to analyze a concept and translate it into specific musical directions and lyrical content."},INPUT_CONTEXT:{id:"music_input",text:"Source Data: User Concept/Mood/Theme."},CREATIVE_RULE:{id:"music_creative",text:"CREATIVE INTERPRETATION RULE: Do NOT interpret the input literally. If the input is a weak or generic example (e.g., 'sad song', 'about love'), DO NOT just repeat those words. Analyze the underlying mood, atmosphere, and subtext. Generate ORIGINAL lyrics and musical cues that evoke the theme metaphorically and artistically. Avoid clichs. Elevate the concept beyond the literal input keywords."},LYRICS_RULE:{id:"music_lyrics",text:"LYRICS STRUCTURE: If requested, write lyrics adhering to a standard song structure (Verse 1, Chorus, Verse 2, Chorus, Bridge, Outro). Ensure rhymes and rhythm match the requested genre."},VERSE_COUNT_RULE:{id:"music_verse_count",text:"STRICT STRUCTURE CONSTRAINT: You MUST generate exactly {N} UNIQUE Verses in the song structure. Do not summarize or skip verses. Explicitly label them as [Verse 1], [Verse 2] ... up to [Verse {N}]."},MUSIC_PROMPT_RULE:{id:"music_prompt_rule",text:"AI MUSIC PROMPT: Generate a technical description string optimized for AI Music Generators (like Suno or Udio). Include: Genre, Instruments, BPM, Mood, Vocal Style. Format as a comma-separated list of tags. CRITICAL CONSTRAINT: The 'music_prompt' must be under 1000 characters."},FORMAT:{id:"music_format",text:"Return a JSON object where keys are language codes. For each language, provide: 'song_title', 'music_prompt', and optional 'lyrics'."}},nA=async(e,t,n)=>{const r=Kt(),a=Un(e),i=n&&n.trim()!==""?`The ideas should be related to the following theme: "${n}".`:"",s=`
        You are a creative assistant for story writing.
        Generate a list of 10 random and interesting ideas for each of the following three categories, tailored for a "${t}" story format.
        ${i}
        The categories are:
        1. Action (a key verb or event, e.g., "find a hidden map", "escape from a maze")
        2. Place (a setting, e.g., "an abandoned space station", "a magical forest")
        3. Obstacle (a challenge or antagonist, e.g., "a mischievous dragon", "a forgotten curse")

        All ideas must be in ${a}.
        Return the output as a single JSON object with keys "action", "place", and "obstacle", where each key has an array of 10 strings.
    `,l={type:pt.OBJECT,properties:{action:{type:pt.ARRAY,items:{type:pt.STRING}},place:{type:pt.ARRAY,items:{type:pt.STRING}},obstacle:{type:pt.ARRAY,items:{type:pt.STRING}}},required:["action","place","obstacle"]};try{const d=(await Jt(()=>r.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{responseMimeType:"application/json",responseSchema:l}}))).text;if(!d)throw new Error("Received empty response from model.");return JSON.parse(yo(d))}catch(c){throw console.error("Error generating idea categories:",c),c}},oA=async(e,t,n,r)=>{const a=Kt(),s=`
        Combine the following three elements into a short, one-paragraph story idea.
        The story idea should be written in ${Un(r)}.

        - Action: ${e}
        - Place: ${t}
        - Obstacle: ${n}

        Return only the story idea paragraph.
    `;try{return((await Jt(()=>a.models.generateContent({model:"gemini-2.5-flash",contents:s}))).text??"").trim()}catch(l){throw console.error("Error combining story idea:",l),l}},rA=async(e,t,n,r=2,a="gemini-3-flash-preview")=>{const i=Kt(),s=[];s.push(Wt.ROLE.text),s.push(`${Wt.INPUT_CONTEXT.text}: "${e}"`);const l=Object.keys(t).filter(w=>t[w]);s.push(`Target Languages: ${JSON.stringify(l)}`),s.push(Wt.CREATIVE_RULE.text),s.push(Wt.MUSIC_PROMPT_RULE.text),n?(s.push(Wt.LYRICS_RULE.text),r&&r>0&&s.push(Wt.VERSE_COUNT_RULE.text.replace("{N}",r.toString()))):s.push("Do NOT generate lyrics."),s.push("Return a JSON object containing an 'outputs' array. Each item in the array must correspond to one of the target languages and contain: 'language', 'song_title', 'music_prompt', and optional 'lyrics'.");const c=s.join(`

`),d={type:pt.OBJECT,properties:{outputs:{type:pt.ARRAY,items:{type:pt.OBJECT,properties:{language:{type:pt.STRING},song_title:{type:pt.STRING},music_prompt:{type:pt.STRING},lyrics:{type:pt.STRING,nullable:!0}},required:["language","song_title","music_prompt"]}}},required:["outputs"]},h=await Jt(()=>i.models.generateContent({model:a,contents:c,config:{responseMimeType:"application/json",responseSchema:d}})),g=JSON.parse(yo(h.text||"{}")),m={};return g.outputs&&Array.isArray(g.outputs)&&g.outputs.forEach(w=>{w.language&&(m[w.language]=w)}),m},At={ROLE:{id:"yt_role",text:"You are an expert YouTube Growth Strategist, SEO Specialist, and Copywriter. Your goal is to maximize Click-Through Rate (CTR) and Audience Retention."},INPUT_CONTEXT:{id:"yt_input",text:"Source Data: User Concept/Video Topic/Channel Theme."},TITLE_MODE_RULES:{id:"yt_title_mode",text:`Generate catchy, high-CTR metadata. 
1. **Titles:** Must be punchy, under 60 chars where possible, evoking curiosity or benefit. 
2. **Description:** First 2 lines must be the hook. Include keywords naturally. 
3. **Tags:** Mix of broad and specific keywords.`},HASHTAGS:{id:"yt_hashtags",text:"HASHTAG INTEGRATION: You MUST append 3-5 highly relevant hashtags (format: #Hashtag) at the very end of the 'description' field. Choose high-volume tags related to the niche."},THUMBNAIL:{id:"yt_thumbnail",text:`THUMBNAIL GENERATION: Generate a separate field 'thumbnailPrompt'. Describe a high-CTR YouTube thumbnail image. 
- **Focus:** Facial expression, emotional hook, bright colors, text overlay (keep it short), and contrast. 
- **Style:** High saturation, clean background, 4k quality.`},CHANNEL_MODE_RULES:{id:"yt_channel_mode",text:`Generate cohesive channel branding. 
1. **Name:** Memorable, unique, easy to spell. 
2. **Handle:** Short, matching the name. 
3. **Bio:** Clear value proposition (Who is this for? What will they get?).`},FORMAT:{id:"yt_format",text:"Return a JSON object where keys are language codes. For 'Title Mode' provide: title, description (with hashtags included), tags, and optional thumbnailPrompt. For 'Channel Mode' provide: channelName, channelDescription, channelKeywords, channelHandle."}},aA=async(e,t="ru")=>{const n=Kt(),r=Un(t),a=e.contextPrompt?`
**User Context / Specific Question:**
"${e.contextPrompt}"
`:"",i=`
        You are an expert YouTube Growth Strategist and Data Analyst. 
        You have been provided with data for a YouTube channel.
        **Current Date/Time:** ${e.currentDate||"Unknown"}
        ${a}
        
        **Channel Context:**
        - **Current Goal:** ${e.goal||"Not specified"}
        - **Current Subscribers:** ${e.currentSubscribers||"Unknown"}
        - **Monetization Status:** ${e.isMonetized?"Monetized":"Not Monetized"}
        
        **Your Task:**
        Analyze the provided data and the user's goal (and answer their specific question if provided). Provide actionable advice to improve channel performance and reach the goal.
        
        1.  **Goal Analysis:** Is the current goal realistic given the stats? Is it the right next step? 
            - If the goal is "Not specified" or seems inappropriate for the channel's current size, suggest a better, immediate milestone.
            - If you suggest a new goal, provide it in the "suggestedGoal" field.
        2.  **Consistency:** Are videos being uploaded regularly? Consider the current date.
        3.  **Trends:** Are subscribers and views increasing, decreasing, or stagnant? Pay attention to Shorts vs Long form performance if distinct.
        4.  **Content Strategy:** Based on the Channel Description and titles of uploaded videos (if available), suggest improvements.
        5.  **Action Plan:** Provide a bulleted list of specific actions.

        **Input Data:**
        ${JSON.stringify(e.channels,null,2)}

        **Output Format:**
        Return a JSON object.
        - "advice": The main analysis and advice text in Markdown format. Use headings.
        - "suggestedGoal": (Optional) A short string (max 5 words) if you recommend changing the specific goal target (e.g., "Reach 1,000 Subscribers"). Leave empty if the current goal is fine.
        
        IMPORTANT: The "advice" content MUST be written in ${r}.
    `,s={type:pt.OBJECT,properties:{advice:{type:pt.STRING},suggestedGoal:{type:pt.STRING,nullable:!0}},required:["advice"]};try{const l=await Jt(()=>n.models.generateContent({model:"gemini-3-pro-preview",contents:i,config:{responseMimeType:"application/json",responseSchema:s}}));return JSON.parse(yo(l.text||"{}"))}catch(l){throw console.error("Error analyzing YouTube stats:",l),l}},iA=async(e,t,n)=>{const r=Kt(),a=[];a.push(At.ROLE.text),a.push(At.TITLE_MODE_RULES.text),(n==null?void 0:n.includeHashtags)!==!1&&a.push(At.HASHTAGS.text),n!=null&&n.generateThumbnail&&a.push(At.THUMBNAIL.text),a.push(`${At.INPUT_CONTEXT.text}: "${e}"`),a.push(`Target Languages: ${JSON.stringify(t)}`),a.push(At.FORMAT.text);const i=a.join(`

`);pt.STRING,pt.STRING,pt.STRING,n!=null&&n.generateThumbnail&&pt.STRING;const s=await Jt(()=>r.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",responseSchema:{type:pt.OBJECT}}}));return JSON.parse(yo(s.text||"{}"))},sA=async(e,t)=>{const n=Kt(),r=[];r.push(At.ROLE.text),r.push(At.CHANNEL_MODE_RULES.text),r.push(`${At.INPUT_CONTEXT.text}: "${e}"`),r.push(`Target Languages: ${JSON.stringify(t)}`),r.push(At.FORMAT.text);const a=r.join(`

`),i=await Jt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:a,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(i.text||"{}"))},lA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a,executionStopRequested:i})=>{const[s,l]=x.useState(null),[c,d]=x.useState(null),[h,g]=x.useState(null),[m,w]=x.useState(null),[y,b]=x.useState(null),[S,_]=x.useState(null),[v,f]=x.useState(null),[T,A]=x.useState(null),[I,M]=x.useState(null),[N,k]=x.useState(null),[E,P]=x.useState(null),[L,H]=x.useState(null),[$,U]=x.useState(null),[O,D]=x.useState(null),z=x.useCallback(async he=>{i.current=!1;const ye=e.find(Ue=>Ue.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{prompt:q,targetLanguage:Q,characterType:J,model:oe,visualStyle:B,customVisualStyle:fe,createSecondaryChars:ie,createKeyItems:Z,thinkingEnabled:ee,useExistingCharacters:R,detailedCharacters:be}=j,Le=t.find(Ue=>Ue.toNodeId===he&&(Ue.toHandleId==="prompt"||Ue.toHandleId===void 0)),je=Le?r(Le.fromNodeId,Le.fromHandleId):q;if(!je.trim()&&(!be||be.length===0)){a("No prompt or existing characters provided.");return}d(he),a(null);try{const Ue=await Gk(je,Q,J,be,j,oe,B,fe,ie,Z,ee);if(i.current)throw new Error("Generation stopped.");let Fe=Ue.detailedCharacters||[];const ot=be.reduce((Ce,ve)=>{const Ge=(ve.index||"").match(/(\d+)/),ce=Ge?parseInt(Ge[1],10):0;return Math.max(Ce,ce)},0);Fe=Fe.map((Ce,ve)=>({...Ce,id:`gen-ent-${Date.now()}-${ve}`,index:`Entity-${ot+ve+1}`}));const at=[...be||[],...Fe],rt={...j.uiState||{},isCharactersSectionCollapsed:!1};n(Ce=>Ce.map(ve=>ve.id===he?{...ve,value:JSON.stringify({...j,detailedCharacters:at,uiState:rt})}:ve))}catch(Ue){a(Ue.message||"Entity generation failed.")}finally{d(null)}},[e,t,r,n,a,i]),G=x.useCallback(async he=>{i.current=!1;const ye=e.find(ve=>ve.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{prompt:q,targetLanguage:Q,characterType:J,narratorEnabled:oe,narratorMode:B,model:fe,visualStyle:ie,customVisualStyle:Z,thinkingEnabled:ee,scenelessMode:R,simpleActions:be,commercialSafe:Le,smartConceptEnabled:je,atmosphericEntryEnabled:Ue,useExistingCharacters:Fe,detailedCharacters:ot}=j,at=t.find(ve=>ve.toNodeId===he&&(ve.toHandleId==="prompt"||ve.toHandleId===void 0)),rt=at?r(at.fromNodeId,at.fromHandleId):q;if(!rt.trim()&&(!ot||ot.length===0)){a("No prompt or existing characters provided.");return}l(he),a(null);const Ce=Date.now();n(ve=>ve.map(Ge=>Ge.id===he?{...Ge,value:JSON.stringify({...j,generationProgress:{current:0,total:1,totalStartTime:Ce,currentItemStartTime:Ce}})}:Ge));try{const ve=await Uk(rt,Q,J,oe,B,ot,j,fe,ie,Z,ee,R,be,Le,je,Ue);if(i.current)throw new Error("Generation stopped.");const Ge={...ve,detailedCharacters:ot};n(ce=>ce.map(He=>{if(He.id===he){const V=JSON.parse(He.value||"{}");return{...He,value:JSON.stringify({...V,...Ge,generationProgress:{...V.generationProgress,endTime:Date.now(),current:1}})}}return He}))}catch(ve){a(ve.message||"Script generation failed.")}finally{l(null)}},[e,t,r,n,a,i]),F=x.useCallback(async he=>{const ye=e.find(ee=>ee.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{prompt:q,numberOfCharacters:Q,targetLanguage:J,characterType:oe,style:B,customStyle:fe}=j,ie=t.find(ee=>ee.toNodeId===he),Z=ie?r(ie.fromNodeId,ie.fromHandleId):q;if(!Z.trim()){a("No prompt provided.");return}g(he),a(null);try{const ee=await $k(Z,Q,J,oe,B,fe);n(R=>R.map(be=>{if(be.id===he){const Le=JSON.parse(be.value||"{}");return{...be,value:JSON.stringify({...Le,characters:ee})}}return be}))}catch(ee){a(ee.message||"Character generation failed.")}finally{g(null)}},[e,t,r,n,a]),K=x.useCallback(async(he,ye)=>{const j=e.find(oe=>oe.id===he);if(!j)return;let q;try{q=JSON.parse(j.value||"{}")}catch{q={}}let Q="";if(j.type===C.IMAGE_GENERATOR){const oe=t.find(B=>B.toNodeId===he);Q=oe?r(oe.fromNodeId,oe.fromHandleId):q.prompt}else if(j.type===C.CHARACTER_GENERATOR&&ye!==void 0){const oe=q.characters.find(B=>B.id===ye);Q=oe?oe.prompt:""}else if(j.type===C.CHARACTER_CARD&&ye!==void 0){const oe=Array.isArray(q)?q[ye]:q;Q=oe.prompt,oe.additionalPrompt&&oe.additionalPrompt.trim()&&(Q=`${Q}, ${oe.additionalPrompt}`)}if(!Q){a("No prompt found.");return}const J=ye!==void 0?`${he}-${ye}`:he;ye!==void 0?b(J):w(he),a(null);try{let oe="1:1";j.type===C.CHARACTER_CARD&&ye!==void 0&&(oe=(Array.isArray(q)?q[ye]:q).selectedRatio||"1:1");const B=await Yk(Q,oe);n(fe=>fe.map(ie=>{if(ie.id===he){const Z=JSON.parse(ie.value||"{}");if(j.type===C.IMAGE_GENERATOR)return{...ie,value:JSON.stringify({...Z,imageBase64:B})};if(j.type===C.CHARACTER_GENERATOR){const ee=Z.characters.map(R=>R.id===ye?{...R,imageBase64:B}:R);return{...ie,value:JSON.stringify({...Z,characters:ee})}}else if(j.type===C.CHARACTER_CARD){const ee=[...Array.isArray(Z)?Z:[Z]],R=ye;if(ee[R]){const be=ee[R],Le={...be.imageSources,[oe]:B},je={...be.thumbnails,[oe]:B};ee[R]={...be,image:B,imageSources:Le,thumbnails:je}}return{...ie,value:JSON.stringify(ee)}}}return ie}))}catch(oe){a(oe.message||"Image generation failed.")}finally{ye!==void 0?b(null):w(null)}},[e,t,r,n,a]),ae=x.useCallback(async he=>{const ye=e.find(be=>be.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{voice:q,intonation:Q,audioFiles:J,mode:oe,isMultiSpeaker:B,speaker1Name:fe,speaker1Voice:ie,speaker2Name:Z,speaker2Voice:ee}=j;let R=j.inputText;if(!R||Array.isArray(R)&&R.length===0){a("No text to synthesize.");return}_(he),a(null);try{const be=[...J],Le=B?{speakers:[{name:fe,voice:ie},{name:Z,voice:ee}]}:void 0,je=B?"multi":q;if(oe==="scene"&&Array.isArray(R)){for(const Ue of R)if(Ue.text){const Fe=await Gd(Ue.text,je,Q,Le);Fe&&be.push({id:`scene-${Ue.sceneNumber}-${Date.now()}`,title:`Scene ${Ue.sceneNumber}`,text:Ue.text,audioData:Fe,voiceName:B?"Multi":q,intonation:Q})}}else{const Ue=typeof R=="string"?R:"",Fe=await Gd(Ue,je,Q,Le);Fe&&be.push({id:`simple-${Date.now()}`,title:"Generated Audio",text:Ue.substring(0,50)+"...",audioData:Fe,voiceName:B?"Multi":q,intonation:Q})}n(Ue=>Ue.map(Fe=>Fe.id===he?{...Fe,value:JSON.stringify({...j,audioFiles:be})}:Fe))}catch(be){a(be.message||"Speech generation failed.")}finally{_(null)}},[e,n,a]),Y=x.useCallback(async he=>{const ye=e.find(B=>B.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{prompt:q,role:Q,targetLanguages:J,generateSSML:oe}=j;if(!q){a("No prompt provided.");return}f(he),a(null);try{const B=Object.keys(J).filter(ie=>J[ie]),fe=await eA(q,Q,B,oe);n(ie=>ie.map(Z=>{if(Z.id===he){const ee=JSON.parse(Z.value||"{}");return{...Z,value:JSON.stringify({...ee,generatedTexts:fe})}}return Z}))}catch(B){a(B.message||"Narrator text generation failed.")}finally{f(null)}},[e,n,a]),ge=x.useCallback(async he=>{const ye=e.find(J=>J.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{audioBase64:q,mimeType:Q}=j;if(!q){a("No audio loaded.");return}A(he),a(null);try{const J=await tA(q,Q||"audio/mp3");let oe=[];try{oe=JSON.parse(J)}catch{}const B=oe.map(fe=>fe.text).join(" ");n(fe=>fe.map(ie=>ie.id===he?{...ie,value:JSON.stringify({...j,transcription:B,segments:oe})}:ie))}catch(J){a(J.message||"Transcription failed.")}finally{A(null)}},[e,n,a]),W=x.useCallback(async he=>{const ye=e.find(ie=>ie.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{idea:q,targetLanguages:Q,includeHashtags:J,generateThumbnail:oe}=j,B=t.find(ie=>ie.toNodeId===he),fe=B?r(B.fromNodeId,B.fromHandleId):q;if(!fe){a("No idea provided.");return}M(he),a(null);try{const ie=Object.keys(Q).filter(ee=>Q[ee]),Z=await iA(fe,ie,{includeHashtags:J,generateThumbnail:oe});n(ee=>ee.map(R=>R.id===he?{...R,value:JSON.stringify({...j,generatedTitleOutputs:Z})}:R))}catch(ie){a(ie.message||"Title generation failed.")}finally{M(null)}},[e,t,r,n,a]),le=x.useCallback(async he=>{const ye=e.find(B=>B.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{idea:q,targetLanguages:Q}=j,J=t.find(B=>B.toNodeId===he),oe=J?r(J.fromNodeId,J.fromHandleId):q;if(!oe){a("No theme provided.");return}k(he),a(null);try{const B=Object.keys(Q).filter(ie=>Q[ie]),fe=await sA(oe,B);n(ie=>ie.map(Z=>Z.id===he?{...Z,value:JSON.stringify({...j,generatedChannelOutputs:fe})}:Z))}catch(B){a(B.message||"Channel info generation failed.")}finally{k(null)}},[e,t,r,n,a]),X=x.useCallback(async he=>{const ye=e.find(ee=>ee.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{a("Invalid node data.");return}const{idea:q,targetLanguages:Q,generateLyrics:J,verseCount:oe,model:B}=j,fe=t.find(ee=>ee.toNodeId===he),ie=fe?r(fe.fromNodeId,fe.fromHandleId):q;if(!Object.values(Q).some(ee=>ee)){a("Please select at least one language.");return}if(!ie||!ie.trim()){a("Please provide an idea.");return}a(null),P(he);try{const ee=await rA(ie,Q,J,oe||2,B),R={},be={},Le={};for(const Ue in ee)ee[Ue].lyrics&&(R[Ue]=ee[Ue].lyrics),ee[Ue].music_prompt&&(be[Ue]=ee[Ue].music_prompt),ee[Ue].song_title&&(Le[Ue]=ee[Ue].song_title);const je={...j,idea:ie,generatedLyrics:R,generatedMusicPrompts:be,generatedTitles:Le};n(Ue=>Ue.map(Fe=>Fe.id===he?{...Fe,value:JSON.stringify(je)}:Fe))}catch(ee){a(ee.message||"An unknown error occurred.")}finally{P(null)}},[e,t,r,n,a,P]),Te=x.useCallback(async he=>{const ye=e.find(Q=>Q.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{imageBase64:q}=j;if(!q){a("No image loaded.");return}H(he),a(null);try{const Q=await qk(q);n(J=>J.map(oe=>oe.id===he?{...oe,value:JSON.stringify({...j,extractedText:Q})}:oe))}catch(Q){a(Q.message||"Text extraction failed.")}finally{H(null)}},[e,n,a]),pe=x.useCallback(async he=>{const ye=e.find(oe=>oe.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{targetLanguage:q,format:Q,theme:J}=j;U(he),a(null);try{const oe=await nA(q,Q,J);n(B=>B.map(fe=>fe.id===he?{...fe,value:JSON.stringify({...j,categories:oe,stage:"selection",selection:{action:null,place:null,obstacle:null}})}:fe))}catch(oe){a(oe.message||"Category generation failed.")}finally{U(null)}},[e,n,a]),ue=x.useCallback(async he=>{const ye=e.find(J=>J.id===he);if(!ye)return;let j;try{j=JSON.parse(ye.value||"{}")}catch{j={}}const{selection:q,targetLanguage:Q}=j;if(!q.action||!q.place||!q.obstacle){a("Please select all three categories.");return}D(he),a(null);try{const J=await oA(q.action,q.place,q.obstacle,Q);n(oe=>oe.map(B=>B.id===he?{...B,value:JSON.stringify({...j,generatedIdea:J})}:B))}catch(J){a(J.message||"Idea generation failed.")}finally{D(null)}},[e,n,a]),Oe=x.useCallback(()=>{l(null),d(null),g(null),w(null),b(null),_(null),f(null),A(null),M(null),k(null),P(null),H(null),U(null),D(null)},[]);return{handleGenerateScript:G,handleGenerateEntities:z,handleGenerateCharacters:F,handleGenerateImage:K,handleGenerateCharacterImage:(he,ye)=>K(he,ye),handleGenerateSpeech:ae,handleGenerateNarratorText:Y,handleTranscribeAudio:ge,handleGenerateYouTubeTitles:W,handleGenerateYouTubeChannelInfo:le,handleGenerateMusicIdeas:X,handleExtractTextFromImage:Te,handleGenerateIdeaCategories:pe,handleCombineStoryIdea:ue,stop:Oe,states:{isGeneratingScript:s,isGeneratingEntities:c,isGeneratingCharacters:h,isGeneratingImage:m,isGeneratingCharacterImage:y,isGeneratingSpeech:S,isGeneratingNarratorText:v,isTranscribingAudio:T,isGeneratingYouTubeTitles:I,isGeneratingYouTubeChannelInfo:N,isGeneratingMusicIdeas:E,isExtractingText:L,isGeneratingIdeaCategories:$,isCombiningStoryIdea:O}}},_s=e=>{if(!e)return[];const t=/\[Character-(\d+)\]/g,n=new Set;let r;for(;(r=t.exec(e))!==null;)n.add(`Character-${r[1]}`);return Array.from(n)},ug=e=>e.sort((t,n)=>{const r=parseInt(t.replace(/\D/g,"")||"0",10),a=parseInt(n.replace(/\D/g,"")||"0",10);return r-a}),cA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a,executionStopRequested:i})=>{const[s,l]=x.useState(null),[c,d]=x.useState(null),[h,g]=x.useState(null),[m,w]=x.useState(null),[y,b]=x.useState(null),[S,_]=x.useState(null),v=x.useCallback(async k=>{const P=t.filter(L=>L.toNodeId===k).map(L=>r(L.fromNodeId,L.fromHandleId));a(null),l(k);try{const L=await Jk(P);n(H=>H.map($=>$.id===k?{...$,value:L}:$))}catch(L){throw a(L.message||"An unknown error occurred."),L}finally{l(null)}},[t,n,r,a,l]),f=x.useCallback(async k=>{var P;const E=e.find(L=>L.id===k);if(E){d(k),a(null);try{let L;try{L=JSON.parse(E.value||"{}")}catch{L={}}let{inputText:H="",targetLanguage:$="en"}=L;const U=t.find(z=>z.toNodeId===k);if(U&&(H=r(U.fromNodeId,U.fromHandleId)),!H.trim())throw new Error("No text to translate.");const O=((P=jl.find(z=>z.code===$))==null?void 0:P.name)||"English",D=await Xk(H,O);n(z=>z.map(G=>{if(G.id===k){const F={...L,inputText:H,translatedText:D};return{...G,value:JSON.stringify(F)}}return G}))}catch(L){a(L.message||"An unknown error occurred during translation.")}finally{d(null)}}},[t,n,r,e,a,d]),T=x.useCallback(async(k,E,P,L)=>{const H=`${k}/${E}`;g(H),a(null);try{const $=await dg(P,L);n(U=>U.map(O=>{var D,z;if(O.id===k)try{const G=JSON.parse(O.value||"{}");let F=!1;if(E==="summary")G.summary=$,F=!0;else if(E.startsWith("character-")){const K=E.substring(10),ae=(D=G.detailedCharacters)==null?void 0:D.find(Y=>Y.id===K);ae&&(ae.fullDescription=$,F=!0)}else if(E.startsWith("scene-")){const K=E.split("-"),ae=parseInt(K[1],10),Y=K[2],ge=(z=G.scenes)==null?void 0:z[ae];ge&&(Y==="narratorText"?ge.narratorText=$:ge.description=$,F=!0)}return F?{...O,value:JSON.stringify(G)}:O}catch{return O}return O}))}catch($){a($.message||"An unknown error occurred during modification.")}finally{g(null)}},[n,a,g]),A=x.useCallback(async(k,E,P,L)=>{if(!L.trim())return;const H=`${k}/frame-${E}/${P}`;g(H),a(null);try{const $=e.find(F=>F.id===k);if(!$)throw new Error("Node not found");const D=(JSON.parse($.value||"{}").scenes||[]).flatMap(F=>F.frames).find(F=>F.frameNumber===E);if(!D||!D[P])throw new Error("Frame or part not found");const z=D[P],G=await dg(z,L);n(F=>F.map(K=>{if(K.id===k)try{const ae=JSON.parse(K.value||"{}"),Y=ae.scenes.map(ge=>({...ge,frames:ge.frames.map(W=>W.frameNumber===E?{...W,[P]:G}:W)}));return{...K,value:JSON.stringify({...ae,scenes:Y})}}catch{return K}return K}))}catch($){a($.message||"An unknown error occurred during modification.")}finally{g(null)}},[e,n,a,g]),I=x.useCallback(async k=>{const E=e.find(H=>H.id===k);if(!E)return;const P=t.find(H=>H.toNodeId===k);let L=E.value;if(P&&(L=r(P.fromNodeId,P.fromHandleId)),!L.trim()){a("No text to fix.");return}w(k),a(null);try{const H=await Zk(L);n($=>$.map(U=>U.id===k?{...U,value:H}:U))}catch(H){a(H.message||"An unknown error occurred while fixing errors.")}finally{w(null)}},[e,t,r,n,a,w]),M=x.useCallback(async k=>{i.current=!1;const E=e.find(R=>R.id===k);if(!E||y===k)return;const P=t.find(R=>R.toNodeId===k&&(R.toHandleId==="all-script-analyzer-data"||!R.toHandleId));if(!P){a("Please connect a Script Analyzer node to the 'Data from analyzer' input.");return}const L=r(P.fromNodeId,P.fromHandleId);if(!L||L.trim()===""||L.trim()==="{}"){a("Upstream script analysis data is empty.");return}let H,$;try{H=JSON.parse(L),$=JSON.parse(E.value||"{}")}catch{a("Failed to parse node data. Ensure it's valid JSON.");return}const{characters:U=[],scenes:O=[]}=H,{targetLanguage:D="en",startFrameNumber:z=null,endFrameNumber:G=null,startSceneNumber:F=null,endSceneNumber:K=null,styleOverride:ae,model:Y="gemini-2.5-pro",disabledInstructionIds:ge=[],includeGeneralCharDesc:W=!1,includeFullCharDesc:le=!1,safeGeneration:X=!1,thinkingEnabled:Te=!1,charDescMode:pe,sceneContexts:ue={}}=$;let Oe=pe;Oe||(le?Oe="full":W===!1?Oe="none":Oe="general");const ye=Object.keys(te).map(R=>te[R].id).filter(R=>!ge.includes(R)),j=ye.includes(te.PROCESS_WHOLE_SCENE.id),q=ye.includes(te.GENERATE_VIDEO_PROMPT.id),Q=t.find(R=>R.toNodeId===k&&R.toHandleId==="style");let J=ae;Q?J=r(Q.fromNodeId,Q.fromHandleId):J||(J=H.visualStyle||H.generatedStyle||"");const oe={};U.forEach(R=>{const be=R.imagePrompt||R.prompt||R.fullDescription||"";R.index&&(oe[R.index]=`${R.name} [Visual Profile: ${be}]`),R.alias&&(oe[R.alias]=`${R.name} [Visual Profile: ${be}]`),R.name&&(oe[R.name]=`${R.name} [Visual Profile: ${be}]`)});let B=[];const fe=O.map(R=>({...R,sceneContext:ue[R.sceneNumber]&&ue[R.sceneNumber].trim()?ue[R.sceneNumber]:R.sceneContext||""}));if(j?B=fe.filter(R=>{const be=R.sceneNumber,Le=!F||be>=F,je=!K||be<=K;return Le&&je}).map(R=>({...R,framesToProcess:R.frames||[]})):B=fe.map(R=>{const be=(R.frames||[]).filter(Le=>{const je=!z||Le.frameNumber>=z,Ue=!G||Le.frameNumber<=G;return je&&Ue});return{...R,framesToProcess:be}}).filter(R=>R.framesToProcess.length>0),B.length===0){a(j?"No scenes found in the specified range.":"No frames to process within the specified range.");return}a(null),b(k);let ie=0,Z=0;B.forEach(R=>Z+=R.framesToProcess.length);const ee=Date.now();n(R=>R.map(be=>{if(be.id===k)try{const Le=JSON.parse(be.value||"{}");return{...be,value:JSON.stringify({...Le,generationProgress:{current:0,total:Z,totalStartTime:ee,currentItemStartTime:Date.now()}})}}catch{return be}return be}));try{if(j)for(const R of B){if(i.current)throw new Error("Chain execution stopped.");const be=Date.now();n(Le=>Le.map(je=>{if(je.id===k)try{const Ue=JSON.parse(je.value||"{}"),Fe=Ue.generationProgress||{current:ie,total:Z,totalStartTime:ee};return{...je,value:JSON.stringify({...Ue,generationProgress:{...Fe,currentItemStartTime:be}})}}catch{return je}return je}));try{const Le=R.sceneContext||"",je=await Bk(Le,R.framesToProcess,oe,D,J,Y,ye,{charDescMode:Oe,safeGeneration:X,thinkingEnabled:Te}),Ue=[],Fe=[];Array.isArray(je)&&je.length===R.framesToProcess.length?(je.forEach((ot,at)=>{const rt=R.framesToProcess[at],Ce=(rt.characters||[]).map(re=>{const ze=U.find(ne=>ne.index===re||ne.alias===re);if(!ze){const ne=U.find(xe=>xe.name===re);return ne?ne.index||ne.alias:re}return ze.index||ze.alias});let ve="",Ge="";typeof ot=="string"?ve=ot:ot&&typeof ot=="object"&&(ve=ot.imagePrompt||"",Ge=ot.videoPrompt||"");const ce=_s(ve),He=_s(Ge),V=ug(Array.from(new Set([...Ce,...ce,...He])));Ue.push({frameNumber:rt.frameNumber,sceneNumber:R.sceneNumber,sceneTitle:R.title,characters:V,duration:rt.duration,prompt:ve,shotType:rt.shotType}),q&&Ge&&Fe.push({frameNumber:rt.frameNumber,sceneNumber:R.sceneNumber,sceneTitle:R.title,videoPrompt:Ge,shotType:rt.shotType})}),ie+=R.framesToProcess.length,n(ot=>ot.map(at=>{if(at.id===k)try{const rt=JSON.parse(at.value||"{}");let Ce=[...rt.finalPrompts||[]];const ve=V=>`${V.sceneNumber}-${V.frameNumber}`,Ge=new Map(Ue.map(V=>[ve(V),V]));Ce=Ce.map(V=>{const re=ve(V);return Ge.has(re)?Ge.get(re):V}),Ue.forEach(V=>{Ce.some(re=>re.frameNumber===V.frameNumber&&re.sceneNumber===V.sceneNumber)||Ce.push(V)}),Ce.sort((V,re)=>V.sceneNumber!==re.sceneNumber?(V.sceneNumber||0)-(re.sceneNumber||0):V.frameNumber-re.frameNumber);let ce=[...rt.videoPrompts||[]];const He=new Map(Fe.map(V=>[ve(V),V]));return ce=ce.map(V=>{const re=ve(V);return He.has(re)?He.get(re):V}),Fe.forEach(V=>{ce.some(re=>re.frameNumber===V.frameNumber&&re.sceneNumber===V.sceneNumber)||ce.push(V)}),ce.sort((V,re)=>V.sceneNumber!==re.sceneNumber?(V.sceneNumber||0)-(re.sceneNumber||0):V.frameNumber-re.frameNumber),{...at,value:JSON.stringify({...rt,finalPrompts:Ce,videoPrompts:ce,generationProgress:{current:ie,total:Z,totalStartTime:ee,currentItemStartTime:Date.now()}})}}catch{return at}return at}))):(ie+=R.framesToProcess.length,a(`Warning: Batch result mismatch for Scene ${R.sceneNumber}`))}catch(Le){a(`Error in Scene ${R.sceneNumber}: ${Le.message}`),ie+=R.framesToProcess.length,n(je=>je.map(Ue=>{if(Ue.id===k)try{const Fe=JSON.parse(Ue.value||"{}");return{...Ue,value:JSON.stringify({...Fe,generationProgress:{current:ie,total:Z,totalStartTime:ee,currentItemStartTime:Date.now()}})}}catch{return Ue}return Ue}))}}else for(const R of B)for(const be of R.framesToProcess){if(i.current)throw new Error("Chain execution stopped.");const Le=Date.now();n(je=>je.map(Ue=>{if(Ue.id===k)try{const Fe=JSON.parse(Ue.value||"{}"),ot=Fe.generationProgress||{current:ie,total:Z,totalStartTime:ee};return{...Ue,value:JSON.stringify({...Fe,generationProgress:{...ot,currentItemStartTime:Le}})}}catch{return Ue}return Ue}));try{const je=be.imagePrompt||"",Ue=be.environmentPrompt||"",Fe=(be.characters||[]).map(re=>{if(oe[re])return`[${re}]: ${oe[re]}`;const ze=U.find(ne=>ne.name===re);if(ze){const ne=ze.imagePrompt||ze.prompt||"";return`[${re}]: ${ze.name} [Visual Profile: ${ne}]`}return null}).filter(Boolean),ot=(be.characters||[]).map(re=>{const ze=U.find(ne=>ne.index===re||ne.alias===re);if(!ze){const ne=U.find(xe=>xe.name===re);return ne?ne.index||ne.alias:re}return ze.index||ze.alias}),at=await Hk(je,Ue,Fe,D,J,R.sceneContext||"",oe,be.characters||[],ye,{charDescMode:Oe,safeGeneration:X,thinkingEnabled:Te});let rt="",Ce="";typeof at=="string"?rt=at:(rt=at.imagePrompt,Ce=at.videoPrompt);const ve=_s(rt),Ge=_s(Ce),ce=ug(Array.from(new Set([...ot,...ve,...Ge]))),He={frameNumber:be.frameNumber,sceneNumber:R.sceneNumber,sceneTitle:R.title,characters:ce,duration:be.duration,prompt:rt,shotType:be.shotType};let V=null;q&&Ce&&(V={frameNumber:be.frameNumber,sceneNumber:R.sceneNumber,sceneTitle:R.title,videoPrompt:Ce,shotType:be.shotType}),ie++,n(re=>re.map(ze=>{if(ze.id===k)try{const ne=JSON.parse(ze.value||"{}");let xe=[...ne.finalPrompts||[]];const _e=xe.findIndex(me=>me.frameNumber===be.frameNumber&&me.sceneNumber===R.sceneNumber);_e!==-1?xe[_e]=He:xe.push(He),xe.sort((me,Ee)=>me.sceneNumber!==Ee.sceneNumber?(me.sceneNumber||0)-(Ee.sceneNumber||0):me.frameNumber-Ee.frameNumber);let Ie=[...ne.videoPrompts||[]];if(V){const me=Ie.findIndex(Ee=>Ee.frameNumber===be.frameNumber&&Ee.sceneNumber===R.sceneNumber);me!==-1?Ie[me]=V:Ie.push(V),Ie.sort((Ee,Ae)=>Ee.sceneNumber!==Ae.sceneNumber?(Ee.sceneNumber||0)-(Ae.sceneNumber||0):Ee.frameNumber-Ae.frameNumber)}return{...ze,value:JSON.stringify({...ne,finalPrompts:xe,videoPrompts:Ie,generationProgress:{current:ie,total:Z,totalStartTime:ee,currentItemStartTime:Date.now()}})}}catch{return ze}return ze}))}catch{ie++}}n(R=>R.map(be=>{if(be.id===k)try{const Le=JSON.parse(be.value||"{}"),je=Le.generationProgress;return je?{...be,value:JSON.stringify({...Le,generationProgress:{...je,endTime:Date.now()}})}:be}catch{return be}return be}))}catch{n(be=>be.map(Le=>{if(Le.id===k)try{const Ue={...JSON.parse(Le.value||"{}")};return delete Ue.generationProgress,{...Le,value:JSON.stringify(Ue)}}catch{return Le}return Le}))}finally{b(null)}},[t,r,n,e,a,b,i,y]),N=x.useCallback(async(k,E)=>{const P=e.find($=>$.id===k);if(!P)return;let L;try{L=JSON.parse(P.value||"{}")}catch{L={}}const H=L.targetLanguage||"en";_(k),a(null);try{const $=await Vk(E,H);n(U=>U.map(O=>O.id===k?{...O,value:JSON.stringify({...L,prompt:$})}:O))}catch($){a($.message||"Concept improvement failed.")}finally{_(null)}},[e,n,a,_]);return{states:{isEnhancing:s,isTranslating:c,isModifyingScriptPart:h,isFixingErrors:m,isModifyingScriptPrompts:y,isImprovingScriptConcept:S},handleEnhance:v,handleTranslate:f,handleModifyScriptPart:T,handleModifyAnalyzerFramePart:A,handleFixErrors:I,handleModifyScriptPrompts:M,handleImproveScriptConcept:N,stop:()=>{l(null),d(null),g(null),w(null),b(null),_(null)}}},dA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a,executionStopRequested:i})=>{const[s,l]=x.useState(null),[c,d]=x.useState(null),[h,g]=x.useState(null),[m,w]=x.useState(null),y=x.useCallback(async v=>{if(!e.find(I=>I.id===v))return;const T=t.find(I=>I.toNodeId===v),A=T?r(T.fromNodeId,T.fromHandleId):"";if(!A){a("No input text to analyze.");return}l(v),a(null);try{const I=await Qk(A);n(M=>M.map(N=>N.id===v?{...N,value:JSON.stringify(I)}:N))}catch(I){a(I.message||"Analysis failed")}finally{l(null)}},[e,t,r,n,a]),b=x.useCallback(async v=>{if(!e.find(I=>I.id===v))return;const T=t.find(I=>I.toNodeId===v),A=T?r(T.fromNodeId,T.fromHandleId):"";if(!A){a("No input text to analyze.");return}d(v),a(null);try{const I=await Wk(A);n(M=>M.map(N=>N.id===v?{...N,value:JSON.stringify(I)}:N))}catch(I){a(I.message||"Character analysis failed")}finally{d(null)}},[e,t,r,n,a]),S=x.useCallback(async v=>{i.current=!1;const f=e.find(j=>j.id===v);if(!f)return;let T;try{T=JSON.parse(f.value||"{}")}catch{T={}}const{model:A="gemini-3-pro-preview",targetLanguage:I="ru",framesPerScene:M,minFrames:N,maxFrames:k,hierarchyEnabled:E=!0,mandatoryBgEnabled:P=!0,statePersistenceEnabled:L=!0,livingWorldEnabled:H=!0,extendedAnalysis:$,generateStartEndFrames:U,professionalStoryboard:O=!1,startSceneNumber:D,endSceneNumber:z,autoIndexCharacters:G=!0,batchProcessing:F=!0}=T,K=t.filter(j=>j.toNodeId===v);let ae="",Y=[],ge=[];const W=j=>{const{image:q,imageBase64:Q,imageSources:J,...oe}=j;return oe};for(const j of K){const q=r(j.fromNodeId,j.fromHandleId);try{const Q=JSON.parse(q);if(Q.scenes){if(Q.summary&&(ae=Q.summary),Array.isArray(Q.scenes)&&(Y=Q.scenes.map((J,oe)=>({...J,sceneNumber:typeof J.sceneNumber=="number"?J.sceneNumber:oe+1}))),Array.isArray(Q.detailedCharacters)){const J=Q.detailedCharacters.map(W);ge=[...ge,...J]}}else Q.name?ge.push(W(Q)):Array.isArray(Q.characters)&&(ge=[...ge,...Q.characters.map(W)])}catch{}}const le=new Map;ge.forEach(j=>{j.name&&le.set(j.name,j)});const X=Array.from(le.values());if(Y.length===0){a("No scenes found to analyze. Please connect a Script Generator.");return}const Te=new Map;Y.forEach(j=>{typeof j.sceneNumber=="number"&&j.title&&Te.set(j.sceneNumber,j.title)});const pe=D&&D>0?D:1,ue=z&&z>0?z:999999,Oe=Y.filter(j=>{const q=j.sceneNumber!==void 0?j.sceneNumber:-1;return q>=pe&&q<=ue});if(Oe.length===0){a(`No scenes found in the selected range (${pe}-${ue}). Check input scene numbers.`);return}g(v),a(null);let he=Oe.length;const ye=Date.now();n(j=>j.map(q=>{if(q.id===v)try{const Q=JSON.parse(q.value||"{}");return{...q,value:JSON.stringify({...Q,generationProgress:{current:0,total:he,totalStartTime:ye,currentItemStartTime:Date.now()}})}}catch{return q}return q}));try{let j=Array.isArray(T.scenes)?[...T.scenes]:[];const q=new Map(j.map(oe=>[oe.sceneNumber,oe])),Q=oe=>{oe.map(ee=>({...ee,title:Te.get(ee.sceneNumber)||ee.title})).forEach(ee=>q.set(ee.sceneNumber,ee));let fe=Array.from(q.values()).sort((ee,R)=>ee.sceneNumber-R.sceneNumber),ie=0,Z=fe.map(ee=>({...ee,frames:(ee.frames||[]).map(R=>{ie++;let be=2;if(R.duration!==void 0){if(typeof R.duration=="number")be=Math.round(R.duration);else if(typeof R.duration=="string"){const Le=parseFloat(R.duration.replace(/s$/i,""));isNaN(Le)||(be=Math.round(Le))}}return{...R,frameNumber:ie,duration:be}})}));if(G){const ee=X.map(Le=>({from:Le.originalName||Le.name,to:Le.alias})),R=Le=>Le.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),be=Le=>{if(!Le)return"";let je=Le;return ee.forEach(({from:Ue,to:Fe})=>{if(Ue&&Fe){const ot=R(Ue),at=new RegExp(`\\b${ot}\\b`,"gi");je=je.replace(at,Fe)}}),je};Z=Z.map(Le=>({...Le,frames:Le.frames.map(je=>({...je,description:be(je.description),imagePrompt:be(je.imagePrompt),environmentPrompt:be(je.environmentPrompt),videoPrompt:be(je.videoPrompt)}))}))}return Z},J={framesPerScene:M,minFrames:N,maxFrames:k,extendedAnalysis:$,generateStartEndFrames:U,batchProcessing:F,professionalStoryboard:O,hierarchyEnabled:E,mandatoryBgEnabled:P,statePersistenceEnabled:L,livingWorldEnabled:H};if(F){if(i.current)throw new Error("Analysis stopped by user.");const oe=await cg(Oe,X,ae,I,J,A),B=Array.isArray(oe)?oe.map((ie,Z)=>{if(Z<Oe.length){const ee=Oe[Z];return{...ie,sceneNumber:ee.sceneNumber,characters:ie.characters||ee.characters||[]}}return ie}):[],fe=Q(B);n(ie=>ie.map(Z=>{if(Z.id===v)try{const ee=JSON.parse(Z.value||"{}");return{...Z,value:JSON.stringify({...ee,scenes:fe,generationProgress:{current:he,total:he,totalStartTime:ye,currentItemStartTime:Date.now()}})}}catch{return Z}return Z}))}else for(let oe=0;oe<Oe.length;oe++){if(i.current)throw new Error("Analysis stopped by user.");const B=Oe[oe],fe=Date.now();n(R=>R.map(be=>{if(be.id===v)try{const Le=JSON.parse(be.value||"{}"),je=Le.generationProgress||{current:oe,total:he,totalStartTime:ye};return{...be,value:JSON.stringify({...Le,generationProgress:{...je,current:oe,currentItemStartTime:fe}})}}catch{return be}return be}));const ie=await cg([B],X,ae,I,J,A),Z=Array.isArray(ie)?ie.map(R=>({...R,sceneNumber:B.sceneNumber,characters:R.characters||B.characters||[]})):[],ee=Q(Z);n(R=>R.map(be=>{if(be.id===v)try{const Le=JSON.parse(be.value||"{}");return{...be,value:JSON.stringify({...Le,scenes:ee,generationProgress:{current:oe+1,total:he,totalStartTime:ye,currentItemStartTime:Date.now()}})}}catch{return be}return be}))}n(oe=>oe.map(B=>{if(B.id===v)try{const fe=JSON.parse(B.value||"{}"),ie=fe.generationProgress;return ie?{...B,value:JSON.stringify({...fe,generationProgress:{...ie,endTime:Date.now()}})}:B}catch{return B}return B}))}catch(j){j.message!=="Analysis stopped by user."&&a(j.message||"Script analysis failed."),n(q=>q.map(Q=>{if(Q.id===v)try{const oe={...JSON.parse(Q.value||"{}")};return delete oe.generationProgress,{...Q,value:JSON.stringify(oe)}}catch{return Q}return Q}))}finally{g(null)}},[e,t,r,n,a,i]),_=x.useCallback(async v=>{var k,E;const f=e.find(P=>P.id===v);if(!f)return;let T;try{T=JSON.parse(f.value||"{}")}catch{a("Invalid node data.");return}const A=T.activeChannelId,I=((k=T.channels)==null?void 0:k.find(P=>P.id===A))||((E=T.channels)==null?void 0:E[0]);if(!I){a("No active channel found to analyze.");return}const M={channels:[I].map(P=>({name:P.name,description:P.description,stats:P.stats,goal:P.goal,isMonetized:P.isMonetized,currentSubscribers:P.currentSubscribers,videos:P.videos.map(L=>({uploadDate:L.uploadDate,title:L.title,views:L.views,likes:L.likes,isShort:L.isShort}))}))||[],goal:I.goal,isMonetized:I.isMonetized,currentSubscribers:I.currentSubscribers,contextPrompt:T.contextPrompt,currentDate:new Date().toLocaleString()},N=T.targetLanguage||"ru";if(M.channels.length===0){a("No channel data available to analyze.");return}a(null),w(v);try{const P=await aA(M,N);n(L=>L.map(H=>{if(H.id===v){const $=JSON.parse(H.value||"{}");return{...H,value:JSON.stringify({...$,aiAdvice:P.advice,aiSuggestedGoal:P.suggestedGoal})}}return H}))}catch(P){a(P.message||"An unknown error occurred during YouTube stats analysis.")}finally{w(null)}},[e,n,a,w]);return{states:{isAnalyzing:s,isAnalyzingCharacter:c,isAnalyzingScript:h,isAnalyzingYouTubeStats:m},handleAnalyzeScript:S,handleAnalyzeYouTubeStats:_,handleAnalyzePrompt:y,handleAnalyzeCharacter:b,stop:()=>{l(null),d(null),g(null),w(null)}}},pg={general:"            ' '.         ,   .    ,    ,     .      ,      ,   .    ,     Markdown.",script:"         .       ,   .       ( ,  ),   ,      .    ,  ,     .       .",prompt:"    -    (Stable Diffusion, Midjourney, DALL-E).       ,    .  ,    (volumetric lighting, cinematic lighting),  (rule of thirds, wide shot),  (cyberpunk, watercolor, oil painting),     (4k, 8k, detailed).     ,      .",youtube:"     YouTube,      .     SEO   (, , ),   (CTR, retention rate)  .        ,   ,   ( )     ,   .    , -    ."},uA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a})=>{const[i,s]=x.useState(null),[l,c]=x.useState(null),d=x.useCallback(async g=>{const m=e.find(f=>f.id===g);if(!m)return;let w;try{w=JSON.parse(m.value)}catch{a("Invalid chat node data.");return}const{messages:y,currentInput:b,mode:S="general"}=w;if(!b||b.trim()==="")return;const _={role:"user",content:b},v=[...y,_];n(f=>f.map(T=>T.id===g?{...T,value:JSON.stringify({messages:v,currentInput:"",mode:S})}:T)),a(null),s(g);try{const f=y.map(E=>({role:E.role,parts:[{text:E.content}]})),T=pg[S]||pg.general,N={role:"model",content:(await Kt().chats.create({model:"gemini-2.5-flash",history:f,config:{systemInstruction:T}}).sendMessage({message:b})).text??""},k=[...v,N];n(E=>E.map(P=>P.id===g?{...P,value:JSON.stringify({messages:k,currentInput:"",mode:S})}:P))}catch(f){a(f.message||"An unknown error occurred during chat."),n(T=>T.map(A=>A.id===g?{...A,value:JSON.stringify({messages:y,currentInput:b,mode:S})}:A))}finally{s(null)}},[e,n,a,s]),h=x.useCallback(async g=>{const m=e.find(_=>_.id===g);if(!m)return;let w;m.type===C.SCRIPT_GENERATOR?w=t.find(_=>_.toNodeId===g&&(_.toHandleId==="prompt"||_.toHandleId===void 0)):w=t.find(_=>_.toNodeId===g);let y="";w&&(y=r(w.fromNodeId,w.fromHandleId));let b;try{b=JSON.parse(m.value||"{}")}catch{b={}}const S=b.mode||"simple";if(m.type===C.SPEECH_SYNTHESIZER){if(S==="scene"){let _=[];try{const v=JSON.parse(y);Array.isArray(v)&&(_=v)}catch{}if(JSON.stringify(b.inputText)===JSON.stringify(_))return}else if(b.inputText===y)return}else if(m.type===C.DATA_READER){if(m.value===y)return;try{const _=JSON.parse(y),v=JSON.stringify(_,null,2);if(m.value===v)return}catch{}}else if(m.type===C.SCRIPT_GENERATOR||m.type===C.CHARACTER_GENERATOR||m.type===C.IDEA_GENERATOR||m.type===C.NARRATOR_TEXT_GENERATOR){const _=m.type===C.IDEA_GENERATOR?"theme":"prompt";if(b[_]===y)return}a(null),c(g);try{if(await new Promise(_=>setTimeout(_,30)),m.type===C.SPEECH_SYNTHESIZER)n(_=>_.map(v=>{if(v.id===g){let f;try{f=JSON.parse(v.value||"{}")}catch{f={}}const T=f.mode||"simple";let A;if(T==="scene"){let I=[];try{const M=JSON.parse(y);Array.isArray(M)&&(I=M)}catch{}A={...f,inputText:I,audioFiles:[]}}else A={...f,inputText:y};return{...v,value:JSON.stringify(A)}}return v}));else if(m.type===C.SCRIPT_GENERATOR||m.type===C.CHARACTER_GENERATOR||m.type===C.IDEA_GENERATOR||m.type===C.NARRATOR_TEXT_GENERATOR)n(_=>_.map(v=>{if(v.id===g){let f;try{f=JSON.parse(v.value||"{}")}catch{f={}}const T=v.type===C.IDEA_GENERATOR?"theme":"prompt";return{...v,value:JSON.stringify({...f,[T]:y})}}return v}));else if(!(m.type===C.SCRIPT_ANALYZER||m.type===C.SCRIPT_PROMPT_MODIFIER)){let _=y;try{const v=JSON.parse(y);_=JSON.stringify(v,null,2)}catch{}n(v=>v.map(f=>f.id===g?{...f,value:_}:f))}}catch(_){a(_.message||"An unknown error occurred while reading data.")}finally{c(null)}},[t,r,n,e,a,c]);return{states:{isChatting:i,isReadingData:l},handleSendMessage:d,handleReadData:h,stop:()=>{s(null),c(null)}}},pA=({nodes:e,connections:t,setNodes:n,executionStopRequested:r,setError:a,generationHandlers:i,analysisHandlers:s,modificationHandlers:l})=>{const[c,d]=x.useState(null),[h,g]=x.useState(!1),[m,w]=x.useState(new Set),y=x.useCallback(f=>new Promise(T=>{n(A=>{const I=A.find(D=>D.id===f);if(!I||I.type!==C.SCRIPT_ANALYZER)return T(),A;let M;try{M=JSON.parse(I.value||"{}")}catch{return T(),A}const{characters:N,scenes:k}=M;if(!N||N.length===0||!k)return T(),A;const E=N.map(D=>({from:D.originalName||D.name,to:D.index||D.alias})),P=D=>D.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=D=>{if(!D)return"";let z=D;return E.forEach(({from:G,to:F})=>{if(G&&F){const K=P(G),ae=new RegExp(`\\b${K}\\b`,"gi");z=z.replace(ae,F)}}),z},H=k.map(D=>({...D,frames:D.frames.map(z=>({...z,description:L(z.description),imagePrompt:L(z.imagePrompt),environmentPrompt:L(z.environmentPrompt),videoPrompt:L(z.videoPrompt)}))})),$=N.map(D=>({...D,imagePrompt:L(D.imagePrompt)})),U={...M,characters:$,scenes:H},O=A.map(D=>D.id===f?{...D,value:JSON.stringify(U)}:D);return T(),O})}),[n]),b=x.useCallback(f=>new Promise(T=>{n(A=>{const I=A.find(U=>U.id===f);if(!I||I.type!==C.CHARACTER_GENERATOR)return T(),A;let M;try{M=JSON.parse(I.value||"{}")}catch{return T(),A}const{characters:N}=M;if(!N||N.length===0)return T(),A;const k=N.map(U=>({from:U.originalName,to:U.index||U.alias})),E=U=>U.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),P=U=>{let O=U;return k.forEach(({from:D,to:z})=>{if(D&&z&&D!==z){const G=E(D),F=new RegExp(`\\b${G}\\b`,"gi");O=O.replace(F,z)}}),O},L=N.map(U=>({...U,fullDescription:P(U.fullDescription),prompt:P(U.prompt)})),H={...M,characters:L},$=A.map(U=>U.id===f?{...U,value:JSON.stringify(H)}:U);return T(),$})}),[n]),S=x.useCallback(async f=>{a(null),g(!0),r.current=!1;const T=(A,I)=>{let M=t.find(k=>k.toNodeId===A);if(!M)return;let N=e.find(k=>k.id===M.fromNodeId);for(;N&&N.type===C.REROUTE_DOT;){if(M=t.find(k=>k.toNodeId===N.id),!M)return;N=e.find(k=>k.id===M.fromNodeId)}return N&&N.type===I?N:void 0};try{d(f);const A=T(f,C.SCRIPT_ANALYZER);if(!A)throw new Error("Could not find a connected Script Analyzer node.");const I=T(A.id,C.SCRIPT_GENERATOR);if(!I)throw new Error("Could not find a connected Script Generator node.");if(d(I.id),await i.handleGenerateScript(I.id),r.current)throw new Error("Chain execution stopped.");if(d(A.id),await s.handleAnalyzeScript(A.id),r.current)throw new Error("Chain execution stopped.");if(await y(A.id),r.current)throw new Error("Chain execution stopped.");if(d(f),await l.handleModifyScriptPrompts(f),r.current)throw new Error("Chain execution stopped.")}catch(A){A.message!=="Chain execution stopped."&&a(A.message||"An unknown error occurred during chain execution.")}finally{g(!1),d(null)}},[e,t,a,g,d,r,i,s,l,y]),_=x.useCallback(async f=>{console.warn("Chain execution is not fully implemented."),g(!0),d(f),r.current=!1,await new Promise(T=>setTimeout(T,1e3)),r.current||(g(!1),d(null))},[g,d,r]),v=x.useCallback(async f=>{console.warn("Process chain forward is not fully implemented.")},[]);return{states:{executingNodeId:c,isExecutingChain:h,stoppingNodes:m},handleExecuteFullChain:S,handleExecuteChain:_,handleProcessChainForward:v,handleApplyAliasesForScriptAnalyzer:y,handleApplyAliasesForCharacterGenerator:b,stop:()=>{g(!1),d(null)}}},hA=(e,t,n)=>{const[r,a]=x.useState(null),i=x.useRef(!1),s=x.useRef(e);s.current=e;const l=x.useCallback(()=>{i.current=!0},[]),c=x.useCallback((S,_,v=new Set)=>{var T,A,I,M,N,k,E,P,L;if(v.has(S))return"";v.add(S);const f=s.current.find(H=>H.id===S);if(!f)return"";if(f.type===C.REROUTE_DOT){const H=t.find($=>$.toNodeId===S);return H?c(H.fromNodeId,H.fromHandleId,v):""}try{const H=JSON.parse(f.value||"{}");if(f.type===C.TEXT_INPUT||f.type===C.NOTE)return f.value;if(f.type===C.TRANSLATOR)return H.translatedText||"";if(f.type===C.PROMPT_PROCESSOR)return f.value;switch(f.type){case C.PROMPT_ANALYZER:if(_==="environment")return H.environment||"";if(_==="action")return H.action||"";if(_==="style")return H.style||"";if(_!=null&&_.startsWith("character-")){const O=parseInt(_.split("-")[1],10);return((T=H.characters)==null?void 0:T[O])||""}return"";case C.CHARACTER_ANALYZER:return _==="character"?H.character||"":_==="clothing"&&H.clothing||"";case C.CHARACTER_CARD:let $=H;Array.isArray($)||($=[$]);const U=O=>{const{image:D,imageBase64:z,imageSources:G,thumbnails:F,selectedRatio:K,alias:ae,...Y}=O;return!Y.index&&ae&&(Y.index=ae),Y};if(_==="primary-character"){const O=$.find(D=>D.isOutput)||$[0];return O?JSON.stringify([U(O)]):"[]"}return JSON.stringify($.map(O=>U(O)));case C.CHARACTER_GENERATOR:if(_!=null&&_.startsWith("character-")){const O=_.replace("character-",""),D=((A=H.characters)==null?void 0:A.find(z=>z.id===O))||((I=H.characters)==null?void 0:I[parseInt(O,10)]);if(D){const{imageBase64:z,image:G,alias:F,...K}=D;return!K.index&&F&&(K.index=F),JSON.stringify(K)}return""}return"";case C.SCRIPT_GENERATOR:if(_==="all-script-parts"||_===void 0){const O={...H},D=t.filter(K=>K.toNodeId===S&&K.toHandleId==="characters"),z=[];D.forEach(K=>{const ae=c(K.fromNodeId,K.fromHandleId,new Set([...v]));try{const Y=JSON.parse(ae||"{}");if(Y.name){const{image:ge,imageBase64:W,imageSources:le,alias:X,...Te}=Y;!Te.index&&X&&(Te.index=X),z.push(Te)}else if(Array.isArray(Y)){const ge=Y.map(W=>{const{image:le,imageBase64:X,imageSources:Te,thumbnails:pe,alias:ue,...Oe}=W;return!Oe.index&&ue&&(Oe.index=ue),Oe});z.push(...ge)}else if(Y.characters&&Array.isArray(Y.characters)){const ge=Y.characters.map(W=>{const{image:le,imageBase64:X,imageSources:Te,alias:pe,...ue}=W;return!ue.index&&pe&&(ue.index=pe),ue});z.push(...ge)}}catch{}});const G=new Set((O.detailedCharacters||[]).map(K=>K.name)),F=z.filter(K=>!G.has(K.name));return O.detailedCharacters=[...O.detailedCharacters||[],...F],!O.generatedStyle&&O.visualStyle&&O.visualStyle!=="none"&&(O.generatedStyle=O.customVisualStyle||O.visualStyle),JSON.stringify(O)}if(_==="all-narrator-text"){const D=(H.scenes||[]).map(z=>({sceneNumber:z.sceneNumber,text:z.narratorText})).filter(z=>z.text);return JSON.stringify(D)}if(_==="summary")return H.summary||"";if(_!=null&&_.startsWith("scene-")){const O=parseInt(_.split("-")[1],10);return((N=(M=H.scenes)==null?void 0:M[O])==null?void 0:N.description)||""}if(_!=null&&_.startsWith("character-")){const O=_.replace("character-",""),D=(k=H.detailedCharacters)==null?void 0:k.find(z=>z.id===O);if(D)return JSON.stringify(D)}return"";case C.SCRIPT_ANALYZER:if(_==="all-script-analyzer-data"||_===void 0){const O={...H},D=t.find(z=>z.toNodeId===S);if(D){const z=c(D.fromNodeId,D.fromHandleId,new Set([...v]));try{const G=JSON.parse(z);if(G.generatedStyle&&(O.generatedStyle=G.generatedStyle),!O.visualStyle&&(G.generatedStyle||G.visualStyle)&&(O.visualStyle=G.generatedStyle||G.visualStyle),G.detailedCharacters&&Array.isArray(G.detailedCharacters)?(O.detailedCharacters=G.detailedCharacters,O.characters=G.detailedCharacters):G.characters&&(O.detailedCharacters=G.characters,O.characters=G.characters),G.scenes&&Array.isArray(G.scenes)&&O.scenes&&Array.isArray(O.scenes)){const F=new Map;G.scenes.forEach(K=>{typeof K.sceneNumber=="number"&&F.set(K.sceneNumber,K)}),O.scenes=O.scenes.map(K=>{const ae=F.get(K.sceneNumber);return ae?{...K,title:K.title||ae.title,description:K.description||ae.description,narratorText:K.narratorText||ae.narratorText}:K})}}catch{}}return JSON.stringify(O)}if(_==="all-narrator-data"){const D=(H.scenes||[]).map(z=>({sceneNumber:z.sceneNumber,text:z.narratorText})).filter(z=>z.text);return JSON.stringify(D)}if(_!=null&&_.startsWith("character-")){const O=_.replace("character-",""),D=(E=H.characters)==null?void 0:E.find(z=>z.id===O);if(D)return JSON.stringify(D)}if(_!=null&&_.startsWith("frame-")){const O=parseInt(_.split("-")[1],10),z=(H.scenes||[]).flatMap(G=>G.frames||[]).find(G=>G.frameNumber===O);return(z==null?void 0:z.imagePrompt)||""}return"";case C.SCRIPT_PROMPT_MODIFIER:if(_!=null&&_.startsWith("final-prompt-")){const O=parseInt(_.substring(13),10),D=(P=H.finalPrompts)==null?void 0:P.find(z=>z.frameNumber===O);if(D)return D.prompt||""}return"";case C.YOUTUBE_ANALYTICS:return H.aiAdvice||"";case C.NARRATOR_TEXT_GENERATOR:return((L=H.generatedTexts)==null?void 0:L[_||""])||"";case C.AUDIO_TRANSCRIBER:return H.transcription||"";case C.IDEA_GENERATOR:return H.generatedIdea||"";case C.YOUTUBE_TITLE_GENERATOR:return _&&H.generatedTitleOutputs&&H.generatedTitleOutputs[_]?JSON.stringify(H.generatedTitleOutputs[_]):JSON.stringify(H);case C.MUSIC_IDEA_GENERATOR:return JSON.stringify(H);default:return f.value||""}}catch{return f.value||""}},[t]),d=lA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a,executionStopRequested:i}),h=dA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a,executionStopRequested:i}),g=cA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a,executionStopRequested:i}),m=uA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a}),w=pA({nodes:e,connections:t,setNodes:n,executionStopRequested:i,setError:a,generationHandlers:{handleGenerateScript:d.handleGenerateScript},analysisHandlers:{handleAnalyzeScript:h.handleAnalyzeScript},modificationHandlers:{handleModifyScriptPrompts:g.handleModifyScriptPrompts}}),y={...d.states,...h.states,...g.states,...m.states,...w.states},b=x.useCallback(()=>{l(),d.stop(),h.stop(),g.stop(),m.stop(),w.stop()},[l,d,h,g,m,w]);return{...d,...h,...g,...m,...w,stopGeneration:b,error:r,setError:a,getUpstreamTextValue:c,...y}},mA="ScriptModifierDB",xl="autosave",gA="appState",fA=()=>new Promise((e,t)=>{const n=indexedDB.open(mA,1);n.onupgradeneeded=r=>{const a=r.target.result;a.objectStoreNames.contains(xl)||a.createObjectStore(xl)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}),yA=async e=>{const t=await fA();return new Promise((n,r)=>{const s=t.transaction(xl,"readwrite").objectStore(xl).put(e,gA);s.onsuccess=()=>n(),s.onerror=()=>r(s.error)})},xA=(e,t)=>{const n=x.useRef(!0),r=x.useRef(e);x.useEffect(()=>{r.current=e},[e]),x.useEffect(()=>{if(n.current){n.current=!1;return}const a=setTimeout(()=>{const i={tabs:e,activeTabIndex:t,timestamp:Date.now()};yA(i).catch(s=>{console.warn("IndexedDB save failed, attempting localStorage fallback",s);try{localStorage.setItem("script-modifier-autosave",JSON.stringify(i))}catch(l){console.error("Failed to auto-save state:",l)}})},1e3);return()=>clearTimeout(a)},[e,t]),x.useEffect(()=>{const a=i=>{if(window.isReloading)return;if(r.current.some(l=>l.nodes.length>0))return i.preventDefault(),i.returnValue="",""};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[])},vA=40,bA=(e,t,n)=>{const[r,a]=x.useState({width:window.innerWidth,height:window.innerHeight});x.useLayoutEffect(()=>{const l=()=>{a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",l),l(),()=>window.removeEventListener("resize",l)},[]);const{visibleNodes:i,visibleConnections:s}=x.useMemo(()=>{const c=(-1e3-n.translate.x)/n.scale,d=(-1e3-n.translate.y)/n.scale,h=(r.width+1e3-n.translate.x)/n.scale,g=(r.height+1e3-n.translate.y)/n.scale,m=new Set,w=[];for(const b of e){const S=b.width,_=b.isCollapsed?vA:b.height,v=b.position.x+S,f=b.position.y+_;b.position.x<h&&v>c&&b.position.y<g&&f>d&&(w.push(b),m.add(b.id))}const y=t.filter(b=>m.has(b.fromNodeId)||m.has(b.toNodeId));return{visibleNodes:w,visibleConnections:y}},[e,t,n,r]);return{visibleNodes:i,visibleConnections:s}},hg={nodes:[{type:C.SCRIPT_GENERATOR,title:"Script Generator",value:'{"prompt":"","targetLanguage":"en","characterType":"simple","useExistingCharacters":false,"narratorEnabled":true,"narratorMode":"normal","summary":"","detailedCharacters":[],"scenes":[],"isAdvancedMode":false,"numberOfScenes":null,"isDetailedPlot":false,"genre":"general","genre2":"general","noCharacters":false,"model":"gemini-3-pro-preview","includeSubscribeScene":false,"visualStyle":"none","customVisualStyle":"","generatedStyle":"","createSecondaryChars":true,"createKeyItems":true,"safeGeneration":false,"thinkingEnabled":false,"scenelessMode":false,"simpleActions":false,"commercialSafe":false,"smartConceptEnabled":false,"uiState":{"isSummaryCollapsed":true,"collapsedCharacters":[],"collapsedScenes":[],"isStyleCollapsed":true,"isSettingsCollapsed":true,"isCharactersSectionCollapsed":true,"isScenesSectionCollapsed":true}}',width:680,height:800,id:"node-13-1763665880409",position:{x:180,y:180}},{type:C.SCRIPT_ANALYZER,title:"Script Analyzer",value:'{"characters":[],"scenes":[],"targetLanguage":"en","model":"gemini-3-pro-preview","startSceneNumber":null,"endSceneNumber":null,"framesPerScene":null,"minFrames":null,"maxFrames":null,"hierarchyEnabled":true,"mandatoryBgEnabled":true,"statePersistenceEnabled":true,"livingWorldEnabled":true,"extendedAnalysis":false,"microActionBreakdown":false,"batchProcessing":true,"professionalStoryboard":true,"cinematographyEnabled":true,"safeGeneration":false,"thinkingEnabled":false,"shotFilter":"all","anthroEnabled":false,"subscribeEnhancement":false,"anatomicalStrictness":true,"propConsistency":true,"visualStyle":"","autoIndexCharacters":true,"uiState":{"isSettingsCollapsed":true,"isCharStyleCollapsed":true},"settingsPaneHeight":200,"characterPaneHeight":160,"generationProgress":null}',width:680,height:800,id:"node-15-1763665895770",position:{x:940,y:180}},{type:C.SCRIPT_PROMPT_MODIFIER,title:"Prompt Finalizer",value:'{"finalPrompts":[],"videoPrompts":[],"usedCharacters":[],"targetLanguage":"en","startFrameNumber":null,"endFrameNumber":null,"startSceneNumber":null,"endSceneNumber":null,"generationProgress":null,"styleOverride":"none","characterPaneHeight":162,"model":"gemini-3-pro-preview","disabledInstructionIds":["break_paragraphs","rule_saturation"],"includeGeneralCharDesc":true,"includeFullCharDesc":false,"safeGeneration":false,"thinkingEnabled":false,"propEnhancementEnabled":true,"uiState":{"isSettingsCollapsed":true,"isCharStyleCollapsed":true},"settingsPaneHeight":200}',width:680,height:800,id:"node-16-1763665908511",position:{x:1700,y:180}},{type:C.CHARACTER_GENERATOR,title:"Character Generator",value:'{"prompt":"","numberOfCharacters":1,"targetLanguage":"en","characterType":"simple","style":"simple","customStyle":"","characters":[]}',width:680,height:800,id:"node-17-1763665920176",position:{x:180,y:1340}},{type:C.YOUTUBE_TITLE_GENERATOR,title:"YouTube Title Generator",value:'{"mode":"title","idea":"","targetLanguages":{"ru":true,"en":false},"generatedTitleOutputs":{},"generatedChannelOutputs":{}}',width:680,height:800,id:"node-18-1763665947291",position:{x:3220,y:1340}},{type:C.NARRATOR_TEXT_GENERATOR,title:"Narrator Text Generator",value:'{"prompt":"","role":"narrator","generatedTexts":{"ru":"","en":""},"targetLanguages":{"ru":true,"en":true},"generateSSML":false}',width:680,height:800,id:"node-19-1763665953580",position:{x:940,y:1340}},{type:C.SPEECH_SYNTHESIZER,title:"Speech Synthesizer",value:'{"inputText":"","voice":"Zephyr","audioFiles":[],"startSceneNumber":null,"endSceneNumber":null,"intonation":"standard","mode":"simple","isMultiSpeaker":false,"speaker1Name":"Man","speaker1Voice":"Zephyr","speaker2Name":"Woman","speaker2Voice":"Kore"}',width:680,height:800,id:"node-21-1763665961743",position:{x:1700,y:1340}},{type:C.MUSIC_IDEA_GENERATOR,title:"Music Idea Generator",value:'{"generateLyrics":true,"idea":"","targetLanguages":{"ru":true,"en":false},"generatedLyrics":{},"generatedMusicPrompts":{},"generatedTitles":{}}',width:680,height:800,id:"node-31-1764450930993",position:{x:2460,y:1340}}],connections:[{fromNodeId:"node-13-1763665880409",toNodeId:"node-15-1763665895770",fromHandleId:"all-script-parts",fromPointOffset:{x:681.2500038165192,y:419.99998694653596},id:"conn-1763665902004-t74xvfcuv"},{fromNodeId:"node-15-1763665895770",toNodeId:"node-16-1763665908511",fromHandleId:"all-script-analyzer-data",toHandleId:"all-script-analyzer-data",fromPointOffset:{x:681.2499748553378,y:419.99998694653596},id:"conn-1763665935004-en9p0i2wu"},{fromNodeId:"node-19-1763665953580",toNodeId:"node-21-1763665961743",fromHandleId:"ru",fromPointOffset:{x:681.249946470853,y:400.99999128512286},id:"conn-1763665983386-jjaugycj8"}],groups:[],viewTransform:{scale:1,translate:{x:-76.28342475994805,y:-87.09443655635778}},nodeIdCounter:32},Ny=x.createContext(null),wA=({children:e})=>{var pp;const{t}=Bt(),[n,r]=x.useState(!1),[a,i]=x.useState("orthogonal"),[s,l]=x.useState(()=>{try{const Me=localStorage.getItem("context-menu-slots");if(Me)return JSON.parse(Me)}catch{}return Array(8).fill(null)}),c=x.useRef(new Map),[d,h]=x.useState(null),g=x.useCallback((Me,$e,tt)=>{const ut=`${Me}-${$e}`;tt?c.current.set(ut,tt):c.current.delete(ut)},[]),m=x.useCallback((Me,$e)=>{const tt=`${Me}-${$e}`;return c.current.get(tt)||null},[]),w=x.useCallback(async Me=>{try{const tt=await(await fetch(`data:image/png;base64,${Me}`)).blob();await navigator.clipboard.write([new ClipboardItem({[tt.type]:tt})])}catch($e){console.error("Failed to copy image",$e)}},[]),y=x.useCallback((Me,$e)=>{const tt=document.createElement("a");tt.href=`data:image/png;base64,${Me}`,tt.download=$e,document.body.appendChild(tt),tt.click(),document.body.removeChild(tt)},[]),b=x.useCallback((Me,$e)=>{l(tt=>{const ut=[...tt];return Me>=0&&Me<8&&(ut[Me]=$e),localStorage.setItem("context-menu-slots",JSON.stringify(ut)),ut})},[]),S=x.useCallback((Me,$e)=>({id:`tab-${Date.now()}`,name:Me,nodes:($e==null?void 0:$e.nodes)??[],connections:($e==null?void 0:$e.connections)??[],groups:($e==null?void 0:$e.groups)??[],viewTransform:($e==null?void 0:$e.viewTransform)??{scale:1,translate:{x:0,y:0}},nodeIdCounter:($e==null?void 0:$e.nodeIdCounter)??1,...$e}),[]),_={id:`tab-${Date.now()}`,name:"Tab 1",...hg},[v,f]=x.useState([S("Tab 1",_)]),[T,A]=x.useState(0),I=x.useRef(_.id),M=Me=>{Me<0||Me>=v.length||A(Me)},N=()=>{const Me=S(`Tab ${v.length+1}`);f($e=>[...$e,Me]),A(v.length)},k=Me=>{if(v.length<=1)return;v[Me],v[T];let $e=T;Me<T?$e=T-1:Me===T&&($e=Me>0?Me-1:0),f(tt=>tt.filter((ut,Ut)=>Ut!==Me)),A($e)},E=(Me,$e)=>{f(tt=>tt.map((ut,Ut)=>Ut===Me?{...ut,name:$e}:ut))},{nodes:P,setNodes:L,nodeIdCounter:H,handleValueChange:$,handleAddNode:U,handleDeleteNode:O,handleCopyNodeValue:D,handlePasteNodeValue:z,handleDuplicateNode:G,handleDuplicateNodeEmpty:F,handleToggleNodeOutputVisibility:K}=gw([],0),ae=G,{connections:Y,setConnections:ge,addConnection:W,removeConnectionsByNodeId:le,removeConnectionById:X}=fw([]),{viewTransform:Te,setViewTransform:pe,isPanning:ue,pointerPosition:Oe,clientPointerPosition:he,handleWheel:ye,startPanning:j,pan:q,updatePointerPosition:Q,stopPanning:J,setZoom:oe,handleCanvasTouchStart:B,handleCanvasTouchMove:fe,handleCanvasTouchEnd:ie}=yw({scale:1,translate:{x:0,y:0}}),{groups:Z,setGroups:ee,addGroup:R,removeGroup:be}=vw([]),Le=x.useCallback(Me=>{L($e=>{const tt=$e.map(ut=>ut.id===Me?{...ut,isCollapsed:!ut.isCollapsed}:ut);return ee(ut=>ut.map(Ut=>{if(!Ut.nodeIds.includes(Me))return Ut;const Qn=tt.filter($n=>Ut.nodeIds.includes($n.id));if(Qn.length===0)return Ut;const gn=30,Io=70;let Ar=1/0,tr=1/0,ta=-1/0,nr=-1/0;return Qn.forEach($n=>{Ar=Math.min(Ar,$n.position.x),tr=Math.min(tr,$n.position.y),ta=Math.max(ta,$n.position.x+$n.width);const Xa=$n.isCollapsed?40:$n.height;nr=Math.max(nr,$n.position.y+Xa)}),{...Ut,position:{x:Ar-gn,y:tr-Io},width:ta-Ar+gn*2,height:nr-tr+Io+gn}})),tt})},[L,ee]);x.useEffect(()=>{const Me=v[T];Me&&Me.id===I.current&&f($e=>$e.map((tt,ut)=>ut===T?{...tt,nodes:P,connections:Y,groups:Z,viewTransform:Te,nodeIdCounter:H.current}:tt))},[P,Y,Z,Te,T]),x.useEffect(()=>{const Me=v[T];Me&&Me.id!==I.current&&(L(Me.nodes),ge(Me.connections),ee(Me.groups||[]),pe(Me.viewTransform),H.current=Me.nodeIdCounter,I.current=Me.id)},[T,v]),xA(v,T);const je=x.useRef(he);x.useEffect(()=>{je.current=he},[he]);const{showDialog:Ue,requestPermission:Fe,declinePermission:ot}=Cw("clipboard-read"),{isQuickSearchOpen:at,isQuickAddOpen:rt,quickAddPosition:Ce,openQuickSearchMenu:ve,openQuickAddMenu:Ge,handleCloseAddNodeMenus:ce,isCatalogOpen:He,handleToggleCatalog:V,handleCloseCatalog:re,isRadialMenuOpen:ze,radialMenuPosition:ne,openRadialMenu:xe,isContextMenuOpen:_e,contextMenuPosition:Ie,openContextMenu:me,closeContextMenu:Ee,connectionMenu:Ae,setConnectionMenu:Ke,isContextMenuPinned:mt,toggleContextMenuPin:Nt,isQuickAddPinned:It,toggleQuickAddPin:kt}=ww(),xt=hA(P,Y,L),{currentCatalogItems:Dt,catalogPath:Mt,navigateCatalogBack:hn,navigateCatalogToFolder:an,createCatalogItem:we,saveGroupToCatalog:Ve,saveGenericItemToCatalog:qe,renameCatalogItem:it,deleteCatalogItem:lt,saveCatalogItemToDisk:Lt,catalogFileInputRef:Nn,handleCatalogFileChange:Ot,triggerLoadFromFile:se,moveCatalogItem:De,catalogItems:Re,activeCategory:Je,setActiveCategory:st,importCatalog:nt}=_w(t),{libraryItems:St,currentLibraryItems:Ft,currentPath:zt,navigateBack:de,navigateToFolder:ke,createLibraryItem:Ne,updateLibraryItem:Qe,deleteLibraryItem:ct,saveLibraryItemToDisk:Gt,libraryFileInputRef:Vt,handleLibraryFileChange:cn,triggerLoadLibraryFromFile:Vn,moveLibraryItem:xn,importLibrary:vn}=Sw(t),[io,Do]=x.useState(0),Nr=x.useCallback(()=>Do(Me=>Me+1),[]),[er,Va]=x.useState(null),[$a,dt]=x.useState(null),et=x.useRef(null),{renameInfo:$t,setRenameInfo:sn,promptEditInfo:_t,setPromptEditInfo:xo,confirmInfo:Wa,setConfirmInfo:kr,isErrorCopied:Qr,handleCopyError:Ya,handleRenameGroup:Bl,handleRenameCatalogItem:Vl,confirmRename:$l,confirmPromptEdit:Wl,handleDeleteCatalogItem:Yl,handleDeleteLibraryItem:ql,handleClearCanvas:Kl,toasts:Jl,addToast:Zn,removeToast:Xl}=Tw({t,setGroups:ee,renameCatalogItem:it,updateLibraryItem:Qe,libraryItems:St,deleteLibraryItem:ct,setNodes:L,setConnections:ge,nodeIdCounter:H,geminiContext:xt,currentCatalogItems:Dt,deleteCatalogItem:lt,saveDataToCatalog:(Me,$e,tt)=>{var ut;return(ut=et.current)==null?void 0:ut.call(et,Me,$e,tt)}}),qa=x.useCallback((Me,$e="info")=>Zn(Me,$e),[Zn]),Ka=x.useCallback(()=>{L(Me=>Me.map($e=>$e.id==="node-24-1763746608198"?{...$e,title:t("app.title")}:{...$e,title:t(`node.title.${$e.type.toLowerCase()}`)}))},[t,L]),gt=x.useCallback((Me=!1)=>{const $e=()=>{const tt=hg;L(tt.nodes),ge(tt.connections),ee(tt.groups||[]),pe(tt.viewTransform),H.current=tt.nodeIdCounter,f(ut=>ut.map((Ut,Qn)=>Qn===T?{...Ut,...tt}:Ut)),setTimeout(Ka,0),Me||Zn(t("toast.resetComplete"),"success")};Me?$e():kr({title:t("dialog.reset.title"),message:t("dialog.reset.message"),onConfirm:$e})},[t,L,ge,ee,pe,H,Zn,Ka,T]),mn=x.useCallback(()=>{L([]),ge([]),ee([]),H.current=0,f(Me=>Me.map(($e,tt)=>tt===T?{...$e,nodes:[],connections:[],groups:[],nodeIdCounter:0}:$e))},[L,ge,ee,T]),en=x.useCallback((Me,$e)=>{const tt=P.find(ut=>ut.id===Me.toNodeId);if(tt&&tt.type===C.REROUTE_DOT){const ut=Ga($e,Me.fromHandleId);$(tt.id,JSON.stringify({type:ut}))}W(Me),tt&&(tt.type===C.SPEECH_SYNTHESIZER||tt.type===C.DATA_READER)&&setTimeout(()=>xt.handleReadData(tt.id),100)},[P,W,$,xt]),Ao=x.useCallback(Me=>{ee($e=>{const tt=$e.find(Ut=>Ut.nodeIds.includes(Me));if(!tt)return $e;const ut=tt.nodeIds.filter(Ut=>Ut!==Me);if(ut.length===0)return $e.filter(Ut=>Ut.id!==tt.id);{const Ut=P.filter(Io=>ut.includes(Io.id)),gn=((Io,Ar)=>{if(Ar.length===0)return Io;const tr=30,ta=70;let nr=1/0,$n=1/0,Xa=-1/0,Ql=-1/0;return Ar.forEach(Ir=>{nr=Math.min(nr,Ir.position.x),$n=Math.min($n,Ir.position.y),Xa=Math.max(Xa,Ir.position.x+Ir.width);const Ex=Ir.isCollapsed?40:Ir.height;Ql=Math.max(Ql,Ir.position.y+Ex)}),{...Io,position:{x:nr-tr,y:$n-ta},width:Xa-nr+tr*2,height:Ql-$n+ta+tr}})({...tt,nodeIds:ut},Ut);return $e.map(Io=>Io.id===gn.id?gn:Io)}})},[P,ee]),Ja=x.useCallback((Me,$e)=>{Ke({isOpen:!0,position:$e,sourceNodeId:Me.fromNodeId,sourceHandleId:Me.fromHandleId,fromType:Me.fromType})},[Ke]),{activeTool:ea,effectiveTool:Ku,setActiveTool:Ju,connectingInfo:Iy,connectionTarget:Py,hoveredNodeId:Ry,setHoveredNodeId:My,selectedNodeIds:Ki,setSelectedNodeIds:Zl,deselectAllNodes:Ly,handleNodeMouseDown:jy,handleGroupMouseDown:Dy,handleNodeResizeMouseDown:Oy,handleStartConnection:Fy,handleNodeClick:zy,hoveredGroupIdForDrop:Gy,handleCanvasMouseDown:Xu,selectionRect:Uy,draggingInfo:Zu,dollyZoomingInfo:Qu,handleNodeTouchStart:Hy,handleGroupTouchStart:By,handleNodeResizeTouchStart:Vy,handleStartConnectionTouchStart:$y,isAltDown:ep,extractionTarget:tp}=bw({nodes:P,setNodes:L,groups:Z,setGroups:ee,addConnection:en,connections:Y,setConnections:ge,viewTransform:Te,updatePointerPosition:Q,pan:q,isPanning:ue,startPanning:j,stopPanning:J,isSnapToGrid:n,onAddNode:U,removeConnectionsByNodeId:le,setZoom:oe,triggerClearSelections:Nr,t,clientPointerPosition:he,clientPointerPositionRef:je,isQuickAddOpen:rt,handleCloseAddNodeMenus:ce,handleExtractNodeFromGroup:Ao,openRadialMenu:xe,onConnectionReleased:Ja}),{onAddNode:Ji,handleAddNodeFromToolbar:Wy,deleteNodeAndConnections:np,handleSplitConnection:Yy,handleGroupSelection:op,handleRemoveGroup:qy,handleSaveGroupToCatalog:Ky,handleSaveGroupToDisk:Jy,handleCopyGroup:Xy,handleDuplicateGroup:Zy,handleAddGroupFromCatalog:Qy,handleApplyAliases:ex,handleDetachCharacter:tx,addCharacterCardFromFile:rp,addImagePreviewNodeFromFile:ap,handlePasteFromClipboard:ip,handleAddGroupFromTemplate:nx,handleDuplicateNode:sp,handleDuplicateNodeEmpty:lp,saveDataToCatalog:Xi}=Nw({nodes:P,connections:Y,groups:Z,addNodeFromHook:U,t,clientPointerPosition:he,clientPointerPositionRef:je,viewTransform:Te,setCreationLine:dt,setLastAddedNodeId:Va,handleDeleteNode:O,removeConnectionsByNodeId:le,addConnection:en,handleValueChange:$,nodeIdCounter:H,setNodes:L,setConnections:ge,addGroup:R,selectedNodeIds:Ki,setSelectedNodeIds:Zl,removeGroup:be,saveGroupToCatalog:Ve,catalogItems:Re,currentCatalogItems:Dt,handleCloseCatalog:re,geminiContext:xt,addToast:qa,setGroups:ee,handleDuplicateNode:ae,handleDuplicateNodeEmpty:F,saveGenericItemToCatalog:qe}),ox=x.useCallback(Me=>{if(!Ae)return;const $e={x:(Ae.position.x-Te.translate.x)/Te.scale,y:(Ae.position.y-Te.translate.y)/Te.scale},tt={x:$e.x-20,y:$e.y-20};let ut;Me===C.REROUTE_DOT&&Ae.fromType&&(ut=JSON.stringify({type:Ae.fromType}));const Ut=Ji(Me,tt,ut),Qn=P.find(gn=>gn.id===Ae.sourceNodeId);if(Qn){let gn;Me===C.SCRIPT_GENERATOR?gn="prompt":Me===C.SCRIPT_PROMPT_MODIFIER?gn="all-script-analyzer-data":Me===C.SCRIPT_ANALYZER&&(gn=void 0),en({fromNodeId:Ae.sourceNodeId,fromHandleId:Ae.sourceHandleId,toNodeId:Ut,toHandleId:gn},Qn)}Ke(null)},[Ae,Te,Ji,P,en,Ke]);x.useEffect(()=>{et.current=Xi},[Xi]);const cp=Me=>ep?Ao(Me):Le(Me),dp=x.useCallback(()=>{try{const $e=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),tt={type:"script-modifier-project",timestamp:Date.now(),appState:{activeTabIndex:T,isSnapToGrid:n,lineStyle:a},tabs:v,catalog:Re,library:St},ut=JSON.stringify(tt,null,2),Ut=new Blob([ut],{type:"application/json"}),Qn=URL.createObjectURL(Ut),gn=document.createElement("a");gn.href=Qn,gn.download=`Script_Modifier_Project_${$e}.json`,document.body.appendChild(gn),gn.click(),document.body.removeChild(gn),URL.revokeObjectURL(Qn),Zn(t("toast.projectSaved"),"success")}catch(Me){console.error("Failed to save project:",Me),Zn(t("toast.saveFailed")||"Failed to save project","info")}},[T,n,a,v,Re,St,Zn,t]),Zi=x.useCallback(Me=>{if(Me.type!=="script-modifier-project"){Zn(t("alert.loadProjectFailed")||"Invalid project file format","info");return}kr({title:"Load Project",message:t("alert.confirmLoadProject"),onConfirm:()=>{var $e;if(Me.appState&&(typeof Me.appState.activeTabIndex=="number"&&A(Me.appState.activeTabIndex),typeof Me.appState.isSnapToGrid=="boolean"&&r(Me.appState.isSnapToGrid),Me.appState.lineStyle&&i(Me.appState.lineStyle)),Array.isArray(Me.tabs)){f(Me.tabs),I.current=null;const tt=(($e=Me.appState)==null?void 0:$e.activeTabIndex)||0,ut=Me.tabs[tt]||Me.tabs[0];ut&&(L(ut.nodes),ge(ut.connections),ee(ut.groups||[]),pe(ut.viewTransform),H.current=ut.nodeIdCounter,I.current=ut.id)}Me.catalog&&nt(Me.catalog),Me.library&&vn(Me.library),Zn(t("toast.projectLoaded"),"success")}})},[t,Zn,nt,vn,L,ge,ee,pe,H]),Qi=x.useRef(null);x.useEffect(()=>{Qi.current=Zi},[Zi]);const{fileInputRef:rx,handleSaveCanvas:ax,handleLoadCanvas:ix,handleFileChange:up,loadStateFromFileContent:sx}=xw({nodes:P,connections:Y,groups:Z,viewTransform:Te,nodeIdCounter:H,setNodes:L,setConnections:ge,setGroups:ee,setViewTransform:pe,activeTabName:((pp=v[T])==null?void 0:pp.name)||"default",onLoadProject:Me=>{var $e;return($e=Qi.current)==null?void 0:$e.call(Qi,Me)},addToast:Zn,setGlobalError:xt.setError}),lx=x.useCallback(Me=>{var tt;const $e=(tt=Me.target.files)==null?void 0:tt[0];if($e){const ut=/^Script-Modifier-(.+)-\d{4}-\d{2}-\d{2}_\d{2}-\d{2}-\d{2}\.json$/,Ut=$e.name.match(ut);if(Ut&&Ut[1]){const Qn=Ut[1].replace(/_/g," ");E(T,Qn)}}up(Me)},[up,E,T]),{isDraggingOverCanvas:cx,handleCanvasDoubleClick:dx,handleDrop:ux,handleDragOver:px,handleDragLeave:hx}=Ew({isQuickSearchOpen:at,handleToggleCatalog:V,openQuickSearchMenu:ve,openQuickAddMenu:Ge,clientPointerPosition:he,clientPointerPositionRef:je,onAddNode:Ji,handleCloseAddNodeMenus:ce,loadStateFromFileContent:sx,activeTool:ea,setActiveTool:Ju,isSnapToGrid:n,setIsSnapToGrid:r,lineStyle:a,setLineStyle:i,selectedNodeIds:Ki,copyNodeValue:D,geminiContext:xt,addCharacterCardFromFile:rp,addImagePreviewNodeFromFile:ap,viewTransform:Te,nodes:P,handlePasteFromClipboard:ip,handleAddGroupFromTemplate:nx,catalogItems:Re,handleToggleNodeCollapse:Le,handleNodeDoubleClick:cp,deleteNodeAndConnections:np,setSelectedNodeIds:Zl,handleGroupSelection:op,handleDuplicateNode:sp,handleDuplicateNodeEmpty:lp,t,contextMenuSlots:s,handleValueChange:$,handleSaveProject:dp,handleLoadProject:Zi,addToast:qa}),{connectedInputs:mx,groupButtonPosition:gx,getCanvasCursor:fx,getConnectionPoints:yx,selectionRect:xx}=kw({nodes:P,connections:Y,selectedNodeIds:Ki,dollyZoomingInfo:Qu,draggingInfo:Zu,effectiveTool:Ku,isPanning:ue,t,selectionRect:Uy}),vx=x.useCallback(Me=>{_e&&!mt&&Ee(),Me.button!==2&&Xu(Me)},[_e,mt,Ee,Xu]),bx=x.useCallback(Me=>{Me.preventDefault(),me({x:Me.clientX,y:Me.clientY})},[me]),wx=x.useCallback((Me,$e)=>{sn({type:"node",id:Me,currentTitle:$e})},[sn]),_x=Me=>{console.log("Save character card",Me)},Cx=Me=>{console.log("Load character card",Me)},Sx=Me=>{Xi(Me,Ze.CHARACTERS,"Character")},Tx={tabs:v,activeTabIndex:T,switchTab:M,addTab:N,closeTab:k,renameTab:E,nodes:P,setNodes:L,connections:Y,groups:Z,viewTransform:Te,setViewTransform:pe,isSnapToGrid:n,setIsSnapToGrid:r,lineStyle:a,setLineStyle:i,setZoom:oe,isQuickSearchOpen:at,isQuickAddOpen:rt,quickAddPosition:Ce,isRadialMenuOpen:ze,radialMenuPosition:ne,isContextMenuOpen:_e,contextMenuPosition:Ie,isCatalogOpen:He,isErrorCopied:Qr,renameInfo:$t,promptEditInfo:_t,confirmInfo:Wa,isDraggingOverCanvas:cx||!!tp,showDialog:Ue,activeTool:ea,effectiveTool:Ku,connectingInfo:Iy,connectionTarget:Py,hoveredNodeId:Ry,selectedNodeIds:Ki,setSelectedNodeIds:Zl,selectionRect:xx,groupButtonPosition:gx,draggingInfo:Zu,dollyZoomingInfo:Qu,hoveredGroupIdForDrop:Gy,dragOverNodeId:null,isAltDown:ep,extractionTarget:tp,currentCatalogItems:Dt,catalogPath:Mt,currentLibraryItems:Ft,libraryPath:zt,libraryItems:St,activeCategory:Je,setActiveCategory:st,fileInputRef:rx,catalogFileInputRef:Nn,libraryFileInputRef:Vt,handleFileChange:lx,handleCatalogFileChange:Ot,handleLibraryFileChange:cn,handleCanvasMouseDown:vx,handleCanvasContextMenu:bx,updatePointerPosition:Q,pointerPosition:Oe,clientPointerPosition:he,handleWheel:ye,handleCanvasDoubleClick:dx,handleDrop:ux,handleDragOver:px,handleDragLeave:hx,getCanvasCursor:fx,getConnectionPoints:yx,handleCanvasTouchStart:B,handleCanvasTouchMove:fe,handleCanvasTouchEnd:ie,handleNodeMouseDown:jy,handleNodeTouchStart:Hy,handleNodeResizeMouseDown:Oy,handleNodeResizeTouchStart:Vy,handleStartConnection:Fy,handleStartConnectionTouchStart:$y,setHoveredNodeId:My,deleteNodeAndConnections:np,removeConnectionsByNodeId:le,copyNodeValue:D,pasteNodeValue:z,handleDuplicateNode:sp,handleDuplicateNodeEmpty:lp,handleToggleNodeCollapse:Le,deselectAllNodes:Ly,handleNodeClick:zy,handleNodeDoubleClick:cp,handleGroupMouseDown:Dy,handleGroupTouchStart:By,handleGroupSelection:op,handleRenameGroup:Bl,handleRemoveGroup:qy,handleSaveGroupToCatalog:Ky,handleSaveGroupToDisk:Jy,removeConnectionById:X,handleSplitConnection:Yy,handleCloseAddNodeMenus:ce,setActiveTool:Ju,onAddNode:Ji,handleAddNodeFromToolbar:Wy,handleSaveCanvas:ax,handleLoadCanvas:ix,openQuickSearchMenu:ve,openQuickAddMenu:Ge,openRadialMenu:xe,onOpenCatalog:V,handleClearCanvas:Kl,handleResetToDefault:gt,handleCloseCatalog:re,confirmRename:$l,confirmPromptEdit:Wl,setRenameInfo:sn,setPromptEditInfo:xo,setConfirmInfo:kr,handleCopyError:Ya,requestPermission:Fe,declinePermission:ot,navigateCatalogBack:hn,navigateCatalogToFolder:an,createCatalogItem:we,handleAddGroupFromCatalog:Qy,handleRenameCatalogItem:Vl,saveCatalogItemToDisk:Lt,handleDeleteCatalogItem:Yl,triggerLoadFromFile:se,moveCatalogItem:De,importCatalog:nt,importLibrary:vn,navigateBack:de,navigateToFolder:ke,createLibraryItem:Ne,updateLibraryItem:Qe,deleteLibraryItem:Me=>ql(Me),saveLibraryItemToDisk:Gt,triggerLoadLibraryFromFile:Vn,moveLibraryItem:xn,handleValueChange:$,connectedInputs:mx,t,lastAddedNodeId:er,creationLine:$a,clearSelectionsSignal:io,...xt,handleGenerateEntities:xt.handleGenerateEntities,isGeneratingEntities:xt.isGeneratingEntities,onAnalyzeYouTubeStats:xt.handleAnalyzeYouTubeStats,handleApplyAliases:ex,handleDetachCharacter:tx,addCharacterCardFromFile:rp,addImagePreviewNodeFromFile:ap,handlePasteFromClipboard:ip,toasts:Jl,addToast:qa,removeToast:Xl,setIsSettingsOpen:()=>{},contextMenuSlots:s,setContextMenuSlot:b,saveDataToCatalog:Xi,connectionMenu:Ae,setConnectionMenu:Ke,handleAddNodeFromConnectionMenu:ox,handleRenameNode:wx,handleSaveProject:dp,handleLoadProject:Zi,closeContextMenu:Ee,openContextMenu:me,isContextMenuPinned:mt,toggleContextMenuPin:Nt,isQuickAddPinned:It,toggleQuickAddPin:kt,handleCopyGroup:Xy,handleDuplicateGroup:Zy,translateGraph:Ka,clearCanvasData:mn,handleToggleNodeOutputVisibility:K,setFullSizeImage:g,getFullSizeImage:m,setImageViewer:h,imageViewerState:d,onCopyImageToClipboard:w,onDownloadImage:y,onSaveCharacterCard:_x,onLoadCharacterCard:Cx,onSaveCharacterToCatalog:Sx,handleGenerateMusicIdeas:xt.handleGenerateMusicIdeas,isGeneratingMusicIdeas:xt.isGeneratingMusicIdeas,handleExtractTextFromImage:xt.handleExtractTextFromImage,isExtractingText:xt.isExtractingText,isAnalyzingYouTubeStats:xt.isAnalyzingYouTubeStats};return o.jsx(Ny.Provider,{value:Tx,children:e})},Qo=()=>{const e=x.useContext(Ny);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e},_A=({node:e,onValueChange:t,onAnalyzeCharacter:n,isAnalyzingCharacter:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l})=>{const c=x.useMemo(()=>{try{const m=JSON.parse(e.value||"{}");return{character:m.character||"",clothing:m.clothing||""}}catch{return{character:"",clothing:""}}},[e.value]),{character:d="",clothing:h=""}=c,g=(m,w)=>{t(e.id,JSON.stringify({...c,[m]:w}))};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",onWheel:m=>m.stopPropagation(),children:[o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:s("node.content.character")}),o.jsx("textarea",{value:d,onChange:m=>g("character",m.target.value),placeholder:s("node.content.characterPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onMouseDown:m=>m.stopPropagation(),onFocus:l})]}),o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:s("node.content.clothing")}),o.jsx("textarea",{value:h,onChange:m=>g("clothing",m.target.value),placeholder:s("node.content.clothingPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onMouseDown:m=>m.stopPropagation(),onFocus:l})]})]}),o.jsx("button",{onClick:r?i:()=>n(e.id),disabled:a,className:`w-full px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 ${a?"bg-yellow-600":r?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700"}`,children:s(a?"node.action.stopping":r?"node.action.stop":"node.content.analyzePrompt")})]})},mg=(e,t,n)=>new Promise((r,a)=>{const i=new Image;i.onload=()=>{const s=document.createElement("canvas");let l=i.width,c=i.height;l>c?l>t&&(c*=t/l,l=t):c>n&&(l*=n/c,c=n),s.width=l,s.height=c;const d=s.getContext("2d");if(d){d.drawImage(i,0,0,l,c);const h=s.toDataURL("image/jpeg",.8);r(h.split(",")[1])}else a(new Error("Failed to get canvas context"))},i.onerror=a,i.src=e.startsWith("data:")?e:`data:image/png;base64,${e}`}),CA=({isOpen:e,onClose:t,onApply:n,imageSrc:r})=>e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg text-white",children:[o.jsx("h3",{className:"text-xl mb-4",children:"Simple Editor"}),r&&o.jsx("img",{src:r.startsWith("data:")?r:`data:image/png;base64,${r}`,alt:"Edit",className:"max-w-md max-h-96 object-contain mb-4"}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-700 rounded hover:bg-gray-600",children:"Close"}),o.jsx("button",{onClick:()=>{r&&n(r.startsWith("data:")?r.split(",")[1]:r),t()},className:"px-4 py-2 bg-emerald-600 rounded hover:bg-emerald-700",children:"Apply (No Op)"})]})]})}):null,ht=({title:e,children:t,position:n="bottom",className:r="",contentClassName:a=""})=>{const[i,s]=x.useState(!1),[l,c]=x.useState({top:0,left:0}),d=x.useRef(null),h=()=>{if(d.current&&i){const m=d.current.getBoundingClientRect(),w=6;let y=0,b=0;switch(n){case"top":y=m.top-w,b=m.left+m.width/2;break;case"bottom":y=m.bottom+w,b=m.left+m.width/2;break;case"left":y=m.top+m.height/2,b=m.left-w;break;case"right":y=m.top+m.height/2,b=m.right+w;break}c({top:y,left:b})}};x.useLayoutEffect(()=>{if(i)return h(),window.addEventListener("scroll",h,!0),window.addEventListener("resize",h),()=>{window.removeEventListener("scroll",h,!0),window.removeEventListener("resize",h)}},[i,n]);const g={top:"-translate-x-1/2 -translate-y-full",bottom:"-translate-x-1/2",left:"-translate-x-full -translate-y-1/2",right:"-translate-y-1/2"};return e?o.jsxs("div",{ref:d,className:`relative flex items-center justify-center ${r}`,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onMouseDown:()=>s(!1),children:[t,i&&Yi.createPortal(o.jsx("div",{className:`fixed z-[9999] px-2 py-1 bg-gray-900 text-gray-200 text-xs font-medium rounded shadow-xl pointer-events-none transition-opacity duration-200 ${g[n]} ${a||"whitespace-nowrap"}`,style:{top:l.top,left:l.left,isolation:"isolate"},role:"tooltip",children:e}),document.body)]}):o.jsx("div",{className:`relative flex items-center justify-center ${r}`,children:t})},Pe=({title:e,onClick:t,children:n,tooltipPosition:r="top",disabled:a=!1,className:i=""})=>o.jsx(ht,{title:a?"":e,position:r,children:o.jsx("button",{onClick:t,disabled:a,onMouseDown:s=>s.stopPropagation(),"aria-label":e,className:`p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none disabled:text-gray-600 disabled:bg-transparent disabled:cursor-not-allowed flex items-center justify-center ${i}`,children:n})}),Ur=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})}),SA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),TA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),EA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),NA=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),kA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),AA=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3v1.5M3 21v-6m0 0l2-2m-2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3"})]}),IA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),PA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),RA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),MA=({value:e,onChange:t,placeholder:n,className:r,onFocus:a})=>{const i=s=>{const l=parseInt(e.replace(/[^0-9]/g,""),10)||0,c=Math.max(1,l+s);t(`Entity-${c}`)};return o.jsxs("div",{className:`flex items-center bg-gray-700 rounded-md border border-gray-600 h-[32px] overflow-hidden group hover:border-gray-500 transition-colors ${r}`,children:[o.jsx("input",{type:"text",value:e,readOnly:!0,placeholder:n,onFocus:a,className:"w-full h-full bg-transparent text-sm text-gray-300 px-2 focus:outline-none border-none min-w-0 cursor-default select-none",onMouseDown:s=>s.stopPropagation()}),o.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800",children:[o.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-emerald-600 text-gray-400 hover:text-white transition-colors",onClick:s=>{s.stopPropagation(),i(1)},children:o.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),o.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-emerald-600 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:s=>{s.stopPropagation(),i(-1)},children:o.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},LA=({fullDescription:e,onDescriptionChange:t,t:n,onFocus:r})=>{const[a,i]=x.useState({});x.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let g,m=!1;for(;(g=h.exec(e))!==null;){m=!0;const w=g[1].trim().toLowerCase(),y=d[w],b=g[2].trim();y&&(c[y]=b)}!m&&e.trim()&&(c.Appearance=e.trim()),i(c)},[e]);const s=(c,d)=>{const h={...a,[c]:d};i(h);const g=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(g)},l={Appearance:{icon:o.jsx(NA,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Personality:{icon:o.jsx(kA,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Clothing:{icon:o.jsx(AA,{className:"h-3.5 w-3.5"}),color:"text-gray-400"}};return o.jsx("div",{className:"space-y-4 p-4 pb-2 text-sm flex flex-col pr-1 overflow-x-hidden",children:["Appearance","Personality","Clothing"].map(c=>{const d=l[c];return o.jsxs("div",{className:"flex-shrink-0 flex flex-col items-start w-full",children:[o.jsxs("div",{className:"flex flex-row items-center justify-between mb-1.5 w-full",children:[o.jsxs("div",{className:"flex flex-row items-center gap-1.5",children:[o.jsx("span",{className:"text-gray-400",children:d.icon}),o.jsx("h5",{className:`font-bold ${d.color} text-[11px] uppercase tracking-wider flex-shrink-0`,children:n(`node.content.${c.toLowerCase()}`)||c})]}),o.jsx(Pe,{title:n("node.action.copy"),onClick:h=>{h.stopPropagation(),navigator.clipboard.writeText(a[c]||"")},className:"p-1 text-gray-500 hover:text-emerald-400 transition-colors",tooltipPosition:"left",children:o.jsx(Ur,{className:"h-3 w-3"})})]}),o.jsx("textarea",{value:a[c]||"",onChange:h=>s(c,h.target.value),className:"w-full text-sm p-2 bg-gray-900/60 border border-gray-700 rounded-md resize-y focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar min-h-[60px] transition-colors hover:bg-gray-800/80 text-gray-200 text-left",onWheel:h=>h.stopPropagation(),onKeyDown:h=>h.stopPropagation(),onFocus:r})]},c)})})},jA=380,DA=({char:e,index:t,nodeId:n,isDragging:r,isDuplicate:a,t:i,onUpdate:s,onRemove:l,onSetOutput:c,onDragStart:d,onGenerateImage:h,isGeneratingImage:g,onSyncFromConnection:m,onCopyImageToClipboard:w,onDetach:y,onSaveCharacter:b,onLoadCharacter:S,onSaveToCatalog:_,onCopyCard:v,onPasteToCard:f,onOpenInEditor:T,onOpenInRasterEditor:A,onRatioChange:I,onCrop1x1:M,onRatioExpand:N,onPasteImageToSlot:k,onClearImage:E,onViewImage:P,onUploadImage:L,onImageDrop:H,transformingRatio:$,deselectAllNodes:U,isModifying:O,isUpdatingDescription:D,onModifyRequest:z,onUpdateDescriptionRequest:G,secondaryLanguage:F})=>{const[K,ae]=x.useState(!1),[Y,ge]=x.useState("");x.useRef(null);const W=!!(e.thumbnails[e.selectedRatio]||e.image),le=X=>{X.dataTransfer.types.includes("application/prompt-modifier-card")&&X.preventDefault()};return o.jsxs("div",{className:"flex flex-col h-full border border-gray-700/50 rounded-xl bg-gray-800/40 p-2.5 overflow-hidden shadow-xl hover:border-gray-600 transition-colors flex-shrink-0",style:{width:`${jA}px`,opacity:r?.4:1,transform:r?"scale(0.95)":"none"},onDragOver:le,children:[o.jsxs("div",{className:"h-8 bg-gray-900/60 rounded-t-lg border-b border-gray-700/50 flex items-center px-3 cursor-grab active:cursor-grabbing hover:bg-gray-800 transition-colors mb-2 group/handle relative flex-shrink-0 gap-2",draggable:!0,onDragStart:d,onMouseDown:X=>X.stopPropagation(),children:[o.jsx("div",{className:"flex items-center gap-1 overflow-hidden flex-grow",children:o.jsxs("span",{className:"text-xs font-bold truncate",children:[o.jsxs("span",{className:"text-emerald-400",children:[e.index||"ENT",":"]})," ",o.jsx("span",{className:"text-gray-200 ml-1",children:e.name||"Unnamed"}),o.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50",children:["#",e.id]})]})}),o.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[o.jsx(ht,{title:i("node.action.markPrimary"),children:o.jsx("button",{onClick:X=>{X.stopPropagation(),c()},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.isOutput?"text-emerald-400":"text-gray-500 hover:text-gray-300"}`,onMouseDown:X=>X.stopPropagation(),children:e.isOutput?o.jsx(RA,{className:"h-4 w-4"}):o.jsx(PA,{className:"h-4 w-4"})})}),o.jsx(ht,{title:i("node.action.deleteItem"),children:o.jsx("button",{onClick:X=>{X.stopPropagation(),l()},className:"p-0.5 rounded hover:bg-red-900/50 text-gray-500 hover:text-red-400 transition-colors",onMouseDown:X=>X.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2.5,strokeLinecap:"round"})})})})]})]}),o.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center mb-2 h-[32px]",children:[o.jsx("input",{type:"text",value:e.name,onChange:X=>s({name:X.target.value}),placeholder:i("node.content.character"),className:"flex-grow min-w-0 px-2 bg-gray-700 border border-gray-600 rounded-md text-sm text-white focus:ring-1 focus:ring-emerald-500 outline-none h-[32px] transition-colors hover:border-gray-500",onMouseDown:X=>X.stopPropagation(),onFocus:U}),o.jsx(MA,{value:e.index,onChange:X=>s({index:X}),placeholder:"Index",onFocus:U,className:`w-28 shrink-0 ${a?"!border-red-500 !ring-1 !ring-red-500":""}`})]}),o.jsxs("div",{className:"flex flex-col flex-shrink-0 mb-1",children:[o.jsxs("div",{className:"flex items-end justify-between pr-2 h-7 z-0 cursor-pointer hover:bg-gray-700/30 transition-colors rounded-t-md select-none",onClick:X=>{X.stopPropagation(),s({isImageCollapsed:!e.isImageCollapsed})},children:[o.jsx("div",{className:"flex items-end pl-2 gap-1 h-full",children:["1:1","16:9","9:16"].map(X=>o.jsx("button",{onClick:Te=>{Te.stopPropagation(),I(X)},onDragEnter:Te=>{Te.stopPropagation(),I(X)},className:`px-3 py-1 text-[10px] font-bold outline-none transition-colors rounded-t-md ${e.selectedRatio===X?"bg-gray-700/80 text-emerald-400 h-full shadow-inner":"bg-gray-700/40 text-gray-500 h-[80%] hover:bg-gray-700/60"}`,children:X},X))}),o.jsx("button",{className:"p-1 mb-0.5 text-gray-500 hover:text-emerald-400 transition-colors",title:e.isImageCollapsed?"Show Image":"Hide Image",children:e.isImageCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isImageCollapsed&&o.jsx("div",{onClick:X=>{X.stopPropagation(),W?P():L()},onDragEnter:X=>{X.dataTransfer.types.includes("application/prompt-modifier-card")||(X.preventDefault(),X.stopPropagation(),ae(!0))},onDragOver:X=>{X.dataTransfer.types.includes("application/prompt-modifier-card")||(X.preventDefault(),X.stopPropagation(),ae(!0))},style:{cursor:W?"zoom-in":"pointer"},className:`flex-shrink-0 h-[256px] bg-gray-700/50 rounded-xl flex items-center justify-center transition-all group relative overflow-hidden z-10 hover:z-20 hover:bg-gray-600/70 ${K?"border-2 border-emerald-500 ring-2 ring-emerald-500/20":""}`,onDragLeave:()=>ae(!1),onDrop:X=>{X.dataTransfer.types.includes("application/prompt-modifier-card")||(X.preventDefault(),X.stopPropagation(),ae(!1),H(X))},children:e.thumbnails[e.selectedRatio]||e.image?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:`data:image/png;base64,${e.thumbnails[e.selectedRatio]||e.image}`,className:"object-contain w-full h-full",style:{imageRendering:"auto"},draggable:!0,onDragStart:X=>{var pe;const Te=((pe=e.imageSources)==null?void 0:pe[e.selectedRatio])||e.image;Te&&(X.dataTransfer.setData("application/prompt-modifier-drag-image",Te),X.stopPropagation())}}),o.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[o.jsx(Pe,{title:i("node.action.paste"),onClick:X=>{X.stopPropagation(),k()},className:"bg-black/60 p-1.5 rounded text-emerald-400 hover:text-white",tooltipPosition:"left",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),o.jsx(Pe,{title:i("node.action.copy"),onClick:X=>{var pe;X.stopPropagation();const Te=((pe=e.imageSources)==null?void 0:pe[e.selectedRatio])||e.image;Te&&w(Te)},className:"bg-black/60 p-1.5 rounded text-emerald-400 hover:text-white",tooltipPosition:"left",children:o.jsx(Ur,{className:"h-4 w-4"})}),o.jsx(Pe,{title:i("node.action.clear"),onClick:X=>{X.stopPropagation(),E()},className:"bg-black/60 p-1.5 rounded text-red-400 hover:text-white",tooltipPosition:"left",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2,strokeLinecap:"round"})})})]})]}):o.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),o.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold text-center px-4 leading-tight",children:i("node.content.imagePromptPlaceholder")}),o.jsxs("button",{onClick:X=>{X.stopPropagation(),k()},className:"mt-2 px-3 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white text-xs font-bold rounded border border-gray-600 transition-colors flex items-center gap-1.5",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),i("node.action.paste")]})]})}),!e.isImageCollapsed&&o.jsx("div",{className:"h-4"})]}),o.jsx("div",{className:"flex gap-1 flex-shrink-0 mb-2 items-center px-1",children:o.jsxs("button",{onClick:X=>{X.stopPropagation(),h()},disabled:!!g||!e.prompt,className:`flex-grow h-8 font-bold rounded text-[10px] uppercase transition-all shadow-sm flex items-center justify-center gap-2
                            ${g?"bg-gray-600 text-gray-300 cursor-not-allowed opacity-75":"bg-emerald-600 hover:bg-emerald-500 text-white"}
                            disabled:opacity-50 disabled:cursor-not-allowed`,children:[g&&o.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i(g?"node.content.generating":"node.content.generateImage")]})}),o.jsxs("div",{className:"flex flex-col gap-1 mb-2 shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-gray-400",children:o.jsx(IA,{className:"h-3 w-3"})}),o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:i("node.content.prompt")})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx(Pe,{title:i("node.action.sync"),onClick:m,tooltipPosition:"left",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx(Pe,{title:i("node.action.copy"),onClick:()=>navigator.clipboard.writeText(e.prompt),tooltipPosition:"left",children:o.jsx(Ur,{className:"h-3 w-3"})})]})]}),o.jsx("textarea",{value:e.prompt,onChange:X=>s({prompt:X.target.value}),className:"w-full p-2 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-200 resize-y focus:border-emerald-500 outline-none min-h-[60px] max-h-[120px] custom-scrollbar",onMouseDown:X=>X.stopPropagation(),onFocus:U})]}),o.jsxs("div",{className:"flex flex-col gap-1 mb-2 shrink-0",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:"Suffix"}),o.jsx("input",{type:"text",value:e.additionalPrompt||"",onChange:X=>s({additionalPrompt:X.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-emerald-500 outline-none",onMouseDown:X=>X.stopPropagation(),onFocus:U})]}),o.jsxs("div",{className:"flex flex-col gap-1 border-b border-gray-700/50 pb-3 mb-2 flex-shrink-0",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:i("node.content.modificationPromptPlaceholder")}),o.jsxs("div",{className:"flex gap-2 h-[32px]",children:[o.jsx("input",{value:Y,onChange:X=>ge(X.target.value),placeholder:"...",className:"flex-grow bg-gray-900/60 border border-gray-700 rounded px-2 text-xs text-white focus:border-emerald-500 outline-none h-full",onMouseDown:X=>X.stopPropagation(),onFocus:U}),o.jsx("div",{className:"flex items-center bg-gray-700 rounded p-0.5 h-full space-x-0.5 justify-center min-w-[50px]",children:[{code:"en",label:"EN"},{code:F,label:F.toUpperCase()}].map((X,Te)=>o.jsx("button",{onClick:pe=>{pe.stopPropagation(),s({targetLanguage:X.code})},className:`h-full flex-1 rounded px-1.5 text-[10px] font-bold transition-colors flex items-center justify-center ${e.targetLanguage===X.code?"bg-emerald-600 text-white":"text-gray-400 hover:text-gray-200"}`,children:X.label},X.code+Te))}),o.jsxs("div",{className:"flex gap-1 h-full",children:[o.jsx(ht,{title:"Modify",children:o.jsx("button",{onClick:X=>{X.stopPropagation(),z(Y),ge("")},disabled:!Y.trim()||O,className:"w-8 bg-emerald-600 hover:bg-emerald-500 text-white rounded flex items-center justify-center disabled:opacity-50 h-full",children:O?o.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})}),o.jsx(ht,{title:"Update Desc",children:o.jsx("button",{onClick:X=>{X.stopPropagation(),G()},disabled:D||!e.prompt,className:"w-8 bg-cyan-600 hover:bg-cyan-500 text-white rounded flex items-center justify-center disabled:opacity-50 h-full transition-colors",children:D?o.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})]})]})]}),o.jsxs("div",{className:"flex-grow min-h-0 mt-2 relative p-0 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden flex flex-col overflow-x-hidden",children:[o.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none flex-shrink-0",onClick:()=>s({isDescriptionCollapsed:!e.isDescriptionCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:`transform transition-transform duration-200 ${e.isDescriptionCollapsed?"-rotate-90":""}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),o.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:i("node.content.fullDescription")})]}),o.jsx("div",{className:"flex gap-1",children:o.jsx(Pe,{title:i("node.action.copy"),onClick:X=>{X.stopPropagation(),navigator.clipboard.writeText(e.fullDescription)},className:"p-1 text-gray-500 hover:text-emerald-400 transition-colors",tooltipPosition:"left",children:o.jsx(Ur,{className:"h-3 w-3"})})})]}),!e.isDescriptionCollapsed&&o.jsx("div",{className:"overflow-y-auto custom-scrollbar flex-grow overflow-x-hidden",onWheel:X=>X.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},children:o.jsx(LA,{fullDescription:e.fullDescription||"",onDescriptionChange:X=>s({fullDescription:X}),t:i,onFocus:U})})]}),o.jsxs("div",{className:"flex gap-1.5 pt-2.5 mt-auto border-t border-gray-700/50 flex-shrink-0 bg-gray-800/20 backdrop-blur-sm",children:[o.jsx("button",{onClick:X=>{X.stopPropagation(),S()},className:"flex-1 h-9 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:i("node.action.loadCharacter")}),o.jsx("button",{onClick:X=>{X.stopPropagation(),b()},className:"flex-1 h-9 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:i("node.action.saveCharacter")}),o.jsxs("div",{className:"flex gap-1.5 ml-auto",children:[o.jsx(Pe,{title:i("group.saveToCatalog"),onClick:X=>{X.stopPropagation(),_()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Pe,{title:i("node.action.copy"),onClick:X=>{X.stopPropagation(),v()},children:o.jsx(Ur,{className:"h-4 w-4"})}),o.jsx(Pe,{title:i("node.action.paste"),onClick:X=>{X.stopPropagation(),f()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),o.jsx(Pe,{title:"Detach",onClick:X=>{X.stopPropagation(),y()},children:o.jsx(SA,{className:"h-4 w-4"})})]})]})]})},OA=({node:e,onValueChange:t,onSaveCharacterCard:n,onLoadCharacterCard:r,t:a,deselectAllNodes:i,onSaveCharacterToCatalog:s,setFullSizeImage:l,getFullSizeImage:c,setImageViewer:d,onCopyImageToClipboard:h,onDownloadImage:g,addToast:m,onUpdateCharacterDescription:w,isUpdatingDescription:y,onModifyCharacter:b,isModifyingCharacter:S,getUpstreamNodeValues:_,connectedInputs:v,onDetachCharacter:f,onGenerateImage:T,isGeneratingImage:A,isGeneratingCharacterImage:I,onAddNode:M,onDeleteNode:N})=>{const k=Qo(),{setNodes:E}=k||{};M||(k==null||k.onAddNode);const P=e.id,L=x.useRef(null),[H,$]=x.useState(!1),[U,O]=x.useState(!1),[D,z]=x.useState(null),[G,F]=x.useState(0),[K,ae]=x.useState(null),[Y,ge]=x.useState(null),[W,le]=x.useState(null),[X,Te]=x.useState(null),[pe,ue]=x.useState(null),{language:Oe}=Bt(),he=Oe==="en"?"ru":Oe;v==null||v.has(void 0);const ye=x.useMemo(()=>{try{let Ce=JSON.parse(e.value||"[]");return Array.isArray(Ce)||(typeof Ce=="object"&&Ce!==null?Ce=[Ce]:Ce=[]),Ce.length===0&&(Ce=[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]),Ce.map((ve,Ge)=>({id:ve.id||`char-card-${Date.now()}-${Ge}`,name:ve.name||"",index:ve.index||ve.alias||`Entity-${Ge+1}`,image:ve.image||null,thumbnails:ve.thumbnails||ve.imageSources||{"1:1":null,"16:9":null,"9:16":null},selectedRatio:ve.selectedRatio||"1:1",prompt:ve.prompt||"",additionalPrompt:ve.additionalPrompt!==void 0?ve.additionalPrompt:"Full body character concept on a gray background",fullDescription:ve.fullDescription||"",targetLanguage:ve.targetLanguage||"en",isOutput:ve.isOutput||Ge===0&&!Ce.some(ce=>ce.isOutput),isDescriptionCollapsed:ve.isDescriptionCollapsed??!1,isImageCollapsed:ve.isImageCollapsed??!1}))}catch{return[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]}},[e.value]),j=x.useMemo(()=>{const Ce={};ye.forEach(Ge=>{const ce=(Ge.index||"").trim();Ce[ce]=(Ce[ce]||0)+1});const ve=new Set;return Object.entries(Ce).forEach(([Ge,ce])=>{ce>1&&Ge!==""&&ve.add(Ge)}),ve},[ye]),q=x.useCallback(Ce=>{t(e.id,JSON.stringify(Ce))},[e.id,t]),Q=x.useCallback((Ce,ve)=>{const Ge=[...ye];Ge[Ce]={...Ge[Ce],...ve},q(Ge)},[ye,q]),J=Ce=>{const ve=ye.map((Ge,ce)=>({...Ge,isOutput:ce===Ce}));q(ve),m==null||m("Entity marked as output","success")},oe=(Ce,ve)=>{Ce.stopPropagation();const Ge=ye[ve],ce={...Ge.thumbnails};c&&Object.entries(Oo).forEach(([V,re])=>{const ze=c(e.id,ve*10+re);ze&&(ce[V]=ze)});const He={type:"prompt-modifier-character-card-transfer",sourceNodeId:e.id,sourceIndex:ve,character:{...Ge,imageSources:ce,_fullResActive:c?c(e.id,ve*10):null}};Ce.dataTransfer.setData("application/prompt-modifier-card",JSON.stringify(He)),Ce.dataTransfer.effectAllowed="move",requestAnimationFrame(()=>ge(ve))},B=(Ce,ve)=>{Ce.dataTransfer.types.includes("application/prompt-modifier-card")&&(Ce.preventDefault(),Ce.stopPropagation(),Te(ve),le(ve))},fe=()=>{Te(null),le(null)},ie=async Ce=>{Ce.preventDefault(),Ce.stopPropagation(),Te(null),ge(null),$(!1);const ve=W;le(null);const Ge=Ce.dataTransfer.getData("application/prompt-modifier-card");if(Ge)try{const ce=JSON.parse(Ge);if(ce.type!=="prompt-modifier-character-card-transfer")return;const{sourceNodeId:He,sourceIndex:V,character:re}=ce,ze=ve!==null?ve:ye.length;if(He===e.id){if(V===ze||V===ze-1)return;const ne=[...ye],[xe]=ne.splice(V,1);let _e=ze;ze>V&&(_e-=1),ne.splice(_e,0,xe);const Ie={};if(c&&ye.forEach((me,Ee)=>{for(let Ae=0;Ae<10;Ae++){const Ke=c(e.id,Ee*10+Ae);Ke&&(Ie[Ee*10+Ae]=Ke)}}),l){for(let me=0;me<ye.length*10;me++)l(e.id,me,null);ne.forEach((me,Ee)=>{const Ae=ye.findIndex(Ke=>Ke.id===me.id);if(Ae!==-1)for(let Ke=0;Ke<10;Ke++){const mt=Ie[Ae*10+Ke];mt&&l(e.id,Ee*10+Ke,mt)}})}q(ne)}else{const ne=[...ye];ne.length===1&&!ne[0].name&&!ne[0].image&&!ne[0].prompt&&ne.splice(0,1);const xe={...re,id:`char-card-${Date.now()}`};ne.splice(ze,0,xe),l&&(xe.imageSources&&Object.entries(xe.imageSources).forEach(([_e,Ie])=>{const me=Oo[_e];me&&typeof Ie=="string"&&l(e.id,ze*10+me,Ie)}),xe._fullResActive&&l(e.id,ze*10,xe._fullResActive)),E&&E(_e=>_e.map(Ie=>Ie.id===e.id?{...Ie,width:ne.length*jr}:Ie)),q(ne),E&&(k!=null&&k.setFullSizeImage)&&(k!=null&&k.getFullSizeImage)&&E(_e=>_e.map(Ie=>{if(Ie.id===He)try{const Ee=JSON.parse(Ie.value).filter((Ae,Ke)=>Ke!==V);return{...Ie,value:JSON.stringify(Ee),width:Math.max(jr,Ee.length*jr)}}catch{return Ie}return Ie})),m==null||m("Card transferred","success")}}catch(ce){console.error("Drop failed",ce)}},Z=Ce=>{Ce.stopPropagation();let ve=0;const Ge=/^New Entity\s*(\d*)$/i;ye.forEach(ne=>{const xe=(ne.name||"").match(Ge);if(xe){const _e=xe[1]?parseInt(xe[1],10):1;_e>ve&&(ve=_e)}});const ce=`New Entity ${ve+1}`;let He=0;const V=/^(?:Entity|Character)-(\d+)$/i;ye.forEach(ne=>{const xe=(ne.index||"").match(V);if(xe){const _e=parseInt(xe[1],10);_e>He&&(He=_e)}});const re=`Entity-${He+1}`,ze=[...ye,{id:`char-card-${Date.now()}`,name:ce,index:re,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!1,isDescriptionCollapsed:!1,isImageCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];q(ze),E&&E(ne=>ne.map(xe=>xe.id===e.id?{...xe,width:ze.length*jr}:xe))},ee=Ce=>{if(ye.length<=1){q([{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]);return}if(l&&c){for(let ce=Ce;ce<ye.length-1;ce++)for(let He=0;He<10;He++){const V=c(e.id,(ce+1)*10+He);l(e.id,ce*10+He,V||null)}const Ge=ye.length-1;for(let ce=0;ce<10;ce++)l(e.id,Ge*10+ce,null)}const ve=ye.filter((Ge,ce)=>ce!==Ce);ve.some(Ge=>Ge.isOutput)||(ve[0].isOutput=!0),q(ve),E&&E(Ge=>Ge.map(ce=>ce.id===e.id?{...ce,width:Math.max(jr,ve.length*jr)}:ce))},R=async(Ce,ve)=>{const Ge=ye[Ce];l&&(l(e.id,Ce*10,ve),l(e.id,Ce*10+(Oo[Ge.selectedRatio]||1),ve));const ce=await mg(ve,256,256),He={...Ge.thumbnails,[Ge.selectedRatio]:ce};Q(Ce,{thumbnails:He,image:ce})},be=(Ce,ve)=>{const Ge=ye[Ce];if(ve===Ge.selectedRatio)return;let ce=null;c&&(ce=c(e.id,Ce*10+(Oo[ve]||1)));const He=Ge.thumbnails[ve]||null;l&&(ce?l(e.id,Ce*10,ce):He&&l(e.id,Ce*10,He)),Q(Ce,{selectedRatio:ve,image:He})},Le=async Ce=>{const ve=ye[Ce],Ge={...ve.thumbnails};c&&Object.entries(Oo).forEach(([He,V])=>{const re=c(e.id,Ce*10+V);re&&(Ge[He]=re)});const ce={type:"character-card",...ve,imageSources:Ge};delete ce.id;try{await navigator.clipboard.writeText(JSON.stringify(ce,null,2)),m==null||m(a("toast.copied"),"success")}catch{m==null||m(a("app.error.copy"),"info")}},je=async Ce=>{try{const ve=await navigator.clipboard.readText(),Ge=JSON.parse(ve);let ce=Array.isArray(Ge)?Ge[0]:Ge;if(ce&&(ce.type==="character-card"||ce.name||ce.prompt)){const He=ce.imageSources||{"1:1":null,"16:9":null,"9:16":null},V={"1:1":null,"16:9":null,"9:16":null};ce.image&&!ce.imageSources&&(He["1:1"]=ce.image);for(const[ze,ne]of Object.entries(He))if(typeof ne=="string"&&ne.startsWith("data:")){const xe=Ce*10+(Oo[ze]||1);l&&l(e.id,xe,ne),V[ze]=await mg(ne,256,256)}else V[ze]=ne;const re=ce.selectedRatio||"1:1";Q(Ce,{name:ce.name||"",index:ce.index||ce.alias||`Entity-${Ce+1}`,prompt:ce.prompt||"",fullDescription:ce.fullDescription||"",selectedRatio:re,image:V[re],thumbnails:V}),m==null||m(a("toast.pasted"),"success")}}catch{m==null||m(a("app.error.fileReadError"),"info")}},Ue=async Ce=>{try{const ve=await navigator.clipboard.read();for(const Ge of ve){const ce=Ge.types.find(He=>He.startsWith("image/"));if(ce){const He=await Ge.getType(ce),V=new FileReader;V.onload=async re=>{var ne;const ze=(ne=re.target)==null?void 0:ne.result;ze&&(await R(Ce,ze),m==null||m(a("toast.pasted"),"success"))},V.readAsDataURL(He);return}}m==null||m(a("toast.pasteFailed"),"info")}catch{m==null||m(a("toast.pasteFailed"),"info")}},Fe=(Ce,ve)=>{const Ge={},ce=["1:1","16:9","9:16"],He=Ce.thumbnails||Ce.imageSources||{};ce.forEach(_e=>{let Ie=He[_e];if(c){const me=c(e.id,ve*10+(Oo[_e]||1));me&&(Ie=me)}_e==="1:1"&&!Ie&&(Ie=Ce.image),Ie?Ge[_e]=Ie.startsWith("data:image")?Ie:`data:image/png;base64,${Ie}`:Ge[_e]=null});const V={type:"character-card",name:Ce.name,index:Ce.index,image:Ge["1:1"]||null,selectedRatio:Ce.selectedRatio||"1:1",prompt:Ce.prompt,fullDescription:Ce.fullDescription,imageSources:Ge,additionalPrompt:Ce.additionalPrompt,targetLanguage:Ce.targetLanguage,isOutput:Ce.isOutput},re=JSON.stringify(V,null,2),ze=new Blob([re],{type:"application/json"}),ne=URL.createObjectURL(ze),xe=document.createElement("a");xe.href=ne,xe.download=`${(Ce.name||"character").replace(/ /g,"_")}.json`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(ne)},ot=Ce=>{(Ce.dataTransfer.types.includes("application/prompt-modifier-card")||Ce.dataTransfer.types.includes("Files"))&&(Ce.preventDefault(),Ce.stopPropagation(),$(!0))},at=x.useCallback(Ce=>{var Ge;const ve=(Ge=Ce.target.files)==null?void 0:Ge[0];if(ve){const ce=new FileReader;ce.onload=async He=>{var ze;const V=(ze=He.target)==null?void 0:ze.result;V&&await R(K!==null?K:G,V)},ce.readAsDataURL(ve)}Ce.target&&(Ce.target.value=""),ae(null)},[G,K]),rt=({index:Ce})=>o.jsx("div",{className:`w-[24px] h-full flex items-center justify-center flex-shrink-0 transition-all cursor-copy ${X===Ce?"bg-gray-800/30":""}`,onDragOver:ve=>B(ve,Ce),onDragLeave:fe,onDrop:ie,children:o.jsx("div",{className:`h-[90%] rounded-full transition-all duration-200 pointer-events-none ${X===Ce?"w-1 bg-emerald-500 shadow-[0_0_10px_#10b981] opacity-100 scale-y-100":"w-[1px] bg-gray-700/30 opacity-50 scale-y-90"}`})});return o.jsxs("div",{className:`flex h-full w-full overflow-x-scroll custom-scrollbar p-0 gap-0 pb-2 transition-colors ${H?"bg-emerald-900/20":""}`,onWheel:Ce=>Ce.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},onDrop:ie,onDragOver:ot,onDragLeave:()=>$(!1),children:[o.jsx("style",{children:".custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; } .custom-scrollbar::-webkit-scrollbar-track { background: rgba(31, 41, 45, 0.5); border-radius: 4px; margin: 0 4px; } .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(75, 85, 99, 0.5); border-radius: 4px; } .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }"}),o.jsx(CA,{isOpen:U,onClose:()=>O(!1),onApply:Ce=>R(G,Ce),imageSrc:D}),o.jsx("input",{ref:L,type:"file",accept:"image/*",className:"hidden",onChange:at}),ye.map((Ce,ve)=>{const Ge=`${P}-${ve}`,ce=j.has((Ce.index||"").trim());return o.jsxs(bt.Fragment,{children:[o.jsx(rt,{index:ve}),o.jsx(DA,{char:Ce,index:ve,nodeId:P,isDragging:Y===ve,isDuplicate:ce,t:a,onUpdate:He=>Q(ve,He),onRemove:()=>ee(ve),onSetOutput:()=>J(ve),onDragStart:He=>oe(He,ve),onGenerateImage:()=>T(P,ve),isGeneratingImage:I===`${P}-${ve}`,onSyncFromConnection:()=>{},onCopyImageToClipboard:h,onDetach:()=>f(Ce,{id:P}),onSaveCharacter:()=>Fe(Ce,ve),onLoadCharacter:()=>r(P),onSaveToCatalog:()=>s(P),onCopyCard:()=>Le(ve),onPasteToCard:()=>je(ve),onOpenInEditor:()=>{},onOpenInRasterEditor:()=>{let He=Ce.image;c&&(He=c(P,ve*10+(Oo[Ce.selectedRatio]||1))||Ce.image),He&&(z(He),F(ve),O(!0))},onRatioChange:He=>be(ve,He),onCrop1x1:()=>{},onRatioExpand:He=>{},onPasteImageToSlot:()=>Ue(ve),onClearImage:()=>Q(ve,{thumbnails:{...Ce.thumbnails,[Ce.selectedRatio]:null},image:null}),onViewImage:()=>{if(d){const He=Oo[Ce.selectedRatio]||1,V=(c?c(P,ve*10+He):null)||Ce.thumbnails[Ce.selectedRatio]||Ce.image;V&&d({sources:[{src:V.startsWith("data:")?V:`data:image/png;base64,${V}`,frameNumber:0,prompt:Ce.name}],initialIndex:0})}},onUploadImage:()=>{var He;ae(ve),(He=L.current)==null||He.click()},onImageDrop:He=>{var ze;const V=He.dataTransfer.getData("application/prompt-modifier-drag-image");V&&R(ve,V);const re=(ze=He.dataTransfer.files)==null?void 0:ze[0];if(re!=null&&re.type.startsWith("image/")){const ne=new FileReader;ne.onload=xe=>{var _e;return R(ve,(_e=xe.target)==null?void 0:_e.result)},ne.readAsDataURL(re)}},transformingRatio:pe,deselectAllNodes:i,isModifying:S===Ge,isUpdatingDescription:y===Ge,onModifyRequest:He=>b(P,ve,He),onUpdateDescriptionRequest:()=>w(P,ve),secondaryLanguage:he})]},Ce.id)}),o.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[60px] mx-2 group cursor-pointer",onClick:Z,children:[o.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-800 border-2 border-gray-600 group-hover:border-emerald-500 group-hover:bg-emerald-900/20 flex items-center justify-center transition-all shadow-md",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400 group-hover:text-emerald-400 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx("span",{className:"text-[10px] text-gray-500 font-bold mt-2 uppercase tracking-wider group-hover:text-emerald-400 transition-colors",children:"Add Entity"})]}),o.jsx(rt,{index:ye.length})]})},Yn=({options:e,value:t,onChange:n,disabled:r,id:a,title:i,placeholder:s})=>{const[l,c]=x.useState(!1),[d,h]=x.useState(!1),[g,m]=x.useState(!1),[w,y]=x.useState(-1),[b,S]=x.useState({top:0,left:0,minWidth:0,maxHeight:300}),_=x.useRef(null),v=x.useRef(null),f=x.useRef([]),T=e.find(k=>k.value===t),A=T?T.label:s||t;x.useEffect(()=>{if(l)h(!0),requestAnimationFrame(()=>m(!0));else{m(!1);const k=setTimeout(()=>h(!1),200);return()=>clearTimeout(k)}},[l]);const I=()=>{if(_.current){const k=_.current.getBoundingClientRect(),P=window.innerHeight-k.bottom-10,L=k.top-10,H=e.length*36+10;let $=0,U=0;P>=H||P>L?($=k.bottom+window.scrollY+4,U=Math.min(H,P)):($=k.top+window.scrollY-Math.min(H,L)-4,U=Math.min(H,L)),S({top:$,left:k.left+window.scrollX,minWidth:k.width,maxHeight:U})}};x.useEffect(()=>{const k=P=>{_.current&&!_.current.contains(P.target)&&v.current&&!v.current.contains(P.target)&&c(!1)},E=P=>{if(P.type==="resize"){l&&c(!1);return}v.current&&P.target instanceof Node&&v.current.contains(P.target)||l&&c(!1)};return l&&(I(),document.addEventListener("mousedown",k,!0),window.addEventListener("scroll",E,!0),window.addEventListener("resize",E)),()=>{document.removeEventListener("mousedown",k,!0),window.removeEventListener("scroll",E,!0),window.removeEventListener("resize",E)}},[l]),x.useEffect(()=>{if(l){const k=e.findIndex(E=>E.value===t);y(k>-1?k:0)}},[l,e,t]);const M=k=>{var E,P;switch(k.key){case"ArrowDown":if(k.preventDefault(),!l)c(!0);else{const L=Math.min(w+1,e.length-1);y(L),(E=f.current[L])==null||E.scrollIntoView({block:"nearest"})}break;case"ArrowUp":if(k.preventDefault(),l){const L=Math.max(w-1,0);y(L),(P=f.current[L])==null||P.scrollIntoView({block:"nearest"})}break;case"Enter":case" ":k.preventDefault(),l&&w!==-1?(n(e[w].value),c(!1)):c(!l);break;case"Escape":c(!1);break;case"Tab":c(!1);break}},N=k=>{n(k),c(!1)};return o.jsxs(o.Fragment,{children:[o.jsxs("button",{ref:_,id:a,disabled:r,onClick:()=>!r&&c(!l),onKeyDown:M,type:"button",title:i,"aria-haspopup":"listbox","aria-expanded":l,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-1 focus:ring-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed flex justify-between items-center text-left group h-9 text-sm transition-colors hover:border-gray-500",children:[o.jsxs("span",{className:"truncate flex items-center gap-2",children:[(T==null?void 0:T.icon)&&o.jsx("span",{className:"text-gray-400",children:T.icon}),o.jsx("span",{className:T?"":"text-gray-400",children:A})]}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 text-gray-400 transition-transform duration-200 flex-shrink-0 ml-1 ${l?"transform rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),d&&Yi.createPortal(o.jsx("ul",{ref:v,role:"listbox",className:`fixed z-[9999] bg-gray-800 border border-gray-600 rounded-md shadow-2xl focus:outline-none overflow-y-auto custom-scrollbar py-1 transition-[opacity,transform] duration-200 ease-out origin-top ${g?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{top:b.top,left:b.left,minWidth:b.minWidth,width:"max-content",maxWidth:"90vw",maxHeight:`${b.maxHeight}px`},onWheel:k=>k.stopPropagation(),children:e.map((k,E)=>o.jsxs("li",{ref:P=>{f.current[E]=P},tabIndex:-1,role:"option","aria-selected":t===k.value,onClick:()=>N(k.value),className:`px-3 py-2 text-sm cursor-pointer select-none transition-colors flex items-center gap-2 group whitespace-nowrap ${w===E||t===k.value?"bg-emerald-600 text-white":"text-gray-200 hover:bg-gray-700"} ${t===k.value?"font-semibold":""}`,onMouseEnter:()=>y(E),children:[k.icon&&o.jsx("span",{className:`${w===E||t===k.value?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:k.icon}),o.jsx("span",{children:k.label})]},k.value))}),document.body)]})},FA=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"de",label:"DE"},{code:"fr",label:"FR"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],zA=({fullDescription:e,onDescriptionChange:t,t:n,onFocus:r})=>{const[a,i]=x.useState({});x.useEffect(()=>{const l={Appearance:"",Personality:"",Clothing:""},c={:"Appearance",:"Personality",:"Personality",:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},d=/####\s*(Appearance|Personality|Clothing||||)\s*([\s\S]*?)(?=####|$)/gi;let h,g=!1;for(;(h=d.exec(e))!==null;){g=!0;const m=h[1].trim().toLowerCase(),w=c[m],y=h[2].trim();w&&(l[w]=y)}!g&&e.trim()&&(l.Appearance=e.trim()),i(l)},[e]);const s=(l,c)=>{const d={...a,[l]:c};i(d);const h=`#### Appearance
${d.Appearance||""}

#### Personality
${d.Personality||""}

#### Clothing
${d.Clothing||""}`;t(h)};return o.jsx("div",{className:"space-y-2 text-sm",children:["Appearance","Personality","Clothing"].map(l=>o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider",children:n(`node.content.${l.toLowerCase()}`)||l}),o.jsx("textarea",{value:a[l]||"",onChange:c=>s(l,c.target.value),className:"w-full text-sm p-2 bg-gray-800 border border-transparent rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar overflow-y-scroll",onWheel:c=>c.stopPropagation(),onFocus:r})]},l))})},GA=({node:e,onValueChange:t,onGenerateCharacters:n,isGeneratingCharacters:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,clearSelectionsSignal:d,onGenerateCharacterImage:h,isGeneratingCharacterImage:g,onDetachCharacter:m})=>{const w=r===e.id,y=c==null?void 0:c.has(void 0),[b,S]=x.useState(new Set),[_,v]=x.useState(new Set);x.useEffect(()=>{d>0&&S(new Set)},[d]);const f=x.useMemo(()=>{try{const Y=JSON.parse(e.value||"{}");return{prompt:Y.prompt||"",numberOfCharacters:Y.numberOfCharacters||1,targetLanguage:Y.targetLanguage||"ru",characterType:Y.characterType||"simple",style:Y.style||"simple",customStyle:Y.customStyle||"",characters:Array.isArray(Y.characters)?Y.characters:[],error:Y.error||null}}catch{return{prompt:"",numberOfCharacters:1,targetLanguage:"ru",characterType:"simple",style:"simple",customStyle:"",characters:[],error:null}}},[e.value]),{prompt:T,numberOfCharacters:A,targetLanguage:I,characterType:M,style:N,customStyle:k,characters:E,error:P}=f,L=x.useCallback(Y=>{const ge={...f,...Y};t(e.id,JSON.stringify(ge))},[e.id,t,f]),H=x.useMemo(()=>[{value:"simple",label:s("node.content.characterType.simple")},{value:"anthro",label:s("node.content.characterType.anthro")},{value:"chibi",label:s("node.content.characterType.chibi")},{value:"key_item",label:s("node.content.characterType.key_item")}],[s]),$=x.useMemo(()=>[{value:"simple",label:s("node.content.style.simple")},{value:"realistic",label:s("node.content.style.realistic")},{value:"3d_cartoon",label:s("node.content.style.3d_cartoon")},{value:"3d_realistic",label:s("node.content.style.3d_realistic")},{value:"2d_animation",label:s("node.content.style.2d_animation")},{value:"anime",label:s("node.content.style.anime")},{value:"comics",label:s("node.content.style.comics")},{value:"custom",label:s("node.content.style.custom")}],[s]),U=x.useMemo(()=>FA.map(Y=>({value:Y.code,label:Y.label})),[]),O=(Y,ge)=>{Y.target.closest("textarea, input, button")||(document.activeElement&&(document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLInputElement)&&document.activeElement.blur(),S(le=>{const X=new Set(Y.shiftKey?le:[]);return X.has(ge)?X.delete(ge):X.add(ge),X}))},D=Y=>{v(ge=>{const W=new Set(ge);return W.has(Y)?W.delete(Y):W.add(Y),W})},z=(Y,ge,W)=>{const le=E.map(X=>X.id===Y?{...X,[ge]:W}:X);L({characters:le})},G=Y=>{L({characters:E.filter(ge=>ge.id!==Y)})},F=Y=>{navigator.clipboard.writeText(Y)},K=Y=>{const ge={};Y.imageBase64&&(ge["1:1"]=`data:image/png;base64,${Y.imageBase64}`);const W={type:"character-card",name:Y.name,index:Y.index||Y.alias||"Entity-1",image:Y.imageBase64?`data:image/png;base64,${Y.imageBase64}`:null,selectedRatio:"1:1",prompt:Y.prompt,fullDescription:Y.fullDescription,imageSources:ge},le=JSON.stringify(W,null,2),X=new Blob([le],{type:"application/json"}),Te=URL.createObjectURL(X),pe=document.createElement("a");pe.href=Te,pe.download=`${(Y.name||"character").replace(/ /g,"_")}.json`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(Te)},ae=()=>{let Y=0;const ge=/^New Entity\s*(\d*)$/i;E.forEach(ue=>{const Oe=(ue.name||"").match(ge);if(Oe){const he=Oe[1]?parseInt(Oe[1],10):1;he>Y&&(Y=he)}});const W=`New Entity ${Y+1}`;let le=0;const X=/^(?:Entity|Character)-(\d+)$/i;E.forEach(ue=>{const Oe=(ue.index||ue.alias||"").match(X);if(Oe){const he=parseInt(Oe[1],10);he>le&&(le=he)}});const Te=`Entity-${le+1}`,pe={id:`char-manual-${Date.now()}`,name:W,index:Te,fullDescription:"",prompt:"",originalName:W};L({characters:[...E,pe]})};return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[o.jsx("textarea",{value:T,onChange:Y=>L({prompt:Y.target.value}),placeholder:s(y?"node.content.connectedPlaceholder":"character_generator.promptPlaceholder"),disabled:y||w,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-y min-h-[80px] focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll",rows:2,onWheel:Y=>Y.stopPropagation(),onMouseDown:Y=>Y.stopPropagation(),onFocus:l}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.characterType")}),o.jsx(Yn,{id:`char-type-select-${e.id}`,value:M,onChange:Y=>L({characterType:Y}),options:H,disabled:w})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.style")}),o.jsx(Yn,{id:`char-style-select-${e.id}`,value:N,onChange:Y=>L({style:Y}),options:$,disabled:w})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.numberOfCharactersShort")}),o.jsx("div",{className:"relative h-9",children:o.jsx("input",{id:`char-count-${e.id}`,type:"number",min:"1",max:"10",value:A,onChange:Y=>L({numberOfCharacters:parseInt(Y.target.value,10)||1}),className:"w-full h-full pl-3 pr-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none",onMouseDown:Y=>Y.stopPropagation(),onFocus:l})})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.targetLanguage")}),o.jsx(Yn,{id:`char-lang-select-${e.id}`,value:I,onChange:Y=>L({targetLanguage:Y}),options:U,disabled:w})]})]}),N==="custom"&&o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{htmlFor:`custom-style-input-${e.id}`,className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.style.custom")}),o.jsx("textarea",{id:`custom-style-input-${e.id}`,value:k,onChange:Y=>L({customStyle:Y.target.value}),onMouseDown:Y=>Y.stopPropagation(),onFocus:l,rows:2,className:"w-full p-2 bg-gray-700 border border-transparent text-white rounded-md text-xs focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar",placeholder:"..."})]}),o.jsx("button",{onClick:w?i:()=>n(e.id),disabled:a||!w&&!y&&!T.trim(),className:`w-full h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${a?"bg-yellow-600":w?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed"}`,children:s(a?"node.action.stopping":w?"node.action.stop":"node.content.generateCharacters")})]}),P&&o.jsx("div",{className:"bg-red-900/50 border border-red-700 text-red-200 text-sm p-2 rounded-md mb-2",children:P}),o.jsxs("div",{className:"flex-grow overflow-y-auto overflow-x-hidden space-y-3 pr-1 custom-scrollbar",onWheel:Y=>Y.stopPropagation(),children:[E.map((Y,ge)=>{const W=b.has(Y.id),le=_.has(Y.id),X=g===`${e.id}-${Y.id}`;return o.jsxs("div",{className:`bg-gray-700 rounded-lg p-3 space-y-2 border-2 ${W?"border-emerald-500":"border-transparent"} transition-colors`,onClick:Te=>O(Te,Y.id),children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[o.jsx(Pe,{tooltipPosition:"left",title:s(le?"node.action.expand":"node.action.collapse"),onClick:Te=>{Te.stopPropagation(),D(Y.id)},children:le?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("input",{type:"text",value:Y.name,onChange:Te=>z(Y.id,"name",Te.target.value),className:"font-semibold text-white bg-transparent w-32 focus:bg-gray-800 rounded px-1",onFocus:l,onMouseDown:Te=>Te.stopPropagation()})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:[s("node.content.characterIndex"),":"]}),o.jsx("input",{type:"text",value:Y.index||Y.alias||"",onChange:Te=>z(Y.id,"index",Te.target.value),className:"font-semibold text-white bg-gray-800 w-24 rounded px-1 text-xs py-0.5 focus:ring-1 focus:ring-emerald-500 focus:outline-none",onFocus:l,onMouseDown:Te=>Te.stopPropagation()}),o.jsx(Pe,{tooltipPosition:"left",title:"Copy All Text",onClick:Te=>{Te.stopPropagation(),F(`Name: ${Y.name}

${Y.fullDescription}`)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),o.jsx(Pe,{tooltipPosition:"left",title:"Save Character to File",onClick:Te=>{Te.stopPropagation(),K(Y)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:"Detach to Character Card Node",onClick:Te=>{Te.stopPropagation(),m(Y,e)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.deleteItem"),onClick:Te=>{Te.stopPropagation(),G(Y.id)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!le&&o.jsxs("div",{className:"flex space-x-3",children:[o.jsxs("div",{className:"w-40 flex-shrink-0 space-y-2",children:[o.jsx("div",{className:"relative w-full aspect-square bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden",children:X?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}):Y.imageBase64?o.jsx("img",{src:`data:image/png;base64,${Y.imageBase64}`,alt:Y.name||"Character",className:"w-full h-full object-contain"}):o.jsxs("div",{className:"text-center text-gray-500 p-2 pointer-events-none",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 mx-auto mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),o.jsx("p",{className:"text-xs",children:"No Image"})]})}),o.jsx("button",{onClick:Te=>{Te.stopPropagation(),h(e.id,Y.id)},disabled:X||!Y.prompt,className:"w-full px-2 py-1 text-xs font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:X?"...":s("node.content.generateImage")})]}),o.jsxs("div",{className:"flex-grow min-w-0",children:[o.jsx(zA,{fullDescription:Y.fullDescription||"",onDescriptionChange:Te=>z(Y.id,"fullDescription",Te),t:s,onFocus:l}),o.jsxs("div",{className:"space-y-1 mt-2",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.imagePrompt")}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.copy"),onClick:Te=>{Te.stopPropagation(),F(Y.prompt||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:Y.prompt||"",onChange:Te=>z(Y.id,"prompt",Te.target.value),className:"w-full text-xs p-2 bg-gray-800 border border-transparent rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar overflow-y-scroll",onWheel:Te=>Te.stopPropagation(),onFocus:l})]})]})]})]},Y.id||ge)}),o.jsx("div",{className:"flex justify-center pt-2 pb-1",children:o.jsxs("button",{onClick:ae,className:"flex items-center gap-1 px-4 py-1.5 bg-gray-800 hover:bg-emerald-700/50 border border-gray-600 hover:border-emerald-500 rounded-full transition-colors text-xs font-bold text-gray-300 hover:text-white",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Manual Entity"]})})]})]})},UA=({node:e,onValueChange:t,onFixErrors:n,isFixingErrors:r,isStopping:a,onStopGeneration:i,connectedInputs:s,t:l,deselectAllNodes:c})=>{const d=s==null?void 0:s.has(void 0),h=r===e.id;return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{value:e.value,onChange:g=>t(e.id,g.target.value),placeholder:l(d?"node.content.connectedPlaceholder":"node.content.notePlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 mb-2 custom-scrollbar overflow-y-scroll",onWheel:g=>g.stopPropagation(),onMouseDown:g=>g.stopPropagation(),onFocus:c,disabled:d||h}),o.jsx("button",{onClick:h?i:()=>n(e.id),disabled:a||!h&&!d&&!e.value.trim(),className:`w-full px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${a?"bg-yellow-600":h?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:l(a?"node.action.stopping":h?"node.action.stop":"node.content.fixErrors")})]})},HA=({node:e,onValueChange:t,onSendMessage:n,isChatting:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l})=>{const c=r===e.id,d=x.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{messages:[],currentInput:"",mode:"general"}}},[e.value]),{messages:h=[],currentInput:g="",mode:m="general"}=d,w=x.useRef(null);x.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[h]);const y=()=>{c||n(e.id)},b=S=>{t(e.id,JSON.stringify({...d,mode:S}))};return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("div",{className:"bg-gray-800 rounded-md p-1 mb-2 flex-shrink-0",children:o.jsxs("div",{className:"flex space-x-1 w-full",children:[o.jsxs("button",{onClick:()=>b("general"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="general"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.general")})]}),o.jsxs("button",{onClick:()=>b("script"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="script"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.script")})]}),o.jsxs("button",{onClick:()=>b("prompt"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="prompt"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.prompt")})]}),o.jsxs("button",{onClick:()=>b("youtube"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="youtube"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.youtube")})]})]})}),o.jsxs("div",{ref:w,onWheel:S=>S.stopPropagation(),className:"flex-grow p-2 bg-gray-900/50 rounded-md overflow-y-auto overflow-x-auto mb-2 space-y-4 select-text custom-scrollbar",children:[h.length===0&&o.jsx("div",{className:"flex h-full items-center justify-center text-gray-500 text-xs italic text-center px-4",children:s(`chat.mode.${m}`)}),h.map((S,_)=>o.jsx("div",{className:`flex ${S.role==="user"?"justify-end":"justify-start"}`,children:o.jsxs("div",{className:`relative group max-w-[80%] p-3 rounded-lg ${S.role==="user"?"bg-emerald-600":"bg-gray-700"}`,children:[o.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:S.content}),S.role==="model"&&o.jsx("div",{className:"absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.copy"),onClick:()=>navigator.clipboard.writeText(S.content),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]})},_)),c&&o.jsx("div",{className:"flex justify-start",children:o.jsx("div",{className:"max-w-[80%] p-3 rounded-lg bg-gray-700",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})})})]}),o.jsxs("div",{className:"relative w-full",children:[o.jsx("textarea",{value:g,onChange:S=>t(e.id,JSON.stringify({...d,currentInput:S.target.value})),onKeyDown:S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),y())},placeholder:s("node.content.chatPlaceholder"),onWheel:S=>S.stopPropagation(),onMouseDown:S=>S.stopPropagation(),className:"w-full p-2 pr-10 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll min-h-[80px]",rows:2,onFocus:l}),o.jsx("button",{onClick:c?i:y,disabled:a||!c&&!g.trim(),className:`absolute right-2 bottom-2 p-1.5 rounded-md transition-colors duration-200 flex items-center justify-center ${a?"bg-yellow-600 text-white":c?"bg-red-600 hover:bg-red-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed"}`,title:a?"Stopping":c?"Stop":"Send",children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 animate-pulse",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("rect",{x:"6",y:"6",width:"8",height:"8"})}):c?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})]})},BA=({node:e,onValueChange:t,onGenerateImage:n,isGeneratingImage:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c})=>{const d=r===e.id,h=c==null?void 0:c.has(void 0),g=x.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{prompt:"",imageBase64:""}}},[e.value]),{prompt:m,imageBase64:w}=g,y=b=>{const S={...g,...b};t(e.id,JSON.stringify(S))};return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{value:m,onChange:b=>y({prompt:b.target.value}),placeholder:s(h?"node.content.connectedPlaceholder":"node.content.imagePromptPlaceholder"),disabled:h||d,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll",rows:4,onWheel:b=>b.stopPropagation(),onMouseDown:b=>b.stopPropagation(),onFocus:l}),o.jsx("button",{onClick:d?i:()=>n(e.id),disabled:a||!d&&!h&&!m.trim(),className:`w-full px-4 py-2 mt-2 font-bold text-white rounded-md transition-colors duration-200 ${a?"bg-yellow-600":d?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:s(a?"node.action.stopping":d?"node.action.stop":"node.content.generateImage")}),o.jsx("div",{className:"flex-grow mt-2 bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden",children:d?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-pulse"}),o.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}):w?o.jsx("img",{src:`data:image/png;base64,${w}`,alt:"Generated",className:"w-full h-full object-contain"}):o.jsxs("div",{className:"text-center text-gray-500 p-4",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("p",{className:"text-sm",children:s("node.content.imagePromptPlaceholder")})]})})]})},VA=({node:e,onValueChange:t,t:n,onExtractTextFromImage:r,isExtractingText:a,addToast:i,deselectAllNodes:s,setImageViewer:l})=>{const[c,d]=x.useState(!1),h=a,g=x.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{imageBase64:null,extractedText:""}}},[e.value]),{imageBase64:m,extractedText:w}=g,y=M=>{t(e.id,JSON.stringify({...g,...M}))},b=M=>{M.preventDefault(),M.stopPropagation(),d(!0)},S=M=>{M.preventDefault(),M.stopPropagation(),d(!1)},_=M=>{var k;M.preventDefault(),M.stopPropagation(),d(!1);const N=(k=M.dataTransfer.files)==null?void 0:k[0];if(N&&N.type.startsWith("image/")){const E=new FileReader;E.onload=P=>{var H;const L=(H=P.target)==null?void 0:H.result;if(L){const $=L.split(",")[1];y({imageBase64:$})}},E.readAsDataURL(N)}},v=()=>{r&&r(e.id)},f=()=>{w&&(navigator.clipboard.writeText(w),i(n("toast.copied"),"success"))},T=async()=>{if(m)try{const N=await(await fetch(`data:image/png;base64,${m}`)).blob();await navigator.clipboard.write([new ClipboardItem({[N.type]:N})]),i(n("toast.copied"),"success")}catch(M){console.error("Failed to copy image:",M),i("Failed to copy image","info")}},A=M=>{m&&l&&(M.stopPropagation(),l({sources:[{src:`data:image/png;base64,${m}`,frameNumber:0,prompt:e.title}],initialIndex:0}))},I=M=>{(M.ctrlKey||M.metaKey)&&M.key==="c"&&m&&(M.preventDefault(),M.stopPropagation(),T())};return o.jsxs("div",{tabIndex:0,onKeyDown:I,onDragOver:b,onDragLeave:S,onDrop:_,className:`flex flex-col h-full rounded-md transition-all duration-200 outline-none ${c?"ring-2 ring-emerald-400":"focus:ring-1 focus:ring-emerald-500/50"}`,children:[o.jsx("div",{className:"relative flex-grow bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden mb-2 group cursor-pointer",onClick:A,children:m?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:`data:image/png;base64,${m}`,alt:"Preview",className:"w-full h-full object-contain pointer-events-none"}),o.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("button",{onClick:M=>{M.stopPropagation(),T()},className:"p-1.5 bg-gray-800/80 rounded-full text-white hover:bg-emerald-600 transition-colors backdrop-blur-sm",title:n("node.action.copy"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx("button",{onClick:M=>{M.stopPropagation(),y({imageBase64:null,extractedText:""})},className:"p-1.5 bg-gray-800/80 rounded-full text-white hover:bg-red-600 transition-colors backdrop-blur-sm",title:n("node.action.clear"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):o.jsxs("div",{className:"text-center text-gray-500 p-4 pointer-events-none",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("p",{className:"text-sm",children:"Drag & drop image here"})]})}),o.jsx("button",{onClick:v,disabled:h||!m,className:"w-full px-4 py-2 mb-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors flex-shrink-0",children:n(h?"node.content.extracting":"node.content.imageToText")}),w&&o.jsxs("div",{className:"flex flex-col flex-shrink-0 h-32",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("node.content.extractedText")}),o.jsx(Pe,{title:n("node.action.copy"),onClick:f,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:w,className:"w-full flex-grow p-2 bg-gray-700 border-none rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:M=>M.stopPropagation(),onFocus:s})]})]})},$A=({node:e,onValueChange:t,t:n,deselectAllNodes:r})=>o.jsx("textarea",{value:e.value,onChange:a=>t(e.id,a.target.value),placeholder:n("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-transparent border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:a=>a.stopPropagation(),onMouseDown:a=>a.stopPropagation(),onFocus:r}),WA=({node:e,onValueChange:t,onAnalyze:n,isAnalyzing:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l})=>{const c=x.useMemo(()=>{try{const f=JSON.parse(e.value||"{}");return Array.isArray(f.characters)||(f.characters=[]),{environment:f.environment||"",characters:f.characters||[],action:f.action||"",style:f.style||"",targetLanguage:f.targetLanguage||"ru"}}catch{return{environment:"",characters:[],action:"",style:"",targetLanguage:"ru"}}},[e.value]),{environment:d,characters:h,action:g,style:m,targetLanguage:w}=c,y=Math.max(1,h.length),b=f=>{const T={...c,...f};t(e.id,JSON.stringify(T))},S=(f,T)=>{const A=[...h||[]];A[f]=T,b({characters:A})},_=(f,T)=>{b({[f]:T})},v=[{key:"environment",value:d,handler:f=>_("environment",f),placeholder:"node.content.environmentPlaceholder"},...Array.from({length:y}).map((f,T)=>({key:`character-${T}`,value:h[T]||"",handler:A=>S(T,A),placeholder:"node.content.characterPlaceholder"})),{key:"action",value:g,handler:f=>_("action",f),placeholder:"node.content.actionPlaceholder"},{key:"style",value:m,handler:f=>_("style",f),placeholder:"node.content.stylePlaceholder"}];return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsx("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",onWheel:f=>f.stopPropagation(),children:v.map(f=>o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:f.key.startsWith("character-")?`${s("node.content.character")} ${parseInt(f.key.split("-")[1],10)+1}`:s(`node.content.${f.key}`)}),o.jsx("textarea",{value:f.value,onChange:T=>f.handler(T.target.value),placeholder:s(f.placeholder),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onMouseDown:T=>T.stopPropagation(),onFocus:l})]},f.key))}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:r?i:()=>n(e.id),disabled:a,className:`flex-grow px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 ${a?"bg-yellow-600":r?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:s(a?"node.action.stopping":r?"node.action.stop":"node.content.analyzePrompt")}),o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1",children:[o.jsx("button",{onClick:()=>b({targetLanguage:"ru"}),className:`px-2 py-1 rounded text-xs font-semibold transition-colors w-10 ${w==="ru"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"RU"}),o.jsx("button",{onClick:()=>b({targetLanguage:"en"}),className:`px-2 py-1 rounded text-xs font-semibold transition-colors w-10 ${w==="en"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"EN"})]})]})]})},YA=({node:e,onEnhance:t,isEnhancing:n,onProcessChainForward:r,isExecutingChain:a,isStopping:i,onStopGeneration:s,t:l,deselectAllNodes:c})=>o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{readOnly:!0,value:e.value,placeholder:l("node.content.enhancedPromptHere"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:outline-none mb-2 custom-scrollbar overflow-y-scroll",onWheel:d=>d.stopPropagation(),onMouseDown:d=>d.stopPropagation(),onFocus:c}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:n?s:()=>t(e.id),disabled:a||i,className:`w-1/2 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${i&&n?"bg-yellow-600":n?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:l(i&&n?"node.action.stopping":n?"node.action.stop":"node.content.enhancePrompt")}),o.jsxs("button",{onClick:a?s:()=>r(e.id),disabled:n||i,className:`w-1/2 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center space-x-2 ${i&&a?"bg-yellow-600":a?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-500"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})}),o.jsx("span",{children:l(i&&a?"node.action.stopping":a?"node.action.stop":"node.action.processChainForward")})]})]})]}),qA=()=>null,Pt=x.forwardRef(({id:e,label:t,originalText:n,translatedText:r,isCritical:a,isEnabled:i=!0,isMandatory:s=!1,onToggle:l,color:c="emerald",className:d="",index:h,isHighlighted:g},m)=>{const[w,y]=x.useState(!1);let b="",S="",_="",v="",f="",T="";if(!i)b="bg-gray-800/20",S="border-gray-700",_="text-gray-500",v="bg-gray-700",f="text-gray-500",T="bg-gray-800 text-gray-600";else if(a)b="bg-red-900/20",S="border-red-800/50",_="text-red-400",v="bg-red-500",f="text-gray-300",T="bg-red-900/50 text-red-200";else if(s)b="bg-gray-800",S="border-gray-600",_="text-emerald-400",v="bg-gray-500",f="text-gray-300",T="bg-gray-700 text-gray-400";else switch(f="text-gray-300",c){case"cyan":b="bg-cyan-900/20",S="border-cyan-700/50",_="text-cyan-400",v="bg-cyan-500",T="bg-cyan-900/50 text-cyan-200";break;default:b="bg-emerald-900/20",S="border-emerald-700/50",_="text-emerald-400",v="bg-emerald-500",T="bg-emerald-900/50 text-emerald-200"}g&&(S="border-yellow-400 ring-1 ring-yellow-400/50",b="bg-yellow-900/30");const A=I=>{I.stopPropagation(),navigator.clipboard.writeText(n),y(!0),setTimeout(()=>y(!1),1500)};return o.jsxs("div",{ref:m,onMouseDown:I=>I.stopPropagation(),onClick:()=>!s&&l&&l(e),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${b} ${S} ${d} flex-shrink-0 ${s?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[h!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${T}`,children:h}),o.jsx("div",{className:`w-px flex-grow mt-1 ${i?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[h===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${v} shadow-[0_0_5px_rgba(0,0,0,0.5)]`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${_}`,children:t})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:A,className:`p-0.5 rounded transition-colors ${i?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:w?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!s&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${i?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:i?"ON":"OFF"})]})]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:`leading-tight ${i?"text-gray-400":"text-gray-600"} text-[10px] mb-1`,children:n}),r&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`leading-tight italic ${f}`,children:r})]})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${v}`})]})});bt.memo(({id:e,onClick:t,t:n})=>o.jsx(ht,{title:n("node.action.locateInStack"),position:"left",children:o.jsx("button",{onClick:r=>{r.stopPropagation(),t(r,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}));const KA=bt.memo(({uiState:e,onUpdateUiState:t,onUpdateValue:n,hierarchyEnabled:r,mandatoryBgEnabled:a,statePersistenceEnabled:i,livingWorldEnabled:s,extendedAnalysis:l,microActionBreakdown:c,batchProcessing:d,professionalStoryboard:h,cinematographyEnabled:g,safeGeneration:m=!1,thinkingEnabled:w=!1,shotFilter:y="all",anthroEnabled:b=!1,subscribeEnhancement:S=!1,anatomicalStrictness:_=!0,propConsistency:v=!0,t:f,initialHeight:T,onHeightChange:A,scale:I,model:M,targetLanguage:N,minFrames:k,maxFrames:E,framesPerScene:P,targetScrollId:L,onSetTargetScrollId:H})=>{const[$,U]=x.useState(!1),[O,D]=x.useState(""),z=x.useRef({}),G=x.useRef(null),[F,K]=x.useState(T||380);x.useEffect(()=>{Math.abs(T-F)>1&&K(T||380)},[T]),x.useEffect(()=>{if(L){D(""),setTimeout(()=>{if(z.current[L]&&!e.isSettingsCollapsed){const be=z.current[L],Le=G.current;if(be&&Le){const je=be.offsetTop,Ue=Math.max(0,je-Le.clientHeight/2+be.clientHeight/2);Le.scrollTo({top:Ue,behavior:"smooth"})}}},50);const R=setTimeout(()=>{H(null)},2e3);return()=>clearTimeout(R)}},[L,e.isSettingsCollapsed,H]);const ae=R=>{R.preventDefault(),R.stopPropagation();const be=R.clientY,Le=F;let je=Le;const Ue=ot=>{ot.preventDefault(),ot.stopPropagation();const at=(ot.clientY-be)/I;je=Math.max(100,Math.min(800,Le+at)),K(je)},Fe=ot=>{ot.preventDefault(),ot.stopPropagation(),window.removeEventListener("mousemove",Ue),window.removeEventListener("mouseup",Fe),A(je)};window.addEventListener("mousemove",Ue),window.addEventListener("mouseup",Fe)},Y=R=>{R.stopPropagation(),n({hierarchyEnabled:!0,mandatoryBgEnabled:!0,statePersistenceEnabled:!0,livingWorldEnabled:!0,extendedAnalysis:!1,microActionBreakdown:!1,batchProcessing:!0,professionalStoryboard:!0,cinematographyEnabled:!0,safeGeneration:!1,thinkingEnabled:!1,shotFilter:"all",anthroEnabled:!1,subscribeEnhancement:!1,anatomicalStrictness:!0,propConsistency:!0,minFrames:null,maxFrames:null})},ge=R=>R==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":R==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":R,W=y==="wideOnly",le=W?Se.STORYBOARD_RULES_WIDE.id:Se.STORYBOARD_RULES.id,X=W?Se.STORYBOARD_RULES_WIDE.text:Se.STORYBOARD_RULES.text,Te=W?"instruction.desc.storyboard_rules_wide":"instruction.desc.storyboard_rules",pe=W?Se.CINEMATOGRAPHY_WIDE.id:Se.CINEMATOGRAPHY.id,ue=W?Se.CINEMATOGRAPHY_WIDE.text:Se.CINEMATOGRAPHY.text,Oe=W?"instruction.desc.ana_cinema_wide":"instruction.desc.ana_cinema",he=W?Se.TECHNICAL_DIRECTIVES_WIDE.id:Se.TECHNICAL_DIRECTIVES.id,ye=W?Se.TECHNICAL_DIRECTIVES_WIDE.text:Se.TECHNICAL_DIRECTIVES.text,j=W?"instruction.desc.tech_directives_wide":"instruction.desc.tech_directives",q=W?Se.EXTENDED_VISUALS_WIDE.id:Se.EXTENDED_VISUALS.id,Q=W?Se.EXTENDED_VISUALS_WIDE.text:Se.EXTENDED_VISUALS.text,J=W?"instruction.desc.extended_visuals_wide":"instruction.desc.extended_visuals",oe=f(W?"instruction.extended_visuals_wide":"node.content.extendedAnalysis"),B=W?"rule_mandatory_bg_wide":Se.MANDATORY_BG.id,fe=W?Se.MANDATORY_BG_WIDE.text:Se.MANDATORY_BG.text,ie=W?"instruction.desc.rule_mandatory_bg_wide":"instruction.desc.rule_mandatory_bg";let Z=0;const ee=(R,be)=>{if(!O)return!0;const Le=O.toLowerCase();return R.toLowerCase().includes(Le)||be.toLowerCase().includes(Le)};return o.jsxs("div",{className:`border ${$?"border-emerald-500":"border-gray-600"} hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden mb-2 flex-shrink-0 flex flex-col relative transition-colors duration-200`,style:{height:e.isSettingsCollapsed?"auto":`${F}px`},children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-1.533 2.16-1.535.113-1.535 2.322 0 2.435 1.594.118 2.073 1.274 1.533 2.16-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.948c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.948c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042 1.533-2.16 1.535-.113 1.535-2.322 0-2.435-1.594-.118-2.073-1.274-1.533-2.16.836-1.372-.734-2.942-2.106-2.106a1.533 1.533 0 01-2.287-.948zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:f("node.content.activePromptStack")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:f("toolbar.resetToDefault"),onClick:Y,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{title:e.isSettingsCollapsed?f("node.action.expand"):f("node.action.collapse"),onClick:R=>{R.stopPropagation(),t({isSettingsCollapsed:!e.isSettingsCollapsed})},children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isSettingsCollapsed&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"p-2 border-b border-gray-700 bg-gray-800/80 sticky top-0 z-10 flex items-center gap-2",children:o.jsxs("div",{className:"relative w-full",children:[o.jsx("input",{type:"text",value:O,onChange:R=>D(R.target.value),placeholder:f("node.content.findStack"),className:"w-full pl-7 pr-2 py-1 text-xs bg-gray-900/80 border border-gray-600 rounded-md focus:outline-none focus:border-emerald-500 text-gray-300 placeholder-gray-600"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),O&&o.jsx("button",{onClick:()=>D(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:""})]})}),o.jsxs("div",{ref:G,className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar flex-grow pb-4 relative",onWheel:R=>R.stopPropagation(),children:[ee(ge(M),f("node.content.model"))&&o.jsx(Pt,{id:"model-brick",label:f("node.content.model"),originalText:ge(M),isMandatory:!0,color:"gray",className:"mb-2"}),ee(Se.INPUTS.text,f(`instruction.${Se.INPUTS.id}`))&&o.jsx(Pt,{ref:R=>{z.current[Se.INPUTS.id]=R},id:Se.INPUTS.id,index:++Z,label:f(`instruction.${Se.INPUTS.id}`),originalText:Se.INPUTS.text,translatedText:f(`instruction.desc.${Se.INPUTS.id}`),isMandatory:!0,color:"gray",isHighlighted:L===Se.INPUTS.id}),ee(Un(N),f("node.content.targetLanguage"))&&o.jsx(Pt,{id:"target-lang-brick",index:++Z,label:f("node.content.targetLanguage"),originalText:Un(N),translatedText:f("instruction.desc.target_lang"),isMandatory:!0,color:"gray"}),ee("Enable extended reasoning",f("node.content.thinkingEnabled"))&&o.jsx(Pt,{ref:R=>{z.current.thinking_mode=R},id:"thinking_mode",index:w?++Z:void 0,label:f("node.content.thinkingEnabled"),originalText:"Enable extended reasoning for deeper plot coherence.",translatedText:"     .",isEnabled:w,onToggle:()=>n({thinkingEnabled:!w}),color:"cyan",isHighlighted:L==="thinking_mode"}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.system")}),ee(Ko.text,f("node.content.safeGeneration"))&&o.jsx(Pt,{ref:R=>{z.current.safe_gen=R},id:"safe_gen",index:m?++Z:void 0,label:f("node.content.safeGeneration"),originalText:Ko.text,translatedText:f("instruction.desc.safe_gen"),isCritical:!0,isEnabled:m,onToggle:()=>n({safeGeneration:!m}),isHighlighted:L==="safe_gen"}),ee(Se.BATCH_PROCESSING.text,f("instruction.batch_processing"))&&o.jsx(Pt,{ref:R=>{z.current[Se.BATCH_PROCESSING.id]=R},id:Se.BATCH_PROCESSING.id,index:d?++Z:void 0,label:f("instruction.batch_processing"),originalText:Se.BATCH_PROCESSING.text,translatedText:f("instruction.desc.batch_processing"),isEnabled:d,onToggle:()=>n({batchProcessing:!d}),color:"emerald",isHighlighted:L===Se.BATCH_PROCESSING.id})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.role")}),ee(Se.ROLE.text,f("instruction.ana_role"))&&o.jsx(Pt,{ref:R=>{z.current[Se.ROLE.id]=R},id:Se.ROLE.id,index:++Z,label:f("instruction.ana_role"),originalText:Se.ROLE.text,translatedText:f("instruction.desc.ana_role"),isMandatory:!0,color:"emerald",isHighlighted:L===Se.ROLE.id}),ee(Se.STATIC_FRAME_LOGIC.text,Se.STATIC_FRAME_LOGIC.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.STATIC_FRAME_LOGIC.id]=R},id:Se.STATIC_FRAME_LOGIC.id,index:++Z,label:f("instruction.static_frame_logic"),originalText:Se.STATIC_FRAME_LOGIC.text,translatedText:f("instruction.desc.static_frame_logic"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.STATIC_FRAME_LOGIC.id}),ee(Se.ANATOMICAL_POSING.text,Se.ANATOMICAL_POSING.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.ANATOMICAL_POSING.id]=R},id:Se.ANATOMICAL_POSING.id,index:++Z,label:f("instruction.anatomical_posing"),originalText:Se.ANATOMICAL_POSING.text,translatedText:f("instruction.desc.anatomical_posing"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.ANATOMICAL_POSING.id}),ee(Se.ANATOMICAL_STRICTNESS.text,Se.ANATOMICAL_STRICTNESS.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.ANATOMICAL_STRICTNESS.id]=R},id:Se.ANATOMICAL_STRICTNESS.id,index:++Z,label:f("instruction.anatomical_strictness"),originalText:Se.ANATOMICAL_STRICTNESS.text,translatedText:f("instruction.desc.anatomical_strictness"),isEnabled:_,onToggle:()=>n({anatomicalStrictness:!_}),color:"emerald",isCritical:!0,isHighlighted:L===Se.ANATOMICAL_STRICTNESS.id}),ee(Se.PROP_CONSISTENCY.text,Se.PROP_CONSISTENCY.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.PROP_CONSISTENCY.id]=R},id:Se.PROP_CONSISTENCY.id,index:++Z,label:f("instruction.prop_consistency"),originalText:Se.PROP_CONSISTENCY.text,translatedText:f("instruction.desc.prop_consistency"),isEnabled:v,onToggle:()=>n({propConsistency:!v}),color:"emerald",isHighlighted:L===Se.PROP_CONSISTENCY.id}),ee(Se.MOTION_DYNAMICS.text,Se.MOTION_DYNAMICS.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.MOTION_DYNAMICS.id]=R},id:Se.MOTION_DYNAMICS.id,index:++Z,label:f("instruction.motion_dynamics"),originalText:Se.MOTION_DYNAMICS.text,translatedText:f("instruction.desc.motion_dynamics"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.MOTION_DYNAMICS.id}),ee(Se.SUBJECT_HIERARCHY.text,Se.SUBJECT_HIERARCHY.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.SUBJECT_HIERARCHY.id]=R},id:Se.SUBJECT_HIERARCHY.id,index:++Z,label:f("instruction.subject_hierarchy"),originalText:Se.SUBJECT_HIERARCHY.text,translatedText:f("instruction.desc.subject_hierarchy"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.SUBJECT_HIERARCHY.id}),ee(Se.RULE_ISOLATION.text,Se.RULE_ISOLATION.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.RULE_ISOLATION.id]=R},id:Se.RULE_ISOLATION.id,index:++Z,label:f("instruction.rule_isolation"),originalText:Se.RULE_ISOLATION.text,translatedText:f("instruction.desc.rule_isolation"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.RULE_ISOLATION.id}),ee(Se.SENSORY_SATURATION.text,Se.SENSORY_SATURATION.label)&&o.jsx(Pt,{ref:R=>{z.current[Se.SENSORY_SATURATION.id]=R},id:Se.SENSORY_SATURATION.id,index:++Z,label:f("instruction.sensory_saturation"),originalText:Se.SENSORY_SATURATION.text,translatedText:f("instruction.desc.sensory_saturation"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.SENSORY_SATURATION.id})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.cinematography")}),ee(Se.SHOT_FILTER_WIDE.text,f("node.content.shotFilter.wideOnly"))&&o.jsx(Pt,{ref:R=>{z.current[Se.SHOT_FILTER_WIDE.id]=R},id:Se.SHOT_FILTER_WIDE.id,index:W?++Z:void 0,label:f("node.content.shotFilter.wideOnly"),originalText:Se.SHOT_FILTER_WIDE.text,translatedText:f("instruction.desc.shot_filter_wide"),isEnabled:W,onToggle:()=>n({shotFilter:W?"all":"wideOnly"}),color:"cyan",isHighlighted:L===Se.SHOT_FILTER_WIDE.id}),ee(ue,f(W?"instruction.ana_cinema_wide":"instruction.ana_cinema"))&&o.jsx(Pt,{ref:R=>{z.current[pe]=R},id:pe,index:g?++Z:void 0,label:f(W?"instruction.ana_cinema_wide":"instruction.ana_cinema"),originalText:ue,translatedText:f(Oe),isEnabled:g,onToggle:()=>n({cinematographyEnabled:!g}),color:"emerald",isHighlighted:L===pe}),ee(X,f(W?"instruction.storyboard_rules_wide":"instruction.storyboard_rules"))&&o.jsx(Pt,{ref:R=>{z.current[le]=R},id:le,index:h?++Z:void 0,label:f(W?"instruction.storyboard_rules_wide":"instruction.storyboard_rules"),originalText:X,translatedText:f(Te),isEnabled:h,onToggle:()=>n({professionalStoryboard:!h}),color:"emerald",isHighlighted:L===le}),ee(ye,f(W?"instruction.tech_directives_wide":"instruction.tech_directives"))&&o.jsx(Pt,{ref:R=>{z.current[he]=R},id:he,index:++Z,label:f(W?"instruction.tech_directives_wide":"instruction.tech_directives"),originalText:ye,translatedText:f(j),isEnabled:!0,isMandatory:!0,color:"emerald",className:"opacity-100",isHighlighted:L===he}),ee(fe,f("instruction.rule_mandatory_bg"))&&o.jsx(Pt,{ref:R=>{z.current[B]=R},id:B,index:a?++Z:void 0,label:f("instruction.rule_mandatory_bg"),originalText:fe,translatedText:f(ie),isCritical:!0,isEnabled:a,onToggle:()=>n({mandatoryBgEnabled:!a}),isHighlighted:L===B}),ee(Q,oe)&&o.jsx(Pt,{ref:R=>{z.current[q]=R},id:q,index:l?++Z:void 0,label:oe,originalText:Q,translatedText:f(J),isEnabled:l,onToggle:()=>n({extendedAnalysis:!l}),color:"cyan",isHighlighted:L===q}),ee(Se.ACTION_PHASE_BREAKDOWN.text,f("node.content.microActionBreakdown"))&&o.jsx(Pt,{ref:R=>{z.current[Se.ACTION_PHASE_BREAKDOWN.id]=R},id:Se.ACTION_PHASE_BREAKDOWN.id,index:c?++Z:void 0,label:f("node.content.microActionBreakdown"),originalText:Se.ACTION_PHASE_BREAKDOWN.text,translatedText:f("instruction.desc.action_phase_breakdown"),isEnabled:c,onToggle:()=>n({microActionBreakdown:!c}),color:"cyan",isHighlighted:L===Se.ACTION_PHASE_BREAKDOWN.id}),ee(f("node.content.recommendedFrames"),f("node.content.recommendedFrames"))&&o.jsx(Pt,{id:"framing-logic",index:++Z,label:f("node.content.recommendedFrames"),originalText:k||E?`GLOBAL FRAME COUNT: Generate between ${k||1} and ${E||"unlimited"} frames per scene.`:P?`GLOBAL MINIMUM FRAMES: Generate at least ${P} frames per scene.`:"PER-SCENE FRAMING: Check 'recommendedFrames' property per scene. Generate enough shots to cover narrative pacing.",translatedText:k||E?` :  ${k||1}  ${E||"."} .`:P?` : ${P}   .`:"     .",isMandatory:!0,color:"gray"})]}),o.jsxs("div",{className:"space-y-1 mb-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.world")}),ee(Se.HIERARCHY.text,f("instruction.rule_hierarchy"))&&o.jsx(Pt,{ref:R=>{z.current[Se.HIERARCHY.id]=R},id:Se.HIERARCHY.id,index:r?++Z:void 0,label:f("instruction.rule_hierarchy"),originalText:Se.HIERARCHY.text,translatedText:f("instruction.desc.rule_hierarchy"),isEnabled:r,onToggle:()=>n({hierarchyEnabled:!r}),color:"emerald",isHighlighted:L===Se.HIERARCHY.id}),ee(Se.LIVING_WORLD.text,f("instruction.rule_living_world"))&&o.jsx(Pt,{ref:R=>{z.current[Se.LIVING_WORLD.id]=R},id:Se.LIVING_WORLD.id,index:s?++Z:void 0,label:f("instruction.rule_living_world"),originalText:b?"**LIVING WORLD & EXTRAS (ANTHRO):** Describe background extras/crowds as **Anthropomorphic Animals** of diverse species.":Se.LIVING_WORLD.text,translatedText:f(b?"instruction.desc.rule_living_world_anthro":"instruction.desc.rule_living_world"),isEnabled:s,onToggle:()=>n({livingWorldEnabled:!s}),color:"emerald",isHighlighted:L===Se.LIVING_WORLD.id}),ee(Se.STATE_PERSISTENCE.text,f("instruction.rule_persistence"))&&o.jsx(Pt,{ref:R=>{z.current[Se.STATE_PERSISTENCE.id]=R},id:Se.STATE_PERSISTENCE.id,index:i?++Z:void 0,label:f("instruction.rule_persistence"),originalText:Se.STATE_PERSISTENCE.text,translatedText:f("instruction.desc.rule_persistence"),isEnabled:i,onToggle:()=>n({statePersistenceEnabled:!i}),color:"emerald",isHighlighted:L===Se.STATE_PERSISTENCE.id}),ee(Se.USE_ALIASES.text,f("instruction.use_aliases"))&&o.jsx(Pt,{ref:R=>{z.current[Se.USE_ALIASES.id]=R},id:Se.USE_ALIASES.id,index:++Z,label:f("instruction.use_aliases"),originalText:Se.USE_ALIASES.text,translatedText:f("instruction.desc.use_aliases"),isMandatory:!0,color:"gray",isHighlighted:L===Se.USE_ALIASES.id}),ee(Se.CHARACTER_ARRAY_INTEGRITY.text,f("instruction.character_array_integrity"))&&o.jsx(Pt,{ref:R=>{z.current[Se.CHARACTER_ARRAY_INTEGRITY.id]=R},id:Se.CHARACTER_ARRAY_INTEGRITY.id,index:++Z,label:f("instruction.character_array_integrity"),originalText:Se.CHARACTER_ARRAY_INTEGRITY.text,translatedText:f("instruction.desc.character_array_integrity"),isMandatory:!0,isCritical:!0,isHighlighted:L===Se.CHARACTER_ARRAY_INTEGRITY.id}),ee(Se.ANTHRO_LOGIC.text,f("node.content.anthroEnabled"))&&o.jsx(Pt,{ref:R=>{z.current[Se.ANTHRO_LOGIC.id]=R},id:Se.ANTHRO_LOGIC.id,index:b?++Z:void 0,label:f("node.content.anthroEnabled"),originalText:Se.ANTHRO_LOGIC.text,translatedText:f("instruction.desc.ana_anthro_logic"),isEnabled:b,onToggle:()=>n({anthroEnabled:!b}),color:"cyan",isHighlighted:L===Se.ANTHRO_LOGIC.id}),ee(Se.SUBSCRIBE_LOGIC.text,f("node.content.subscribeEnhancement"))&&o.jsx(Pt,{ref:R=>{z.current[Se.SUBSCRIBE_LOGIC.id]=R},id:Se.SUBSCRIBE_LOGIC.id,index:S?++Z:void 0,label:f("node.content.subscribeEnhancement"),originalText:Se.SUBSCRIBE_LOGIC.text,translatedText:f("instruction.desc.ana_subscribe_logic"),isEnabled:S,onToggle:()=>n({subscribeEnhancement:!S}),color:"cyan",isHighlighted:L===Se.SUBSCRIBE_LOGIC.id})]})]}),o.jsx("div",{className:"absolute bottom-0 inset-x-0 h-3 cursor-ns-resize bg-transparent z-20",onMouseDown:ae,onMouseEnter:()=>U(!0),onMouseLeave:()=>U(!1)})]})]})}),JA=bt.memo(({fullDescription:e,onDescriptionChange:t,readOnly:n=!1,t:r,onFocus:a})=>{const[i,s]=x.useState({});x.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Personality",:"Clothing",Appearance:"Appearance",Personality:"Personality",Clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing||||)\s*([\s\S]*?)(?=####|$)/gi;let g,m=!1;for(;(g=h.exec(e))!==null;){m=!0;const w=d[g[1].trim()],y=g[2].trim();w&&(c[w]=y)}!m&&e.trim()&&(c.Appearance=e.trim()),s(c)},[e]);const l=(c,d)=>{const h={...i,[c]:d},g=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(g)};return o.jsx("div",{className:"space-y-2 text-sm",children:["Appearance","Personality","Clothing"].map(c=>o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider",children:r(`node.content.${c.toLowerCase()}`)||c}),o.jsx("textarea",{value:i[c]||"",onChange:d=>l(c,d.target.value),readOnly:n,className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll read-only:bg-gray-900/50 read-only:text-gray-400",onWheel:d=>d.stopPropagation(),onFocus:a})]},c))})}),Ct=({checked:e,onChange:t,disabled:n,id:r,className:a="h-4 w-4",title:i})=>o.jsx("button",{type:"button",id:r,role:"checkbox","aria-checked":e,disabled:n,onClick:s=>{s.stopPropagation(),n||t(!e)},onMouseDown:s=>{s.stopPropagation(),s.preventDefault()},title:i,className:`
        relative flex items-center justify-center 
        rounded border 
        transition-colors duration-200 ease-in-out flex-shrink-0
        outline-none focus:outline-none focus-visible:ring-1 focus-visible:ring-emerald-500
        ${a}
        ${e?"bg-emerald-600 border-emerald-500 hover:bg-emerald-500":"bg-gray-900 border-gray-600 hover:border-gray-500"}
        ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,children:o.jsx("svg",{className:`w-[70%] h-[70%] text-white transition-transform duration-200 ${e?"scale-100 opacity-100":"scale-0 opacity-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),XA=bt.memo(({char:e,currentId:t,isSelected:n,isCollapsed:r,t:a,onClick:i,onToggleCollapse:s,onUpdate:l,deselectAllNodes:c,onEmbed:d,onDelete:h})=>o.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 mb-2 space-y-2 border border-gray-700 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:g=>{g.target.closest("input, button")||s(t)},children:[o.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[e.isLinked&&o.jsx("div",{title:"Linked from upstream (Read-only)",className:"mr-2 text-emerald-400 flex-shrink-0",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),o.jsx(Pe,{tooltipPosition:"right",title:a("node.action.togglePanel"),onClick:g=>{g.stopPropagation(),s(t)},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"text",value:e.name,readOnly:e.isLinked,onChange:g=>l(t,"name",g.target.value),className:`font-semibold text-white bg-transparent w-64 rounded px-1 border border-transparent focus:border-emerald-500 focus:ring-0 focus:bg-gray-800 focus:outline-none transition-colors ${e.isLinked?"cursor-not-allowed text-gray-400 focus:border-transparent":""}`,onMouseDown:g=>g.stopPropagation()}),o.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 truncate max-w-[120px]",title:String(t),children:["(",t,")"]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:[a("node.content.characterIndex"),":"]}),o.jsx("input",{type:"text",value:e.index||"",readOnly:e.isLinked,onChange:g=>l(t,"index",g.target.value),className:`font-semibold text-white bg-gray-800 w-24 rounded px-1 text-xs py-0.5 border border-transparent focus:border-emerald-500 focus:ring-0 focus:outline-none transition-colors ${e.isLinked?"bg-gray-900/50 text-gray-400 cursor-not-allowed focus:border-transparent":""}`,onFocus:c,onMouseDown:g=>g.stopPropagation()}),h&&o.jsx(Pe,{tooltipPosition:"left",title:a("node.action.deleteItem"),onClick:g=>{g.stopPropagation(),h(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!r&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-1 mb-2",children:[o.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:a("node.content.imagePrompt")}),o.jsx("textarea",{value:e.imagePrompt||e.prompt||"",onChange:g=>l(t,"imagePrompt",g.target.value),readOnly:e.isLinked,className:`w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll ${e.isLinked?"bg-gray-900/50 text-gray-400 cursor-not-allowed":""}`,onWheel:g=>g.stopPropagation(),onMouseDown:g=>g.stopPropagation()})]}),o.jsx(JA,{fullDescription:e.fullDescription||"",onDescriptionChange:g=>l(t,"fullDescription",g),readOnly:e.isLinked,t:a,onFocus:c})]})]})),ZA=bt.memo(({uiState:e,initialHeight:t,onHeightChange:n,scale:r,onUpdateUiState:a,onUpdateValue:i,onApplyAliases:s,nodeId:l,autoIndexCharacters:c,charactersToDisplay:d,selectedCharacters:h,collapsedCharacters:g,areAllCharactersCollapsed:m,onToggleAllCharacters:w,handleCharacterClick:y,handleToggleCharacterCollapse:b,updateCharacter:S,visualStyle:_,upstreamVisualStyle:v,deselectAllNodes:f,t:T,onEmbedCharacter:A,onSyncCharacters:I,onClearCharacters:M,onDeleteCharacter:N,isSyncAvailable:k,onMoveCharacter:E,onAddCharacter:P})=>{const[L,H]=x.useState(!1),$=x.useRef(null),[U,O]=x.useState(t||170);x.useEffect(()=>{Math.abs(t-U)>1&&O(t||170)},[t]);const D=F=>{F.preventDefault(),F.stopPropagation();const K=F.clientY,ae=U;let Y=ae;const ge=le=>{le.preventDefault(),le.stopPropagation();const X=(le.clientY-K)/r;Y=Math.max(100,Math.min(800,ae+X)),$.current&&requestAnimationFrame(()=>{$.current&&($.current.style.height=`${Y}px`)})},W=le=>{le.preventDefault(),le.stopPropagation(),window.removeEventListener("mousemove",ge),window.removeEventListener("mouseup",W),O(Y),n(Y)};window.addEventListener("mousemove",ge),window.addEventListener("mouseup",W)},z=x.useMemo(()=>[...d||[]].sort((K,ae)=>{const Y=le=>{const X=(le||"").match(/(\d+)/);return X?parseInt(X[1],10):99999},ge=K.index||"",W=ae.index||"";return Y(ge)-Y(W)}),[d]),G={};return z.forEach(F=>{const K=(F.name||"").trim().toLowerCase();G[K]=(G[K]||0)+1}),z.forEach(F=>{(F.index||F.alias||"").trim().toLowerCase()}),o.jsxs("div",{ref:$,style:{height:e.isCharStyleCollapsed?"auto":`${U}px`},className:`flex-shrink-0 mb-1 bg-gray-900 rounded-md border ${L?"border-emerald-500":"border-gray-700"} hover:border-gray-400 overflow-hidden flex flex-col transition-all duration-200 relative`,children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>a({isCharStyleCollapsed:!e.isCharStyleCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:T("node.content.characters")}),k&&I&&o.jsx(ht,{title:T("node.action.refreshData"),position:"top",children:o.jsx("button",{onClick:F=>{F.stopPropagation(),I()},className:"p-1 hover:bg-gray-700 rounded text-emerald-400 hover:text-emerald-300 transition-colors ml-1",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(ht,{title:T(m?"node.action.expandAll":"node.action.collapseAll"),position:"top",children:o.jsx("button",{onClick:F=>{F.stopPropagation(),w()},disabled:e.isCharStyleCollapsed,className:`p-1 rounded transition-colors ${e.isCharStyleCollapsed?"text-gray-600 cursor-default":"hover:bg-gray-700 text-emerald-400 hover:text-emerald-300"}`,children:m?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})}),P&&o.jsx(Pe,{tooltipPosition:"left",title:T("node.action.addCharacter"),onClick:F=>{F.stopPropagation(),P()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),M&&o.jsx(Pe,{tooltipPosition:"left",title:T("node.action.clear"),onClick:F=>{F.stopPropagation(),M()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx(ht,{title:T("node.action.index"),position:"left",children:o.jsx("button",{onClick:F=>{F.stopPropagation(),s(l)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-gray-200 transition-colors",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),o.jsxs("div",{className:"flex items-center space-x-2 pl-1",onClick:F=>F.stopPropagation(),children:[o.jsx(Ct,{id:`auto-index-${l}`,checked:c,onChange:F=>i({autoIndexCharacters:F}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`auto-index-${l}`,className:"text-[10px] font-medium text-gray-400 cursor-pointer select-none uppercase tracking-wide",children:T("node.content.autoIndexCharacters")})]}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{tooltipPosition:"left",title:e.isCharStyleCollapsed?T("node.action.expand"):T("node.action.collapse"),onClick:F=>{F.stopPropagation(),a({isCharStyleCollapsed:!e.isCharStyleCollapsed})},children:e.isCharStyleCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isCharStyleCollapsed&&o.jsx("div",{style:{contentVisibility:"auto"},className:"p-2 space-y-2 overflow-y-auto custom-scrollbar flex-grow",onWheel:F=>F.stopPropagation(),children:z.map((F,K)=>{const ae=F.id||`char-idx-${K}`,Y=G[(F.name||"").trim().toLowerCase()]>1;return(F.index||F.alias||"").trim().toLowerCase(),o.jsxs("div",{className:Y?"border-red-500 border rounded-lg":"",children:[Y&&o.jsx("div",{className:"text-[10px] text-red-400 bg-red-900/30 px-2 py-0.5 rounded-t-lg",children:"Duplicate Name Warning"}),o.jsx(XA,{char:F,currentId:ae,isSelected:h.has(ae),isCollapsed:g.has(ae),t:T,onToggleCollapse:b,onClick:y,onUpdate:S,onEmbed:A,onDelete:N,deselectAllNodes:f})]},ae)})}),!e.isCharStyleCollapsed&&o.jsx("div",{className:"absolute bottom-0 inset-x-0 h-3 cursor-ns-resize bg-transparent z-20",onMouseDown:D,onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1)})]})}),QA=bt.memo(({scene:e,t,isCollapsed:n,onToggle:r})=>{const a=e.characters&&Array.isArray(e.characters)?e.characters.map(i=>{const s=i.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return s?`ENT-${s[1]}`:i}).join(", "):null;return o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent hover:border-gray-700/50 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:i=>{i.stopPropagation(),r()},children:[o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-semibold text-gray-300 text-sm truncate pr-2",children:`${t("node.content.scene")} ${e.sceneNumber}${e.title?`: ${e.title}`:""}`}),o.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.recommendedFrames!==void 0&&o.jsxs("span",{className:"text-[9px] text-emerald-500 font-mono font-bold uppercase tracking-wider",children:[t("node.content.recommendedFrames"),": ",e.recommendedFrames]}),a&&o.jsx("span",{className:"text-[9px] text-cyan-300 font-mono uppercase tracking-wider bg-cyan-900/30 px-1 rounded truncate max-w-[150px]",title:a,children:a})]})]}),o.jsx(Pe,{tooltipPosition:"left",title:t(n?"node.action.expandScene":"node.action.collapseScene"),onClick:i=>{i.stopPropagation(),r()},children:n?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!n&&o.jsxs("div",{className:"mt-2 text-xs",children:[o.jsx("p",{className:"text-gray-400 whitespace-pre-wrap select-text",children:e.description}),e.narratorText&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700/50",children:[o.jsx("p",{className:"font-semibold text-emerald-400 mb-1",children:t("node.content.narrator")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-emerald-500",children:e.narratorText})]})]})]})}),e5=bt.memo(({width:e,upstreamScriptData:t,collapsedInputScenes:n,isSummaryCollapsed:r,onToggleInputSceneCollapse:a,setIsSummaryCollapsed:i,t:s,onToggleAllInputScenes:l,areAllInputScenesCollapsed:c})=>o.jsxs("div",{className:"overflow-y-scroll overflow-x-hidden custom-scrollbar pr-1 space-y-2 px-1 pb-1",style:{width:e,contentVisibility:"auto"},onWheel:d=>d.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pr-2 sticky top-0 bg-gray-900 z-10 py-1 border-b border-gray-800/50 mb-2 -mx-1 px-2",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-1",children:s("node.content.inputScripts")}),(t==null?void 0:t.scenes)&&t.scenes.length>0&&o.jsx(Pe,{tooltipPosition:"left",title:s(c?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:l,children:c?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),r?(t==null?void 0:t.summary)&&o.jsx("div",{className:"bg-gray-800/50 rounded-lg p-2 cursor-pointer hover:bg-gray-800 border border-transparent hover:border-gray-700/50 transition-colors",onClick:()=>i(!1),children:o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex items-center",children:[o.jsx("span",{className:"truncate mr-2",children:s("node.content.summary")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})}):(t==null?void 0:t.summary)&&o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent",children:[o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex justify-between items-center cursor-pointer",onClick:()=>i(!0),children:[o.jsx("span",{children:s("node.content.summary")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]}),o.jsx("div",{className:"mt-1 text-xs text-gray-400 whitespace-pre-wrap select-text",children:t.summary})]}),t!=null&&t.scenes&&t.scenes.length>0?t.scenes.map((d,h)=>o.jsx(QA,{scene:d,t:s,isCollapsed:n.has(h),onToggle:()=>a(h)},h)):o.jsx("div",{className:"text-center text-xs text-gray-500 p-4",children:s("node.content.noInputScenes")})]})),t5=({characters:e,onChange:t,availableCharacters:n})=>{const r=l=>{const c=l.match(/(?:Entity|Character|)[-\s]?(\d+)/i);if(c)return parseInt(c[1],10);const d=l.match(/(\d+)/);return d?parseInt(d[1],10):null},a=(l,c)=>{const d=e[l];let h=r(d);h===null&&(h=0);const m=`Entity-${Math.max(1,h+c)}`,w=[...e];w[l]=m,t(w)},i=l=>{const c=e.filter((d,h)=>h!==l);t(c)},s=()=>{let l=0;e.forEach(d=>{const h=r(d);h!==null&&h>l&&(l=h)});const c=[...e,`Entity-${l+1}`];t(c)};return o.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[e.map((l,c)=>{const h=`ENT-${r(l)??"?"}`;return o.jsxs("div",{className:"flex items-center bg-gray-900 rounded px-1 border border-gray-600 h-6",children:[o.jsx("span",{className:"text-xs font-mono text-gray-300 mr-1 select-none",title:l,children:h}),o.jsxs("div",{className:"flex flex-col -space-y-0.5",children:[o.jsx("button",{onClick:g=>{g.stopPropagation(),a(c,1)},className:"text-[8px] leading-none text-gray-500 hover:text-white",children:""}),o.jsx("button",{onClick:g=>{g.stopPropagation(),a(c,-1)},className:"text-[8px] leading-none text-gray-500 hover:text-white",children:""})]}),o.jsx("button",{onClick:g=>{g.stopPropagation(),i(c)},className:"ml-1 text-xs text-gray-500 hover:text-white",children:""})]},c)}),o.jsx("button",{onClick:l=>{l.stopPropagation(),s()},className:"w-6 h-6 flex items-center justify-center bg-gray-900 hover:bg-gray-700 border border-gray-600 rounded text-gray-400 hover:text-white text-xs font-bold",title:"Add character reference",children:"+"})]})},n5=bt.memo(({frame:e,sceneIndex:t,frameIndex:n,frameUniqueId:r,isSelected:a,isCollapsed:i,availableCharacters:s,t:l,onClick:c,onToggleCollapse:d,onUpdate:h,onAddFrame:g,onReorder:m,onDelete:w,onCopy:y,handleTextFocus:b})=>{const S=(e.characters||[]).map(T=>{const A=T.match(/(?:Entity|Character|)[-\s]?(\d+)/i);if(A)return`ENT-${A[1]}`;const I=s.find(M=>M.name===T);if(I){const M=I.index||I.alias;if(M){const N=M.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return N?`ENT-${N[1]}`:M}}return T}),_=S.length>0?S.join(", "):"NONE",v=e.shotType?` [${e.shotType}]`:"",f=`F${e.frameNumber}-S${e.sceneNumber||t+1}: ${_}${v} (${e.duration}s)`;return o.jsxs("div",{className:`bg-gray-800 rounded-lg p-2 space-y-2 border ${a?"border-emerald-500":"border-gray-700"} cursor-pointer`,onClick:T=>c(T,r),children:[o.jsxs("div",{className:"flex justify-between items-center",onClick:T=>{T.target.closest("input, button")||d(r)},children:[o.jsxs("div",{className:"flex items-center space-x-2 flex-grow min-w-0",children:[o.jsx(Pe,{tooltipPosition:"right",title:l(i?"node.action.expandFrame":"node.action.collapseFrame"),onClick:T=>{T.stopPropagation(),d(r)},children:i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("h4",{className:"font-bold text-white truncate pr-2 text-sm",children:f})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.addFrame"),onClick:T=>{T.stopPropagation(),g(t,n)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.moveUp"),onClick:T=>{T.stopPropagation(),m(t,n,"up")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.moveDown"),onClick:T=>{T.stopPropagation(),m(t,n,"down")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.deleteItem"),onClick:T=>{T.stopPropagation(),w(t,n)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!i&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-1 rounded border border-gray-700 overflow-hidden",children:[o.jsxs("div",{className:"flex items-center ml-1",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase flex-shrink-0",children:":"})]}),o.jsx("input",{type:"number",value:e.duration,onChange:T=>h(t,n,"duration",parseInt(T.target.value)||0),className:"w-10 p-0.5 bg-gray-800 text-white rounded text-[10px] border border-gray-600 outline-none focus:border-emerald-500 text-center",onFocus:b,onMouseDown:T=>T.stopPropagation()})]}),o.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-1 rounded border border-gray-700 overflow-hidden",children:[o.jsxs("div",{className:"flex items-center ml-1",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),o.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase flex-shrink-0",children:":"})]}),o.jsx("input",{type:"text",value:e.shotType||"",onChange:T=>h(t,n,"shotType",T.target.value),placeholder:"...",className:"w-14 p-0.5 bg-gray-800 text-white rounded text-[10px] border border-gray-600 outline-none focus:border-emerald-500 font-mono uppercase px-1 text-center",onFocus:b,onMouseDown:T=>T.stopPropagation()})]})]}),o.jsxs("div",{className:"bg-gray-900/30 p-1.5 rounded border border-gray-700",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase block mb-1",children:l("node.content.characters")}),o.jsx(t5,{characters:e.characters||[],onChange:T=>h(t,n,"characters",T),availableCharacters:s})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-emerald-500 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("label",{className:"text-xs font-medium text-emerald-400",children:l("node.content.compositionAndBlocking")})]}),o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.copy"),onClick:T=>{T.stopPropagation(),y(e.imagePrompt)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{value:e.imagePrompt,onChange:T=>h(t,n,"imagePrompt",T.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",onFocus:b,onMouseDown:T=>T.stopPropagation()})]}),o.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-500 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsx("label",{className:"text-xs font-medium text-cyan-400",children:l("node.content.environmentPrompt")})]}),o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.copy"),onClick:T=>{T.stopPropagation(),y(e.environmentPrompt)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:e.environmentPrompt,onChange:T=>h(t,n,"environmentPrompt",T.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[40px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",onFocus:b,onMouseDown:T=>T.stopPropagation()})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-purple-500 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),o.jsx("label",{className:"text-xs font-medium text-purple-400",children:l("node.content.videoPrompt")})]}),o.jsx(Pe,{tooltipPosition:"left",title:l("node.action.copy"),onClick:T=>{T.stopPropagation(),y(e.videoPrompt)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:e.videoPrompt,onChange:T=>h(t,n,"videoPrompt",T.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[40px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",onFocus:b,onMouseDown:T=>T.stopPropagation()})]})]})]})]})}),o5=bt.memo(({width:e,scenes:t,characters:n,areAllOutputScenesCollapsed:r,areAllFramesCollapsed:a,collapsedOutputScenes:i,collapsedFrames:s,collapsedContexts:l,selectedFrames:c,onToggleAllOutputScenes:d,onToggleAllFramesCollapse:h,onToggleOutputSceneCollapse:g,onToggleSceneContextCollapse:m,onToggleCollapse:w,onAddFrame:y,onAddScene:b,onRenameScene:S,onReorderFrame:_,onDeleteFrame:v,onFramePartChange:f,onSceneContextChange:T,onFrameClick:A,onCopy:I,handleTextFocus:M,t:N,onDeleteScene:k})=>{const[E,P]=x.useState(null),[L,H]=x.useState(""),$=(D,z,G)=>{G.stopPropagation(),P(D),H(z)},U=D=>{S(D,L),P(null)},O=()=>{P(null)};return o.jsxs("div",{className:"overflow-y-scroll custom-scrollbar pl-1 space-y-2 px-1 pb-1",style:{width:e,contentVisibility:"auto"},onWheel:D=>D.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pr-2 sticky top-0 bg-gray-900 z-10 py-1 border-b border-gray-800/50 -mx-1 px-2",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-2",children:N("node.content.frames")}),o.jsxs("div",{className:"flex items-center space-x-1",children:[t.length===0&&o.jsx(Pe,{tooltipPosition:"left",title:N("node.action.addFirstFrame"),onClick:D=>{D.stopPropagation(),b()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),t.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(Pe,{tooltipPosition:"left",title:N("node.action.addScene"),onClick:D=>{D.stopPropagation(),b()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:N(r?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:d,children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}),o.jsx(Pe,{tooltipPosition:"left",title:N(a?"node.action.expandAllFrames":"node.action.collapseAllFrames"),onClick:h,disabled:r,children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})})]})]})]}),t.map((D,z)=>{var K;const G=i.has(z),F=l.has(z);return D.title||`${D.sceneNumber}`,o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{className:"group px-2 py-1 mb-1 text-xs font-bold text-gray-400 uppercase border-b border-gray-700 hover:bg-gray-800/50 transition-colors rounded",onClick:()=>g(z),children:o.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[o.jsx(Pe,{tooltipPosition:"right",title:N(G?"node.action.expandScene":"node.action.collapseScene"),onClick:ae=>{ae.stopPropagation(),g(z)},children:G?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),E===z?o.jsx("input",{type:"text",value:L,onChange:ae=>H(ae.target.value),onBlur:()=>U(z),onKeyDown:ae=>{ae.key==="Enter"?U(z):ae.key==="Escape"&&O()},onClick:ae=>ae.stopPropagation(),onMouseDown:ae=>ae.stopPropagation(),autoFocus:!0,className:"bg-gray-900 text-white px-1 py-0.5 rounded border border-emerald-500 outline-none w-full font-bold"}):o.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[o.jsx("span",{className:"truncate font-bold text-gray-300 text-sm",children:`${N("node.content.scene")} ${D.sceneNumber}: ${D.title||""}`}),o.jsx("button",{onClick:ae=>$(z,D.title||`Scene ${D.sceneNumber}`,ae),className:"opacity-0 group-hover:opacity-100 text-gray-500 hover:text-emerald-400 transition-opacity",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]})]}),o.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[o.jsxs("span",{className:"flex-shrink-0 text-[9px] bg-gray-700 px-1.5 py-0.5 rounded text-gray-400 font-mono",children:[((K=D.frames)==null?void 0:K.length)||0," ",N("node.content.frame_plural")]}),o.jsx(Pe,{tooltipPosition:"left",title:N("node.action.addFrame"),onClick:ae=>{ae.stopPropagation(),y(z)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:N("node.action.deleteItem"),onClick:ae=>{ae.stopPropagation(),k(z)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),!G&&o.jsxs("div",{className:"pl-2 space-y-2",children:[o.jsxs("div",{className:"bg-gray-800 p-2 rounded-md border border-gray-700 mb-2",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 cursor-pointer",onClick:ae=>{const Y=ae.target;Y&&!Y.closest("button")&&m(z)},children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{tooltipPosition:"right",title:N(F?"node.action.expand":"node.action.collapse"),onClick:ae=>{ae.stopPropagation(),m(z)},children:F?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx("label",{className:"text-xs font-bold text-emerald-400 cursor-pointer select-none",children:N("node.content.sceneContext")})]}),o.jsx(Pe,{tooltipPosition:"left",title:N("node.action.copy"),onClick:ae=>{ae.stopPropagation(),I(D.sceneContext||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),!F&&o.jsx("textarea",{value:D.sceneContext||"",onChange:ae=>T(z,ae.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[50px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",placeholder:N("node.content.sceneContextPlaceholder"),onFocus:M,onMouseDown:ae=>ae.stopPropagation()})]}),(D.frames||[]).map((ae,Y)=>{const ge=`${z}-${ae.frameNumber}`;return o.jsx(n5,{frame:ae,sceneIndex:z,frameIndex:Y,frameUniqueId:ge,isSelected:c.has(ge),isCollapsed:s.has(ge),availableCharacters:n,t:N,onClick:A,onToggleCollapse:w,onUpdate:f,onAddFrame:y,onReorder:_,onDelete:v,onCopy:I,handleTextFocus:M},ge)})]})]},D.sceneNumber)})]})}),rr=bt.memo(({id:e,onClick:t})=>o.jsx("button",{onClick:n=>{n.stopPropagation(),t(n,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",title:"Locate in Stack",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})),r5=({node:e,onValueChange:t,onAnalyzeScript:n,isAnalyzingScript:r,isStopping:a,onStopGeneration:i,t:s,getUpstreamTextValue:l,connections:c,connectedInputs:d,onApplyAliases:h,addToast:g,deselectAllNodes:m,inputData:w})=>{var Ot;const{language:y}=Bt(),[b,S]=x.useState(null),[_,v]=x.useState(new Set),[f,T]=x.useState(!0),[A,I]=x.useState(50),[M,N]=x.useState(new Set),[k,E]=x.useState(new Set),[P,L]=x.useState(new Set),[H,$]=x.useState(new Set),[U,O]=x.useState(new Set),[D,z]=x.useState(new Set),[G,F]=x.useState(null),K=(se,De)=>F(De),[ae,Y]=x.useState({current:0,total:0,last:0}),ge=r===e.id,{viewTransform:W}=Qo(),le=y==="en"?"ru":y,X=x.useMemo(()=>{try{const se=JSON.parse(e.value||"{}");return{characters:Array.isArray(se.characters)?se.characters:[],scenes:Array.isArray(se.scenes)?se.scenes:[],targetLanguage:se.targetLanguage||y,model:se.model||"gemini-3-pro-preview",startSceneNumber:se.startSceneNumber||null,endSceneNumber:se.endSceneNumber||null,framesPerScene:se.framesPerScene||null,minFrames:se.minFrames||null,maxFrames:se.maxFrames||null,hierarchyEnabled:se.hierarchyEnabled!==!1,mandatoryBgEnabled:se.mandatoryBgEnabled!==!1,statePersistenceEnabled:se.statePersistenceEnabled!==!1,livingWorldEnabled:se.livingWorldEnabled!==!1,extendedAnalysis:!!se.extendedAnalysis,microActionBreakdown:!!se.microActionBreakdown,batchProcessing:se.batchProcessing!==!1,professionalStoryboard:se.professionalStoryboard!==!1,cinematographyEnabled:se.cinematographyEnabled!==!1,safeGeneration:!!se.safeGeneration,thinkingEnabled:!!se.thinkingEnabled,shotFilter:se.shotFilter||"all",anthroEnabled:!!se.anthroEnabled,subscribeEnhancement:!!se.subscribeEnhancement,anatomicalStrictness:se.anatomicalStrictness!==!1,propConsistency:se.propConsistency!==!1,visualStyle:se.visualStyle||"",autoIndexCharacters:se.autoIndexCharacters!==!1,uiState:se.uiState||{isSettingsCollapsed:!0,isCharStyleCollapsed:!0},settingsPaneHeight:se.settingsPaneHeight||380,characterPaneHeight:se.characterPaneHeight||170,generationProgress:se.generationProgress||null}}catch{return{characters:[],scenes:[],targetLanguage:y,model:"gemini-3-pro-preview",uiState:{isSettingsCollapsed:!0,isCharStyleCollapsed:!0},settingsPaneHeight:380,characterPaneHeight:170,anatomicalStrictness:!0,propConsistency:!0,minFrames:null,maxFrames:null,framesPerScene:null}}},[e.value,y]),{characters:Te,scenes:pe,targetLanguage:ue,model:Oe,startSceneNumber:he,endSceneNumber:ye,minFrames:j,maxFrames:q,framesPerScene:Q,hierarchyEnabled:J,mandatoryBgEnabled:oe,statePersistenceEnabled:B,livingWorldEnabled:fe,extendedAnalysis:ie,microActionBreakdown:Z,batchProcessing:ee,professionalStoryboard:R,cinematographyEnabled:be,safeGeneration:Le,thinkingEnabled:je,shotFilter:Ue,anthroEnabled:Fe,subscribeEnhancement:ot,anatomicalStrictness:at,propConsistency:rt,visualStyle:Ce,autoIndexCharacters:ve,uiState:Ge,settingsPaneHeight:ce,characterPaneHeight:He,generationProgress:V}=X;x.useEffect(()=>{if(pe&&pe.length>0){const se=new Set(pe.map((Je,st)=>st)),De=new Set(pe.map((Je,st)=>st)),Re=new Set;pe.forEach((Je,st)=>{(Je.frames||[]).forEach(nt=>Re.add(`${st}-${nt.frameNumber}`))}),N(se),L(De),E(Re)}if(Te&&Te.length>0){const se=new Set(Te.map(De=>De.id||De.name));z(se)}},[]);const re=x.useCallback(se=>{const De={...X,...se};t(e.id,JSON.stringify(De))},[e.id,t,X]),ze=x.useCallback(se=>{re({uiState:{...Ge,...se}})},[re,Ge]),ne=se=>{se.preventDefault();const De=se.clientX,Re=A,Je=se.target.parentElement;if(!Je)return;const st=Je.offsetWidth,nt=W.scale,St=zt=>{const de=(zt.clientX-De)/nt,ke=Re+de/st*100;I(Math.max(20,Math.min(80,ke)))},Ft=()=>{window.removeEventListener("mousemove",St),window.removeEventListener("mouseup",Ft)};window.addEventListener("mousemove",St),window.addEventListener("mouseup",Ft)},xe=se=>{const De=Math.max(1,se),Re={startSceneNumber:De};ye!==null&&De>ye&&(Re.endSceneNumber=De),re(Re)},_e=se=>{if(se===null){re({endSceneNumber:null});return}const De=Math.max(1,se),Re={endSceneNumber:De};De<(he||1)&&(Re.startSceneNumber=De),re(Re)};x.useEffect(()=>{let se;return V?V.endTime?Y({current:0,total:Math.floor((V.endTime-V.totalStartTime)/1e3),last:V.lastItemDuration||0}):ge&&(se=window.setInterval(()=>{const De=Date.now();Y({current:Math.floor((De-(V.currentItemStartTime||De))/1e3),total:Math.floor((De-(V.totalStartTime||De))/1e3),last:V.lastItemDuration||0})},100)):Y({current:0,total:0,last:0}),()=>clearInterval(se)},[ge,V]);const Ie=x.useMemo(()=>pe.reduce((se,De)=>{var Re;return se+(((Re=De.frames)==null?void 0:Re.length)||0)},0),[pe]),me=x.useMemo(()=>he||ye?`${s("node.content.scene_plural")}: ${he||1}-${ye||"End"}`:"",[he,ye,s]),Ee=x.useCallback(()=>{if(!c||!l)return;const se=c.find(De=>De.toNodeId===e.id);if(se){const De=l(se.fromNodeId,se.fromHandleId);try{const Re=JSON.parse(De),Je=(Re.scenes||[]).map((de,ke)=>({...de,sceneNumber:typeof de.sceneNumber=="number"?de.sceneNumber:ke+1}));S({summary:Re.summary||"",scenes:Je,generatedStyle:Re.generatedStyle||Re.visualStyle||""}),Je.length>0&&v(new Set(Je.map((de,ke)=>ke)));let st=[];Array.isArray(Re.detailedCharacters)?st=Re.detailedCharacters:Array.isArray(Re.characters)?st=Re.characters:Re.name&&(st=[Re]);const nt=X.characters||[],St=nt.filter(de=>!de.isLinked),Ft=st.map(de=>{const{alias:ke,...Ne}=de;return{name:Ne.name||"Unknown",id:Ne.id||`linked-${se.fromNodeId}-${Ne.index||Ne.name||Math.random()}`,index:Ne.index,imagePrompt:Ne.prompt||Ne.imagePrompt||"",fullDescription:Ne.fullDescription||Ne.description||"",isLinked:!0}});let zt=[...St,...Ft];zt.sort((de,ke)=>{const Ne=Gt=>{const Vt=(Gt||"").match(/(\d+)/);return Vt?parseInt(Vt[1],10):99999},Qe=de.index||"",ct=ke.index||"";return Ne(Qe)-Ne(ct)}),zt=zt.map((de,ke)=>({...de,index:`Entity-${ke+1}`})),JSON.stringify(zt)!==JSON.stringify(nt)&&re({characters:zt})}catch{S(null)}}else{S(null);const De=X.characters||[],Re=De.filter(Je=>!Je.isLinked);De.length!==Re.length&&re({characters:Re})}},[c,l,e.id,X.characters,re]);x.useEffect(()=>{const se=setTimeout(()=>{Ee()},100);return()=>clearTimeout(se)},[Ee,w]);const Ae=()=>{Ee(),setTimeout(()=>n(e.id),50)},Ke=()=>{const De=Math.ceil((he||1)/5)*5+1,Re=De+4;re({startSceneNumber:De,endSceneNumber:Re})},mt=()=>{const De=Math.max(1,Math.floor(((he||1)-1)/5)*5-4),Re=De+4;re({startSceneNumber:De,endSceneNumber:Re})},Nt=()=>re({startSceneNumber:null,endSceneNumber:null}),It=x.useCallback(()=>{b!=null&&b.scenes&&(_.size===b.scenes.length?v(new Set):v(new Set(b.scenes.map((se,De)=>De))))},[b,_]),kt=x.useCallback(()=>{if(M.size===pe.length)N(new Set);else{N(new Set(pe.map((Re,Je)=>Je)));const se=new Set,De=new Set;pe.forEach((Re,Je)=>{De.add(Je),(Re.frames||[]).forEach(st=>se.add(`${Je}-${st.frameNumber}`))}),E(se),L(De)}},[pe,M]),xt=x.useCallback(()=>{const se=pe.flatMap((Re,Je)=>Re.frames.map(st=>`${Je}-${st.frameNumber}`)),De=pe.map((Re,Je)=>Je);k.size===se.length?(E(new Set),L(new Set)):(E(new Set(se)),L(new Set(De)))},[pe,k]),Dt=x.useCallback((se,De)=>{const Re=[...pe];Re[se]={...Re[se],sceneContext:De},re({scenes:Re})},[pe,re]),Mt=x.useCallback((se,De,Re,Je)=>{const st=[...pe],nt={...st[se]},St=[...nt.frames||[]];St[De]={...St[De],[Re]:Je},nt.frames=St,st[se]=nt,re({scenes:st})},[pe,re]),hn=x.useCallback((se,De)=>{const Re=[...pe],Je={...Re[se]},st=[...Je.frames||[]],nt={frameNumber:0,characters:[],duration:2,imagePrompt:"",environmentPrompt:"",videoPrompt:"",shotType:"WS"};De!==void 0?st.splice(De+1,0,nt):st.push(nt),Je.frames=st.map((St,Ft)=>({...St,frameNumber:Ft+1})),Re[se]=Je,re({scenes:Re})},[pe,re]),an=x.useCallback(()=>{const se=[...pe],De=pe.length+1;se.push({sceneNumber:De,title:`Scene ${De}`,description:"",frames:[],sceneContext:""}),re({scenes:se})},[pe,re]),we=x.useCallback((se,De)=>{const Re=[...pe];Re[se]&&(Re[se]={...Re[se],title:De},re({scenes:Re}))},[pe,re]),Ve=x.useCallback((se,De,Re)=>{const Je=[...pe],st={...Je[se]},nt=[...st.frames||[]];if(Re==="up"){if(De<=0)return;[nt[De],nt[De-1]]=[nt[De-1],nt[De]]}else{if(De>=nt.length-1)return;[nt[De],nt[De+1]]=[nt[De+1],nt[De]]}st.frames=nt.map((St,Ft)=>({...St,frameNumber:Ft+1})),Je[se]=st,re({scenes:Je})},[pe,re]),qe=x.useCallback((se,De)=>{const Re=[...pe],Je={...Re[se]},st=(Je.frames||[]).filter((nt,St)=>St!==De);Je.frames=st.map((nt,St)=>({...nt,frameNumber:St+1})),Re[se]=Je,re({scenes:Re})},[pe,re]),it=x.useCallback(se=>{const De=pe.filter((Re,Je)=>Je!==se);re({scenes:De})},[pe,re]),lt=x.useCallback(se=>{navigator.clipboard.writeText(se),g(s("toast.copied"),"success")},[g,s]),Lt=x.useCallback((se,De)=>{se.stopPropagation(),$(Re=>{const Je=new Set(se.shiftKey?Re:[]);return Je.has(De)?Je.delete(De):Je.add(De),Je})},[]),Nn=x.useCallback(se=>{const De=Te.filter(Re=>Re.id!==se&&Re.index!==se);re({characters:De})},[Te,re]);return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex flex-col gap-2 mb-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5",children:[o.jsx(ht,{title:s("tooltip.model.flash"),position:"top",className:"h-full flex",children:o.jsxs("button",{onClick:()=>re({model:"gemini-3-flash-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${Oe==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),"FLASH"]})}),o.jsx(ht,{title:s("tooltip.model.pro"),position:"top",className:"h-full flex",children:o.jsxs("button",{onClick:()=>re({model:"gemini-3-pro-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${Oe==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),"PRO"]})})]}),o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5",children:[o.jsx(ht,{title:s(`tooltip.lang.${le}`),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>re({targetLanguage:le}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${ue===le?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:le.toUpperCase()})}),o.jsx(ht,{title:s("tooltip.lang.en"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>re({targetLanguage:"en"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${ue==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"EN"})})]}),o.jsxs("button",{onClick:ge?i:Ae,disabled:a,className:`flex-grow h-10 px-4 font-bold text-xs uppercase tracking-wide text-white rounded-lg transition-all duration-200 shadow-sm flex items-center justify-center ${a?"bg-yellow-600 hover:bg-yellow-500":ge?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed"}`,children:[ge?o.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),s(a?"node.action.stopping":ge?"node.content.analyzing":"node.content.analyzeScript")]})]}),o.jsxs("div",{className:"bg-gray-900/50 rounded-md flex-shrink-0 flex flex-col",children:[o.jsxs("div",{className:"p-2 border-b border-gray-800 flex items-center justify-start gap-4",children:[o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[o.jsx("label",{className:"whitespace-nowrap",children:s("node.content.analyzeFromScene")}),o.jsxs("div",{className:"relative w-14 h-7",children:[o.jsx("input",{type:"number",min:"1",placeholder:"1",value:he||"",onChange:se=>xe(parseInt(se.target.value)||1),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:se=>se.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>xe((he||0)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>xe(Math.max(1,(he||0)-1)),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),o.jsx("label",{className:"whitespace-nowrap",children:s("node.content.analyzeUpToScene")}),o.jsxs("div",{className:"relative w-16 h-7",children:[o.jsx("input",{type:"number",min:"1",placeholder:s("node.content.endPlaceholder"),value:ye||"",onChange:se=>_e(se.target.value?parseInt(se.target.value):null),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:se=>se.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>_e((ye||he||1)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>_e((ye||he||1)-1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:mt,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"-5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),o.jsx("button",{onClick:Ke,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"+5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})}),o.jsx("button",{onClick:Nt,className:"p-1 text-gray-400 hover:text-red-400 bg-gray-800 rounded hover:bg-gray-700 ml-1",title:"Clear Range",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400 border-l border-gray-700 pl-4",children:[o.jsx("label",{className:"whitespace-nowrap font-bold text-emerald-500/80 uppercase tracking-tight",children:s("node.content.framesPerScene")}),o.jsx("input",{type:"number",min:"1",placeholder:s("node.content.minFrames"),value:j||"",onChange:se=>re({minFrames:se.target.value?parseInt(se.target.value):null}),className:"w-10 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-[10px]",onMouseDown:se=>se.stopPropagation(),title:"Minimum frames per scene"}),o.jsx("span",{className:"text-gray-600",children:"-"}),o.jsx("input",{type:"number",min:"1",placeholder:s("node.content.maxFrames"),value:q||"",onChange:se=>re({maxFrames:se.target.value?parseInt(se.target.value):null}),className:"w-10 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-[10px]",onMouseDown:se=>se.stopPropagation(),title:"Maximum frames per scene"})]})]}),o.jsxs("div",{className:"px-2 pb-2 flex flex-wrap items-center gap-x-4 gap-y-2 border-b border-gray-800",children:[o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({batchProcessing:!ee})},children:[o.jsx(Ct,{id:`batch-processing-${e.id}`,checked:ee,onChange:se=>re({batchProcessing:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-emerald-400 transition-colors",title:s("node.content.batchProcessingInfo"),children:s("node.content.batchProcessing")}),o.jsx(rr,{id:Se.BATCH_PROCESSING.id,onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({thinkingEnabled:!je})},children:[o.jsx(Ct,{id:`thinking-${e.id}`,checked:je,onChange:se=>re({thinkingEnabled:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.thinkingEnabled")}),o.jsx(rr,{id:"thinking_mode",onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({shotFilter:Ue==="wideOnly"?"all":"wideOnly"})},children:[o.jsx(Ct,{id:`shot-filter-wide-${e.id}`,checked:Ue==="wideOnly",onChange:se=>re({shotFilter:se?"wideOnly":"all"}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.shotFilter.wideOnly")}),o.jsx(rr,{id:Se.SHOT_FILTER_WIDE.id,onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({extendedAnalysis:!ie})},children:[o.jsx(Ct,{id:`extended-analysis-${e.id}`,checked:ie,onChange:se=>re({extendedAnalysis:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.extendedAnalysis")}),o.jsx(rr,{id:Se.EXTENDED_VISUALS.id,onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({microActionBreakdown:!Z})},children:[o.jsx(Ct,{id:`micro-action-${e.id}`,checked:Z,onChange:se=>re({microActionBreakdown:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.microActionBreakdown")}),o.jsx(rr,{id:Se.ACTION_PHASE_BREAKDOWN.id,onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({livingWorldEnabled:!fe})},children:[o.jsx(Ct,{id:`living-world-${e.id}`,checked:fe,onChange:se=>re({livingWorldEnabled:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-emerald-400 transition-colors",children:s("instruction.rule_living_world")}),o.jsx(rr,{id:Se.LIVING_WORLD.id,onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({anthroEnabled:!Fe})},children:[o.jsx(Ct,{id:`anthro-${e.id}`,checked:Fe,onChange:se=>re({anthroEnabled:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.anthroEnabled")}),o.jsx(rr,{id:Se.ANTHRO_LOGIC.id,onClick:K})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:se=>{se.stopPropagation(),ge||re({subscribeEnhancement:!ot})},children:[o.jsx(Ct,{id:`subscribe-${e.id}`,checked:ot,onChange:se=>re({subscribeEnhancement:se}),disabled:ge,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.subscribeEnhancement")}),o.jsx(rr,{id:Se.SUBSCRIBE_LOGIC.id,onClick:K})]})]}),o.jsxs("div",{className:"p-2 flex items-center justify-between text-xs border-t border-gray-800",children:[o.jsx("div",{className:"font-semibold text-emerald-400",children:s("node.content.frames_analyzed",{count:Ie})}),o.jsxs("div",{className:"flex items-center gap-4 text-gray-400",children:[me&&o.jsx("div",{className:"text-gray-500 font-medium",children:me}),V&&o.jsxs(o.Fragment,{children:[ge?o.jsx("div",{className:"text-yellow-400 animate-pulse font-mono",children:s("node.content.status.batch",{current:V.current,total:V.total})}):null,o.jsxs("div",{className:"text-gray-400 font-mono text-[10px]",children:[" (): (: ",ae.last,") / : ",ae.current," / : ",ae.total]})]})]})]}),ge&&V&&o.jsx("div",{className:"w-full h-1 bg-gray-800 rounded-b-md overflow-hidden border-t border-gray-800",children:o.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out",style:{width:`${V.current/Math.max(1,V.total)*100}%`}})}),o.jsx(KA,{uiState:Ge,onUpdateUiState:ze,onUpdateValue:re,hierarchyEnabled:J,mandatoryBgEnabled:oe,statePersistenceEnabled:B,livingWorldEnabled:fe,extendedAnalysis:ie,microActionBreakdown:Z,batchProcessing:ee,professionalStoryboard:R,cinematographyEnabled:be,safeGeneration:Le,thinkingEnabled:je,shotFilter:Ue,anthroEnabled:Fe,subscribeEnhancement:ot,anatomicalStrictness:at,propConsistency:rt,t:s,initialHeight:ce||380,onHeightChange:se=>re({settingsPaneHeight:se}),scale:W.scale,model:Oe,targetLanguage:ue,minFrames:j,maxFrames:q,framesPerScene:Q,targetScrollId:G,onSetTargetScrollId:F})]})]}),o.jsx(ZA,{uiState:Ge,initialHeight:He||170,onHeightChange:se=>re({characterPaneHeight:se}),scale:W.scale,onUpdateUiState:ze,onUpdateValue:re,onApplyAliases:h,nodeId:e.id,autoIndexCharacters:ve,charactersToDisplay:Te,selectedCharacters:U,collapsedCharacters:D,areAllCharactersCollapsed:Te.length>0&&D.size===Te.length,onToggleAllCharacters:()=>{D.size===Te.length?z(new Set):z(new Set(Te.map(se=>se.id||se.name)))},handleCharacterClick:(se,De)=>{O(Re=>{const Je=new Set(Re);return Je.has(De)?Je.delete(De):Je.add(De),Je})},handleToggleCharacterCollapse:se=>{z(De=>{const Re=new Set(De);return Re.has(se)?Re.delete(se):Re.add(se),Re})},updateCharacter:(se,De,Re)=>{const Je=Te.map(st=>st.id===se||st.index===se?{...st,[De]:Re}:st);re({characters:Je})},visualStyle:Ce,upstreamVisualStyle:(b==null?void 0:b.generatedStyle)||"",deselectAllNodes:m,t:s,onEmbedCharacter:se=>{const De=Te.map(Re=>{if(Re.id===se.id||Re.index===se.index){const{isLinked:Je,...st}=Re;return{...st,id:`detached-${Date.now()}-${Re.id||Math.random()}`}}return Re});re({characters:De})},onSyncCharacters:Ee,isSyncAvailable:!0,onMoveCharacter:()=>{},onClearCharacters:()=>re({characters:[]}),onDeleteCharacter:Nn}),o.jsxs("div",{className:"flex-grow flex flex-row min-h-0 items-stretch bg-gray-900 rounded-b-md overflow-hidden border-t border-gray-600",children:[o.jsx(e5,{width:`calc(${A}% - 0.5rem)`,upstreamScriptData:b,collapsedInputScenes:_,isSummaryCollapsed:f,onToggleInputSceneCollapse:se=>{v(De=>{const Re=new Set(De);return Re.has(se)?Re.delete(se):Re.add(se),Re})},setIsSummaryCollapsed:T,t:s,onToggleAllInputScenes:It,areAllInputScenesCollapsed:((Ot=b==null?void 0:b.scenes)==null?void 0:Ot.length)>0&&_.size===b.scenes.length}),o.jsx("div",{onMouseDown:ne,className:"w-2 mx-1 cursor-col-resize bg-gray-600 hover:bg-emerald-500 transition-colors flex-shrink-0 rounded-full"}),o.jsx(o5,{width:`calc(${100-A}% - 0.5rem)`,scenes:pe,characters:Te,areAllOutputScenesCollapsed:pe.length>0&&M.size===pe.length,areAllFramesCollapsed:pe.length>0&&k.size>0,collapsedOutputScenes:M,collapsedFrames:k,collapsedContexts:P,selectedFrames:H,onToggleAllOutputScenes:kt,onToggleAllFramesCollapse:xt,onToggleOutputSceneCollapse:se=>{N(De=>{const Re=new Set(De);return Re.has(se)?Re.delete(se):Re.add(se),Re})},onToggleSceneContextCollapse:se=>{L(De=>{const Re=new Set(De);return Re.has(se)?Re.delete(se):Re.add(se),Re})},onToggleCollapse:se=>{E(De=>{const Re=new Set(De);return Re.has(se)?Re.delete(se):Re.add(se),Re})},onAddFrame:hn,onAddScene:an,onRenameScene:we,onReorderFrame:Ve,onDeleteFrame:qe,onFramePartChange:Mt,onSceneContextChange:Dt,onFrameClick:Lt,onCopy:lt,handleTextFocus:m,t:s,onDeleteScene:it})]})]})},Rt=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d,isHighlighted:h},g)=>{const[m,w]=x.useState(!1);let y="",b="",S="",_="",v="",f="";if(!a)y="bg-gray-800/20",b="border-gray-700",S="text-gray-500",_="bg-gray-700",v="text-gray-500",f="bg-gray-800 text-gray-600";else if(r)y="bg-red-900/20",b="border-red-800/50",S="text-red-400",_="bg-red-500",v="text-gray-300",f="bg-red-900/50 text-red-200";else if(i)y="bg-gray-800",b="border-gray-600",S="text-emerald-400",_="bg-gray-500",v="text-gray-300",f="bg-gray-700 text-gray-400";else switch(v="text-gray-300",l){case"cyan":y="bg-cyan-900/20",b="border-cyan-700/50",S="text-cyan-400",_="bg-cyan-500",f="bg-cyan-900/50 text-cyan-200";break;case"purple":y="bg-purple-900/20",b="border-purple-700/50",S="text-purple-400",_="bg-purple-500",f="bg-purple-900/50 text-purple-200";break;default:y="bg-emerald-900/20",b="border-emerald-700/50",S="text-emerald-400",_="bg-emerald-500",f="bg-emerald-900/50 text-emerald-200"}h&&(b="border-yellow-400 ring-1 ring-yellow-400/50",y="bg-yellow-900/30");const T=A=>{A.stopPropagation(),navigator.clipboard.writeText(t),w(!0),setTimeout(()=>w(!1),1500)};return o.jsxs("div",{ref:g,onMouseDown:A=>A.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${y} ${b} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${f}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${_}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${S}`,children:e})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:T,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:m?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!i&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${a?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:a?"ON":"OFF"})]})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${v} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${_}`})]})}),Pn=bt.memo(({id:e,onClick:t,t:n})=>o.jsx(ht,{title:n("node.action.locateInStack"),position:"left",children:o.jsx("button",{onClick:r=>{r.stopPropagation(),t(r,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})})),a5=({uiState:e,onUpdateUiState:t,onUpdateValue:n,nodeId:r,t:a,deselectAllNodes:i,numberOfScenes:s,visualStyle:l,customVisualStyle:c,genre:d,genre2:h,characterType:g,narratorMode:m,narratorEnabled:w,noCharacters:y,useExistingCharacters:b,isCharactersInputConnected:S,linkedCharactersCount:_,isDetailedPlot:v,includeSubscribeScene:f,model:T,isLoading:A,targetLanguage:I,prompt:M,allCharacters:N,estimateFrames:k=!0,safeGeneration:E=!1,thinkingEnabled:P=!1,scenelessMode:L=!1,simpleActions:H=!1,commercialSafe:$=!1,smartConceptEnabled:U=!0,atmosphericEntryEnabled:O=!0,generateMainChars:D,createSecondaryChars:z,createKeyItems:G,onToggleGenerateMainChars:F,onToggleCreateSecondaryChars:K,onToggleCreateKeyItems:ae,targetScrollId:Y,onSetTargetScrollId:ge})=>{const[W,le]=x.useState(""),[X,Te]=x.useState(null),pe=x.useRef({}),ue=x.useRef(null),Oe=x.useCallback((R,be)=>{le(""),requestAnimationFrame(()=>{setTimeout(()=>{const Le=pe.current[be],je=ue.current;if(Le&&je){const Fe=Le.offsetTop-40;je.scrollTo({top:Math.max(0,Fe),behavior:"smooth"}),Te(be),setTimeout(()=>Te(null),2e3)}},50)})},[]),he=R=>R==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":R==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":R,ye=R=>({ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italian",pt:"Portugus",zh:"",ja:"",ko:"",uz:"Ozbek",tr:"Trke"})[R]||R.toUpperCase(),j=R=>({general:"General",comedy:"Comedy",drama:"Drama",action:"Action",scifi:"Sci-Fi",fantasy:"Fantasy",horror:"Horror",thriller:"Thriller",childrens_animation:"Children's Animation",shorts_story:"Shorts Story",scientific_historical:"Scientific Historical"})[R]||R,q=R=>({none:"None",simple:"Simple",realistic:"Realistic","3d_cartoon":"3D Cartoon","3d_realistic":"3D Realistic","2d_animation":"2D Animation",anime:"Anime",comics:"Comics",custom:"Custom"})[R]||R,Q=x.useMemo(()=>["general","comedy","drama","action","scifi","fantasy","horror","thriller","childrens_animation","shorts_story","scientific_historical"].map(R=>({value:R,label:a(`genre.${R}`)})),[a]),J=x.useMemo(()=>[{value:"",label:a("node.content.style.none")},{value:"simple",label:a("node.content.style.simple")},{value:"realistic",label:a("node.content.style.realistic")},{value:"3d_cartoon",label:a("node.content.style.3d_cartoon")},{value:"3d_realistic",label:a("node.content.style.3d_realistic")},{value:"2d_animation",label:a("node.content.style.2d_animation")},{value:"anime",label:a("node.content.style.anime")},{value:"comics",label:a("node.content.style.comics")},{value:"custom",label:a("node.content.style.custom")}],[a]),oe=x.useMemo(()=>[{value:"simple",label:a("node.content.characterType.simple")},{value:"anthro",label:a("node.content.characterType.anthro")}],[a]),B=x.useMemo(()=>[{value:"normal",label:a("node.content.narratorMode.normal")},{value:"dual",label:a("node.content.narratorMode.dual")},{value:"first_person",label:a("node.content.narratorMode.first_person")}],[a]),fe=R=>{n({numberOfScenes:Math.max(1,R)})},ie=R=>{R.stopPropagation(),n({characterType:"simple",useExistingCharacters:!1,narratorEnabled:!0,narratorMode:"normal",isAdvancedMode:!1,numberOfScenes:null,isDetailedPlot:!1,genre:"general",noCharacters:!1,genre2:"general",model:"gemini-3-flash-preview",includeSubscribeScene:!1,visualStyle:"none",customVisualStyle:"",estimateFrames:!0,safeGeneration:!1,thinkingEnabled:!1,scenelessMode:!1,simpleActions:!1,commercialSafe:!1,smartConceptEnabled:!0,atmosphericEntryEnabled:!0,generateMainChars:!0,createSecondaryChars:!0,createKeyItems:!0})},Z=(R,be)=>{if(!W)return!0;const Le=W.toLowerCase();return R.toLowerCase().includes(Le)||be.toLowerCase().includes(Le)};let ee=0;return o.jsxs("div",{className:`border border-gray-600 hover:border-gray-200 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200 ${e.isSettingsCollapsed?"":"h-[400px]"}`,children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-1.533 2.16-1.535.113-1.535 2.322 0 2.435 1.594.118 2.073 1.274 1.533 2.16-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.948c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.948c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042 1.533-2.16 1.535-.113 1.535-2.322 0-2.435-1.594-.118-2.073-1.274-1.533-2.16.836-1.372-.734-2.942-2.106-2.106a1.533 1.533 0 01-2.287-.948zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:a("node.content.parameters")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:a("toolbar.resetToDefault"),onClick:ie,tooltipPosition:"left",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{tooltipPosition:"left",title:e.isSettingsCollapsed?a("node.action.expand"):a("node.action.collapse"),onClick:R=>{R.stopPropagation(),t({isSettingsCollapsed:!e.isSettingsCollapsed})},children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"flex flex-row flex-grow min-h-0 bg-gray-800/50",onWheel:R=>R.stopPropagation(),children:[o.jsxs("div",{className:"w-1/2 p-2 space-y-3 border-r border-gray-600 overflow-y-auto custom-scrollbar",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{htmlFor:`num-scenes-${r}`,className:"block text-xs font-medium text-gray-400 truncate",children:a("node.content.numberOfScenes")}),o.jsx(Pn,{id:"sg_scene_count",onClick:Oe,t:a})]}),o.jsxs("div",{className:"relative w-full h-9",children:[o.jsx("input",{id:`num-scenes-${r}`,type:"number",min:"1",value:s??"",onChange:R=>n({numberOfScenes:R.target.value?parseInt(R.target.value):null}),placeholder:a("node.content.numberOfScenes.auto"),className:"w-full h-full pl-3 pr-6 bg-gray-700 border border-gray-600 text-white rounded-md text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none appearance-none"}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-6 flex flex-col border-l border-gray-600",children:[o.jsx("button",{onClick:()=>fe((s||0)+1),className:"h-1/2 hover:bg-gray-600 text-gray-400 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",onMouseDown:R=>R.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>fe((s||0)-1),className:"h-1/2 hover:bg-gray-600 text-gray-400 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-600 focus:outline-none",onMouseDown:R=>R.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{className:"block text-xs font-medium text-gray-400 truncate",children:a("node.content.style")}),o.jsx(Pn,{id:"sg_visual_style",onClick:Oe,t:a})]}),o.jsx(Yn,{value:l,onChange:R=>n({visualStyle:R}),options:J,disabled:A,id:`style-select-${r}`})]})]}),l==="custom"&&o.jsxs("div",{className:"flex flex-col space-y-1 pt-1 border-t border-gray-700/50",children:[o.jsx("label",{htmlFor:`custom-style-input-${r}`,className:"text-xs text-gray-400",children:a("node.content.style.custom")}),o.jsx("textarea",{id:`custom-style-input-${r}`,value:c,onChange:R=>n({customVisualStyle:R.target.value}),onMouseDown:R=>R.stopPropagation(),onFocus:i,rows:2,className:"w-full p-1 bg-gray-800 text-white rounded-md text-xs focus:ring-2 focus:ring-emerald-500 focus:outline-none custom-scrollbar resize-none",placeholder:"..."})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6 bg-gray-800/50 rounded px-2 border border-gray-700",children:[o.jsx(Ct,{id:`sceneless-mode-${r}`,checked:L,onChange:R=>n({scenelessMode:R}),disabled:A,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-emerald-400 font-bold select-none truncate cursor-pointer flex-grow",htmlFor:`sceneless-mode-${r}`,children:a("node.content.scenelessMode")}),o.jsx(Pn,{id:"sceneless_mode",onClick:Oe,t:a})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{className:`block text-xs font-medium text-gray-400 truncate ${L?"opacity-50":""}`,children:a("node.content.genre")}),o.jsx(Pn,{id:"sg_genre",onClick:Oe,t:a})]}),o.jsx(Yn,{value:d,onChange:R=>n({genre:R}),options:Q,id:`genre-select-${r}`,disabled:L})]}),o.jsxs("div",{children:[o.jsx("label",{className:`block text-xs font-medium text-gray-400 mb-1 truncate ${L?"opacity-50":""}`,children:a("node.content.genre2")}),o.jsx(Yn,{value:h,onChange:R=>n({genre2:R}),options:Q,id:`genre2-select-${r}`,disabled:L})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{className:"text-xs text-gray-400 truncate",children:a("node.content.characterType")}),o.jsx(Pn,{id:"sg_anthro",onClick:Oe,t:a})]}),o.jsx(Yn,{value:g,onChange:R=>n({characterType:R}),options:oe,disabled:A,id:`char-type-select-${r}`})]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("label",{className:`text-xs text-gray-400 mb-1 truncate transition-opacity ${w?"opacity-100":"opacity-50"}`,children:a("node.content.narratorMode")}),o.jsx(Yn,{value:m,onChange:R=>n({narratorMode:R}),options:B,disabled:!w||A,id:`narrator-mode-${r}`})]})]}),o.jsxs("div",{className:"grid grid-cols-1 gap-y-1",children:[o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`thinking-enabled-${r}`,checked:P,onChange:R=>n({thinkingEnabled:R}),disabled:A,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-cyan-400 transition-colors flex-grow",htmlFor:`thinking-enabled-${r}`,children:a("node.content.thinkingEnabled")}),o.jsx(Pn,{id:"thinking_mode",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`safe-gen-${r}`,checked:E,onChange:R=>n({safeGeneration:R}),disabled:A,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-emerald-400 transition-colors flex-grow",htmlFor:`safe-gen-${r}`,children:a("node.content.safeGeneration")}),o.jsx(Pn,{id:"safe_gen",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`commercial-safe-${r}`,checked:$,onChange:R=>n({commercialSafe:R}),disabled:A,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-emerald-400 transition-colors flex-grow",htmlFor:`commercial-safe-${r}`,children:a("node.content.commercialSafe")}),o.jsx(Pn,{id:We.COMMERCIAL_SAFE.id,onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`smart-concept-${r}`,checked:U,onChange:R=>n({smartConceptEnabled:R}),disabled:A,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-cyan-400 transition-colors flex-grow",htmlFor:`smart-concept-${r}`,children:a("node.content.smartConcept")}),o.jsx(Pn,{id:"char_smart_concept",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`atmospheric-entry-${r}`,checked:O,onChange:R=>n({atmosphericEntryEnabled:R}),disabled:A||L,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer hover:text-emerald-400 transition-colors flex-grow ${L?"opacity-50":""}`,htmlFor:`atmospheric-entry-${r}`,children:a("instruction.sg_exposition")}),o.jsx(Pn,{id:We.EXPOSITION.id,onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`no-characters-${r}`,checked:y,onChange:R=>{n({noCharacters:R,useExistingCharacters:R?!1:b})},disabled:A||S,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${S?"opacity-50 cursor-not-allowed":""}`,htmlFor:`no-characters-${r}`,children:a("node.content.noCharacters")}),o.jsx(Pn,{id:"sg_no_chars",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`use-existing-${r}`,checked:b||S,onChange:R=>n({useExistingCharacters:R}),disabled:A||y||S,className:"h-3.5 w-3.5"}),o.jsxs("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${y?"opacity-50":""} ${S?"cursor-not-allowed text-emerald-400":""}`,htmlFor:`use-existing-${r}`,children:[a("node.content.useExistingCharacters"),S&&" (Locked by connection)"]}),S&&_>0&&o.jsx("span",{className:"text-[10px] text-emerald-400 font-mono bg-emerald-900/30 px-1.5 py-0.5 rounded ml-1",title:"Connected Characters Count",children:_}),o.jsx(Pn,{id:"no_duplicates",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`narrator-enabled-${r}`,checked:w,onChange:R=>n({narratorEnabled:R}),className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer flex-grow",htmlFor:`narrator-enabled-${r}`,children:a("node.content.narratorEnabled")}),o.jsx(Pn,{id:"sg_narrator",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`simple-actions-${r}`,checked:H,onChange:R=>n({simpleActions:R}),className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-emerald-300 font-medium select-none truncate cursor-pointer flex-grow",htmlFor:`simple-actions-${r}`,children:a("node.content.simpleActions")}),o.jsx(Pn,{id:"sg_simple_actions",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`detailed-plot-${r}`,checked:v,onChange:R=>n({isDetailedPlot:R}),disabled:L,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${L?"opacity-50":""}`,htmlFor:`detailed-plot-${r}`,children:a("node.content.detailedPlot")}),o.jsx(Pn,{id:"sg_detailed_plot",onClick:Oe,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(Ct,{id:`subscribe-scene-${r}`,checked:f,onChange:R=>n({includeSubscribeScene:R}),disabled:L,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${L?"opacity-50":""}`,htmlFor:`subscribe-scene-${r}`,children:a("node.content.includeSubscribeScene")}),o.jsx(Pn,{id:"sg_subscribe",onClick:Oe,t:a})]})]})]}),o.jsxs("div",{className:"w-1/2 flex flex-col relative",children:[o.jsx("div",{className:"p-2 border-b border-gray-700 bg-gray-800/80 sticky top-0 z-10 flex items-center gap-2",children:o.jsxs("div",{className:"relative w-full",children:[o.jsx("input",{type:"text",value:W,onChange:R=>le(R.target.value),placeholder:a("node.content.findStack"),className:"w-full pl-7 pr-2 py-1 text-xs bg-gray-900/80 border border-gray-600 rounded-md focus:outline-none focus:border-emerald-500 text-gray-300 placeholder-gray-600"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),W&&o.jsx("button",{onClick:()=>le(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:""})]})}),o.jsxs("div",{ref:ue,className:"p-2 overflow-y-auto custom-scrollbar space-y-1 flex-grow relative",children:[o.jsx("h5",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1 border-b border-gray-700 pb-1",children:a("node.content.scriptGenerationStack")}),o.jsxs("div",{className:"space-y-1 pb-2 mb-2 border-b border-gray-700/30",children:[Z(T,a("node.content.model"))&&o.jsx(Rt,{ref:R=>{pe.current["model-brick"]=R},id:"model-brick",label:a("node.content.model"),text:he(T),isMandatory:!0,color:"gray",isHighlighted:X==="model-brick"}),Z(a(`instruction.${We.INPUTS_DATA.id}`),a(`instruction.${We.INPUTS_DATA.id}`))&&o.jsx(Rt,{label:a(`instruction.${We.INPUTS_DATA.id}`),text:We.INPUTS_DATA.text,translatedText:a(`instruction.desc.${We.INPUTS_DATA.id}`),isMandatory:!0,color:"gray",index:++ee}),Z(ye(I),a("node.content.targetLanguage"))&&o.jsx(Rt,{ref:R=>{pe.current.target_lang=R},id:"target_lang",index:++ee,label:a("node.content.targetLanguage"),text:`Target Language: ${Un(I)}`,translatedText:ye(I),isMandatory:!0,color:"gray",isHighlighted:X==="target_lang"}),Z("Thinking Mode",a("node.content.thinkingEnabled"))&&o.jsx(Rt,{ref:R=>{pe.current.thinking_mode=R},id:"thinking_mode",index:P?++ee:void 0,label:a("node.content.thinkingEnabled"),text:"Enable extended reasoning for deeper plot coherence.",translatedText:"  .",isEnabled:P,onToggle:()=>n({thinkingEnabled:!P}),color:"cyan",isHighlighted:X==="thinking_mode"})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.priming")}),Z(Ko.text,a("node.content.safeGeneration"))&&o.jsx(Rt,{ref:R=>{pe.current.safe_gen=R},id:"safe_gen",index:E?++ee:void 0,label:a("node.content.safeGeneration"),text:Ko.text,translatedText:a("instruction.desc.safe_gen"),isCritical:!0,isEnabled:E,onToggle:()=>n({safeGeneration:!E}),isHighlighted:X==="safe_gen"}),Z(We.COMMERCIAL_SAFE.text,a("node.content.commercialSafe"))&&o.jsx(Rt,{ref:R=>{pe.current[We.COMMERCIAL_SAFE.id]=R},id:We.COMMERCIAL_SAFE.id,index:$?++ee:void 0,label:a("node.content.commercialSafe"),text:We.COMMERCIAL_SAFE.text,translatedText:a("instruction.desc.commercial_safe"),isCritical:!0,isEnabled:$,onToggle:()=>n({commercialSafe:!$}),isHighlighted:X===We.COMMERCIAL_SAFE.id}),Z(We.CORE.text,a(`instruction.${We.CORE.id}`))&&o.jsx(Rt,{ref:R=>{pe.current[We.CORE.id]=R},id:We.CORE.id,index:++ee,label:a(`instruction.${We.CORE.id}`),text:We.CORE.text,translatedText:a(`instruction.desc.${We.CORE.id}`),isMandatory:!0,color:"emerald",isHighlighted:X===We.CORE.id}),Z(We.ANTI_COMPRESSION.text,a(`instruction.${We.ANTI_COMPRESSION.id}`))&&o.jsx(Rt,{ref:R=>{pe.current[We.ANTI_COMPRESSION.id]=R},id:We.ANTI_COMPRESSION.id,index:++ee,label:a(`instruction.${We.ANTI_COMPRESSION.id}`),text:We.ANTI_COMPRESSION.text,translatedText:a(`instruction.desc.${We.ANTI_COMPRESSION.id}`),isMandatory:!0,color:"emerald",isHighlighted:X===We.ANTI_COMPRESSION.id}),Z(We.SCENELESS_MODE.text,a("instruction.sceneless_mode"))&&o.jsx(Rt,{ref:R=>{pe.current.sceneless_mode=R},id:"sceneless_mode",index:L?++ee:void 0,label:a("instruction.sceneless_mode"),text:We.SCENELESS_MODE.text,translatedText:a("instruction.desc.sceneless_mode"),isEnabled:L,onToggle:()=>n({scenelessMode:!L}),color:L?"emerald":"gray",isHighlighted:X==="sceneless_mode"})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.narrative")}),(L?[We.VISUALS_FIRST,We.ATMOSPHERE]:[We.ANALYSIS,We.IMPROVE_CONCEPT,We.EXPOSITION,We.VISUALS_FIRST,We.SEAMLESS_FLOW,We.ATMOSPHERE,We.DELAYED_REVEAL,We.VISUAL_METAPHOR,We.PACING_RHYTHM,We.SUBTEXT]).map(R=>R.id===We.EXPOSITION.id?Z(R.text,a(`instruction.${R.id}`))&&o.jsx(Rt,{ref:be=>{pe.current[R.id]=be},id:R.id,index:O?++ee:void 0,label:a(`instruction.${R.id}`),text:R.text,translatedText:a(`instruction.desc.${R.id}`),isEnabled:O,onToggle:()=>n({atmosphericEntryEnabled:!O}),color:"emerald",isHighlighted:X===R.id},R.id):Z(R.text,a(`instruction.${R.id}`))&&o.jsx(Rt,{ref:be=>{pe.current[R.id]=be},id:R.id,index:++ee,label:a(`instruction.${R.id}`)||R.label,text:R.text,translatedText:a(`instruction.desc.${R.id}`),isMandatory:!0,color:R.id==="rule_visuals"||R.id==="rule_flow"||R.id==="rule_atmosphere"?"gray":"emerald",isHighlighted:X===R.id},R.id))]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.world")}),Z(We.LIVING_WORLD.text,a("instruction.sg_living_world"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_living_world=R},id:"sg_living_world",index:++ee,label:a("instruction.sg_living_world"),text:g==="anthro"?"EXTRAS: Anthropomorphic animals of various species.":"EXTRAS: Human crowd appropriate to setting.",translatedText:a(g==="anthro"?"instruction.desc.sg_living_world_anthro":"instruction.desc.sg_living_world_simple"),isMandatory:!0,color:"emerald",isHighlighted:X==="sg_living_world"}),Z(vt.SMART_CONCEPT.text,a(`instruction.${vt.SMART_CONCEPT.id}`))&&o.jsx(Rt,{ref:R=>{pe.current[vt.SMART_CONCEPT.id]=R},id:vt.SMART_CONCEPT.id,index:U?++ee:void 0,label:a(`instruction.${vt.SMART_CONCEPT.id}`),text:vt.SMART_CONCEPT.text,translatedText:a(`instruction.desc.${vt.SMART_CONCEPT.id}`),isEnabled:U,onToggle:()=>n({smartConceptEnabled:!U}),color:"gray",isHighlighted:X===vt.SMART_CONCEPT.id},vt.SMART_CONCEPT.id),[We.VISUAL_DNA,vt.DETAILED_STYLE].map(R=>Z(R.text,a(`instruction.${R.id}`))&&o.jsx(Rt,{ref:be=>{pe.current[R.id]=be},id:R.id,index:++ee,label:a(`instruction.${R.id}`)||R.label,text:R.text,translatedText:a(`instruction.desc.${R.id}`),isMandatory:!0,color:R.id==="sg_visual_dna"?"cyan":"emerald",isHighlighted:X===R.id},R.id)),Z(We.FRAME_ESTIMATION.text,a("node.content.recommendedFrames"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_frame_estimation=R},id:"sg_frame_estimation",index:++ee,label:a("node.content.recommendedFrames"),text:We.FRAME_ESTIMATION.text,translatedText:a("instruction.desc.sg_frame_estimation"),isMandatory:!0,color:"emerald",isHighlighted:X==="sg_frame_estimation"}),Z(a("instruction.sg_visual_style"),a("instruction.sg_visual_style"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_visual_style=R},id:"sg_visual_style",index:l&&l!=="none"?++ee:void 0,label:a("instruction.sg_visual_style"),text:`Request: Generate visual style based on '${l==="custom"?c:q(l)}'.`,translatedText:a("instruction.desc.sg_visual_style",{style:l==="custom"?c:a(`node.content.style.${l||"none"}`)}),isEnabled:!!l&&l!=="none",onToggle:()=>n({visualStyle:l!=="none"?"":"simple"}),color:"cyan",isHighlighted:X==="sg_visual_style"}),Z(a("instruction.sg_anthro"),a("instruction.sg_anthro"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_anthro=R},id:"sg_anthro",index:g==="anthro"?++ee:void 0,label:a("instruction.sg_anthro"),text:"Characters MUST be animals with human traits.",translatedText:a("instruction.desc.sg_anthro"),isEnabled:g==="anthro",onToggle:()=>n({characterType:g==="anthro"?"simple":"anthro"}),color:"cyan",isHighlighted:X==="sg_anthro"}),Z(a("instruction.sg_genre"),a("instruction.sg_genre"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_genre=R},id:"sg_genre",index:!L&&(d!=="general"||h!=="general")?++ee:void 0,label:a("instruction.sg_genre"),text:`Context: ${j(d)}${h!=="general"?` + ${j(h)}`:""}`,translatedText:a("instruction.desc.sg_genre",{genre:`${a(`genre.${d}`)} ${h!=="general"?`+ ${a(`genre.${h}`)}`:""}`}),isEnabled:!L&&(d!=="general"||h!=="general"),onToggle:()=>{n(d!=="general"||h!=="general"?{genre:"general",genre2:"general"}:{genre:"comedy"})},color:"cyan",isHighlighted:X==="sg_genre"})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.constraints")}),Z(a("instruction.sg_simple_actions"),a("instruction.sg_simple_actions"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_simple_actions=R},id:"sg_simple_actions",index:H?++ee:void 0,label:a("instruction.sg_simple_actions"),text:We.SIMPLE_ACTIONS.text,translatedText:a("instruction.desc.sg_simple_actions"),isEnabled:H,onToggle:()=>n({simpleActions:!H}),color:"emerald",isCritical:!0,isHighlighted:X==="sg_simple_actions"}),Z(a("instruction.sg_no_chars"),a("instruction.sg_no_chars"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_no_chars=R},id:"sg_no_chars",index:y?++ee:void 0,label:a("instruction.sg_no_chars"),text:"Focus on events/documentary style.",translatedText:a("instruction.desc.sg_no_chars"),isEnabled:y,onToggle:()=>n({noCharacters:!y}),color:"emerald",isHighlighted:X==="sg_no_chars"}),!y&&Z(a("node.content.useExistingCharacters"),a("node.content.useExistingCharacters"))&&o.jsx(Rt,{ref:R=>{pe.current.use_existing=R},id:"use_existing",index:b?++ee:void 0,label:a("node.content.useExistingCharacters"),text:"Use connected character profiles.",translatedText:a("node.content.useExistingCharactersInfo"),isEnabled:b,onToggle:()=>{S||n({useExistingCharacters:!b})},color:"cyan",isHighlighted:X==="use_existing"}),!y&&o.jsx(o.Fragment,{children:Z(a(`instruction.${vt.NO_DUPLICATES.id}`),a(`instruction.${vt.NO_DUPLICATES.id}`))&&o.jsx(Rt,{ref:R=>{pe.current.no_duplicates=R},id:"no_duplicates",index:b?++ee:void 0,label:a(`instruction.${vt.NO_DUPLICATES.id}`),text:vt.NO_DUPLICATES.text,translatedText:a(`instruction.desc.${vt.NO_DUPLICATES.id}`),isEnabled:b,isMandatory:!1,color:"emerald",isHighlighted:X==="no_duplicates"})}),Z(a("node.content.narrator"),a("node.content.narrator"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_narrator=R},id:"sg_narrator",index:++ee,label:a("node.content.narrator"),text:w?`Include Narrator voiceover text. Style: ${m}.`:"Do NOT include narrator text.",translatedText:w?"  .":"   .",isEnabled:w,onToggle:()=>n({narratorEnabled:!w}),color:"cyan",isHighlighted:X==="sg_narrator"}),Z(a("node.content.numberOfScenes"),a("node.content.numberOfScenes"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_scene_count=R},id:"sg_scene_count",index:s?++ee:void 0,label:a("node.content.numberOfScenes"),text:s?`Exactly ${s} scenes.`:"Auto-determine scene count.",translatedText:s?`${a("node.content.numberOfScenes")}: ${s}`:a("node.content.numberOfScenes.auto"),isEnabled:s!==null,onToggle:()=>n({numberOfScenes:s?null:5}),color:"cyan",isHighlighted:X==="sg_scene_count"}),Z(a("instruction.sg_detailed_plot"),a("instruction.sg_detailed_plot"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_detailed_plot=R},id:"sg_detailed_plot",index:!L&&v?++ee:void 0,label:a("instruction.sg_detailed_plot"),text:"Plot Detail: Provide highly detailed descriptions of actions and plot.",translatedText:a("instruction.desc.sg_detailed_plot"),isEnabled:!L&&v,onToggle:()=>n({isDetailedPlot:!v}),color:"emerald",isHighlighted:X==="sg_detailed_plot"}),Z(a("instruction.sg_subscribe"),a("instruction.sg_subscribe"))&&o.jsx(Rt,{ref:R=>{pe.current.sg_subscribe=R},id:"sg_subscribe",index:!L&&f?++ee:void 0,label:a("instruction.sg_subscribe"),text:"Include a scene asking audience to Subscribe/Like.",translatedText:a("instruction.desc.sg_subscribe"),isEnabled:!L&&f,onToggle:()=>n({includeSubscribeScene:!f}),color:"emerald",isHighlighted:X==="sg_subscribe"})]}),o.jsx("h5",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1 pt-2 border-t border-gray-700",children:a("node.content.entityGenerationStack")}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx(Rt,{label:"Entity Mode",text:"Focus: Generating Entities based on the story concept.",translatedText:":      .",isMandatory:!0,color:"purple"}),Z(a("instruction.create_main_chars"),a("instruction.create_main_chars"))&&o.jsx(Rt,{ref:R=>{pe.current[vt.MAIN_CHAR_LOGIC.id]=R},id:vt.MAIN_CHAR_LOGIC.id,label:a("instruction.create_main_chars"),text:vt.MAIN_CHAR_LOGIC.text,translatedText:a("instruction.desc.create_main_chars"),isEnabled:D,onToggle:F,color:"emerald",isHighlighted:Y===vt.MAIN_CHAR_LOGIC.id}),Z(a("instruction.create_secondary_chars"),a("instruction.create_secondary_chars"))&&o.jsx(Rt,{ref:R=>{pe.current[vt.SECONDARY_CHARS.id]=R},id:vt.SECONDARY_CHARS.id,label:a("instruction.create_secondary_chars"),text:vt.SECONDARY_CHARS.text,translatedText:a("instruction.desc.create_secondary_chars"),isEnabled:z,onToggle:K,color:"emerald",isHighlighted:Y===vt.SECONDARY_CHARS.id}),Z(a("instruction.create_key_items"),a("instruction.create_key_items"))&&o.jsx(Rt,{ref:R=>{pe.current[vt.KEY_ITEMS_LOGIC.id]=R},id:vt.KEY_ITEMS_LOGIC.id,label:a("instruction.create_key_items"),text:vt.KEY_ITEMS_LOGIC.text,translatedText:a("instruction.desc.create_key_items"),isEnabled:G,onToggle:ae,color:"cyan",isHighlighted:Y===vt.KEY_ITEMS_LOGIC.id})]})]})]})]})]})},i5=bt.memo(({fullDescription:e,onDescriptionChange:t,readOnly:n=!1,t:r,onFocus:a})=>{const[i,s]=x.useState({});x.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Clothing",Appearance:"Appearance",Personality:"Personality",Clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing|||)\s*([\s\S]*?)(?=####|$)/gi;let g,m=!1;for(;(g=h.exec(e))!==null;){m=!0;const w=d[g[1].trim()],y=g[2].trim();w&&(c[w]=y)}!m&&e.trim()&&(c.Appearance=e.trim()),s(c)},[e]);const l=(c,d)=>{const h={...i,[c]:d},g=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(g)};return o.jsx("div",{className:"space-y-2 text-sm",children:["Appearance","Personality","Clothing"].map(c=>o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider",children:r(`node.content.${c.toLowerCase()}`)||c}),o.jsx(Pe,{tooltipPosition:"left",title:`${r("node.action.copy")} ${c}`,onClick:d=>{d.stopPropagation(),navigator.clipboard.writeText(i[c]||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:i[c]||"",onChange:d=>l(c,d.target.value),readOnly:n,className:`w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll read-only:bg-gray-900/50 read-only:text-gray-400 ${n?"read-only:cursor-not-allowed":""}`,onWheel:d=>d.stopPropagation(),onFocus:a})]},c))})}),s5=bt.memo(({char:e,currentId:t,isSelected:n,isCollapsed:r,t:a,onClick:i,onToggleCollapse:s,onUpdate:l,deselectAllNodes:c,onEmbed:d,onDelete:h,onDetach:g,onMove:m,index:w,isFirst:y,isLast:b,hasDuplicateIndex:S})=>o.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 mb-2 space-y-2 border border-gray-700 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:_=>{_.target.closest("input, button")||s(t)},children:[o.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[e.isLinked&&o.jsx("div",{title:"Linked from upstream (Read-only)",className:"mr-2 text-emerald-400 flex-shrink-0",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),o.jsx(Pe,{tooltipPosition:"right",title:a("node.action.togglePanel"),onClick:_=>{_.stopPropagation(),s(t)},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"text",value:e.name,readOnly:e.isLinked,onChange:_=>l(t,"name",_.target.value),className:`font-semibold text-white bg-gray-900 w-64 rounded px-2 py-0.5 border border-transparent focus:border-emerald-500 focus:ring-0 focus:outline-none transition-colors ${e.isLinked?"cursor-not-allowed text-gray-400 focus:border-transparent !bg-transparent !px-1":""}`,onMouseDown:_=>_.stopPropagation(),onFocus:c}),o.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50 select-none",children:["#",String(t)]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:[a("node.content.characterIndex"),":"]}),o.jsx("input",{type:"text",value:e.index||e.alias||"",readOnly:e.isLinked,onChange:_=>l(t,"index",_.target.value),className:`font-semibold text-white bg-gray-900/50 w-24 rounded px-1 text-xs py-0.5 border border-transparent cursor-not-allowed focus:outline-none focus:ring-0 ${S?"border-red-500 ring-1 ring-red-500":""}`,onFocus:c,onMouseDown:_=>_.stopPropagation()}),e.isLinked?o.jsx(Pe,{tooltipPosition:"left",title:a("node.action.embedCharacter"),onClick:_=>{_.stopPropagation(),d(e)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}):g&&o.jsx(Pe,{tooltipPosition:"left",title:"Detach to Character Card Node",onClick:_=>{_.stopPropagation(),g(e)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),h&&o.jsx(Pe,{tooltipPosition:"left",title:a("node.action.deleteItem"),onClick:_=>{_.stopPropagation(),h(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!r&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-1 mb-2",children:[o.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:a("node.content.imagePrompt")}),o.jsx("textarea",{value:e.prompt||"",onChange:_=>l(t,"prompt",_.target.value),readOnly:e.isLinked,className:`w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll ${e.isLinked?"bg-gray-900/50 text-gray-400 cursor-not-allowed":""}`,onWheel:_=>_.stopPropagation(),onMouseDown:_=>_.stopPropagation(),onFocus:c})]}),o.jsx(i5,{fullDescription:e.fullDescription||"",onDescriptionChange:_=>l(t,"fullDescription",_),readOnly:e.isLinked,t:a,onFocus:c})]})]})),l5=bt.memo(({uiState:e,onUpdateUiState:t,onUpdateValue:n,isCharactersSectionCollapsed:r,allCharacters:a,selectedCharacters:i,collapsedCharacters:s,areAllCharactersCollapsed:l,handleToggleAllCharacters:c,handleCharacterClick:d,handleToggleCharacterCollapse:h,updateCharacter:g,deleteCharacter:m,onAddCharacter:w,handleEmbedCharacter:y,deselectAllNodes:b,t:S,onDetachCharacter:_,onMoveCharacter:v,onClearCharacters:f,onGenerateEntities:T,isGeneratingEntities:A,generateMainChars:I,createSecondaryChars:M,createKeyItems:N,onGenerateMainChange:k,onCreateSecondaryChange:E,onCreateKeyItemsChange:P,onSetTargetScrollId:L})=>{const H={};a.forEach(O=>{const D=(O.index||O.alias||"").trim().toLowerCase();H[D]=(H[D]||0)+1});const $={};a.forEach(O=>{const D=(O.name||"").trim().toLowerCase();$[D]=($[D]||0)+1});const U=(O,D)=>{O.stopPropagation(),L&&(L(D),e.isSettingsCollapsed&&t({isSettingsCollapsed:!1}))};return o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200 relative",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isCharactersSectionCollapsed:!r}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:S("node.content.characters")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(ht,{title:S(l?"node.action.expandAll":"node.action.collapseAll"),position:"top",children:o.jsx("button",{onClick:O=>{O.stopPropagation(),c()},disabled:r,className:`p-1 rounded transition-colors ${r?"text-gray-600 cursor-default":"hover:bg-gray-700 text-emerald-400 hover:text-emerald-300"}`,children:l?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})}),w&&o.jsx(Pe,{tooltipPosition:"left",title:S("node.action.addCharacter"),onClick:O=>{O.stopPropagation(),w()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),f&&o.jsx(Pe,{tooltipPosition:"left",title:S("node.action.clear"),onClick:O=>{O.stopPropagation(),f()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{tooltipPosition:"left",title:S(r?"node.action.expand":"node.action.collapse"),onClick:O=>{O.stopPropagation(),t({isCharactersSectionCollapsed:!r})},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!r&&o.jsxs("div",{style:{contentVisibility:"auto"},className:"p-2 space-y-2 overflow-y-auto custom-scrollbar flex-grow",onWheel:O=>O.stopPropagation(),children:[T&&o.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-gray-800/50 rounded-md border border-gray-700 mb-2",children:[o.jsxs("div",{className:"flex gap-3 items-center",children:[o.jsxs("div",{className:"flex items-center gap-1 group",title:"Create Main Characters",children:[o.jsx(Ct,{id:"gen_main_chars",checked:!!I,onChange:O=>k==null?void 0:k(O),disabled:!!A,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"gen_main_chars",className:"text-[10px] text-gray-300 font-bold uppercase cursor-pointer select-none hover:text-emerald-400 transition-colors",children:S("node.content.mainChars")}),o.jsx("button",{onClick:O=>U(O,vt.MAIN_CHAR_LOGIC.id),className:"p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),o.jsxs("div",{className:"flex items-center gap-1 group",title:S("instruction.create_secondary_chars"),children:[o.jsx(Ct,{id:"create_secondary",checked:!!M,onChange:O=>E==null?void 0:E(O),disabled:!!A,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"create_secondary",className:"text-[10px] text-gray-300 font-bold uppercase cursor-pointer select-none hover:text-emerald-400 transition-colors",children:S("node.content.secChars")}),o.jsx("button",{onClick:O=>U(O,vt.SECONDARY_CHARS.id),className:"p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),o.jsxs("div",{className:"flex items-center gap-1 group",title:S("instruction.create_key_items"),children:[o.jsx(Ct,{id:"create_items",checked:!!N,onChange:O=>P==null?void 0:P(O),disabled:!!A,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"create_items",className:"text-[10px] text-gray-300 font-bold uppercase cursor-pointer select-none hover:text-cyan-400 transition-colors",children:S("node.content.keyItems")}),o.jsx("button",{onClick:O=>U(O,vt.KEY_ITEMS_LOGIC.id),className:"p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),o.jsx("button",{onClick:T,disabled:A,className:`px-3 py-1 text-[10px] font-bold uppercase tracking-wider rounded bg-cyan-600 hover:bg-cyan-500 text-white transition-colors flex items-center justify-center ${A?"opacity-50 cursor-not-allowed":""}`,children:A?o.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):S("node.content.generateEntities")})]}),a.map((O,D)=>{const z=O.id||`char-idx-${D}`,G=$[(O.name||"").trim().toLowerCase()]>1,F=(O.index||O.alias||"").trim().toLowerCase(),K=H[F]>1;return o.jsxs("div",{className:G?"border-red-500 border rounded-lg":"",children:[G&&o.jsx("div",{className:"text-[10px] text-red-400 bg-red-900/30 px-2 py-0.5 rounded-t-lg",children:"Duplicate Name Warning"}),o.jsx(s5,{char:O,index:D,currentId:z,isSelected:i.has(z),isCollapsed:s.includes(String(z)),t:S,onToggleCollapse:h,onClick:d,onUpdate:g,onDelete:m,onDetach:_,onEmbed:y,onMove:v,deselectAllNodes:b,isFirst:D===0,isLast:D===a.length-1,hasDuplicateIndex:K})]},z)})]})]})}),c5=bt.memo(({scene:e,index:t,isSelected:n,isCollapsed:r,narratorEnabled:a,isModifying:i,t:s,onToggleCollapse:l,onClick:c,onUpdate:d,onDelete:h,onAddAfter:g,onMove:m,onModifyScriptPart:w,deselectAllNodes:y})=>{var A;const[b,S]=x.useState(""),_=(A=e.title)!=null&&A.startsWith(`${s("node.content.scene")} ${t+1}`)?e.title:`${s("node.content.scene")} ${t+1}: ${e.title||""}`,v=I=>{I.stopPropagation();const M=Array.isArray(e.characters)?e.characters:[];let N=0;M.forEach(E=>{const P=E.match(/(\d+)/);P&&(N=Math.max(N,parseInt(P[1],10)))});const k=[...M,`Entity-${N+1}`];d(t,"characters",k)},f=(I,M)=>{const N=[...Array.isArray(e.characters)?e.characters:[]],E=N[I].match(/(\d+)/);let P=E?parseInt(E[1],10):0;const L=Math.max(1,P+M);N[I]=`Entity-${L}`,d(t,"characters",N)},T=I=>{const M=[...Array.isArray(e.characters)?e.characters:[]];M.splice(I,1),d(t,"characters",M)};return o.jsxs("div",{className:`bg-gray-800 rounded-lg p-3 mb-2 space-y-2 border-2 ${n?"border-emerald-500":"border-transparent"} transition-colors shadow-sm`,onClick:I=>c(I,t),children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:I=>{I.target.closest("input, button")||l(t)},children:[o.jsx("div",{className:"flex items-center space-x-2 flex-grow min-w-0",children:o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-bold text-white truncate text-sm",title:_,children:_}),o.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.recommendedFrames!==void 0&&o.jsxs("span",{className:"text-[9px] text-emerald-400 font-mono uppercase tracking-wider bg-emerald-900/30 px-1 rounded whitespace-nowrap",children:[s("node.content.recommendedFrames"),": ",e.recommendedFrames]}),o.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[(Array.isArray(e.characters)?e.characters:[]).map((I,M)=>{const N=I.match(/(?:Entity|Character|)[-\s]?(\d+)/i),k=N?`ENT-${N[1]}`:I;return o.jsx("div",{className:"relative group/char",children:o.jsx("input",{type:"text",value:k,readOnly:!0,className:"text-[9px] text-cyan-300 font-mono uppercase tracking-wider bg-cyan-900/30 px-1 rounded w-12 text-center border border-transparent focus:border-cyan-500 focus:outline-none cursor-ew-resize select-none",onClick:E=>E.stopPropagation(),onKeyDown:E=>{(E.key==="ArrowUp"||E.key==="ArrowRight")&&(E.preventDefault(),E.stopPropagation(),f(M,1)),(E.key==="ArrowDown"||E.key==="ArrowLeft")&&(E.preventDefault(),E.stopPropagation(),f(M,-1))},title:"Use arrows to change index. Shift+Click to remove.",onMouseDown:E=>{E.shiftKey&&(E.stopPropagation(),E.preventDefault(),T(M))}})},`${t}-${M}`)}),o.jsx("button",{onClick:v,className:"text-[9px] text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 px-1.5 rounded transition-colors font-bold h-4 flex items-center justify-center",title:"Add Character (ENT-N)",children:"+"})]})]})]})}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.addScene"),onClick:I=>{I.stopPropagation(),g(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.moveUp"),onClick:I=>{I.stopPropagation(),m(t,"up")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.moveDown"),onClick:I=>{I.stopPropagation(),m(t,"down")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.deleteItem"),onClick:I=>{I.stopPropagation(),h(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{tooltipPosition:"left",title:s(r?"node.action.expandScene":"node.action.collapseScene"),onClick:I=>{I.stopPropagation(),l(t)},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!r&&o.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-700/50",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.sceneDescription")}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsxs("span",{className:"text-[10px] text-gray-500 uppercase",children:[s("node.content.recommendedFrames"),":"]}),o.jsx("input",{type:"number",min:"1",value:e.recommendedFrames||"",onChange:I=>d(t,"recommendedFrames",parseInt(I.target.value,10)||0),className:"bg-gray-900 border border-gray-700 text-emerald-400 text-[10px] w-10 px-1 rounded focus:outline-none focus:border-emerald-500",onMouseDown:I=>I.stopPropagation()})]})]}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.copy"),onClick:I=>{I.stopPropagation(),navigator.clipboard.writeText(e.description)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{value:e.description,onChange:I=>d(t,"description",I.target.value),className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[80px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll",onWheel:I=>I.stopPropagation(),onFocus:y}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("input",{type:"text",value:b,onChange:I=>S(I.target.value),placeholder:s("node.content.modificationPromptPlaceholder"),className:"flex-grow bg-gray-800 text-xs rounded px-2 py-1 border border-gray-700 focus:border-emerald-500 outline-none text-gray-300",onMouseDown:I=>I.stopPropagation()}),o.jsx("button",{onClick:I=>{I.stopPropagation(),w(`scene-${t}-description`,e.description,b),S("")},disabled:!b.trim()||i,className:"bg-emerald-600 hover:bg-emerald-500 text-white text-xs px-2 py-1 rounded disabled:opacity-50",children:i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]})]}),a&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("label",{className:"text-xs font-medium text-emerald-400",children:s("node.content.narrator")}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.copy"),onClick:I=>{I.stopPropagation(),navigator.clipboard.writeText(e.narratorText||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{value:e.narratorText||"",onChange:I=>d(t,"narratorText",I.target.value),className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll text-gray-300 italic",onWheel:I=>I.stopPropagation(),onFocus:y})]})]})]})}),d5=({isScenesSectionCollapsed:e,areAllScenesCollapsed:t,scenes:n,selectedScenes:r,collapsedScenes:a,narratorEnabled:i,isModifyingScriptPart:s,nodeId:l,t:c,handleUiStateUpdate:d,addScene:h,handleToggleAllScenes:g,handleSceneClick:m,handleToggleSceneCollapse:w,updateScene:y,deleteScene:b,addSceneAfter:S,moveScene:_,onModifyScriptPart:v,deselectAllNodes:f,onClearScenes:T})=>o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>d({isScenesSectionCollapsed:!e}),children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:c("node.content.scenes")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:A=>{A.stopPropagation(),g()},disabled:e,className:`p-1 rounded transition-colors ${e?"text-gray-600 cursor-default":"hover:bg-gray-700 text-emerald-400 hover:text-emerald-300"}`,title:c(t?"node.action.expandAll":"node.action.collapseAll"),children:t?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:c("node.action.addScene"),onClick:A=>{A.stopPropagation(),h()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Pe,{tooltipPosition:"left",title:c("node.action.clear"),onClick:A=>{A.stopPropagation(),T()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{tooltipPosition:"left",title:c(e?"node.action.expand":"node.action.collapse"),onClick:A=>{A.stopPropagation(),d({isScenesSectionCollapsed:!e})},children:e?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e&&o.jsx("div",{style:{contentVisibility:"auto"},className:"p-2 space-y-2",children:n.map((A,I)=>o.jsx(c5,{scene:A,index:I,isSelected:r.has(I),isCollapsed:a.includes(I),narratorEnabled:i,isModifying:s===`${l}/scene-${I}-description`,t:c,onToggleCollapse:w,onClick:m,onUpdate:y,onDelete:b,onAddAfter:S,onMove:_,onModifyScriptPart:v,deselectAllNodes:f},I))})]}),u5=({node:e,onValueChange:t,onGenerateScript:n,isGeneratingScript:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,onModifyScriptPart:d,isModifyingScriptPart:h,onDetachCharacter:g,addToast:m,inputData:w,onImproveScriptConcept:y,isImprovingScriptConcept:b,connections:S,getUpstreamTextValue:_,onRemoveConnection:v,onGenerateEntities:f,isGeneratingEntities:T})=>{var hn,an;const{viewTransform:A}=Qo(),{language:I}=Bt(),M=r===e.id,N=T===e.id,k=(c==null?void 0:c.has("prompt"))||(c==null?void 0:c.has(void 0)),E=c==null?void 0:c.has("characters"),P=I==="en"?"ru":I,[L,H]=x.useState(new Set),[$,U]=x.useState(new Set),[O,D]=x.useState(0),[z,G]=x.useState([]),[F,K]=x.useState(null),ae=x.useRef(new Set),[Y,ge]=x.useState({current:0,total:0,last:0}),W=x.useMemo(()=>{try{const we=JSON.parse(e.value||"{}"),Ve={isSettingsCollapsed:!0,isSummaryCollapsed:!0,isStyleCollapsed:!0,isCharactersSectionCollapsed:!0,isScenesSectionCollapsed:!1,collapsedCharacters:[],collapsedScenes:[]};return{prompt:we.prompt||"",targetLanguage:we.targetLanguage||"ru",characterType:we.characterType||"simple",useExistingCharacters:!!we.useExistingCharacters,narratorEnabled:!!we.narratorEnabled,narratorMode:we.narratorMode||"normal",summary:we.summary||"",detailedCharacters:Array.isArray(we.detailedCharacters)?we.detailedCharacters:[],scenes:Array.isArray(we.scenes)?we.scenes:[],isAdvancedMode:!!we.isAdvancedMode,numberOfScenes:we.numberOfScenes||null,isDetailedPlot:!!we.isDetailedPlot,genre:we.genre||"general",genre2:we.genre2||"general",noCharacters:!!we.noCharacters,model:we.model||"gemini-3-pro-preview",includeSubscribeScene:!!we.includeSubscribeScene,visualStyle:we.visualStyle||"none",customVisualStyle:we.customVisualStyle||"",generatedStyle:we.generatedStyle||"",generateMainChars:we.generateMainChars!==!1,createSecondaryChars:we.createSecondaryChars!==!1,createKeyItems:we.createKeyItems!==!1,safeGeneration:!!we.safeGeneration,thinkingEnabled:!!we.thinkingEnabled,scenelessMode:!!we.scenelessMode,simpleActions:!!we.simpleActions,commercialSafe:!!we.commercialSafe,smartConceptEnabled:!!we.smartConceptEnabled,atmosphericEntryEnabled:we.atmosphericEntryEnabled!==!1,generationProgress:we.generationProgress||null,uiState:{...Ve,...we.uiState||{}}}}catch{return{prompt:"",targetLanguage:"ru",detailedCharacters:[],scenes:[],uiState:{isSettingsCollapsed:!0,isSummaryCollapsed:!0,isStyleCollapsed:!0,isCharactersSectionCollapsed:!0,isScenesSectionCollapsed:!1,collapsedCharacters:[],collapsedScenes:[]},model:"gemini-3-pro-preview",summary:"",generatedStyle:"",generateMainChars:!0,commercialSafe:!1,smartConceptEnabled:!1,atmosphericEntryEnabled:!0,generationProgress:null}}},[e.value]),{prompt:le,targetLanguage:X,characterType:Te,useExistingCharacters:pe,narratorEnabled:ue,narratorMode:Oe,summary:he,detailedCharacters:ye,scenes:j,isAdvancedMode:q,numberOfScenes:Q,isDetailedPlot:J,genre:oe,genre2:B,noCharacters:fe,model:ie,includeSubscribeScene:Z,visualStyle:ee,customVisualStyle:R,generatedStyle:be,generateMainChars:Le,createSecondaryChars:je,createKeyItems:Ue,safeGeneration:Fe,thinkingEnabled:ot,scenelessMode:at,simpleActions:rt,commercialSafe:Ce,smartConceptEnabled:ve,atmosphericEntryEnabled:Ge,uiState:ce,generationProgress:He}=W,V=x.useRef(ye),re=x.useRef(ce),ze=x.useRef(pe),ne=x.useRef(fe);x.useEffect(()=>{V.current=ye,re.current=ce,ze.current=pe,ne.current=fe},[ye,ce,pe,fe]),x.useEffect(()=>{let we;return He?He.endTime?ge({current:0,total:Math.floor((He.endTime-He.totalStartTime)/1e3),last:He.lastItemDuration||0}):M&&(we=window.setInterval(()=>{const Ve=Date.now();ge({current:Math.floor((Ve-(He.currentItemStartTime||Ve))/1e3),total:Math.floor((Ve-(He.totalStartTime||Ve))/1e3),last:He.lastItemDuration||0})},100)):ge({current:0,total:0,last:0}),()=>clearInterval(we)},[M,He]);const xe=x.useMemo(()=>S==null?void 0:S.find(we=>we.toNodeId===e.id&&(we.toHandleId==="prompt"||we.toHandleId===void 0)),[S,e.id]),_e=x.useMemo(()=>!xe||!_?"":_(xe.fromNodeId,xe.fromHandleId),[xe,_,w]),Ie=k?_e:le,me=x.useCallback(we=>{const Ve={...W,...we};t(e.id,JSON.stringify(Ve))},[e.id,t,W]);x.useEffect(()=>{let we={},Ve=!1;if(j.length>0){const qe=j.map((lt,Lt)=>Lt);(ce.collapsedScenes||[]).length!==qe.length&&(we.uiState={...ce,collapsedScenes:qe},Ve=!0)}if(ye.length>0){const qe=ye.map(Lt=>Lt.id),it=ce.collapsedCharacters||[];qe.every(Lt=>it.includes(Lt))||(we.uiState={...we.uiState||ce,collapsedCharacters:qe},Ve=!0)}Ve&&me(we)},[]),x.useEffect(()=>{if(w&&pe){const we=setTimeout(()=>{me({_upstreamSync:Date.now()})},800);return()=>clearTimeout(we)}},[w,pe]);const Ee=x.useCallback(we=>{me({uiState:{...ce,...we}})},[me,ce]),Ae=()=>{n(e.id)},Ke=we=>{we.stopPropagation();const Ve=Ie;if(!Ve.trim()){m&&m("No concept to improve.","info");return}k&&xe&&v&&v(xe.id),y&&y(e.id,Ve)},mt=x.useCallback(()=>{const we=`char-${Date.now()}`;let Ve=0;const qe=/^New Entity\s*(\d*)$/i,it=[...z,...ye||[]];it.forEach(De=>{const Re=(De.name||"").match(qe);if(Re){const Je=Re[1]?parseInt(Re[1],10):1;Je>Ve&&(Ve=Je)}});const lt=`New Entity ${Ve+1}`,Lt=it.length+1,Nn={id:we,name:lt,index:`Entity-${Lt}`,fullDescription:"",prompt:"",originalName:lt},Ot=[...ye||[],Nn],se={...ce,isCharactersSectionCollapsed:!1,collapsedCharacters:[...ce.collapsedCharacters||[],we]};me({detailedCharacters:Ot,uiState:se})},[ye,z,me,ce]),Nt=x.useCallback(()=>{const we=((j==null?void 0:j.length)||0)+1,Ve={sceneNumber:we,title:`Scene ${we}`,description:"",narratorText:"",recommendedFrames:6},qe=[...j||[],Ve],it=qe.length-1,lt={...ce,isScenesSectionCollapsed:!1,collapsedScenes:[...ce.collapsedScenes||[],it]};me({scenes:qe,uiState:lt})},[j,me,ce]),It=x.useCallback(we=>{const Ve=[...j||[]],qe={sceneNumber:0,title:"New Scene",description:"",narratorText:"",recommendedFrames:6};Ve.splice(we+1,0,qe);const it=Ve.map((Ot,se)=>({...Ot,sceneNumber:se+1,title:Ot.title==="New Scene"||Ot.title.match(/^Scene \d+$/)?`Scene ${se+1}`:Ot.title})),lt=we+1,Lt=(ce.collapsedScenes||[]).map(Ot=>Ot>=lt?Ot+1:Ot).concat(lt),Nn={...ce,isScenesSectionCollapsed:!1,collapsedScenes:Lt};me({scenes:it,uiState:Nn})},[j,me,ce]),kt=x.useCallback((we,Ve)=>{if(!j||j.length<2)return;const qe=[...j];if(Ve==="up"){if(we===0)return;[qe[we],qe[we-1]]=[qe[we-1],qe[we]]}else{if(we===qe.length-1)return;[qe[we],qe[we+1]]=[qe[we+1],qe[we]]}const it=qe.map((lt,Lt)=>({...lt,sceneNumber:Lt+1}));me({scenes:it})},[j,me]),xt=x.useCallback((we,Ve)=>{if(!ye||ye.length<2)return;let qe=[...ye];const it=qe[we];qe.splice(we,1),Ve==="top"?qe.unshift(it):Ve==="bottom"?qe.push(it):Ve==="up"?qe.splice(Math.max(0,we-1),0,it):Ve==="down"&&qe.splice(Math.min(qe.length,we+1),0,it),me({detailedCharacters:qe})},[ye,me]);x.useEffect(()=>{if(!S||!_){G([]),D(0);return}const we=S.filter(nt=>nt.toNodeId===e.id&&nt.toHandleId==="characters"),Ve=[];we.forEach(nt=>{const St=_(nt.fromNodeId,nt.fromHandleId);try{const Ft=JSON.parse(St||"{}"),zt=de=>({...de,isLinked:!0,id:de.id||`linked-${nt.fromNodeId}-${de.name}`});Array.isArray(Ft)?Ft.forEach(de=>Ve.push(zt(de))):Ft.characters&&Array.isArray(Ft.characters)?Ft.characters.forEach(de=>Ve.push(zt(de))):Ft.name&&Ve.push(zt(Ft))}catch{}});const qe=V.current||[],it=re.current;let lt={};we.length>0&&(ze.current||(lt.useExistingCharacters=!0),ne.current&&(lt.noCharacters=!1));const Lt=Ve.map((nt,St)=>{const{alias:Ft,...zt}=nt;return{...zt,index:`Entity-${St+1}`}}),Nn=Lt.length+1;let Ot=!1;const se=qe.map((nt,St)=>{const zt=`Entity-${Nn+St}`,{alias:de,...ke}=nt;return ke.index!==zt||de?(Ot=!0,{...ke,index:zt}):ke}),De=[...Lt,...se].map(nt=>nt.id),Re=new Set(it.collapsedCharacters||[]);let Je=!1;De.forEach(nt=>{ae.current.has(nt)||Re.has(nt)||(Re.add(nt),Je=!0)}),ae.current=new Set(De);const st=JSON.stringify(z)!==JSON.stringify(Lt);JSON.stringify(qe),JSON.stringify(se),st&&(G(Lt),D(Lt.length)),(Ot||Je||Object.keys(lt).length>0)&&(Ot&&(lt.detailedCharacters=se),Je&&(lt.uiState={...it,collapsedCharacters:Array.from(Re)}),setTimeout(()=>{me(lt)},0))},[S,_,e.id,w,me]);const Dt=x.useCallback(we=>{const Ve={...we,isLinked:!1,id:`char-${Date.now()}-${Math.random().toString(36).substr(2,5)}`};me({detailedCharacters:[...ye,Ve]})},[ye,me]),Mt=x.useMemo(()=>[...z,...ye].sort((Ve,qe)=>{const it=parseInt(Ve.index.replace(/\D/g,""))||999,lt=parseInt(qe.index.replace(/\D/g,""))||999;return it-lt}),[z,ye]);return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex flex-col gap-2 mb-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center px-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.scriptPromptPlaceholder")}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:s("node.action.improveConcept"),tooltipPosition:"left",onClick:Ke,disabled:!Ie.trim()||!!b,children:b?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 animate-spin",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),o.jsx(Pe,{title:s("node.action.clear"),tooltipPosition:"left",onClick:we=>{we.stopPropagation(),me({prompt:""})},disabled:k||!le,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsx("textarea",{value:Ie,onChange:we=>me({prompt:we.target.value}),placeholder:s(k?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),disabled:k||M||N,className:`w-full p-2 bg-gray-700 border border-gray-600 rounded-md resize-y min-h-[80px] max-h-[200px] focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll ${k?"text-gray-300 italic":""}`,rows:2,onWheel:we=>we.stopPropagation(),onMouseDown:we=>we.stopPropagation(),onFocus:l}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5 items-center",children:[o.jsx(ht,{title:s("tooltip.model.flash"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>me({model:"gemini-3-flash-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${ie==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),"FLASH"]})}),o.jsx(ht,{title:s("tooltip.model.pro"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>me({model:"gemini-3-pro-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${ie==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),"PRO"]})})]}),o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5 items-center",children:[o.jsx(ht,{title:s(`tooltip.lang.${P}`),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>me({targetLanguage:P}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${X===P?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:P.toUpperCase()})}),o.jsx(ht,{title:s("tooltip.lang.en"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>me({targetLanguage:"en"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${X==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"EN"})})]}),o.jsxs("button",{onClick:M||N?i:Ae,disabled:a||!M&&!k&&!le.trim()&&!pe,className:`flex-grow h-10 px-4 font-bold text-xs uppercase tracking-wide text-white rounded-lg transition-all duration-200 shadow-sm flex items-center justify-center ${a?"bg-yellow-600 hover:bg-yellow-500":M?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed"}`,children:[M?o.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})}),s(a?"node.action.stopping":M?"node.content.generating":"node.content.generateScript")]})]}),o.jsxs("div",{className:"p-2 flex items-center justify-between text-xs border border-gray-700 bg-gray-900/50 rounded-md",children:[o.jsx("div",{className:"font-semibold text-emerald-400",children:s("node.content.scenes_generated",{count:j.length})}),o.jsx("div",{className:"flex items-center gap-4 text-gray-400",children:He&&o.jsxs(o.Fragment,{children:[M?o.jsx("div",{className:"text-yellow-400 animate-pulse font-mono",children:s("node.content.status.generating")}):null,o.jsxs("div",{className:"text-gray-400 font-mono text-[10px]",children:["Time (sec): (prev: ",Y.last,") / Cur: ",Y.current," / Total: ",Y.total]})]})})]}),M&&He&&o.jsx("div",{className:"w-full h-1 bg-gray-800 rounded-b-md overflow-hidden border-t border-gray-800 -mt-2",children:o.jsx("div",{className:"h-full bg-emerald-500 animate-pulse w-full"})})]}),o.jsx(a5,{uiState:ce,onUpdateUiState:Ee,onUpdateValue:me,nodeId:e.id,t:s,deselectAllNodes:l,numberOfScenes:Q,visualStyle:ee,customVisualStyle:R,genre:oe,genre2:B,characterType:Te,narratorMode:Oe,narratorEnabled:ue,noCharacters:fe,useExistingCharacters:pe,isCharactersInputConnected:!!E,linkedCharactersCount:O,isDetailedPlot:J,includeSubscribeScene:Z,model:ie,isLoading:M||!!N,targetLanguage:X,prompt:le,allCharacters:ye,estimateFrames:!0,safeGeneration:Fe,thinkingEnabled:ot,scenelessMode:at,simpleActions:rt,commercialSafe:Ce,smartConceptEnabled:ve,atmosphericEntryEnabled:Ge,targetScrollId:F,onSetTargetScrollId:K,generateMainChars:Le,createSecondaryChars:je,createKeyItems:Ue,onToggleGenerateMainChars:()=>me({generateMainChars:!Le}),onToggleCreateSecondaryChars:()=>me({createSecondaryChars:!je}),onToggleCreateKeyItems:()=>me({createKeyItems:!Ue})}),o.jsx("div",{className:"my-2 border-b border-gray-700/50"}),o.jsxs("div",{className:"flex-grow overflow-y-auto min-h-0 custom-scrollbar p-1 flex flex-col gap-1 bg-gray-900/30 border border-gray-700/50 rounded-md",onWheel:we=>we.stopPropagation(),style:{scrollbarGutter:"stable"},children:[o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>Ee({isStyleCollapsed:!ce.isStyleCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:s("node.content.style")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.copy"),onClick:we=>{we.stopPropagation(),navigator.clipboard.writeText(be)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.clear"),onClick:we=>{we.stopPropagation(),me({generatedStyle:""})},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{title:ce.isStyleCollapsed?s("node.action.expand"):s("node.action.collapse"),onClick:we=>{we.stopPropagation(),Ee({isStyleCollapsed:!ce.isStyleCollapsed})},tooltipPosition:"left",children:ce.isStyleCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!ce.isStyleCollapsed&&o.jsx("div",{className:"p-2",children:o.jsx("textarea",{value:be,onChange:we=>me({generatedStyle:we.target.value}),placeholder:s("node.content.stylePromptPlaceholder"),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar text-gray-300"})})]}),o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>Ee({isSummaryCollapsed:!ce.isSummaryCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:s("node.content.summary")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.copy"),onClick:we=>{we.stopPropagation(),navigator.clipboard.writeText(he)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Pe,{tooltipPosition:"left",title:s("node.action.clear"),onClick:we=>{we.stopPropagation(),me({summary:""})},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{title:ce.isSummaryCollapsed?s("node.action.expand"):s("node.action.collapse"),onClick:we=>{we.stopPropagation(),Ee({isSummaryCollapsed:!ce.isSummaryCollapsed})},tooltipPosition:"left",children:ce.isSummaryCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!ce.isSummaryCollapsed&&o.jsx("div",{className:"p-2",children:o.jsx("textarea",{value:he,onChange:we=>me({summary:we.target.value}),placeholder:"...",className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar text-gray-300"})})]}),o.jsx(l5,{uiState:ce,onUpdateUiState:Ee,onUpdateValue:me,allCharacters:Mt,selectedCharacters:$,collapsedCharacters:ce.collapsedCharacters||[],isCharactersSectionCollapsed:!!ce.isCharactersSectionCollapsed,areAllCharactersCollapsed:Mt.length>0&&((hn=ce.collapsedCharacters)==null?void 0:hn.length)===Mt.length,t:s,onAddCharacter:mt,handleToggleAllCharacters:()=>{var we;((we=ce.collapsedCharacters)==null?void 0:we.length)===Mt.length?me({uiState:{...ce,collapsedCharacters:[]}}):me({uiState:{...ce,collapsedCharacters:Mt.map(Ve=>Ve.id)}})},handleCharacterClick:(we,Ve)=>{U(qe=>{const it=new Set(qe);return it.has(String(Ve))?it.delete(String(Ve)):it.add(String(Ve)),it})},handleToggleCharacterCollapse:we=>{const Ve=ce.collapsedCharacters||[],qe=Ve.includes(String(we))?Ve.filter(it=>it!==String(we)):[...Ve,String(we)];Ee({collapsedCharacters:qe})},updateCharacter:(we,Ve,qe)=>{const it=ye.map(lt=>lt.id===we?{...lt,[Ve]:qe}:lt);me({detailedCharacters:it})},deleteCharacter:we=>{const Ve=ye.filter(qe=>qe.id!==we);me({detailedCharacters:Ve})},onDetachCharacter:we=>g(we,e),handleEmbedCharacter:Dt,deselectAllNodes:l,onSyncCharacters:void 0,isSyncAvailable:!1,onMoveCharacter:xt,onClearCharacters:()=>me({detailedCharacters:[]}),onGenerateEntities:()=>f(e.id),isGeneratingEntities:!!N,generateMainChars:Le,createSecondaryChars:je,createKeyItems:Ue,onGenerateMainChange:we=>me({generateMainChars:we}),onCreateSecondaryChange:we=>me({createSecondaryChars:we}),onCreateKeyItemsChange:we=>me({createKeyItems:we}),onSetTargetScrollId:K}),o.jsx(d5,{isScenesSectionCollapsed:!!ce.isScenesSectionCollapsed,areAllScenesCollapsed:j.length>0&&((an=ce.collapsedScenes)==null?void 0:an.length)===j.length,scenes:j,selectedScenes:L,collapsedScenes:ce.collapsedScenes||[],narratorEnabled:ue,isModifyingScriptPart:h,nodeId:e.id,t:s,handleUiStateUpdate:Ee,addScene:Nt,handleToggleAllScenes:()=>{var we;((we=ce.collapsedScenes)==null?void 0:we.length)===j.length?me({uiState:{...ce,collapsedScenes:[]}}):me({uiState:{...ce,collapsedScenes:j.map((Ve,qe)=>qe)}})},handleSceneClick:()=>{},handleToggleSceneCollapse:we=>{const Ve=ce.collapsedScenes||[],qe=Ve.includes(we)?Ve.filter(it=>it!==we):[...Ve,we];me({uiState:{...ce,collapsedScenes:qe}})},updateScene:(we,Ve,qe)=>{const it=[...j];it[we]={...it[we],[Ve]:qe},me({scenes:it})},deleteScene:we=>{const Ve=j.filter((qe,it)=>it!==we);me({scenes:Ve})},addSceneAfter:It,moveScene:kt,onModifyScriptPart:(we,Ve,qe)=>d(e.id,we,Ve,qe),deselectAllNodes:l,onClearScenes:()=>me({scenes:[]})})]})]})},Ht=x.forwardRef(({id:e,label:t,originalText:n,translatedText:r,isCritical:a,isEnabled:i=!0,isMandatory:s=!1,onToggle:l,color:c="emerald",className:d="h-full",index:h,isHighlighted:g},m)=>{const[w,y]=x.useState(!1);let b="",S="",_="",v="",f="",T="";const A="flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none gap-3 items-stretch duration-200";if(!i)b="bg-gray-800/40 hover:bg-gray-800/60",S="border-gray-700 hover:border-gray-600",_="text-gray-500 group-hover:text-gray-400",v="bg-gray-700 group-hover:bg-gray-600",f="text-gray-600 group-hover:text-gray-500",T="bg-gray-800 text-gray-600";else if(a)b="bg-red-900/20",S="border-red-800/50",_="text-red-400",v="bg-red-500",f="text-gray-300",T="bg-red-900/50 text-red-200";else if(s)b="bg-gray-800",S="border-gray-600",_="text-emerald-400",v="bg-gray-500",f="text-gray-300",T="bg-gray-700 text-gray-400";else switch(f="text-gray-300",c){case"cyan":b="bg-cyan-900/20",S="border-cyan-700/50",_="text-cyan-400",v="bg-cyan-500",T="bg-cyan-900/50 text-cyan-200";break;case"gray":b="bg-gray-700/40",S="border-gray-500/50",_="text-gray-300",v="bg-gray-400",T="bg-gray-600 text-gray-200";break;default:b="bg-emerald-900/20",S="border-emerald-700/50",_="text-emerald-400",v="bg-emerald-500",T="bg-emerald-900/50 text-emerald-200"}g&&(S="border-yellow-400 ring-1 ring-yellow-400/50",b="bg-yellow-900/30");const I=N=>{!s&&l&&(N.preventDefault(),N.stopPropagation(),l(e))},M=N=>{N.preventDefault(),N.stopPropagation(),navigator.clipboard.writeText(n),y(!0),setTimeout(()=>y(!1),1500)};return o.jsxs("div",{ref:m,onMouseDown:N=>N.stopPropagation(),onClick:I,className:`${A} ${b} ${S} ${d} ${s?"":"cursor-pointer shadow-sm"}`,children:[h!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${T}`,children:h}),o.jsx("div",{className:`w-px flex-grow mt-1 ${i?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[h===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${v}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${_}`,children:t})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:M,className:`p-0.5 rounded transition-colors ${i?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:w?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!s&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${i?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:i?"ON":"OFF"})]})]}),o.jsx("div",{className:`mb-1 leading-tight ${i?"text-gray-400":"text-gray-600"} text-[10px]`,children:n}),r&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`leading-tight italic ${f}`,children:r})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${v}`})]})}),aa=bt.memo(({id:e,onClick:t,t:n})=>o.jsx(ht,{title:n("node.action.locateInStack"),position:"left",children:o.jsx("button",{onClick:r=>{r.stopPropagation(),t(r,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",type:"button",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})})),p5=bt.memo(({uiState:e,localSettingsHeight:t,setLocalSettingsHeight:n,onUpdateUiState:r,onUpdateValue:a,disabledInstructionIds:i,t:s,targetLanguage:l,scale:c,maxHeight:d,charDescMode:h,safeGeneration:g=!1,thinkingEnabled:m=!1,model:w,targetScrollId:y,onSetTargetScrollId:b,propEnhancementEnabled:S=!0,isProcessWholeScene:_,onToggleProcessWholeScene:v,isSaturationEnabled:f,onToggleSaturation:T,onTogglePropEnhancement:A})=>{const[I,M]=x.useState(!1),[N,k]=x.useState(""),E=x.useRef({}),P=x.useRef(null),[L,H]=x.useState(t||380);x.useEffect(()=>{Math.abs(t-L)>1&&H(t||380)},[t]),x.useEffect(()=>{if(y){k(""),setTimeout(()=>{if(E.current[y]&&!e.isSettingsCollapsed){const le=E.current[y],X=P.current;if(le&&X){const Te=le.offsetTop,pe=Math.max(0,Te-X.clientHeight/2+le.clientHeight/2);X.scrollTo({top:pe,behavior:"smooth"})}}},50);const W=setTimeout(()=>{b(null)},2e3);return()=>clearTimeout(W)}},[y,e.isSettingsCollapsed,b]);const $=W=>{W.preventDefault(),W.stopPropagation();const le=W.clientY,X=L;let Te=X;const pe=Oe=>{Oe.preventDefault(),Oe.stopPropagation();const he=(Oe.clientY-le)/c;Te=Math.max(100,Math.min(800,X+he)),H(Te),n(Te)},ue=Oe=>{Oe.preventDefault(),Oe.stopPropagation(),window.removeEventListener("mousemove",pe),window.removeEventListener("mouseup",ue),a({settingsPaneHeight:Te})};window.addEventListener("mousemove",pe),window.addEventListener("mouseup",ue)},U=W=>{W.stopPropagation(),a({disabledInstructionIds:["break_paragraphs","pm_anthro","pm_subscribe","rule_saturation"],charDescMode:"general",safeGeneration:!1,thinkingEnabled:!1,propEnhancementEnabled:!0})},O=W=>{const le=i.includes(W);let X;le?X=i.filter(ue=>ue!==W):X=[...i,W];const Te=te.GENERATE_VIDEO_PROMPT.id,pe=te.IMG_VID_CONSISTENCY.id;W===Te&&(le?X=X.filter(ue=>ue!==pe):X.includes(pe)||X.push(pe)),a({disabledInstructionIds:X})},D=W=>!i.includes(W),z=D(te.GENERATE_VIDEO_PROMPT.id),G=W=>W==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":W==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":W;let F=0;const K=(W,le)=>{b(le)},ae=(W,le)=>{if(!N)return!0;const X=N.toLowerCase();return W.toLowerCase().includes(X)||le.toLowerCase().includes(X)},Y=()=>h==="none"?Yu:D(te.VISUAL_SATURATION.id)?te.LAYERED_CONSTRUCTION.text:Wu,ge=()=>h==="none"?"instruction.desc.layered_no_char":D(te.VISUAL_SATURATION.id)?"instruction.desc.layered":"instruction.desc.layered_no_style";return o.jsxs("div",{className:`border ${I?"border-emerald-500":"border-gray-600"} hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden mb-2 flex-shrink-0 flex flex-col relative transition-colors duration-200`,style:{height:e.isSettingsCollapsed?"auto":`${L}px`},onWheel:W=>W.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>r({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-1.533 2.16-1.535.113-1.535 2.322 0 2.435 1.594.118 2.073 1.274 1.533 2.16-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.948c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.948c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042 1.533-2.16 1.535-.113 1.535-2.322 0-2.435-1.594-.118-2.073-1.274-1.533-2.16.836-1.372-.734-2.942-2.106-2.106a1.533 1.533 0 01-2.287-.948zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:s("node.content.activePromptStack")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:s("toolbar.resetToDefault"),onClick:U,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{title:e.isSettingsCollapsed?s("node.action.expand"):s("node.action.collapse"),onClick:W=>{W.stopPropagation(),r({isSettingsCollapsed:!e.isSettingsCollapsed})},children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isSettingsCollapsed&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"px-2 py-2 border-b border-gray-700 bg-gray-800/30 flex flex-wrap gap-x-3 gap-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(Ct,{id:"quick-safe",checked:g,onChange:W=>a({safeGeneration:W}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"quick-safe",className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-emerald-400 transition-colors whitespace-nowrap",children:s("node.content.safeGeneration")}),o.jsx(aa,{id:"safe-gen-brick",onClick:K,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(Ct,{id:"quick-thinking",checked:m,onChange:W=>a({thinkingEnabled:W}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"quick-thinking",className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-cyan-400 transition-colors whitespace-nowrap",children:s("node.content.thinkingEnabled")}),o.jsx(aa,{id:"thinking-brick",onClick:K,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(Ct,{id:"quick-anthro",checked:D(te.ANTHRO_REINFORCEMENT.id),onChange:()=>O(te.ANTHRO_REINFORCEMENT.id),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"quick-anthro",className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-cyan-400 transition-colors whitespace-nowrap",children:s("node.content.anthroEnabled")}),o.jsx(aa,{id:te.ANTHRO_REINFORCEMENT.id,onClick:K,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(Ct,{id:"quick-format",checked:D(te.BREAK_PARAGRAPHS.id),onChange:()=>O(te.BREAK_PARAGRAPHS.id),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"quick-format",className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-white transition-colors whitespace-nowrap",children:s("instruction.formatting")}),o.jsx(aa,{id:te.BREAK_PARAGRAPHS.id,onClick:K,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(Ct,{id:"quick-general-char",checked:h==="general",onChange:()=>a({charDescMode:h==="general"?"none":"general"}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"quick-general-char",className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-emerald-400 transition-colors whitespace-nowrap",children:s("node.content.includeGeneralCharDesc")}),o.jsx(aa,{id:te.GENERAL_CHAR_DESC.id,onClick:K,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(Ct,{id:"quick-video-prompt",checked:z,onChange:()=>O(te.GENERATE_VIDEO_PROMPT.id),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"quick-video-prompt",className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-cyan-400 transition-colors whitespace-nowrap",children:s("instruction.video")}),o.jsx(aa,{id:te.GENERATE_VIDEO_PROMPT.id,onClick:K,t:s})]})]}),o.jsx("div",{className:"p-2 border-b border-gray-700 bg-gray-800/80 sticky top-0 z-10 flex items-center gap-2",children:o.jsxs("div",{className:"relative w-full",children:[o.jsx("input",{type:"text",value:N,onChange:W=>k(W.target.value),placeholder:s("node.content.findStack"),className:"w-full pl-7 pr-2 py-1 text-xs bg-gray-900/80 border border-gray-600 rounded-md focus:outline-none focus:border-emerald-500 text-gray-300 placeholder-gray-600"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),N&&o.jsx("button",{onClick:()=>k(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:""})]})}),o.jsxs("div",{ref:P,className:"p-2 overflow-y-auto custom-scrollbar flex-grow bg-gray-800/20 space-y-2 pb-4 relative",onWheel:W=>W.stopPropagation(),children:[ae(G(w),s("node.content.model"))&&o.jsx(Ht,{ref:W=>{E.current["model-brick"]=W},id:"model-brick",label:s("node.content.model"),originalText:G(w),isMandatory:!0,color:"gray",className:"h-auto",isHighlighted:y==="model-brick"}),ae(te.INPUTS.text,s(`instruction.${te.INPUTS.id}`))&&o.jsx(Ht,{ref:W=>{E.current[te.INPUTS.id]=W},id:te.INPUTS.id,index:++F,label:s(`instruction.${te.INPUTS.id}`),originalText:te.INPUTS.text,translatedText:s(`instruction.desc.${te.INPUTS.id}`),isMandatory:!0,color:"gray",className:"h-auto",isHighlighted:y===te.INPUTS.id}),ae(Un(l),s("node.content.targetLanguage"))&&o.jsx(Ht,{id:"target-lang-brick",index:++F,label:s("node.content.targetLanguage"),originalText:Un(l),translatedText:s("instruction.desc.target_lang"),isMandatory:!0,color:"gray",className:"h-auto"}),ae("Enable extended reasoning",s("node.content.thinkingEnabled"))&&o.jsx(Ht,{ref:W=>{E.current["thinking-brick"]=W},id:"thinking-brick",index:m?++F:void 0,label:s("node.content.thinkingEnabled"),originalText:"Enable extended reasoning for deeper plot coherence.",translatedText:"     .",isEnabled:m,onToggle:()=>a({thinkingEnabled:!m}),color:"cyan",className:"h-auto",isHighlighted:y==="thinking-brick"}),o.jsxs("div",{className:"space-y-1 flex-none mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.priming")}),ae(Ko.text,s("node.content.safeGeneration"))&&o.jsx(Ht,{ref:W=>{E.current["safe-gen-brick"]=W},id:"safe-gen-brick",index:g?++F:void 0,label:s("node.content.safeGeneration"),originalText:Ko.text,translatedText:s("instruction.desc.safe_gen"),isCritical:!0,isEnabled:g,onToggle:()=>a({safeGeneration:!g}),className:"h-auto",isHighlighted:y==="safe-gen-brick"}),ae(te.ROLE.text,s("instruction.role"))&&o.jsx(Ht,{ref:W=>{E.current[te.ROLE.id]=W},id:te.ROLE.id,index:++F,label:s("instruction.role"),originalText:te.ROLE.text,translatedText:s("instruction.desc.role"),isMandatory:!0,className:"h-auto",isHighlighted:y===te.ROLE.id})]}),o.jsxs("div",{className:"space-y-1 flex-none mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.physics")}),ae(te.NO_POV.text,s("instruction.no_pov"))&&o.jsx(Ht,{ref:W=>{E.current[te.NO_POV.id]=W},id:te.NO_POV.id,index:++F,label:s("instruction.no_pov"),originalText:te.NO_POV.text,translatedText:s("instruction.desc.no_pov"),isMandatory:!0,isCritical:!0,className:"h-auto",isHighlighted:y===te.NO_POV.id}),ae(te.STATIC_STATE.text,s("instruction.rule_static"))&&o.jsx(Ht,{ref:W=>{E.current[te.STATIC_STATE.id]=W},id:te.STATIC_STATE.id,index:++F,label:s("instruction.rule_static"),originalText:te.STATIC_STATE.text,translatedText:s("instruction.desc.rule_static"),isMandatory:!0,className:"h-auto",isHighlighted:y===te.STATIC_STATE.id}),ae(te.ATMOSPHERIC_FIX.text,s("instruction.atmosphere_fix"))&&o.jsx(Ht,{ref:W=>{E.current[te.ATMOSPHERIC_FIX.id]=W},id:te.ATMOSPHERIC_FIX.id,index:++F,label:s("instruction.atmosphere_fix"),originalText:te.ATMOSPHERIC_FIX.text,translatedText:s("instruction.desc.atmosphere_fix"),isMandatory:!0,className:"h-auto",isHighlighted:y===te.ATMOSPHERIC_FIX.id}),ae(te.STATELESS.text,s("instruction.stateless"))&&o.jsx(Ht,{ref:W=>{E.current[te.STATELESS.id]=W},id:te.STATELESS.id,index:++F,label:s("instruction.stateless"),originalText:te.STATELESS.text,translatedText:s("instruction.desc.stateless"),isMandatory:!0,isCritical:!0,className:"h-auto",isHighlighted:y===te.STATELESS.id}),ae(te.ALWAYS_ENV.text,s("instruction.always_env"))&&o.jsx(Ht,{ref:W=>{E.current[te.ALWAYS_ENV.id]=W},id:te.ALWAYS_ENV.id,index:++F,label:s("instruction.always_env"),originalText:te.ALWAYS_ENV.text,translatedText:s("instruction.desc.always_env"),isCritical:!0,isMandatory:!0,className:"h-auto",isHighlighted:y===te.ALWAYS_ENV.id})]}),o.jsxs("div",{className:"space-y-1 flex-none mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.hierarchy")}),ae(te.SUBJECT_FOCUS.text,s("instruction.subject_focus"))&&o.jsx(Ht,{ref:W=>{E.current[te.SUBJECT_FOCUS.id]=W},id:te.SUBJECT_FOCUS.id,index:++F,label:s("instruction.subject_focus"),originalText:te.SUBJECT_FOCUS.text,translatedText:s("instruction.desc.subject_focus"),isMandatory:!0,className:"h-auto",isHighlighted:y===te.SUBJECT_FOCUS.id}),ae(te.ANATOMICAL_STRICTNESS.text,s("instruction.anatomical_strictness"))&&o.jsx(Ht,{ref:W=>{E.current[te.ANATOMICAL_STRICTNESS.id]=W},id:te.ANATOMICAL_STRICTNESS.id,index:D(te.ANATOMICAL_STRICTNESS.id)?++F:void 0,label:s("instruction.anatomical_strictness"),originalText:te.ANATOMICAL_STRICTNESS.text,translatedText:s("instruction.desc.anatomical_strictness"),onToggle:()=>O(te.ANATOMICAL_STRICTNESS.id),isEnabled:D(te.ANATOMICAL_STRICTNESS.id),isCritical:!0,color:"emerald",className:"h-auto",isHighlighted:y===te.ANATOMICAL_STRICTNESS.id}),ae(te.PROP_ENHANCEMENT.text,te.PROP_ENHANCEMENT.label)&&o.jsx(Ht,{ref:W=>{E.current[te.PROP_ENHANCEMENT.id]=W},id:te.PROP_ENHANCEMENT.id,index:S?++F:void 0,label:te.PROP_ENHANCEMENT.label,originalText:te.PROP_ENHANCEMENT.text,translatedText:s("instruction.desc.prop_enhancement"),isEnabled:S,onToggle:()=>a({propEnhancementEnabled:!S}),color:"emerald",className:"h-auto",isHighlighted:y===te.PROP_ENHANCEMENT.id}),ae(te.STRICT_CHAR_INDEX.text,s("instruction.strict_char_index"))&&o.jsx(Ht,{ref:W=>{E.current[te.STRICT_CHAR_INDEX.id]=W},id:te.STRICT_CHAR_INDEX.id,index:++F,label:s("instruction.strict_char_index"),originalText:te.STRICT_CHAR_INDEX.text,translatedText:s("instruction.desc.strict_char_index"),isMandatory:!0,className:"h-auto",isHighlighted:y===te.STRICT_CHAR_INDEX.id}),ae(te.NO_NAMES.text,s("instruction.no_names"))&&o.jsx(Ht,{ref:W=>{E.current[te.NO_NAMES.id]=W},id:te.NO_NAMES.id,index:++F,label:s("instruction.no_names"),originalText:te.NO_NAMES.text,translatedText:s("instruction.desc.no_names"),isCritical:!0,isMandatory:!0,className:"h-auto",isHighlighted:y===te.NO_NAMES.id}),o.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[ae(te.ANTHRO_REINFORCEMENT.text,s("node.content.anthroEnabled"))&&o.jsx(Ht,{ref:W=>{E.current[te.ANTHRO_REINFORCEMENT.id]=W},id:te.ANTHRO_REINFORCEMENT.id,index:D(te.ANTHRO_REINFORCEMENT.id)?++F:void 0,label:s("node.content.anthroEnabled"),originalText:te.ANTHRO_REINFORCEMENT.text,translatedText:s("instruction.desc.pm_anthro"),onToggle:()=>O(te.ANTHRO_REINFORCEMENT.id),isEnabled:D(te.ANTHRO_REINFORCEMENT.id),color:"cyan",className:"h-auto",isHighlighted:y===te.ANTHRO_REINFORCEMENT.id}),ae(te.SUBSCRIBE_REINFORCEMENT.text,s("node.content.subscribeEnhancement"))&&o.jsx(Ht,{ref:W=>{E.current[te.SUBSCRIBE_REINFORCEMENT.id]=W},id:te.SUBSCRIBE_REINFORCEMENT.id,index:D(te.SUBSCRIBE_REINFORCEMENT.id)?++F:void 0,label:s("node.content.subscribeEnhancement"),originalText:te.SUBSCRIBE_REINFORCEMENT.text,translatedText:s("instruction.desc.pm_subscribe"),onToggle:()=>O(te.SUBSCRIBE_REINFORCEMENT.id),isEnabled:D(te.SUBSCRIBE_REINFORCEMENT.id),color:"cyan",className:"h-auto",isHighlighted:y===te.SUBSCRIBE_REINFORCEMENT.id})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-1 mt-1",children:[ae(s("node.content.noCharDesc"),s("node.content.noCharDesc"))&&o.jsx(Ht,{id:"no-char-desc",index:h==="none"?++F:void 0,label:s("node.content.noCharDesc"),originalText:"Excludes character visual descriptions.",translatedText:s("instruction.desc.layered_no_char"),isEnabled:h==="none",onToggle:()=>a({charDescMode:"none"}),color:"gray"}),ae(te.GENERAL_CHAR_DESC.text,s("node.content.includeGeneralCharDesc"))&&o.jsx(Ht,{ref:W=>{E.current[te.GENERAL_CHAR_DESC.id]=W},id:te.GENERAL_CHAR_DESC.id,index:h==="general"?++F:void 0,label:s("node.content.includeGeneralCharDesc"),originalText:te.GENERAL_CHAR_DESC.text,translatedText:s("instruction.desc.general_char_desc"),isEnabled:h==="general",onToggle:()=>a({charDescMode:"general"}),color:"emerald",isHighlighted:y===te.GENERAL_CHAR_DESC.id}),ae(te.FULL_CHAR_DESC.text,s("node.content.includeFullCharDesc"))&&o.jsx(Ht,{ref:W=>{E.current[te.FULL_CHAR_DESC.id]=W},id:te.FULL_CHAR_DESC.id,index:h==="full"?++F:void 0,label:s("node.content.includeFullCharDesc"),originalText:te.FULL_CHAR_DESC.text,translatedText:s("instruction.desc.full_char_desc"),isEnabled:h==="full",onToggle:()=>a({charDescMode:"full"}),color:"emerald",isHighlighted:y===te.FULL_CHAR_DESC.id})]})]}),o.jsxs("div",{className:"space-y-1 flex-none",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.construction")}),ae(te.PROCESS_WHOLE_SCENE.text,s("instruction.process_whole_scene"))&&o.jsx(Ht,{ref:W=>{E.current[te.PROCESS_WHOLE_SCENE.id]=W},id:te.PROCESS_WHOLE_SCENE.id,index:D(te.PROCESS_WHOLE_SCENE.id)?++F:void 0,label:s("instruction.process_whole_scene"),originalText:te.PROCESS_WHOLE_SCENE.text,translatedText:s("instruction.desc.process_whole_scene"),onToggle:()=>O(te.PROCESS_WHOLE_SCENE.id),isEnabled:D(te.PROCESS_WHOLE_SCENE.id),color:"cyan",className:"h-auto",isHighlighted:y===te.PROCESS_WHOLE_SCENE.id}),ae(Y(),s("instruction.layered"))&&o.jsx(Ht,{ref:W=>{E.current[te.LAYERED_CONSTRUCTION.id]=W},id:te.LAYERED_CONSTRUCTION.id,index:++F,label:s("instruction.layered"),originalText:Y(),translatedText:s(ge()),onToggle:()=>O(te.LAYERED_CONSTRUCTION.id),isEnabled:D(te.LAYERED_CONSTRUCTION.id),color:"emerald",className:"h-auto",isHighlighted:y===te.LAYERED_CONSTRUCTION.id}),ae(te.VISUAL_SATURATION.text,s("instruction.visuals"))&&o.jsx(Ht,{ref:W=>{E.current[te.VISUAL_SATURATION.id]=W},id:te.VISUAL_SATURATION.id,index:D(te.VISUAL_SATURATION.id)?++F:void 0,label:s("instruction.visuals"),originalText:te.VISUAL_SATURATION.text,translatedText:s("instruction.desc.visuals"),onToggle:()=>O(te.VISUAL_SATURATION.id),isEnabled:D(te.VISUAL_SATURATION.id),color:"cyan",className:"h-auto",isHighlighted:y===te.VISUAL_SATURATION.id}),ae(te.BREAK_PARAGRAPHS.text,s("instruction.formatting"))&&o.jsx(Ht,{ref:W=>{E.current[te.BREAK_PARAGRAPHS.id]=W},id:te.BREAK_PARAGRAPHS.id,index:D(te.BREAK_PARAGRAPHS.id)?++F:void 0,label:s("instruction.formatting"),originalText:te.BREAK_PARAGRAPHS.text,translatedText:s("instruction.desc.formatting"),onToggle:()=>O(te.BREAK_PARAGRAPHS.id),isEnabled:D(te.BREAK_PARAGRAPHS.id),color:"gray",className:"h-auto",isHighlighted:y===te.BREAK_PARAGRAPHS.id}),ae(te.GENERATE_VIDEO_PROMPT.text,s("instruction.video"))&&o.jsx(Ht,{ref:W=>{E.current[te.GENERATE_VIDEO_PROMPT.id]=W},id:te.GENERATE_VIDEO_PROMPT.id,index:z?++F:void 0,label:s("instruction.video"),originalText:te.GENERATE_VIDEO_PROMPT.text,translatedText:s("instruction.desc.video"),onToggle:()=>O(te.GENERATE_VIDEO_PROMPT.id),isEnabled:z,color:"cyan",className:"h-auto",isHighlighted:y===te.GENERATE_VIDEO_PROMPT.id}),ae(te.IMG_VID_CONSISTENCY.text,s("instruction.img_vid_consistency"))&&o.jsx(Ht,{ref:W=>{E.current[te.IMG_VID_CONSISTENCY.id]=W},id:te.IMG_VID_CONSISTENCY.id,index:D(te.IMG_VID_CONSISTENCY.id)?++F:void 0,label:s("instruction.img_vid_consistency"),originalText:te.IMG_VID_CONSISTENCY.text,translatedText:s("instruction.desc.img_vid_consistency"),onToggle:()=>O(te.IMG_VID_CONSISTENCY.id),isEnabled:D(te.IMG_VID_CONSISTENCY.id),color:"emerald",className:"h-auto",isHighlighted:y===te.IMG_VID_CONSISTENCY.id})]})]}),o.jsx("div",{className:"absolute bottom-0 inset-x-0 h-3 cursor-ns-resize bg-transparent z-20",onMouseDown:$,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1)})]})]})}),h5=({uiState:e,onUpdateUiState:t,onUpdateValue:n,upstreamAnalyzerData:r,isStyleConnected:a,isDataConnected:i,upstreamStyleValue:s,styleOverride:l,deselectAllNodes:c,t:d,characters:h,onRefresh:g})=>{const m=(r==null?void 0:r.visualStyle)||(r==null?void 0:r.generatedStyle)||"",w=a?d("node.content.connectedPlaceholder"):m||d("node.content.stylePromptPlaceholder"),y=x.useMemo(()=>h?[...h].sort((b,S)=>{const _=T=>{const A=(T||"").match(/(\d+)/);return A?parseInt(A[1],10):99999},v=b.index||b.alias||"",f=S.index||S.alias||"";return _(v)-_(f)}):[],[h]);return o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-gray-400 overflow-hidden flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>t({isCharStyleCollapsed:!e.isCharStyleCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),o.jsxs("h3",{className:"font-bold text-gray-400 text-xs uppercase tracking-wider",children:[d("node.content.characters")," & ",d("node.content.style")]}),g&&o.jsx("button",{onClick:b=>{b.stopPropagation(),g()},className:"p-1 hover:bg-gray-700 rounded text-emerald-400 hover:text-emerald-300 transition-colors ml-2",title:d("node.action.refreshData"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Pe,{tooltipPosition:"left",title:e.isCharStyleCollapsed?d("node.action.expand"):d("node.action.collapse"),onClick:b=>{b.stopPropagation(),t({isCharStyleCollapsed:!e.isCharStyleCollapsed})},children:e.isCharStyleCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]}),!e.isCharStyleCollapsed&&o.jsxs("div",{className:"p-2 flex gap-2 h-[170px]",children:[o.jsx("div",{className:"w-1/2 flex flex-col min-h-0",children:o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar pr-1 space-y-1 bg-gray-800 rounded-md p-1 border border-gray-700",onWheel:b=>b.stopPropagation(),children:y&&y.length>0?y.map((b,S)=>o.jsxs("div",{className:"bg-gray-800 p-1.5 rounded-md text-xs flex flex-col border border-gray-600/50",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[i&&o.jsx("div",{title:"Linked from upstream",className:"text-emerald-400 flex-shrink-0",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),o.jsx("span",{className:"font-semibold text-gray-200 truncate",title:b.name,children:b.name||"Unknown"})]}),(b.index||b.alias)&&o.jsxs("span",{className:"text-gray-400 ml-2 flex-shrink-0 font-mono text-[10px]",children:["(",b.index||b.alias,")"]})]}),b.id&&o.jsxs("div",{className:"text-[9px] text-gray-500 font-mono mt-0.5 truncate select-all",title:b.id,children:["ID: ",b.id]})]},S)):o.jsx("p",{className:"text-xs text-gray-500 text-center pt-4",children:d("node.content.noCharactersAnalyzed")})})}),o.jsx("div",{className:"w-1/2 flex flex-col min-h-0 border-l border-gray-700 pl-2",children:o.jsx("textarea",{value:a?s:l,onChange:b=>n({styleOverride:b.target.value}),placeholder:w,readOnly:a,className:"w-full flex-grow p-2 bg-gray-800 rounded-md resize-none focus:ring-1 focus:ring-emerald-500 focus:outline-none custom-scrollbar read-only:bg-gray-800/50 read-only:cursor-default read-only:text-gray-400 border border-gray-700 text-xs leading-relaxed placeholder-gray-500",onWheel:b=>b.stopPropagation(),onFocus:c,style:{scrollbarGutter:"stable"}})})]})]})},m5=bt.memo(({scene:e,t,isCollapsed:n,onToggle:r})=>{const a=e.frames&&Array.isArray(e.frames)&&e.frames.length>0;return o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent hover:border-gray-700/50 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:i=>{i.stopPropagation(),r()},children:[o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-semibold text-gray-300 text-sm truncate pr-2",children:`${t("node.content.scene")} ${e.sceneNumber}${e.title?`: ${e.title}`:""}`}),o.jsx("span",{className:"text-[9px] text-emerald-500 font-mono font-bold uppercase tracking-wider",children:a?`${e.frames.length} ${t("node.content.frame_plural")}`:e.recommendedFrames!==void 0?`${t("node.content.recommendedFrames")}: ${e.recommendedFrames}`:""})]}),o.jsx(Pe,{tooltipPosition:"left",title:t(n?"node.action.expandScene":"node.action.collapseScene"),onClick:i=>{i.stopPropagation(),r()},children:n?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!n&&o.jsx("div",{className:"mt-2 text-xs",children:a?o.jsxs("div",{className:"space-y-3",children:[e.sceneContext&&o.jsxs("div",{className:"bg-gray-900/30 p-2 rounded border border-gray-700/50",children:[o.jsx("p",{className:"text-[9px] uppercase font-bold text-emerald-500 mb-1",children:t("node.content.sceneContext")}),o.jsx("p",{className:"text-gray-300 whitespace-pre-wrap leading-relaxed",children:e.sceneContext})]}),o.jsx("div",{className:"space-y-2",children:e.frames.map((i,s)=>{const l=(i.characters||[]).map(d=>{const h=d.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return h?`ENT-${h[1]}`:d}),c=l.length>0?l.join(", "):"";return o.jsxs("div",{className:"bg-gray-900/50 p-2 rounded border border-gray-800",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1.5 border-b border-gray-800 pb-1",children:[o.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[o.jsxs("span",{className:"text-[10px] font-bold text-gray-400 whitespace-nowrap",children:[t("node.content.frame")," ",i.frameNumber," ",i.shotType?`| ${i.shotType}`:""]}),c&&o.jsx("span",{className:"text-[9px] text-cyan-500 font-mono truncate",title:c,children:c})]}),i.duration&&o.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap ml-1",children:[i.duration,"s"]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[9px] text-emerald-600 uppercase font-semibold",children:t("node.content.compositionAndBlocking")}),o.jsx("p",{className:"text-[10px] text-gray-400 italic leading-snug",children:i.imagePrompt})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[9px] text-cyan-600 uppercase font-semibold",children:t("node.content.environmentPrompt")}),o.jsx("p",{className:"text-[10px] text-gray-400 italic leading-snug",children:i.environmentPrompt})]}),i.videoPrompt&&o.jsxs("div",{children:[o.jsx("p",{className:"text-[9px] text-purple-500 uppercase font-semibold",children:t("node.content.videoPrompt")}),o.jsx("p",{className:"text-[10px] text-gray-400 italic leading-snug",children:i.videoPrompt})]})]})]},s)})})]}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-gray-400 whitespace-pre-wrap select-text",children:e.description}),e.narratorText&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700/50",children:[o.jsx("p",{className:"font-semibold text-emerald-400 mb-1",children:t("node.content.narrator")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-emerald-500",children:e.narratorText})]})]})})]})}),g5=({verticalDividerPos:e,isProcessWholeScene:t,upstreamAnalyzerData:n,collapsedInputScenes:r,collapsedInputFrames:a,collapsedInputContexts:i,onToggleInputSceneCollapse:s,onToggleInputFrameCollapse:l,onToggleInputContextCollapse:c,onToggleAllInputScenes:d,onToggleAllInputFrames:h,areAllInputScenesCollapsed:g,areAllInputFramesCollapsed:m,t:w})=>o.jsxs("div",{className:"overflow-y-scroll overflow-x-hidden custom-scrollbar pr-1 space-y-2 px-1",style:{width:`calc(${e}% - 0.5rem)`,contentVisibility:"auto"},onWheel:y=>y.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pr-2 sticky top-0 bg-gray-900 z-10 pt-1 pb-1 border-b border-gray-800/50 mb-2 -mx-1 px-2",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-1",children:w("node.content.inputFrames")}),(n==null?void 0:n.scenes)&&n.scenes.length>0&&o.jsx(Pe,{tooltipPosition:"left",title:w(g?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:d,children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),(n==null?void 0:n.summary)&&o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent mb-2",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm mb-1",children:w("node.content.summary")}),o.jsx("div",{className:"text-xs text-gray-400 whitespace-pre-wrap select-text",children:n.summary})]}),n!=null&&n.scenes&&n.scenes.length>0?n.scenes.map((y,b)=>o.jsx(m5,{scene:y,t:w,isCollapsed:r.has(b),onToggle:()=>s(b)},b)):o.jsx("div",{className:"text-center text-xs text-gray-500 p-4",children:w("node.content.noInputScenes")})]});bt.memo(({frame:e,characters:t,t:n,isCollapsed:r,onToggle:a})=>{const i=(e.characters||[]).map(d=>{const h=d.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return h?`ENT-${h[1]}`:d}),s=i.length>0?i.join(", "):"NONE",l=e.shotType?` | ${e.shotType}`:"",c=`Frame-${e.frameNumber}${l}  ${s}`;return o.jsxs("div",{className:"bg-gray-800 rounded-lg p-2 border border-gray-700",children:[o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex justify-between items-center cursor-pointer select-none",onClick:d=>{d.stopPropagation(),a()},children:[o.jsx("span",{className:"truncate pr-2",children:c}),o.jsx(Pe,{tooltipPosition:"left",title:n(r?"node.action.expandFrame":"node.action.collapseFrame"),onClick:d=>{d.stopPropagation(),a()},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!r&&o.jsxs("div",{className:"mt-1 text-xs space-y-2",children:[o.jsxs("div",{className:"pt-1",children:[o.jsx("p",{className:"font-semibold text-emerald-400 mb-0.5",children:n("node.content.compositionAndBlocking")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-emerald-500",children:e.imagePrompt})]}),o.jsxs("div",{className:"pt-1 border-t border-gray-700/50",children:[o.jsx("p",{className:"font-semibold text-cyan-400 mb-0.5",children:n("node.content.environmentPrompt")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-cyan-500",children:e.environmentPrompt})]})]})]})});const f5=bt.memo(({promptId:e,title:t,imagePrompt:n,videoPrompt:r,isCollapsed:a,t:i,onToggleCollapse:s,onCopy:l,onDelete:c})=>o.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 space-y-0",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer hover:bg-gray-700/50 transition-colors rounded-t-lg",onDoubleClick:()=>s(e),onClick:()=>s(e),children:[o.jsxs("div",{className:"flex items-center space-x-2 flex-grow min-w-0",children:[o.jsx(Pe,{tooltipPosition:"right",title:i(a?"node.action.expand":"node.action.collapse"),onClick:d=>{d.stopPropagation(),s(e)},children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("h4",{className:"font-bold text-white truncate pr-2 text-sm",title:t,children:t})]}),o.jsx("div",{className:"flex items-center space-x-1",children:o.jsx(Pe,{tooltipPosition:"left",title:i("node.action.deleteItem"),onClick:d=>{d.stopPropagation(),c()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),!a&&o.jsxs("div",{className:"p-2 space-y-3 border-t border-gray-700",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-emerald-400 uppercase tracking-wider",children:i("node.content.imagePrompt")}),o.jsx(Pe,{tooltipPosition:"left",title:i("node.action.copy"),onClick:d=>{d.stopPropagation(),l(n)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{className:"w-full p-2 bg-gray-900 border border-gray-700 rounded-md resize-none focus:outline-none custom-scrollbar text-xs text-gray-300 h-[120px]",value:n,readOnly:!0})]}),r&&o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-emerald-400 uppercase tracking-wider",children:i("node.content.videoPrompt")}),o.jsx(Pe,{tooltipPosition:"left",title:i("node.action.copy"),onClick:d=>{d.stopPropagation(),l(r)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{className:"w-full p-2 bg-gray-900 border border-gray-700 rounded-md resize-none focus:outline-none custom-scrollbar text-xs text-gray-300 h-[60px]",value:r,readOnly:!0})]})]})]})),y5=({verticalDividerPos:e,groupedPrompts:t,collapsedOutputScenes:n,collapsedPrompts:r,areAllOutputScenesCollapsed:a,areAllOutputPromptsCollapsed:i,sceneContexts:s,onToggleOutputSceneCollapse:l,onTogglePromptCollapse:c,onToggleAllOutputScenes:d,onToggleAllOutputPrompts:h,onDeletePrompt:g,onDeleteScenePrompts:m,onDownloadJson:w,onCopy:y,onUpdateSceneContext:b,t:S,deselectAllNodes:_})=>o.jsxs("div",{className:"overflow-y-scroll custom-scrollbar pl-1 space-y-2",style:{width:`calc(${100-e}% - 0.5rem)`,contentVisibility:"auto"},onWheel:v=>v.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pl-2 sticky top-0 bg-gray-900 z-10 pt-1 pb-1 border-b border-gray-800/50",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-2",children:S("node.content.finalPrompt_plural")}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{tooltipPosition:"left",title:S("node.action.downloadJson"),onClick:w,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),t.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(Pe,{tooltipPosition:"left",title:S(a?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:d,children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),o.jsx(Pe,{tooltipPosition:"left",title:S(i?"node.action.expandAllFrames":"node.action.collapseAllFrames"),onClick:h,disabled:a,children:i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})})]})]})]}),t.length>0?t.map(v=>{const f=n.has(v.sceneNum),T=s[v.sceneNum]||"";return o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"px-2 py-1 mb-1 text-xs font-bold text-gray-400 uppercase border-b border-gray-700 flex justify-between items-center group cursor-pointer hover:bg-gray-800/50 transition-colors rounded",onClick:()=>l(v.sceneNum),children:[o.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden flex-1 min-w-0",children:[o.jsx(Pe,{tooltipPosition:"right",title:S(f?"node.action.expandScene":"node.action.collapseScene"),onClick:A=>{A.stopPropagation(),l(v.sceneNum)},children:f?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx("span",{className:"truncate",children:`${S("node.content.scene")} ${v.sceneNum}${v.title?`: ${v.title}`:""}`})]}),o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:[o.jsxs("span",{className:"text-[9px] bg-gray-700 px-1.5 py-0.5 rounded text-gray-400 font-mono",children:[v.prompts.length," ",S("node.content.frame_plural")]}),o.jsx(Pe,{tooltipPosition:"left",title:S("node.action.deleteItem"),onClick:A=>{A.stopPropagation(),m(Number(v.sceneNum))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!f&&o.jsxs("div",{className:"pl-2 space-y-2",children:[o.jsxs("div",{className:"bg-gray-800/80 border border-emerald-500/30 rounded-md p-2 mb-2 shadow-inner",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-wider",children:"MASTER ENVIRONMENT PROMPT"})]}),o.jsx(Pe,{tooltipPosition:"left",title:S("node.action.copy"),onClick:A=>{A.stopPropagation(),y(T)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:T,onChange:A=>b(v.sceneNum,A.target.value),className:"w-full text-xs p-2 bg-gray-900 border border-gray-700 rounded resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar text-gray-300 placeholder-gray-600",placeholder:"Detailed master scene description (Furniture, Lighting, Textures)...",onFocus:_,onMouseDown:A=>A.stopPropagation()})]}),v.prompts.map((A,I)=>{const M=A.final||A.video,N=`${M.sceneNumber}-${M.frameNumber}`,k=(M.characters||[]).map(H=>{const $=H.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return $?`ENT-${$[1]}`:H}),E=k.length>0?k.join(", "):"",P=M.shotType?` [${M.shotType}]`:"",L=`Frame-${M.frameNumber}${P} ${E}`;return o.jsx(f5,{promptId:N,title:L,imagePrompt:A.final?A.final.prompt:"No Image Prompt Generated",videoPrompt:A.video?A.video.videoPrompt:"No Video Prompt Generated",isCollapsed:r.has(N),t:S,onToggleCollapse:c,onCopy:y,onDelete:()=>g(Number(v.sceneNum),M.frameNumber)},N)})]})]},v.sceneNum)}):o.jsx("div",{className:"text-center text-xs text-gray-500 p-4",children:S("node.content.promptsGeneratedPlaceholder")})]}),x5=({node:e,onValueChange:t,onModifyScriptPrompts:n,isModifyingScriptPrompts:r,onExecuteFullChain:a,isExecutingChain:i,onStopGeneration:s,isStopping:l,t:c,getUpstreamTextValue:d,connections:h,connectedInputs:g,onApplyAliases:m,addToast:w,saveDataToCatalog:y,deselectAllNodes:b,inputData:S})=>{const{language:_}=Bt(),{setConfirmInfo:v,viewTransform:f}=Qo(),T=r===e.id,[A,I]=x.useState(!1),[M,N]=x.useState(50),k=bt.useRef(null),[E,P]=x.useState(null),[L,H]=x.useState(""),[$,U]=x.useState(new Set),[O,D]=x.useState(new Set),[z,G]=x.useState(new Set),[F,K]=x.useState(new Set),[ae,Y]=x.useState(new Set),[ge,W]=x.useState({current:0,total:0,last:0}),[le,X]=x.useState(null),[Te,pe]=x.useState(360),ue=g==null?void 0:g.has("style"),Oe=!!h.find(de=>de.toNodeId===e.id&&(de.toHandleId==="all-script-analyzer-data"||!de.toHandleId)),he=_==="en"?"ru":_,ye=x.useMemo(()=>{try{const de=JSON.parse(e.value||"{}");let ke=Array.isArray(de.disabledInstructionIds)?[...de.disabledInstructionIds]:[];Array.isArray(de.disabledInstructionIds)||(de.processWholeScene===!1&&ke.push(te.PROCESS_WHOLE_SCENE.id),de.generateVideoPrompt===!1&&ke.push(te.GENERATE_VIDEO_PROMPT.id),de.breakIntoParagraphs===!1&&ke.push(te.BREAK_PARAGRAPHS.id),(!de.finalPrompts||de.finalPrompts.length===0)&&(ke.includes(te.BREAK_PARAGRAPHS.id)||ke.push(te.BREAK_PARAGRAPHS.id)),ke=[...new Set(ke)]);let Ne=de.charDescMode;return Ne||(de.includeFullCharDesc?Ne="full":de.includeGeneralCharDesc===!1?Ne="none":Ne="general"),{finalPrompts:Array.isArray(de.finalPrompts)?de.finalPrompts.sort((Qe,ct)=>Qe.frameNumber-ct.frameNumber):[],videoPrompts:Array.isArray(de.videoPrompts)?de.videoPrompts.sort((Qe,ct)=>Qe.frameNumber-ct.frameNumber):[],sceneContexts:de.sceneContexts||{},usedCharacters:Array.isArray(de.usedCharacters)?de.usedCharacters:[],targetLanguage:de.targetLanguage||_,startFrameNumber:de.startFrameNumber||null,endFrameNumber:de.endFrameNumber||null,startSceneNumber:de.startSceneNumber||null,endSceneNumber:de.endSceneNumber||null,generationProgress:de.generationProgress||null,styleOverride:de.styleOverride||"",characterPaneHeight:de.characterPaneHeight||160,model:de.model||"gemini-3-flash-preview",disabledInstructionIds:ke,charDescMode:Ne||"general",safeGeneration:!!de.safeGeneration,thinkingEnabled:!!de.thinkingEnabled,propEnhancementEnabled:de.propEnhancementEnabled!==!1,uiState:de.uiState||{isSettingsCollapsed:!0,isCharStyleCollapsed:!1},settingsPaneHeight:de.settingsPaneHeight||360}}catch{return{finalPrompts:[],videoPrompts:[],sceneContexts:{},usedCharacters:[],targetLanguage:_,startFrameNumber:null,endFrameNumber:null,startSceneNumber:null,endSceneNumber:null,generationProgress:null,styleOverride:"",characterPaneHeight:160,model:"gemini-3-flash-preview",disabledInstructionIds:[te.BREAK_PARAGRAPHS.id,te.ANTHRO_REINFORCEMENT.id,te.SUBSCRIBE_REINFORCEMENT.id,te.VISUAL_SATURATION.id],charDescMode:"general",safeGeneration:!1,thinkingEnabled:!1,propEnhancementEnabled:!0,uiState:{isSettingsCollapsed:!0,isCharStyleCollapsed:!1},settingsPaneHeight:360}}},[e.value,_]),{finalPrompts:j,videoPrompts:q,sceneContexts:Q,usedCharacters:J,targetLanguage:oe,startFrameNumber:B,endFrameNumber:fe,startSceneNumber:ie,endSceneNumber:Z,generationProgress:ee,styleOverride:R,characterPaneHeight:be,model:Le,disabledInstructionIds:je,charDescMode:Ue,safeGeneration:Fe,thinkingEnabled:ot,propEnhancementEnabled:at,uiState:rt,settingsPaneHeight:Ce}=ye;x.useEffect(()=>{let de;return ee?ee.endTime?W({current:0,total:Math.floor((ee.endTime-ee.totalStartTime)/1e3),last:ee.lastItemDuration||0}):T&&(de=window.setInterval(()=>{const ke=Date.now();W({current:Math.floor((ke-(ee.currentItemStartTime||ke))/1e3),total:Math.floor((ke-(ee.totalStartTime||ke))/1e3),last:ee.lastItemDuration||0})},100)):W({current:0,total:0,last:0}),()=>clearInterval(de)},[T,ee]),x.useEffect(()=>{Math.abs((Ce||360)-Te)>1&&pe(Ce||360)},[Ce]);const ve=!je.includes(te.PROCESS_WHOLE_SCENE.id),Ge=!je.includes(te.VISUAL_SATURATION.id),ce=x.useCallback(de=>{const ke={...ye,...de};t(e.id,JSON.stringify(ke))},[e.id,t,ye]),He=x.useCallback(de=>{ce({uiState:{...rt,...de}})},[ce,rt]),V=x.useCallback(de=>{navigator.clipboard.writeText(de),w(c("toast.copied"),"success")},[w,c]),re=x.useCallback((de,ke)=>{const Ne=j.filter(ct=>!(ct.sceneNumber===de&&ct.frameNumber===ke)),Qe=q.filter(ct=>!(ct.sceneNumber===de&&ct.frameNumber===ke));ce({finalPrompts:Ne,videoPrompts:Qe})},[j,q,ce]),ze=x.useCallback(de=>{const ke=j.filter(Qe=>Qe.sceneNumber!==de),Ne=q.filter(Qe=>Qe.sceneNumber!==de);ce({finalPrompts:ke,videoPrompts:Ne})},[j,q,ce]),ne=x.useCallback(async()=>{I(!0),await new Promise(Ne=>setTimeout(Ne,50));let de=null,ke="";try{if(!d||!h)return P(null),H(""),{analyzerData:null,styleVal:""};const Ne=h.find(ct=>ct.toNodeId===e.id&&(ct.toHandleId==="all-script-analyzer-data"||!ct.toHandleId));if(Ne){const ct=d(Ne.fromNodeId,Ne.fromHandleId);if(ct)try{const Gt=JSON.parse(ct),cn=[...Array.isArray(Gt.detailedCharacters)?Gt.detailedCharacters:Array.isArray(Gt.characters)?Gt.characters:[]].sort((Vn,xn)=>{const vn=Nr=>{const er=(Nr||"").match(/(\d+)/);return er?parseInt(er[1],10):99999},io=Vn.index||Vn.alias||"",Do=xn.index||xn.alias||"";return vn(io)-vn(Do)});de={scenes:Array.isArray(Gt.scenes)?Gt.scenes:[],characters:cn,visualStyle:Gt.visualStyle||Gt.generatedStyle||"",generatedStyle:Gt.generatedStyle,detailedCharacters:Gt.detailedCharacters}}catch{}}if(P(de),de!=null&&de.scenes){const ct=new Set,Gt=new Set,Vt=new Set,cn={...Q};let Vn=!1;de.scenes.forEach((xn,vn)=>{const io=xn.sceneNumber||vn+1;Gt.add(vn),Vt.add(vn),(xn.frames||[]).forEach(Do=>ct.add(`${vn}-${Do.frameNumber}`)),xn.sceneContext&&cn[io]!==xn.sceneContext&&(cn[io]=xn.sceneContext,Vn=!0)}),D(ct),K(Gt),Y(Vt),Vn&&ce({sceneContexts:cn})}const Qe=h.find(ct=>ct.toNodeId===e.id&&ct.toHandleId==="style");Qe&&(ke=d(Qe.fromNodeId,Qe.fromHandleId)),H(ke)}finally{I(!1)}return{analyzerData:de,styleVal:ke}},[h,d,e.id,Q,ce]);x.useEffect(()=>{ne()},[h,e.id,ne,S]),x.useEffect(()=>{const de=(E==null?void 0:E.generatedStyle)||(E==null?void 0:E.visualStyle)||"";de&&!R&&!ue&&ce({styleOverride:de})},[E,R,ue,ce]),x.useEffect(()=>{if(E!=null&&E.characters){const de=E.characters.map(ke=>({name:ke.name,index:ke.index||ke.alias}));JSON.stringify(de)!==JSON.stringify(J)&&ce({usedCharacters:de})}else Oe||J.length>0&&ce({usedCharacters:[]})},[E,J,ce,Oe]);const xe=x.useRef(r);x.useEffect(()=>{if(xe.current&&!r){const de=new Set;j.forEach(ke=>de.add(`${ke.sceneNumber}-${ke.frameNumber}`)),q.forEach(ke=>de.add(`${ke.sceneNumber}-${ke.frameNumber}`)),U(de)}xe.current=r},[r,j,q]);const _e=async()=>{await ne(),n(e.id)},Ie=()=>{a&&v({title:c("dialog.executeChain.title"),message:c("dialog.executeChain.message"),onConfirm:()=>a(e.id)})},me=de=>{de.preventDefault();const ke=de.clientX,Ne=M,Qe=de.target.parentElement;if(!Qe)return;const ct=Qe.offsetWidth,Gt=f.scale,Vt=Vn=>{const xn=(Vn.clientX-ke)/Gt,vn=Ne+xn/ct*100;N(Math.max(20,Math.min(80,vn)))},cn=()=>{window.removeEventListener("mousemove",Vt),window.removeEventListener("mouseup",cn)};window.addEventListener("mousemove",Vt),window.addEventListener("mouseup",cn)},Ee=x.useMemo(()=>{const de={},ke={};return E!=null&&E.scenes&&E.scenes.forEach(Ne=>{const Qe=Ne.sceneNumber.toString();de[Qe]=[],ke[Qe]=Ne.title||`Scene ${Ne.sceneNumber}`}),j.forEach(Ne=>{const Qe=Ne.sceneNumber!==void 0?Ne.sceneNumber:0,ct=Qe.toString();de[ct]||(de[ct]=[]),Ne.sceneTitle&&(ke[ct]=Ne.sceneTitle);const Gt=q.find(Vt=>Vt.frameNumber===Ne.frameNumber&&Vt.sceneNumber===Qe);de[ct].push({final:Ne,video:Gt})}),Object.entries(de).sort((Ne,Qe)=>Number(Ne[0])-Number(Qe[0])).map(([Ne,Qe])=>({sceneNum:Ne,title:ke[Ne],prompts:Qe}))},[j,q,E]),Ae=de=>{G(ke=>{const Ne=new Set(ke);return Ne.has(de)?Ne.delete(de):Ne.add(de),Ne})},Ke=de=>{K(ke=>{const Ne=new Set(ke);return Ne.has(de)?Ne.delete(de):Ne.add(de),Ne})},mt=de=>{D(ke=>{const Ne=new Set(ke);return Ne.has(de)?Ne.delete(de):Ne.add(de),Ne})},Nt=de=>{Y(ke=>{const Ne=new Set(ke);return Ne.has(de)?Ne.delete(de):Ne.add(de),Ne})},It=de=>{U(ke=>{const Ne=new Set(ke);return Ne.has(de)?Ne.delete(de):Ne.add(de),Ne})},kt=x.useMemo(()=>!(E!=null&&E.scenes)||E.scenes.length===0?!1:E.scenes.every((de,ke)=>F.has(ke)),[E,F]),xt=x.useCallback(()=>{if(E!=null&&E.scenes)if(kt)K(new Set),D(new Set),Y(new Set);else{const de=new Set,ke=new Set;E.scenes.forEach((Ne,Qe)=>{de.add(Qe),(Ne.frames||[]).forEach(ct=>ke.add(`${Qe}-${ct.frameNumber}`))}),K(de),D(ke),Y(de)}},[E,kt]),Dt=x.useMemo(()=>Ee.length===0?!1:Ee.every(de=>z.has(de.sceneNum)),[Ee,z]),Mt=x.useCallback(()=>{if(Ee.length!==0)if(Dt)G(new Set),U(new Set);else{const de=new Set,ke=new Set;Ee.forEach(Ne=>{de.add(Ne.sceneNum),Ne.prompts.forEach(Qe=>{const ct=Qe.final||Qe.video;ke.add(`${ct.sceneNumber}-${ct.frameNumber}`)})}),G(de),U(ke)}},[Ee,Dt]),hn=x.useMemo(()=>{if(!(E!=null&&E.scenes))return!1;const de=[];return E.scenes.forEach((ke,Ne)=>{(ke.frames||[]).forEach(Qe=>de.push(`${Ne}-${Qe.frameNumber}`))}),de.length===0?!1:de.every(ke=>O.has(ke))},[E,O]),an=x.useCallback(()=>{if(!(E!=null&&E.scenes))return;const de=new Set,ke=new Set;E.scenes.forEach((Ne,Qe)=>{ke.add(Qe),(Ne.frames||[]).forEach(ct=>de.add(`${Qe}-${ct.frameNumber}`))}),hn?(D(new Set),Y(new Set)):(D(de),Y(ke))},[E,hn]),we=x.useMemo(()=>{if(Ee.length===0)return!1;const de=[];return Ee.forEach(ke=>{ke.prompts.forEach(Ne=>{const Qe=Ne.final||Ne.video;de.push(`${Qe.sceneNumber}-${Qe.frameNumber}`)})}),de.length===0?!1:de.every(ke=>$.has(ke))},[Ee,$]),Ve=x.useCallback(()=>{if(Ee.length===0)return;const de=new Set;Ee.forEach(ke=>{ke.prompts.forEach(Ne=>{const Qe=Ne.final||Ne.video;de.add(`${Qe.sceneNumber}-${Qe.frameNumber}`)})}),U(we?new Set:de)},[Ee,we]),qe=()=>{const de=(E==null?void 0:E.generatedStyle)||(E==null?void 0:E.visualStyle)||"",Ne={type:"script-prompt-modifier-data",finalPrompts:j,videoPrompts:q,sceneContexts:Q,usedCharacters:J,visualStyle:R||de||"",title:e.title},Qe=JSON.stringify(Ne,null,2),ct=new Blob([Qe],{type:"application/json"}),Gt=URL.createObjectURL(ct),Vt=document.createElement("a"),cn=new Date,xn=`final_prompts_${`${cn.getFullYear()}-${String(cn.getMonth()+1).padStart(2,"0")}-${String(cn.getDate()).padStart(2,"0")}_${String(cn.getHours()).padStart(2,"0")}-${String(cn.getMinutes()).padStart(2,"0")}`}.json`;Vt.href=Gt,Vt.download=xn,Vt.click(),URL.revokeObjectURL(Gt),w(c("toast.savedToCatalog"),"success")},it=de=>{const ke=Math.max(1,de);if(ve){const Ne={startSceneNumber:ke};Z!==null&&ke>Z&&(Ne.endSceneNumber=ke),ce(Ne)}else{const Ne={startFrameNumber:ke};fe!==null&&ke>fe&&(Ne.endFrameNumber=ke),ce(Ne)}},lt=de=>{if(!de&&de!==0){ce(ve?{endSceneNumber:null}:{endFrameNumber:null});return}const ke=Math.max(1,de);if(ve){const Ne={endSceneNumber:ke};ke<(ie||1)&&(Ne.startSceneNumber=ke),ce(Ne)}else{const Ne={endFrameNumber:ke};ke<(B||1)&&(Ne.startFrameNumber=ke),ce(Ne)}},Lt=()=>ce({startSceneNumber:null,endSceneNumber:null,startFrameNumber:null,endFrameNumber:null}),Nn=()=>{const ke=Math.ceil(((ve?ie:B)||1)/5)*5+1,Ne=ke+4;ce(ve?{startSceneNumber:ke,endSceneNumber:Ne}:{startFrameNumber:ke,endFrameNumber:Ne})},Ot=()=>{const ke=Math.max(1,Math.floor((((ve?ie:B)||1)-1)/5)*5-4),Ne=ke+4;ce(ve?{startSceneNumber:ke,endSceneNumber:Ne}:{startFrameNumber:ke,endFrameNumber:Ne})},se=de=>{const ke=te.PROCESS_WHOLE_SCENE.id;let Ne;de?Ne=je.filter(Qe=>Qe!==ke):Ne=[...je,ke],ce({disabledInstructionIds:Ne})},De=de=>{const ke=te.VISUAL_SATURATION.id;let Ne;de?Ne=je.filter(Qe=>Qe!==ke):Ne=[...je,ke],ce({disabledInstructionIds:Ne})},Re=()=>{t(e.id,JSON.stringify({...ye,propEnhancementEnabled:!at}))},Je=(de,ke)=>{const Ne={...Q,[de]:ke};ce({sceneContexts:Ne})},st=x.useMemo(()=>E!=null&&E.scenes?E.scenes.reduce((de,ke)=>{var Ne;return de+(((Ne=ke.frames)==null?void 0:Ne.length)||0)},0):0,[E]),nt=x.useMemo(()=>{const de=ve?ie:B,ke=ve?Z:fe,Ne=c(ve?"node.content.scenes":"node.content.frame");return de||ke?`${Ne}: ${de||1}-${ke||"End"}`:""},[ve,ie,Z,B,fe,c]);x.useMemo(()=>{const de={},{characters:ke=[]}=E||{};return ke.forEach(Ne=>{const Qe=Ne.imagePrompt||Ne.prompt||Ne.fullDescription||"";Ne.alias&&(de[Ne.alias]=`${Ne.name} [Visual Profile: ${Qe}]`),Ne.name&&(de[Ne.name]=`${Ne.name} [Visual Profile: ${Qe}]`)}),de},[E]);const St=(E==null?void 0:E.characters)||J,Ft=(E==null?void 0:E.visualStyle)||(E==null?void 0:E.generatedStyle)||"",zt=({id:de})=>o.jsx("button",{onClick:ke=>{ke.stopPropagation(),X(de)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",title:"Locate in Stack",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})});return o.jsxs("div",{ref:k,className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex flex-col gap-2 mb-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsxs("div",{className:"flex w-40 flex-shrink-0 gap-1 select-none bg-gray-900/50 rounded-lg p-0.5 h-10",children:[o.jsx(ht,{title:c("tooltip.model.flash"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>ce({model:"gemini-3-flash-preview"}),className:`w-full h-full text-xs font-bold text-center transition-colors rounded-md flex items-center justify-center ${Le==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),"Flash"]})}),o.jsx(ht,{title:c("tooltip.model.pro"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>ce({model:"gemini-3-pro-preview"}),className:`w-full h-full text-xs font-bold text-center transition-colors rounded-md flex items-center justify-center ${Le==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),"Pro"]})})]}),o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5",children:[o.jsx(ht,{title:c("tooltip.lang.ru"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>ce({targetLanguage:he}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${oe===he?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:he.toUpperCase()})}),o.jsx(ht,{title:c("tooltip.lang.en"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>ce({targetLanguage:"en"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${oe==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"EN"})})]}),o.jsxs("button",{onClick:T?s:_e,disabled:l||i,className:`flex-grow h-10 px-4 font-bold text-xs uppercase tracking-wide text-white rounded-lg transition-all duration-200 shadow-sm flex items-center justify-center ${l?"bg-yellow-600 hover:bg-yellow-500":T?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:[!T&&!l&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),T&&o.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),c(l?"node.action.stopping":T?"node.content.analyzing":"node.content.generateFinalPrompts")]}),a&&o.jsx("button",{onClick:i?s:Ie,disabled:T||l,className:`flex-shrink-0 w-10 h-10 p-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center ${l&&i?"bg-yellow-600":i?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-500"}`,title:c("node.action.executeChainTitle"),children:l&&i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 animate-pulse",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("rect",{x:"6",y:"6",width:"8",height:"8"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]}),o.jsxs("div",{className:"bg-gray-900/50 rounded-md flex-shrink-0 flex flex-col",children:[o.jsxs("div",{className:"p-2 border-b border-gray-800 flex items-center justify-start gap-4",children:[o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[o.jsx("label",{htmlFor:`start-range-${e.id}`,className:"whitespace-nowrap",children:c(ve?"node.content.processFromScene":"node.content.processFromFrame")}),o.jsxs("div",{className:"relative w-14 h-7",children:[o.jsx("input",{id:`start-range-${e.id}`,type:"number",min:"1",placeholder:"1",value:(ve?ie:B)||"",onChange:de=>it(de.target.value?parseInt(de.target.value,10):0),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:de=>de.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>it(((ve?ie:B)||0)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>it(Math.max(1,((ve?ie:B)||0)-1)),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),o.jsx("label",{htmlFor:`end-range-${e.id}`,className:"whitespace-nowrap",children:c(ve?"node.content.analyzeUpToScene":"node.content.generateUpToFrame")}),o.jsxs("div",{className:"relative w-16 h-7",children:[o.jsx("input",{id:`end-range-${e.id}`,type:"number",min:"1",placeholder:c("node.content.endPlaceholder"),value:(ve?Z:fe)||"",onChange:de=>lt(de.target.value?parseInt(de.target.value,10):0),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:de=>de.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>lt(((ve?Z:fe)||0)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>lt(Math.max(1,((ve?Z:fe)||0)-1)),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:Ot,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"-5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),o.jsx("button",{onClick:Nn,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"+5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})}),o.jsx("button",{onClick:Lt,className:"p-1 text-gray-400 hover:text-red-400 bg-gray-800 rounded hover:bg-gray-700 ml-1",title:"Clear Range",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsxs("div",{className:"px-2 pb-2 flex items-center gap-4 border-b border-gray-800",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ct,{id:`process-whole-scene-${e.id}`,checked:ve,onChange:se,disabled:T,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`process-whole-scene-${e.id}`,className:"text-xs text-gray-400 cursor-pointer select-none font-medium hover:text-emerald-400 transition-colors",title:c("node.content.processWholeSceneInfo"),children:c("node.content.processWholeScene")}),o.jsx(zt,{id:te.PROCESS_WHOLE_SCENE.id})]}),o.jsxs("div",{className:"flex items-center ml-2 border-l border-gray-700 pl-2 gap-2",children:[o.jsx(Ct,{id:`generate-style-${e.id}`,checked:!je.includes(te.VISUAL_SATURATION.id),onChange:De,disabled:T,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`generate-style-${e.id}`,className:"text-xs text-gray-400 cursor-pointer select-none font-medium hover:text-emerald-400 transition-colors",children:c("node.content.generateStyle")}),o.jsx(zt,{id:te.VISUAL_SATURATION.id})]})]}),o.jsxs("div",{className:"p-2 flex items-center justify-between text-xs",children:[o.jsx("div",{className:"font-semibold text-emerald-400",children:c("node.content.status.total",{generated:j.length,total:st})}),o.jsxs("div",{className:"flex items-center gap-4 text-gray-400",children:[nt&&o.jsx("div",{className:"text-gray-500 font-medium",children:nt}),ee&&o.jsxs(o.Fragment,{children:[T?o.jsx("div",{className:"text-yellow-400 animate-pulse font-mono",children:c("node.content.status.batch",{current:ee.current,total:ee.total})}):null,o.jsxs("div",{className:"text-gray-400 font-mono text-[10px]",children:[" (): (: ",ge.last,") / : ",ge.current," / : ",ge.total]})]})]})]}),T&&ee&&o.jsx("div",{className:"w-full h-1 bg-gray-800 rounded-b-md overflow-hidden border-t border-gray-800",children:o.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out",style:{width:`${ee.current/Math.max(1,ee.total)*100}%`}})})]}),o.jsx(p5,{uiState:rt,localSettingsHeight:Te,setLocalSettingsHeight:pe,onUpdateUiState:He,onUpdateValue:ce,disabledInstructionIds:je,t:c,targetLanguage:oe,scale:f.scale,maxHeight:e.height-256,charDescMode:Ue,safeGeneration:Fe,thinkingEnabled:ot,model:Le,targetScrollId:le,onSetTargetScrollId:X,isProcessWholeScene:ve,onToggleProcessWholeScene:se,isSaturationEnabled:Ge,onToggleSaturation:De,propEnhancementEnabled:at,onTogglePropEnhancement:Re})]}),o.jsx(h5,{uiState:rt,onUpdateUiState:He,onUpdateValue:ce,upstreamAnalyzerData:E,isStyleConnected:!!ue,isDataConnected:Oe,upstreamStyleValue:ue?L:Ft,styleOverride:R,deselectAllNodes:b,t:c,characters:St,onRefresh:ne}),o.jsxs("div",{className:"flex-grow flex flex-row min-h-0 items-stretch bg-gray-900 rounded-b-md overflow-hidden border-t border-gray-600",children:[o.jsx(g5,{verticalDividerPos:M,isProcessWholeScene:ve,upstreamAnalyzerData:E,collapsedInputScenes:F,collapsedInputFrames:O,collapsedInputContexts:ae,onToggleInputSceneCollapse:Ke,onToggleInputFrameCollapse:mt,onToggleInputContextCollapse:Nt,onToggleAllInputScenes:xt,onToggleAllInputFrames:an,areAllInputScenesCollapsed:kt,areAllInputFramesCollapsed:hn,t:c}),o.jsx("div",{onMouseDown:me,className:"w-2 mx-1 cursor-col-resize bg-gray-600 hover:bg-emerald-500 transition-colors flex-shrink-0 rounded-full"}),o.jsx(y5,{verticalDividerPos:M,groupedPrompts:Ee,collapsedOutputScenes:z,collapsedPrompts:$,areAllOutputScenesCollapsed:Dt,areAllOutputPromptsCollapsed:we,sceneContexts:Q,onToggleOutputSceneCollapse:Ae,onTogglePromptCollapse:It,onToggleAllOutputScenes:Mt,onToggleAllOutputPrompts:Ve,onDeletePrompt:re,onDeleteScenePrompts:ze,onDownloadJson:qe,onCopy:V,onUpdateSceneContext:Je,t:c,deselectAllNodes:b})]})]})},v5=({libraryItems:e,onPromptInsert:t})=>{const{t:n}=Bt(),[r,a]=x.useState(!1),[i,s]=x.useState(!1),[l,c]=x.useState(!1),[d,h]=x.useState(null),g=x.useRef(null),m=x.useMemo(()=>d?e.find(S=>S.id===d):null,[d,e]),w=x.useMemo(()=>e.filter(S=>S.parentId===d).sort((S,_)=>S.type===_.type?S.name.localeCompare(_.name):S.type===Yt.FOLDER?-1:1),[e,d]);x.useEffect(()=>{if(r)s(!0),requestAnimationFrame(()=>c(!0));else{c(!1);const S=setTimeout(()=>s(!1),200);return()=>clearTimeout(S)}},[r]),x.useEffect(()=>{if(!r)return;const S=_=>{g.current&&!g.current.contains(_.target)&&(a(!1),h(null))};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[r]);const y=S=>{S.type===Yt.FOLDER?h(S.id):(t(S.content||""),a(!1),h(null))},b=()=>{h(m?m.parentId:null)};return o.jsxs("div",{ref:g,className:"relative mb-1 flex-shrink-0",children:[o.jsxs("button",{onClick:()=>a(!r),className:`flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-semibold transition-colors w-full bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white border border-gray-700 ${r?"ring-1 ring-emerald-500 border-emerald-500":""}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),o.jsx("span",{children:n("catalog.tabs.library")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ml-auto transition-transform ${r?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),i&&o.jsxs("div",{className:`absolute top-full left-0 right-0 mt-1 max-h-64 overflow-y-auto bg-gray-800 rounded-md shadow-xl z-50 border border-gray-600 flex flex-col transition-[opacity,transform] duration-200 ease-out origin-top ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`,onWheel:S=>S.stopPropagation(),children:[d?o.jsxs("button",{onClick:b,className:"flex items-center px-3 py-2 text-sm font-bold text-gray-300 hover:text-white hover:bg-gray-700 border-b border-gray-700/50 sticky top-0 bg-gray-800 z-10",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),(m==null?void 0:m.name)||"Back"]}):o.jsx("div",{className:"px-3 py-2 text-xs font-bold text-gray-500 uppercase border-b border-gray-700/50 sticky top-0 bg-gray-800 z-10 cursor-default",children:n("catalog.tabs.library")}),o.jsx("div",{className:"p-1",children:w.length>0?w.map(S=>o.jsxs("button",{onClick:()=>y(S),className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white rounded-md flex items-center group",title:S.content,children:[S.type===Yt.FOLDER?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-emerald-500 group-hover:text-emerald-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-emerald-500 group-hover:text-emerald-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("span",{className:"truncate",children:S.name}),S.type===Yt.FOLDER&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-auto text-gray-500 group-hover:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},S.id)):o.jsx("div",{className:"text-center text-xs text-gray-500 py-4 italic",children:n("library.empty.title")})})]})]})},b5=({node:e,onValueChange:t,libraryItems:n,t:r,deselectAllNodes:a})=>o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx(v5,{libraryItems:n,onPromptInsert:i=>{const s=e.value?`${e.value}, ${i}`:i;t(e.id,s)}}),o.jsx("textarea",{value:e.value,onChange:i=>t(e.id,i.target.value),placeholder:r("node.content.notePlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:i=>i.stopPropagation(),onMouseDown:i=>i.stopPropagation(),onFocus:a})]}),w5=({node:e,onValueChange:t,onTranslate:n,isTranslating:r,isStopping:a,onStopGeneration:i,connectedInputs:s,t:l,deselectAllNodes:c})=>{const d=r===e.id,h=x.useMemo(()=>{try{const S=JSON.parse(e.value||"{}");return{inputText:S.inputText||"",targetLanguage:S.targetLanguage||"ru",translatedText:S.translatedText||""}}catch{return{inputText:"",targetLanguage:"ru",translatedText:""}}},[e.value]),{inputText:g,targetLanguage:m,translatedText:w}=h,y=s==null?void 0:s.has(void 0),b=S=>{const _={...h,...S};delete _.inputHeight,t(e.id,JSON.stringify(_))};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsxs("div",{className:"flex-shrink-0 flex items-end space-x-2",children:[o.jsxs("div",{className:"flex-grow",children:[o.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:l("node.content.targetLanguage")}),o.jsx("select",{id:`lang-select-${e.id}`,value:m,onChange:S=>b({targetLanguage:S.target.value}),onMouseDown:S=>S.stopPropagation(),disabled:d,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-emerald-500 focus:outline-none disabled:opacity-50 h-10",children:jl.map(S=>o.jsx("option",{value:S.code,children:S.name},S.code))})]}),o.jsx("button",{onClick:d?i:()=>n(e.id),disabled:a||!d&&!y&&!g.trim(),className:`px-4 py-2 h-10 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 ${a?"bg-yellow-600":d?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:l(a?"node.action.stopping":d?"node.action.stop":"node.content.translate")})]}),o.jsx("textarea",{value:g,onChange:S=>b({inputText:S.target.value}),placeholder:l(y?"node.content.connectedPlaceholder":"node.content.translatePlaceholder"),className:"w-full flex-1 p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 min-h-[60px] custom-scrollbar overflow-y-scroll",onWheel:S=>S.stopPropagation(),onMouseDown:S=>S.stopPropagation(),disabled:y||d,onFocus:c}),o.jsx("textarea",{readOnly:!0,value:w,placeholder:l("node.content.translatedTextPlaceholder"),className:"w-full flex-1 p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none custom-scrollbar overflow-y-scroll min-h-[60px]",onWheel:S=>S.stopPropagation(),onMouseDown:S=>S.stopPropagation(),onFocus:c})]})},_5=({node:e,onReadData:t,isReadingData:n,isStopping:r,onStopGeneration:a,t:i,deselectAllNodes:s})=>{const l=n===e.id;return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{readOnly:!0,value:e.value,placeholder:i("node.content.dataPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation(),onFocus:s}),o.jsx("button",{onClick:l?a:()=>t(e.id),disabled:r,title:i("node.action.readData"),className:`w-full mt-2 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${r?"bg-yellow-600":l?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:i(r?"node.action.stopping":l?"node.content.reading":"node.content.readData")})]})};function qu(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let a=0;a<n;a++)r[a]=t.charCodeAt(a);return r}async function ky(e,t,n,r){const a=new Int16Array(e.buffer),i=a.length/r,s=t.createBuffer(r,i,n);for(let l=0;l<r;l++){const c=s.getChannelData(l);for(let d=0;d<i;d++)c[d]=a[d*r+l]/32768}return s}const kc=(e,t,n,r,a)=>{if(!e)return;const i=(b,S,_)=>{for(let v=0;v<_.length;v++)b.setUint8(S+v,_.charCodeAt(v))},s=qu(e),l=new ArrayBuffer(44+s.length),c=new DataView(l);i(c,0,"RIFF"),c.setUint32(4,36+s.length,!0),i(c,8,"WAVE"),i(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,1,!0),c.setUint32(24,24e3,!0),c.setUint32(28,24e3*2,!0),c.setUint16(32,2,!0),c.setUint16(34,16,!0),i(c,36,"data"),c.setUint32(40,s.length,!0),new Uint8Array(l,44).set(s);let d;const h=String(t);h.startsWith("scene-")?d=`scene_${h.split("-")[1]}`:h.startsWith("simple-")?d=`generated_audio_${h.split("-")[1]}`:d=a.replace(/[^a-z0-9]/gi,"_").toLowerCase();const g=`${d}_${n}_${r}`,m=new Blob([c],{type:"audio/wav"}),w=URL.createObjectURL(m),y=document.createElement("a");y.href=w,y.download=`${g}.wav`,y.click(),URL.revokeObjectURL(w)},C5=({id:e,title:t,text:n,audioData:r,voiceName:a,intonation:i,isSelected:s,onSelect:l,onDownload:c,onPlayRequest:d,t:h})=>{var T;const[g,m]=x.useState(!1),w=x.useRef(null),y=x.useRef(null),S=((T=x.useMemo(()=>[{value:"standard",label:h("intonation.standard")},{value:"cheerful",label:h("intonation.cheerful")},{value:"angry",label:h("intonation.angry")},{value:"sad",label:h("intonation.sad")},{value:"excited",label:h("intonation.excited")},{value:"announcer",label:h("intonation.announcer")},{value:"whispering",label:h("intonation.whispering")}],[h]).find(A=>A.value===i))==null?void 0:T.label)||i,_=x.useCallback(()=>{y.current&&(y.current.onended=null,y.current.stop(),y.current.disconnect(),y.current=null),m(!1)},[]),v=x.useCallback(async()=>{if(!r)return;d(_),(!w.current||w.current.state==="closed")&&(w.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}));const A=w.current;try{const I=qu(r),M=await ky(I,A,24e3,1),N=A.createBufferSource();N.buffer=M,N.connect(A.destination),N.onended=()=>{y.current===N&&(m(!1),y.current=null)},N.start(),y.current=N,m(!0)}catch(I){console.error("Error playing audio:",I),m(!1)}},[r,d,_]),f=x.useCallback(()=>{g?_():v()},[g,_,v]);return x.useEffect(()=>()=>{_(),w.current&&w.current.state!=="closed"&&w.current.close()},[_]),o.jsxs("div",{className:"bg-gray-700/50 p-2 rounded-lg space-y-2 flex items-center space-x-2",children:[o.jsx("input",{type:"checkbox",checked:s,onChange:()=>l(e),onClick:A=>A.stopPropagation(),className:"h-4 w-4 text-emerald-600 bg-gray-800 border-gray-600 rounded focus:ring-emerald-500"}),o.jsxs("div",{className:"flex-grow min-w-0",children:[o.jsxs("p",{className:"font-semibold text-sm text-gray-200 truncate",title:t,children:[t," - ",o.jsx("span",{className:"text-emerald-400",children:a})," / ",o.jsx("span",{className:"text-cyan-400",children:S})]}),o.jsx("p",{className:"text-xs text-gray-400 line-clamp-2",title:n,children:n})]}),o.jsxs("div",{className:"flex items-center justify-center space-x-2 flex-shrink-0",children:[o.jsx("button",{onClick:f,className:"p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 transition-colors","aria-label":g?"Stop":"Play",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>c(e),className:"p-2 rounded-full bg-cyan-600 text-white hover:bg-cyan-700 transition-colors","aria-label":"Download",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})},S5=({node:e,onValueChange:t,onGenerateSpeech:n,isGeneratingSpeech:r,isStopping:a,onStopGeneration:i,t:s,onReadData:l,isReadingData:c,connectedInputs:d,addToast:h,inputData:g})=>{const m=r===e.id,w=c===e.id,[y,b]=x.useState(!1),S=x.useRef(null),_=x.useRef(null),v=x.useRef(new Map),[f,T]=x.useState(new Set),[A,I]=x.useState(new Set),M=d==null?void 0:d.has(void 0),N=x.useRef(null),k=x.useMemo(()=>{try{const B=JSON.parse(e.value||"{}");return{inputText:B.inputText||"",voice:B.voice||"Zephyr",audioFiles:Array.isArray(B.audioFiles)?B.audioFiles:[],startSceneNumber:B.startSceneNumber||null,endSceneNumber:B.endSceneNumber||null,isAutoDownloadEnabled:B.isAutoDownloadEnabled||!1,intonation:B.intonation||"standard",mode:B.mode||"simple",isMultiSpeaker:B.isMultiSpeaker||!1,speaker1Name:B.speaker1Name||"Man",speaker1Voice:B.speaker1Voice||"Zephyr",speaker2Name:B.speaker2Name||"Woman",speaker2Voice:B.speaker2Voice||"Kore"}}catch{return{inputText:"",voice:"Zephyr",audioFiles:[],startSceneNumber:null,endSceneNumber:null,isAutoDownloadEnabled:!1,intonation:"standard",mode:"simple",isMultiSpeaker:!1,speaker1Name:"Man",speaker1Voice:"Zephyr",speaker2Name:"Woman",speaker2Voice:"Kore"}}},[e.value]),{inputText:E,voice:P,audioFiles:L,startSceneNumber:H,endSceneNumber:$,isAutoDownloadEnabled:U,intonation:O,mode:D,isMultiSpeaker:z,speaker1Name:G,speaker1Voice:F,speaker2Name:K,speaker2Voice:ae}=k,Y=B=>{const fe={...k,...B};t(e.id,JSON.stringify(fe))};x.useEffect(()=>{M&&g&&l(e.id)},[g,M,l,e.id]);const ge=x.useCallback(B=>{N.current&&N.current!==B&&N.current(),N.current=B},[]),W=x.useCallback(()=>{_.current&&(_.current.onended=null,_.current.stop(),_.current.disconnect(),_.current=null),b(!1)},[]);x.useEffect(()=>(S.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),()=>{W(),S.current&&S.current.state!=="closed"&&S.current.close().catch(console.error)}),[W]);const le=x.useCallback(async B=>{if(y){W();return}b(!0);try{const fe=s("node.content.voicePreviewText");let ie=v.current.get(`${B}-${O}`);if(ie||(ie=await Gd(fe,B,O),ie&&v.current.set(`${B}-${O}`,ie)),!ie)throw new Error("Failed to generate or retrieve audio data.");(!S.current||S.current.state==="closed")&&(S.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}));const Z=S.current;Z.state==="suspended"&&await Z.resume();const ee=qu(ie),R=await ky(ee,Z,24e3,1);_.current&&_.current.stop();const be=Z.createBufferSource();be.buffer=R,be.connect(Z.destination),be.onended=()=>{_.current===be&&(b(!1),_.current=null)},be.start(),_.current=be}catch(fe){console.error("Error previewing voice:",fe),h(fe.message||"Failed to preview voice."),b(!1)}},[y,W,s,O,h]),X=x.useCallback(B=>{const fe=L.find(ie=>ie.id===B);fe&&kc(fe.audioData,fe.id,fe.voiceName,fe.intonation||"standard",fe.title)},[L]),Te=x.useCallback(async()=>{const B=L.filter(fe=>f.has(fe.id));for(const fe of B)kc(fe.audioData,fe.id,fe.voiceName,fe.intonation||"standard",fe.title),await new Promise(ie=>setTimeout(ie,300))},[L,f]),pe=x.useRef(L.length);x.useEffect(()=>{if(U&&L.length>pe.current){const B=L.slice(0,L.length-pe.current);for(const fe of B)kc(fe.audioData,fe.id,fe.voiceName,fe.intonation||"standard",fe.title)}pe.current=L.length},[L,U]);const ue=B=>{T(fe=>{const ie=new Set(fe);return ie.has(B)?ie.delete(B):ie.add(B),ie})},Oe=B=>{I(fe=>{const ie=new Set(fe);return ie.has(B)?ie.delete(B):ie.add(B),ie})},he=()=>{const B=new Set(L.map(fe=>fe.id));T(B)},ye=()=>{T(new Set)},j=()=>{const B=new Set(L.map(ie=>ie.id)),fe=new Set;B.forEach(ie=>{f.has(ie)||fe.add(ie)}),T(fe)},q=x.useMemo(()=>[{name:"Aoede",apiName:"aoede",gender:s("gender.female")},{name:"Autonoe",apiName:"autonoe",gender:s("gender.female")},{name:"Callirrhoe",apiName:"callirrhoe",gender:s("gender.female")},{name:"Despina",apiName:"despina",gender:s("gender.female")},{name:"Erinome",apiName:"erinome",gender:s("gender.female")},{name:"Kore",apiName:"kore",gender:s("gender.female")},{name:"Laomedeia",apiName:"laomedeia",gender:s("gender.female")},{name:"Leda",apiName:"leda",gender:s("gender.female")},{name:"Pulcherrima",apiName:"pulcherrima",gender:s("gender.female")},{name:"Sadachbia",apiName:"sadachbia",gender:s("gender.female")},{name:"Sadaltager",apiName:"sadaltager",gender:s("gender.female")},{name:"Schedar",apiName:"schedar",gender:s("gender.female")},{name:"Sulafat",apiName:"sulafat",gender:s("gender.female")},{name:"Vindemiatrix",apiName:"vindemiatrix",gender:s("gender.female")},{name:"Achernar",apiName:"achernar",gender:s("gender.male")},{name:"Achird",apiName:"achird",gender:s("gender.male")},{name:"Algenib",apiName:"algenib",gender:s("gender.male")},{name:"Algieba",apiName:"algieba",gender:s("gender.male")},{name:"Alnilam",apiName:"alnilam",gender:s("gender.male")},{name:"Charon",apiName:"charon",gender:s("gender.male")},{name:"Enceladus",apiName:"enceladus",gender:s("gender.male")},{name:"Fenrir",apiName:"fenrir",gender:s("gender.male")},{name:"Gacrux",apiName:"gacrux",gender:s("gender.male")},{name:"Iapetus",apiName:"iapetus",gender:s("gender.male")},{name:"Orus",apiName:"orus",gender:s("gender.male")},{name:"Puck",apiName:"puck",gender:s("gender.male")},{name:"Rasalgethi",apiName:"rasalgethi",gender:s("gender.male")},{name:"Umbriel",apiName:"umbriel",gender:s("gender.male")},{name:"Zephyr",apiName:"zephyr",gender:s("gender.male")},{name:"Zubenelgenubi",apiName:"zubenelgenubi",gender:s("gender.male")}],[s]),Q=x.useMemo(()=>q.map(B=>({value:B.apiName,label:`${B.name} (${B.gender})`})),[q]),J=x.useMemo(()=>[{value:"standard",label:s("intonation.standard")},{value:"cheerful",label:s("intonation.cheerful")},{value:"angry",label:s("intonation.angry")},{value:"sad",label:s("intonation.sad")},{value:"excited",label:s("intonation.excited")},{value:"announcer",label:s("intonation.announcer")},{value:"whispering",label:s("intonation.whispering")}],[s]),oe=/\[style:.*?]/.test(typeof E=="string"?E:"");return o.jsxs("div",{className:"flex flex-col h-full space-y-4",children:[o.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Ct,{id:`multi-speaker-${e.id}`,checked:z,onChange:B=>Y({isMultiSpeaker:B}),disabled:m||y,className:"h-4 w-4"}),o.jsx("label",{htmlFor:`multi-speaker-${e.id}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:s("speech_synthesizer.multiSpeaker")})]}),z?o.jsxs("div",{className:"p-3 bg-gray-900/40 rounded-md border border-gray-700/50 space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{htmlFor:`speaker1-name-${e.id}`,className:"text-xs font-medium text-emerald-400",children:s("speech_synthesizer.speaker1Name")}),o.jsx("input",{id:`speaker1-name-${e.id}`,type:"text",value:G,onChange:B=>Y({speaker1Name:B.target.value}),className:"w-full p-2 bg-gray-900 border border-emerald-500/50 rounded-md text-xs focus:ring-1 focus:ring-emerald-500 outline-none text-gray-200",onMouseDown:B=>B.stopPropagation()}),o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.voice")}),o.jsx(Yn,{value:F,onChange:B=>Y({speaker1Voice:B}),options:Q,disabled:m,id:`speaker1-voice-${e.id}`})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{htmlFor:`speaker2-name-${e.id}`,className:"text-xs font-medium text-cyan-400",children:s("speech_synthesizer.speaker2Name")}),o.jsx("input",{id:`speaker2-name-${e.id}`,type:"text",value:K,onChange:B=>Y({speaker2Name:B.target.value}),className:"w-full p-2 bg-gray-900 border border-emerald-500/50 rounded-md text-xs focus:ring-1 focus:ring-emerald-500 outline-none text-gray-200",onMouseDown:B=>B.stopPropagation()}),o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.voice")}),o.jsx(Yn,{value:ae,onChange:B=>Y({speaker2Voice:B}),options:Q,disabled:m,id:`speaker2-voice-${e.id}`})]})]}),o.jsx("p",{className:"text-[10px] text-gray-500 italic border-t border-gray-700/50 pt-1",children:s("speech_synthesizer.multiSpeakerHint")})]}):o.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[o.jsx("div",{className:"w-1/2",children:o.jsx(Yn,{value:P,onChange:B=>Y({voice:B}),options:Q,disabled:m||y||z,id:`voice-select-${e.id}`})}),o.jsxs("div",{className:"w-1/2 relative",children:[o.jsx(Yn,{value:O,onChange:B=>Y({intonation:B}),options:J,disabled:m||y||oe||z,id:`intonation-select-${e.id}`}),oe&&o.jsx("div",{className:"absolute inset-0 bg-gray-700/80 rounded-md flex items-center justify-center text-xs text-gray-300 font-medium z-10 pointer-events-none",title:s("speech_synthesizer.ssmlHint"),children:"SSML Active"})]}),o.jsx("div",{className:"flex-shrink-0",children:o.jsx(Pe,{title:s("node.content.previewVoice"),onClick:()=>le(P),disabled:m||a||z,children:y?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 animate-pulse text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-emerald-500 hover:text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})})]}),o.jsxs("div",{className:"flex-shrink-0 p-1 bg-gray-900/50 rounded-md flex items-center space-x-1 border border-gray-700/30",children:[o.jsx("div",{className:`p-2 h-8 w-10 flex items-center justify-center rounded-md transition-colors ${w?"bg-emerald-600/30 text-emerald-400":"text-gray-500 bg-transparent"}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${w?"animate-spin":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>Y({mode:"simple"}),className:`flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors h-8 ${D==="simple"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:s("speech_synthesizer.mode.simple")}),o.jsx("button",{onClick:()=>Y({mode:"scene"}),className:`flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors h-8 ${D==="scene"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:s("speech_synthesizer.mode.scene")})]})]}),D==="scene"&&o.jsx("div",{className:"flex items-center justify-end gap-2 p-2 bg-gray-900/50 rounded-md flex-shrink-0 border border-gray-700/30",children:o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[o.jsx("label",{htmlFor:`start-scene-${e.id}`,className:"whitespace-nowrap",children:s("node.content.analyzeFromScene")}),o.jsx("input",{id:`start-scene-${e.id}`,type:"number",min:"1",placeholder:"1",value:H||"",onChange:B=>Y({startSceneNumber:B.target.value?parseInt(B.target.value,10):null}),className:"w-14 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 outline-none border border-transparent focus:border-emerald-500",onMouseDown:B=>B.stopPropagation()}),o.jsx("label",{htmlFor:`end-scene-${e.id}`,className:"whitespace-nowrap",children:s("node.content.analyzeUpToScene")}),o.jsx("input",{id:`end-scene-${e.id}`,type:"number",min:"1",placeholder:s("node.content.endPlaceholder"),value:$||"",onChange:B=>Y({endSceneNumber:B.target.value?parseInt(B.target.value,10):null}),className:"w-16 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 outline-none border border-transparent focus:border-emerald-500",onMouseDown:B=>B.stopPropagation()})]})}),o.jsxs("button",{onClick:m?i:()=>n(e.id),disabled:a||y||typeof E=="string"&&!E.trim()&&D==="simple"||Array.isArray(E)&&E.length===0&&D==="scene",className:`w-full flex-shrink-0 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 whitespace-nowrap flex items-center justify-center space-x-2 ${a?"bg-yellow-600":m?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),o.jsx("span",{children:s(a?"node.action.stopping":m?"node.content.generating":"node.content.generateSpeech")})]}),o.jsxs("div",{className:"flex flex-row flex-grow min-h-0 space-x-2",children:[o.jsx("div",{onWheel:B=>B.stopPropagation(),className:"w-1/2 bg-gray-900/50 rounded p-2 overflow-y-auto custom-scrollbar border border-gray-700/30",children:D==="scene"?Array.isArray(E)&&E.length>0?o.jsx("div",{className:"space-y-2",children:E.map(B=>{const fe=A.has(B.sceneNumber);return o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-gray-700/30 hover:border-gray-600 transition-colors",children:[o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex justify-between items-center cursor-pointer select-none",onClick:()=>Oe(B.sceneNumber),children:[o.jsxs("span",{children:[s("node.content.scene")," ",B.sceneNumber]}),fe?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]}),!fe&&o.jsx("p",{className:"mt-2 text-sm text-gray-200 whitespace-pre-wrap select-text",children:B.text})]},B.sceneNumber)})}):o.jsx("div",{className:"flex items-center justify-center h-full text-center text-xs text-gray-500 p-4",children:o.jsx("p",{children:s("node.content.connectNarratorData")})}):o.jsx("textarea",{className:"w-full h-full bg-transparent p-1 disabled:bg-transparent disabled:text-gray-500 custom-scrollbar resize-none focus:ring-1 focus:ring-emerald-500 focus:outline-none rounded text-sm text-gray-200 placeholder-gray-600",placeholder:s(M?"node.content.connectedPlaceholder":"node.content.textToSynthesize"),value:typeof E=="string"?E:"",onChange:B=>Y({inputText:B.target.value}),disabled:M||m,onMouseDown:B=>B.stopPropagation()})}),o.jsxs("div",{className:"w-1/2 bg-gray-900/50 rounded p-2 flex flex-col space-y-2 border border-gray-700/30",children:[L.length>0&&o.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between border-b border-gray-700/50 pb-2",children:[o.jsx("span",{className:"text-sm text-gray-300 font-medium",children:s("node.content.promptsGenerated",{count:L.length})}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:s("selection.selectAll"),onClick:he,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),o.jsx(Pe,{title:s("selection.deselectAll"),onClick:ye,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7h8M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2"})})}),o.jsx(Pe,{title:s("selection.invert"),onClick:j,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),o.jsx("div",{onWheel:B=>B.stopPropagation(),className:"flex-grow overflow-y-auto custom-scrollbar space-y-2 pr-1 -mr-1",children:L.length>0?L.map((B,fe)=>o.jsx(C5,{id:B.id,title:B.title,text:B.text,audioData:B.audioData,voiceName:B.voiceName,intonation:B.intonation||"standard",isSelected:f.has(B.id),onSelect:ue,onDownload:X,onPlayRequest:ge,t:s},B.id||fe)):o.jsx("div",{className:"flex items-center justify-center h-full text-center text-xs text-gray-500",children:o.jsx("p",{children:"Generated audio files will appear here."})})}),L.length>0&&o.jsxs("div",{className:"flex-shrink-0 flex flex-col items-stretch space-y-2 pt-2 border-t border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center space-x-2 px-1",children:[o.jsx(Ct,{id:`auto-download-${e.id}`,checked:U,onChange:B=>Y({isAutoDownloadEnabled:B}),className:"h-4 w-4"}),o.jsx("label",{htmlFor:`auto-download-${e.id}`,className:"text-xs text-gray-300 select-none cursor-pointer",children:s("node.content.autoDownload")})]}),o.jsx("button",{onClick:Te,disabled:f.size===0,className:"w-full px-3 py-2 text-sm font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors",children:s("node.content.downloadSelected")})]})]})]})]})},T5=["   ","    ",",    ",",     ","   "," ,   ","    ","       ","   ","    ","    ",",    ",",   -  ",",     ","     "," ","   ","   ",",   ","  ","      "," ,   ","    ","-,    ","      -","    ","     ",",  "," -"," ,    "," ,   ","  -","-","     ","    ","  ,   ","    "," ,   ",",    ","    ","      ","    ","     ","     ","  "," ,    ","     ","      ",",   ","   ","    ","   "," ,   ","    ","     1940-","  ,   ","  ","    ?","   ","    ","  ,     "," ,   ",",       ","      ","    ",",    ",",   ","   ","  ","  ","   ","   ","-","       ","  ",",   ","  "," ","    ",",   ","    ","   ","      ","  ","    ","   ","    ","    ","    ","       ","  ","  ","   ","    ","     ","  "," ","     ","    ","   ","    "," ,   "," ,     ",",    ","    ","    ","    ",",   ","     ","   ,     ","    ","  ","    ","    ","  ","   ","  -","   ","    "," ,  ","    ","    ","    ","     ","     XIV","  "," ","   ","    ","   ","  "," ","  ","    ","   ","    ","     ","      ","    ","    ","    ","      ","    "," ,      ","  ","    ",",   ","    ,    ","-    ","     ","   ",",     ?","  ","      ","  :   ","   ","    ","      /","     ","   -","   ","  ",",    ","   ","   ","  ,     ","    ","    ",",     ","  ",",   ","    ","  ",",   ","  ","  "," ,  ","  ","   ","   ",",    ",",      ",",      ","  ,   ","   ","  ","   ",",   ",",    ",",   ","  ",",    - ","   ","  ",",   ","  ",",    ",",    ","  ","  "],E5=["A forgotten kingdom under the mountain","Flying islands with crystal castles","A forest where trees whisper prophecies","A city built on the back of a giant turtle","A magical academy in the clouds","A cursed artifact seeking its master","The last dragon and its rider","A war between elves and dwarves over an ancient relic","A journey to the underworld","A thieves' guild with magical abilities","Living statues in an ancient temple","A knight who made a deal with a demon","A library containing every book ever written","A world where magic is based on music","A monster hunter in a gothic city","A goblin rebellion","A prophecy about the end of the world","A lost city in the jungle","A kingdom ruled by animals","A floating market of wonders","A colony on Mars loses contact with Earth","An artificial intelligence that has realized it is a god","A journey to the center of a black hole","A cyberpunk city where memories can be bought","The last man on Earth and his robot companion","Space pirates in the asteroid belt","Discovery of an alien civilization in the depths of the ocean","A corporation that controls time","A rebellion of android servants","A generation ship flying to a new star","Virtual reality that has become more real than life","Genetically modified human super-soldiers","A prison planet","A bounty hunter in a neon metropolis","A post-apocalyptic world after a nuclear war","Contact with a race that communicates through emotions","Archaeological excavations on another planet","A star ark carrying frozen colonists","A world where people have stopped aging","Teleportation and its unforeseen consequences","A murder in a locked room in a Victorian mansion","The disappearance of a famous painting from a museum","A series of mysterious disappearances in a small town","A detective with amnesia investigates his own past","The mystery of an old lighthouse","An encrypted message found in an antique book","A crime on board a luxury cruise liner","An investigation in a closed scientific complex in the Arctic","A ghost haunting an old theater","A political conspiracy and blackmail","The search for a missing heir to a huge fortune","The mysterious death of a famous writer","A bank robbery committed without a trace","A case of forged works of art","A private detective in a noir city of the 1940s","The mystery of an ancient curse that kills family members","An investigation in a monastery","Who poisoned the critic in the restaurant?","The mystery of an abandoned amusement park","A secret society and its rituals","A haunted house that won't let its residents go","An ancient evil awakened in the forest","An experiment gone wrong in a secret laboratory","A group of teenagers at a summer camp and a maniac","A spaceship finds an abandoned station","A doll possessed by a spirit","A city shrouded in eternal fog","Vampires in a modern metropolis","The discovery of a strange videotape","A ritual to summon a demon","A creature from the depths of the sea","A psychological thriller about paranoia","A killer clown","A family moves into a new house with a dark past","Infection by an unknown virus","A cult that worships an ancient deity","Lost in caves","A living dead","Strange events on an isolated farm","Nightmares that become reality","A treasure hunt on a deserted island","An expedition to the North Pole","A journey down the Amazon in search of a lost tribe","Climbing Mount Everest","A round-the-world trip in a hot air balloon","Rafting down a turbulent river","Survival after a plane crash in the jungle","The search for the mythical fountain of youth","The adventures of an archaeologist in Egyptian tombs","A journey to the Wild West during the Gold Rush","A prison break","Exploring underwater caves","Hunting for a rare animal","Hitchhiking across the country","Becoming a student of a great martial arts master","A flight to Mars","The search for Atlantis","Participating in a dog sled race","The adventures of a cabin boy on a pirate ship","Crossing the desert on camels","First love in high school","A family secret revealed at a funeral","A young musician trying to make it in the big city","A friendship tested by time and distance","The complex relationship between a mother and daughter","A custody battle for a child","A doctor in the emergency room","A teacher inspiring troubled teenagers","A sports drama about the path to victory","Life in a small town where everyone knows each other","The story of immigrants in a new country","A midlife crisis","The choice between career and family","Volunteering at an animal shelter","The struggle with addiction","Starting your own small business","The rivalry between two chefs","Student life in a dormitory","A political career and moral dilemmas","A love story divided by war","The life of a gladiator in Ancient Rome","A Viking expedition to unknown lands","Espionage during the Cold War","The construction of the Great Wall of China through the eyes of a worker","Life at the court of King Louis XIV","The great geographical discoveries","The French Revolution","A samurai in the Meiji era","The Salem witch trials","Life in a medieval castle","The campaign of Alexander the Great","The Trojan War","The conquest of America by the conquistadors","Intrigues in the harem of the Ottoman sultan","The life of Leonardo da Vinci","Forbidden love in Victorian England","The struggle for independence in colonial America","Pirates of the Caribbean in the Golden Age of Piracy","Ancient Egypt and the construction of the pyramids","World War I in the trenches","Two losers try to rob a bank","A body swap between a teenager and his dog","An office comedy about strange colleagues","A family road trip where everything goes wrong","The adventures of a hapless superhero","A student accidentally becomes the head of the mafia","A farmer who won the lottery","A romantic comedy about two people who hate each other","A zombie apocalypse from the zombie's point of view","The gods of Olympus live in a modern apartment","A parody of spy movies","What if animals could talk?","A disastrous blind date","An attempt to make a movie with no budget and no talent","Roommates: a neat freak and a slob","A trip to a music festival","An alien tries to pretend to be a normal person","How to survive on a deserted island with your ex","An attempt to impress your partner's parents","A hot dog eating contest","The friendship of a boy and a dragon","The adventures of a talking cat","A girl who found a magic wand","A journey to the land of sweets","A school for young wizards","The story of how the stars got into the sky","An enchanted forest and its inhabitants","A little gnome looking for his home","A princess who didn't want to get married","The secret life of toys","A fairy who lost her wings","How animals prepare for winter","The underwater kingdom of mermaids","A boy who could fly","A competition of forest animals","The mystery of an old attic","A magic tree that grants wishes","The adventures of a little ghost","The search for a missing rainbow color","The story of a brave little mouse","A world where colors have taste","A man who can see other people's dreams","A city where time flows backwards","A journey through a country made of books","People with animal heads","An ocean in the sky","A conversation with one's own reflection","Memories that can be materialized","A city where everyone speaks in verse","A man made of glass","A staircase to nowhere","A desert where there are clocks instead of sand","A factory for producing clouds","A carnival of forgotten ideas","An architect who builds impossible buildings","A world without sounds","A map that changes before your eyes","A man living in a single minute","A symphony of city noises","A museum of lost feelings"],N5=({node:e,onValueChange:t,t:n,onGenerateIdeaCategories:r,isGeneratingIdeaCategories:a,onCombineStoryIdea:i,isCombiningStoryIdea:s,addToast:l})=>{const c=a||s,d=x.useMemo(()=>{try{const N=JSON.parse(e.value||"{}");return{stage:N.stage||"initial",theme:N.theme||"",categories:N.categories||null,selection:N.selection||{action:null,place:null,obstacle:null},generatedIdea:N.generatedIdea||"",targetLanguage:N.targetLanguage||"ru",format:N.format||"childrens"}}catch{return{stage:"initial",theme:"",categories:null,selection:{action:null,place:null,obstacle:null},generatedIdea:"",targetLanguage:"ru",format:"childrens"}}},[e.value]),{stage:h,theme:g,categories:m,selection:w,generatedIdea:y,targetLanguage:b,format:S}=d,_=x.useMemo(()=>[{value:"childrens",label:n("idea_generator.format.childrens")},{value:"adventure",label:n("idea_generator.format.adventure")},{value:"fantasy",label:n("idea_generator.format.fantasy")},{value:"detective",label:n("idea_generator.format.detective")},{value:"scifi",label:n("idea_generator.format.scifi")},{value:"horror",label:n("idea_generator.format.horror")},{value:"historical",label:n("idea_generator.format.historical")},{value:"general",label:n("idea_generator.format.general")}],[n]),v=N=>{t(e.id,JSON.stringify({...d,...N}))},f=(N,k)=>{v({selection:{...w,[N]:w[N]===k?null:k}})},T=()=>{const N=b==="ru"?T5:E5,k=Math.floor(Math.random()*N.length);v({theme:N[k]})},A=()=>{if(!m)return;const N=m.action[Math.floor(Math.random()*m.action.length)],k=m.place[Math.floor(Math.random()*m.place.length)],E=m.obstacle[Math.floor(Math.random()*m.obstacle.length)];v({selection:{action:N,place:k,obstacle:E}})},I=w.action&&w.place&&w.obstacle,M=()=>m?o.jsx("div",{className:"flex flex-row space-x-2 h-full",children:["action","place","obstacle"].map(N=>o.jsxs("div",{className:"flex flex-col w-1/3 bg-gray-900/50 p-2 rounded-md",children:[o.jsx("h4",{className:"font-semibold text-emerald-400 mb-2 capitalize flex-shrink-0",children:n(`node.content.category.${N}`)}),o.jsx("div",{className:"overflow-y-auto custom-scrollbar -mr-2 pr-2 p-1",children:o.jsx("div",{className:"flex flex-col items-start gap-2",children:(m[N]||[]).map((k,E)=>o.jsx("button",{onClick:()=>f(N,k),disabled:c,className:`w-full text-left px-3 py-1 text-sm rounded-md transition-colors ${w[N]===k?"bg-emerald-600 text-white font-semibold ring-2 ring-emerald-400":"bg-gray-800 hover:bg-gray-600 text-gray-200 disabled:bg-gray-800/50 disabled:cursor-not-allowed"}`,children:k},E))})})]},N))}):null;return o.jsxs("div",{className:"flex flex-col h-full space-y-2",onWheel:N=>N.stopPropagation(),children:[o.jsxs("div",{className:"flex-shrink-0 flex items-end space-x-2",children:[o.jsxs("div",{className:"flex-grow space-y-1",children:[o.jsx("label",{htmlFor:`theme-input-${e.id}`,className:"text-xs font-medium text-gray-400 block mb-1",children:n("node.content.theme")}),o.jsxs("div",{className:"relative",children:[o.jsx("textarea",{id:`theme-input-${e.id}`,value:g,onChange:N=>v({theme:N.target.value}),disabled:c,placeholder:n("idea_generator.themePlaceholder"),rows:1,className:"w-full pl-2 pr-8 py-2 text-sm bg-gray-700 border-none rounded-md resize-none focus:ring-1 focus:ring-emerald-500 focus:outline-none custom-scrollbar h-9 leading-tight"}),o.jsx("button",{onClick:T,disabled:c,title:n("idea_generator.randomTheme"),className:"absolute top-1/2 right-1 -translate-y-1/2 p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white disabled:opacity-50",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5m-5.223 2.152A9 9 0 0119.77 8.227M20 20v-5h-5m5.223-2.152A9 9 0 014.23 15.773"})})})]})]}),o.jsxs("div",{className:"w-48 flex-shrink-0 space-y-1",children:[o.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:n("node.content.storyFormat")}),o.jsx(Yn,{value:S,onChange:N=>v({format:N}),options:_,disabled:c,id:`format-select-${e.id}`})]})]}),o.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[o.jsxs("div",{className:"flex w-24 flex-shrink-0 bg-gray-700 rounded-md overflow-hidden h-10",children:[o.jsx("button",{onClick:()=>v({targetLanguage:"ru"}),className:`flex-1 py-1.5 text-xs font-bold text-center transition-colors ${b==="ru"?"bg-emerald-600 text-white":"bg-transparent text-gray-300 hover:text-white"}`,children:"RU"}),o.jsx("div",{className:"w-px bg-gray-600"}),o.jsx("button",{onClick:()=>v({targetLanguage:"en"}),className:`flex-1 py-1.5 text-xs font-bold text-center transition-colors ${b==="en"?"bg-emerald-600 text-white":"bg-transparent text-gray-300 hover:text-white"}`,children:"EN"})]}),o.jsx("button",{onClick:()=>r(e.id),disabled:c,className:"flex-grow h-10 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500/50 transition-colors",children:n(a?"node.content.generating":h==="initial"?"node.content.requestCategories":"node.content.requestNewCategories")})]}),o.jsx("div",{className:"flex-grow min-h-0",children:h==="initial"?o.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-center p-4 bg-gray-900/50 rounded-md",children:o.jsx("p",{children:n("idea_generator.initialMessage",{buttonName:n("node.content.requestCategories")})})}):M()}),o.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[o.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-md",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("node.content.generatedIdea")}),o.jsx(Pe,{title:n("node.action.copy"),onClick:()=>{y&&(navigator.clipboard.writeText(y),l(n("toast.copied"),"success"))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:y,onChange:N=>v({generatedIdea:N.target.value}),placeholder:n("idea_generator.ideaPlaceholder"),className:"w-full text-sm p-2 bg-gray-800 border-none rounded-md resize-none focus:outline-none custom-scrollbar overflow-y-scroll",rows:3,onWheel:N=>N.stopPropagation()})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:A,disabled:c||!m,title:n("idea_generator.randomCombination"),className:"h-10 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5m-5.223 2.152A9 9 0 0119.77 8.227M20 20v-5h-5m5.223-2.152A9 9 0 014.23 15.773"})})}),o.jsx("button",{onClick:()=>i(e.id),disabled:c||!I,className:"w-full px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:n(s?"node.content.generating":"node.content.generateIdea")})]})]})]})},Cs=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d},h)=>{const[g,m]=x.useState(!1);let w="",y="",b="",S="",_="",v="";if(!a)w="bg-gray-800/20",y="border-gray-700",b="text-gray-500",S="bg-gray-700",_="text-gray-500",v="bg-gray-800 text-gray-600";else if(r)w="bg-red-900/20",y="border-red-800/50",b="text-red-400",S="bg-red-500",_="text-gray-300",v="bg-red-900/50 text-red-200";else if(i)w="bg-gray-800",y="border-gray-600",b="text-emerald-400",S="bg-gray-500",_="text-gray-300",v="bg-gray-700 text-gray-400";else switch(_="text-gray-300",l){case"cyan":w="bg-cyan-900/20",y="border-cyan-700/50",b="text-cyan-400",S="bg-cyan-500",v="bg-cyan-900/50 text-cyan-200";break;case"purple":w="bg-purple-900/20",y="border-purple-700/50",b="text-purple-400",S="bg-purple-500",v="bg-purple-900/50 text-purple-200";break;default:w="bg-emerald-900/20",y="border-emerald-700/50",b="text-emerald-400",S="bg-emerald-500",v="bg-emerald-900/50 text-emerald-200"}const f=T=>{T.stopPropagation(),navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),1500)};return o.jsxs("div",{ref:h,onMouseDown:T=>T.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${w} ${y} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${v}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${S}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${b}`,children:e})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("button",{onClick:f,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${_} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${S}`})]})}),so={ROLE_NARRATOR:{id:"narrator_role_story",label:"Role: Storyteller",text:"You are a professional Voiceover Artist and Storyteller. Your tone should be engaging, descriptive, and emotionally resonant, suitable for audiobooks or narrative content."},ROLE_ANNOUNCER:{id:"narrator_role_news",label:"Role: Announcer",text:"You are a professional Broadcaster and Announcer. Your tone should be clear, punchy, energetic, and authoritative, suitable for commercials, trailers, or news."},ROLE_FIRST_PERSON:{id:"narrator_role_fps",label:"Role: Character",text:"You are the Character speaking from the First Person perspective. Express internal monologue, subjectivity, and direct emotional reaction to the events."},INPUT_CONTEXT:{id:"narrator_input",text:"Source Data: User Prompt / Scene Description."},SSML_RULE:{id:"narrator_ssml",text:'USE SSML TAGS: You MUST use Speech Synthesis Markup Language (SSML) to control the prosody. Use <break time="..."/> for pauses, <emphasis> for stress, and <prosody> for speed/pitch changes to enhance the performance.'},FORMAT:{id:"narrator_format",text:"Return a JSON object where keys are language codes (e.g., 'en', 'ru') and values are the generated voiceover scripts for those languages."}},k5=({uiState:e,onUpdateUiState:t,role:n,generateSSML:r,onToggleSSML:a,t:i})=>{let s=0;const c=(()=>{switch(n){case"announcer":case"dual_announcer":return so.ROLE_ANNOUNCER;case"first_person":return so.ROLE_FIRST_PERSON;case"narrator":case"dual_narrator":default:return so.ROLE_NARRATOR}})();return o.jsxs("div",{className:"border border-gray-600 hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:i("node.content.activePromptStack")}),o.jsx("div",{className:"text-gray-400",children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar max-h-64",onWheel:d=>d.stopPropagation(),children:[o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"1. Context"}),o.jsx(Cs,{label:i(`instruction.${so.INPUT_CONTEXT.id}`),text:so.INPUT_CONTEXT.text,translatedText:i(`instruction.desc.${so.INPUT_CONTEXT.id}`),isMandatory:!0,color:"gray",index:++s}),o.jsx(Cs,{label:i(`instruction.${c.id}`),text:c.text,translatedText:i(`instruction.desc.${c.id}`),isMandatory:!0,color:"emerald",index:++s})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"2. Formatting"}),o.jsx(Cs,{label:i(`instruction.${so.SSML_RULE.id}`),text:so.SSML_RULE.text,translatedText:i(`instruction.desc.${so.SSML_RULE.id}`),isEnabled:r,onToggle:a,color:"purple",index:r?++s:void 0})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"3. Output"}),o.jsx(Cs,{label:i(`instruction.${so.FORMAT.id}`),text:so.FORMAT.text,translatedText:i(`instruction.desc.${so.FORMAT.id}`),isMandatory:!0,color:"gray",index:++s})]})]})]})},A5=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"fr",label:"FR"},{code:"de",label:"DE"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],I5={ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italiano",pt:"Portugus",zh:"",ja:"",ko:""},P5=({node:e,onValueChange:t,t:n,deselectAllNodes:r,connectedInputs:a,onGenerateNarratorText:i,isGeneratingNarratorText:s,isStopping:l,onStopGeneration:c,getUpstreamTextValue:d,inputData:h,connections:g})=>{const m=s===e.id,w=a==null?void 0:a.has(void 0),y=x.useMemo(()=>{try{const P=JSON.parse(e.value||"{}"),L=P.targetLanguages||{ru:!0,en:!1},H=P.languageSelectionOrder||Object.keys(L).filter($=>L[$]);return{prompt:P.prompt||"",role:P.role||"narrator",generatedTexts:P.generatedTexts||{ru:"",en:""},targetLanguages:L,generateSSML:P.generateSSML||!1,languageSelectionOrder:H,uiState:P.uiState||{isSettingsCollapsed:!0}}}catch{return{prompt:"",role:"narrator",generatedTexts:{ru:"",en:""},targetLanguages:{ru:!0,en:!1},generateSSML:!1,languageSelectionOrder:["ru"],uiState:{isSettingsCollapsed:!0}}}},[e.value]),{prompt:b,role:S,generatedTexts:_,targetLanguages:v,generateSSML:f,languageSelectionOrder:T,uiState:A}=y,I=x.useMemo(()=>[{value:"narrator",label:n("node.content.role.narrator")},{value:"announcer",label:n("node.content.role.announcer")},{value:"first_person",label:n("node.content.role.first_person")},{value:"dual_narrator",label:n("node.content.role.dual_narrator")},{value:"dual_announcer",label:n("node.content.role.dual_announcer")}],[n]),M=P=>{const L={...y,...P};t(e.id,JSON.stringify(L))},N=P=>{M({uiState:{...A,...P}})};x.useEffect(()=>{if(w&&d&&g){const P=g.find(L=>L.toNodeId===e.id);if(P){const L=d(P.fromNodeId,P.fromHandleId);L!==b&&M({prompt:L})}}},[h,w]);const k=P=>{const L=!!v[P];let H={...v},$=[...T||[]];if(L)H[P]=!1,$=$.filter(U=>U!==P);else{for(;$.length>=2;){const U=$.shift();U&&(H[U]=!1)}H[P]=!0,$.push(P)}M({targetLanguages:H,languageSelectionOrder:$})},E=(P,L)=>{M({generatedTexts:{..._,[P]:L}})};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsx("textarea",{value:b,onChange:P=>M({prompt:P.target.value}),placeholder:n(w?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),disabled:w||m,className:"w-full min-h-[80px] max-h-[140px] p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar flex-shrink-0",onWheel:P=>P.stopPropagation(),onFocus:r}),o.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[o.jsx("div",{className:"w-40 flex-shrink-0",children:o.jsx(Yn,{value:S,onChange:P=>M({role:P}),options:I,disabled:m,id:`narrator-role-${e.id}`})}),o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md px-2 space-x-2 h-9 border border-gray-600 flex-shrink-0",title:"Embed intonation tags for speech synthesis.",children:[o.jsx(Ct,{id:`generate-ssml-${e.id}`,checked:f,onChange:P=>M({generateSSML:P}),disabled:m,className:"h-4 w-4"}),o.jsx("label",{htmlFor:`generate-ssml-${e.id}`,className:"text-xs text-gray-300 select-none cursor-pointer font-medium",children:"SSML"})]}),o.jsxs("button",{onClick:m?c:()=>i(e.id),disabled:l||!m&&!b.trim()&&!w,className:`flex-grow h-9 px-4 py-2 font-bold text-white text-xs uppercase rounded-md transition-colors duration-200 flex-shrink-0 flex items-center justify-center ${l?"bg-yellow-600":m?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:[!m&&!l&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),n(l?"node.action.stopping":m?"node.content.generating":"node.content.generateText")]})]}),o.jsx(k5,{uiState:A,onUpdateUiState:N,role:S,generateSSML:f,onToggleSSML:()=>M({generateSSML:!f}),t:n}),o.jsx("div",{className:"flex-shrink-0 bg-gray-700/50 p-1 rounded-md",children:o.jsx("div",{className:"flex flex-wrap gap-1",children:A5.map(P=>o.jsx(ht,{title:n(`languages.${P.code}`),position:"top",className:"flex-1",children:o.jsx("button",{onClick:()=>k(P.code),className:`w-full min-w-[30px] py-1 rounded text-[10px] font-bold uppercase transition-colors ${v[P.code]?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:P.label})},P.code))})}),o.jsx("div",{className:"flex flex-col flex-grow min-h-0 space-y-2",children:(T&&T.length>0?T:Object.keys(v)).map(P=>{if(!v[P])return null;const L=I5[P]||P.toUpperCase(),H=_&&_[P]||"";return o.jsxs("div",{className:"bg-gray-900/50 rounded-md p-2 flex flex-col flex-1 min-h-[120px]",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm",children:L}),o.jsx(Pe,{tooltipPosition:"left",title:n("node.action.copy"),onClick:$=>{$.stopPropagation(),navigator.clipboard.writeText(H)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:H,onChange:$=>E(P,$.target.value),className:"w-full text-sm p-2 bg-gray-800 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar flex-grow",onWheel:$=>$.stopPropagation(),onFocus:r})]},P)})})]})};function R5(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)})}function M5(e){const t=e.numberOfChannels,n=e.length,r=new Int16Array(n*t),a=[];for(let s=0;s<t;s++)a.push(e.getChannelData(s));let i=0;for(let s=0;s<n;s++)for(let l=0;l<t;l++){const c=Math.max(-1,Math.min(1,a[l][s]));r[i++]=c<0?c*32768:c*32767}return r}function Ss(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}function L5(e){const t=M5(e),n=new ArrayBuffer(44),r=new DataView(n),a=e.numberOfChannels,i=e.sampleRate,s=16,l=i*a*(s/8),c=a*(s/8);return Ss(r,0,"RIFF"),r.setUint32(4,36+t.byteLength,!0),Ss(r,8,"WAVE"),Ss(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,a,!0),r.setUint32(24,i,!0),r.setUint32(28,l,!0),r.setUint16(32,c,!0),r.setUint16(34,s,!0),Ss(r,36,"data"),r.setUint32(40,t.byteLength,!0),new Blob([r,t],{type:"audio/wav"})}const j5=({node:e,onValueChange:t,t:n,onTranscribeAudio:r,isTranscribingAudio:a,isStopping:i,onStopGeneration:s,deselectAllNodes:l,addToast:c})=>{const d=x.useRef(null),h=a,[g,m]=x.useState(!1),[w,y]=x.useState(!1),b=x.useMemo(()=>{try{const O=JSON.parse(e.value||"{}");return{audioBase64:O.audioBase64||null,mimeType:O.mimeType||null,transcription:O.transcription||"",segments:O.segments||[],fileName:O.fileName||null}}catch{return{audioBase64:null,mimeType:null,transcription:"",segments:[],fileName:null}}},[e.value]),{audioBase64:S,transcription:_,fileName:v,segments:f,mimeType:T}=b,A=O=>{t(e.id,JSON.stringify({...b,...O}))},I=async O=>{if(O.type.startsWith("video/mp4")){y(!0);try{const D=new(window.AudioContext||window.webkitAudioContext),z=await R5(O),G=await D.decodeAudioData(z),F=L5(G),K=new FileReader;K.onload=ae=>{var ge;const Y=((ge=ae.target)==null?void 0:ge.result).split(",")[1];A({audioBase64:Y,mimeType:"audio/wav",fileName:O.name,transcription:"",segments:[]}),y(!1)},K.onerror=()=>{y(!1),c(n("error.fileReadError"),"info")},K.readAsDataURL(F)}catch(D){console.error("Error converting video to audio:",D),c(n("error.videoConversionError"),"info"),y(!1)}}else if(O.type.startsWith("audio/")){const D=new FileReader;D.onload=z=>{var F;const G=((F=z.target)==null?void 0:F.result).split(",")[1];A({audioBase64:G,mimeType:O.type,fileName:O.name,transcription:"",segments:[]})},D.readAsDataURL(O)}else c(n("error.unsupportedFile"),"info")},M=O=>{var z;const D=(z=O.target.files)==null?void 0:z[0];D&&(I(D),O.target&&(O.target.value=""))},N=()=>{var O;(O=d.current)==null||O.click()},k=async()=>{r(e.id)};x.useMemo(()=>{if(_&&typeof _=="string"&&_.trim().startsWith("["))try{const O=JSON.parse(_);if(Array.isArray(O)&&O.length>0&&O[0].startTime){const D=O.map(z=>z.text).join(" ");setTimeout(()=>{A({transcription:D,segments:O})},0)}}catch{}},[_]);const E=()=>{let O="";const D=f||[];D.length>0?O=D.map((ae,Y)=>{const ge=ae.startTime.replace(".",","),W=ae.endTime.replace(".",",");return`${Y+1}
${ge} --> ${W}
${ae.text}
`}).join(`
`):O=`1
00:00:00,000 --> 00:00:05,000
${_}`;const z=new Blob([O],{type:"text/plain"}),G=URL.createObjectURL(z),F=document.createElement("a");F.href=G;const K=v?v.replace(/\.[^/.]+$/,""):"transcription";F.download=`${K}.srt`,F.click(),URL.revokeObjectURL(G)},P=O=>{if(O.preventDefault(),O.stopPropagation(),O.dataTransfer.items&&O.dataTransfer.items.length>0){const D=O.dataTransfer.items[0].type;(D.startsWith("audio/")||D==="video/mp4")&&m(!0)}},L=O=>{O.preventDefault(),O.stopPropagation(),m(!1)},H=O=>{var z;O.preventDefault(),O.stopPropagation(),m(!1);const D=(z=O.dataTransfer.files)==null?void 0:z[0];D&&(D.type.startsWith("audio/")||D.type==="video/mp4")&&I(D)},$=O=>{O.stopPropagation(),A({audioBase64:null,mimeType:null,fileName:null})},U=()=>T?v!=null&&v.endsWith(".mp4")||T.startsWith("video/")?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z",clipRule:"evenodd"})}):null;return o.jsxs("div",{className:`flex flex-col h-full space-y-2 rounded-md transition-all duration-200 ${g?"ring-2 ring-blue-400":""}`,onDragOver:P,onDragLeave:L,onDrop:H,children:[o.jsx("input",{type:"file",ref:d,onChange:M,accept:"audio/*,video/mp4",className:"hidden"}),o.jsxs("div",{className:"flex flex-col gap-1 flex-shrink-0",children:[o.jsxs("button",{onClick:N,disabled:h||w,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 hover:bg-cyan-500 rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors text-sm flex items-center justify-center gap-2",children:[w?o.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),n(w?"node.content.convertingVideo":"node.content.uploadAudio")]}),o.jsxs("div",{className:`text-center text-[10px] p-1 bg-gray-900/30 rounded truncate flex items-center justify-between gap-1 h-6 relative ${v?"text-cyan-400 font-medium":"text-gray-500"}`,children:[o.jsxs("div",{className:"flex items-center justify-center w-full gap-1 truncate px-4",children:[v&&U(),o.jsx("span",{className:"truncate",children:w?n("node.content.convertingVideo"):v?`${v}`:n("node.content.noAudioLoaded")})]}),v&&!w&&o.jsx("button",{onClick:$,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 hover:text-red-400 text-gray-500 rounded-full transition-colors flex items-center justify-center",title:"Remove file",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsxs("button",{onClick:h?s:k,disabled:i||!S||w,className:`w-full px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 flex items-center justify-center gap-2 ${i?"bg-yellow-600":h?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-700 disabled:text-gray-500"}`,children:[h&&!i?o.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),n(i?"node.action.stopping":h?"node.content.transcribing":"node.content.transcribe")]}),o.jsx("textarea",{value:_,onChange:O=>A({transcription:O.target.value}),onMouseDown:O=>O.stopPropagation(),onFocus:l,placeholder:n("node.content.transcriptionPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar",onWheel:O=>O.stopPropagation()}),_&&o.jsxs("button",{onClick:E,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors duration-200 flex items-center justify-center gap-2 flex-shrink-0",title:n("node.action.downloadSRT"),children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),o.jsx("span",{children:n("node.action.downloadSRT")})]})]})},Pr=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d},h)=>{const[g,m]=x.useState(!1);let w="",y="",b="",S="",_="",v="";if(!a)w="bg-gray-800/20",y="border-gray-700",b="text-gray-500",S="bg-gray-700",_="text-gray-500",v="bg-gray-800 text-gray-600";else if(r)w="bg-red-900/20",y="border-red-800/50",b="text-red-400",S="bg-red-500",_="text-gray-300",v="bg-red-900/50 text-red-200";else if(i)w="bg-gray-800",y="border-gray-600",b="text-emerald-400",S="bg-gray-500",_="text-gray-300",v="bg-gray-700 text-gray-400";else switch(_="text-gray-300",l){case"cyan":w="bg-cyan-900/20",y="border-cyan-700/50",b="text-cyan-400",S="bg-cyan-500",v="bg-cyan-900/50 text-cyan-200";break;case"red":w="bg-red-900/20",y="border-red-700/50",b="text-red-400",S="bg-red-500",v="bg-red-900/50 text-red-200";break;default:w="bg-emerald-900/20",y="border-emerald-700/50",b="text-emerald-400",S="bg-emerald-500",v="bg-emerald-900/50 text-emerald-200"}const f=T=>{T.stopPropagation(),navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),1500)};return o.jsxs("div",{ref:h,onMouseDown:T=>T.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${w} ${y} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${v}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${S}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${b}`,children:e})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("button",{onClick:f,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${_} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${S}`})]})}),D5=({uiState:e,onUpdateUiState:t,mode:n,t:r,includeHashtags:a=!0,onToggleHashtags:i,generateThumbnail:s=!1,onToggleThumbnail:l})=>{let c=0;return o.jsxs("div",{className:"border border-gray-600 hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:r("node.content.activePromptStack")}),o.jsx("div",{className:"text-gray-400",children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar max-h-64",onWheel:d=>d.stopPropagation(),children:[o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"1. Context"}),o.jsx(Pr,{label:r(`instruction.${At.ROLE.id}`),text:At.ROLE.text,translatedText:r(`instruction.desc.${At.ROLE.id}`),isMandatory:!0,color:"red",index:++c}),o.jsx(Pr,{label:r(`instruction.${At.INPUT_CONTEXT.id}`),text:At.INPUT_CONTEXT.text,translatedText:r(`instruction.desc.${At.INPUT_CONTEXT.id}`),isMandatory:!0,color:"gray",index:++c})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"2. Strategy"}),n==="title"&&o.jsxs(o.Fragment,{children:[o.jsx(Pr,{label:r(`instruction.${At.TITLE_MODE_RULES.id}`),text:At.TITLE_MODE_RULES.text,translatedText:r(`instruction.desc.${At.TITLE_MODE_RULES.id}`),isMandatory:!0,color:"cyan",index:++c}),o.jsx(Pr,{label:r(`instruction.${At.HASHTAGS.id}`),text:At.HASHTAGS.text,translatedText:r(`instruction.desc.${At.HASHTAGS.id}`),isEnabled:a,onToggle:i,color:"emerald",index:a?++c:void 0}),o.jsx(Pr,{label:r(`instruction.${At.THUMBNAIL.id}`),text:At.THUMBNAIL.text,translatedText:r(`instruction.desc.${At.THUMBNAIL.id}`),isEnabled:s,onToggle:l,color:"emerald",index:s?++c:void 0})]}),n==="channel"&&o.jsx(Pr,{label:r(`instruction.${At.CHANNEL_MODE_RULES.id}`),text:At.CHANNEL_MODE_RULES.text,translatedText:r(`instruction.desc.${At.CHANNEL_MODE_RULES.id}`),isMandatory:!0,color:"cyan",index:++c})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"3. Output Format"}),o.jsx(Pr,{label:r(`instruction.${At.FORMAT.id}`),text:At.FORMAT.text,translatedText:r(`instruction.desc.${At.FORMAT.id}`),isMandatory:!0,color:"gray",index:++c})]})]})]})},O5=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"fr",label:"FR"},{code:"de",label:"DE"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],F5={ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italiano",pt:"Portugus",zh:"",ja:"",ko:""},z5=({node:e,onValueChange:t,t:n,deselectAllNodes:r,connectedInputs:a,onGenerateYouTubeTitles:i,isGeneratingYouTubeTitles:s,onGenerateYouTubeChannelInfo:l,isGeneratingYouTubeChannelInfo:c,isStopping:d,onStopGeneration:h,addToast:g})=>{const m=s||c,w=a==null?void 0:a.has(void 0),y=x.useMemo(()=>{try{const U=JSON.parse(e.value||"{}"),O=U.targetLanguages||{ru:!0,en:!1},D=U.languageSelectionOrder||Object.keys(O).filter(z=>O[z]);return{mode:U.mode||"title",idea:U.idea||"",targetLanguages:O,generatedTitleOutputs:U.generatedTitleOutputs||{},generatedChannelOutputs:U.generatedChannelOutputs||{},languageSelectionOrder:D,includeHashtags:U.includeHashtags!==!1,generateThumbnail:U.generateThumbnail!==!1,uiState:U.uiState||{isSettingsCollapsed:!0}}}catch{return{mode:"title",idea:"",targetLanguages:{ru:!0,en:!1},generatedTitleOutputs:{},generatedChannelOutputs:{},languageSelectionOrder:["ru"],includeHashtags:!0,generateThumbnail:!0,uiState:{isSettingsCollapsed:!0}}}},[e.value]),{mode:b,idea:S,targetLanguages:_,generatedTitleOutputs:v,generatedChannelOutputs:f,languageSelectionOrder:T,includeHashtags:A,generateThumbnail:I,uiState:M}=y,N=U=>{t(e.id,JSON.stringify({...y,...U}))},k=U=>{N({uiState:{...M,...U}})},E=U=>{const O=!!_[U];let D={..._},z=[...T||[]];if(O)D[U]=!1,z=z.filter(G=>G!==U);else{for(;z.length>=2;){const G=z.shift();G&&(D[G]=!1)}D[U]=!0,z.push(U)}N({targetLanguages:D,languageSelectionOrder:z})},P=U=>{U&&(navigator.clipboard.writeText(U),g(n("toast.copied"),"success"))},L=()=>{b==="title"&&i?i(e.id):l&&l(e.id)},H=Object.entries(_).filter(([,U])=>U).map(([U])=>U),$=U=>{const O=b==="title",D=O?v[U]||{}:f[U]||{},z=F5[U]||U.toUpperCase(),G=O?[{key:"title",label:n("youtube_title_generator.title")},{key:"description",label:n("youtube_title_generator.description")},{key:"tags",label:n("youtube_title_generator.tags")},...I?[{key:"thumbnailPrompt",label:n("node.content.thumbnailPrompt")}]:[]]:[{key:"channelName",label:n("youtube_title_generator.channelName")},{key:"channelDescription",label:n("youtube_title_generator.channelDescription")},{key:"channelKeywords",label:n("youtube_title_generator.channelKeywords")},{key:"channelHandle",label:n("youtube_title_generator.channelHandle")}];return o.jsxs("div",{className:"flex flex-col flex-1 min-h-0 space-y-2",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm border-b border-gray-700/50 pb-1",children:z}),o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3 pr-1",children:G.map(F=>o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:F.label}),o.jsx(Pe,{title:n("node.action.copy"),onClick:()=>P(D[F.key]||""),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:D[F.key]||"",className:`w-full p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:border-emerald-500 focus:ring-0 focus:outline-none border border-transparent ${F.key==="description"?"min-h-[100px]":F.key==="thumbnailPrompt"?"min-h-[60px]":"min-h-[40px]"}`,onMouseDown:K=>K.stopPropagation(),onFocus:r,rows:F.key==="description"?4:F.key==="tags"?3:2})]},F.key))})]},U)};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",onWheel:U=>U.stopPropagation(),children:[o.jsx("textarea",{value:S,onChange:U=>N({idea:U.target.value}),placeholder:n(w?"node.content.connectedPlaceholder":b==="title"?"youtube_title_generator.ideaPlaceholder":"youtube_title_generator.channelIdeaPlaceholder"),disabled:w||m,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar min-h-[60px] max-h-[120px] flex-shrink-0",rows:2,onMouseDown:U=>U.stopPropagation(),onFocus:r}),o.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1 h-10",children:[o.jsx("button",{onClick:()=>N({mode:"title"}),className:`px-2 py-1 rounded text-xs font-semibold h-full ${b==="title"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:n("youtube_title_generator.mode.title")}),o.jsx("button",{onClick:()=>N({mode:"channel"}),className:`px-2 py-1 rounded text-xs font-semibold h-full ${b==="channel"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:n("youtube_title_generator.mode.channel")})]}),o.jsx("button",{onClick:m?h:L,disabled:d||!m&&!S.trim()&&!w,className:`flex-grow flex-shrink-0 h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${d?"bg-yellow-600":m?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:n(d?"node.action.stopping":m?"node.content.generating":"node.content.generateText")})]}),o.jsx(D5,{uiState:M,onUpdateUiState:k,mode:b,t:n,includeHashtags:A,onToggleHashtags:()=>N({includeHashtags:!A}),generateThumbnail:I,onToggleThumbnail:()=>N({generateThumbnail:!I})}),o.jsx("div",{className:"flex-shrink-0 bg-gray-700/50 p-1 rounded-md border border-gray-600/30",children:o.jsx("div",{className:"flex flex-wrap gap-1",children:O5.map(U=>o.jsx(ht,{title:n(`languages.${U.code}`),position:"top",className:"flex-1",children:o.jsx("button",{onClick:()=>E(U.code),className:`w-full min-w-[30px] py-1 rounded text-[10px] font-bold uppercase transition-colors ${_[U.code]?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:U.label})},U.code))})}),o.jsx("div",{className:"flex flex-row flex-grow min-h-0 space-x-2",children:H.map(U=>$(U))})]})},Rr=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d},h)=>{const[g,m]=x.useState(!1);let w="",y="",b="",S="",_="",v="";if(!a)w="bg-gray-800/20",y="border-gray-700",b="text-gray-500",S="bg-gray-700",_="text-gray-500",v="bg-gray-800 text-gray-600";else if(r)w="bg-red-900/20",y="border-red-800/50",b="text-red-400",S="bg-red-500",_="text-gray-300",v="bg-red-900/50 text-red-200";else if(i)w="bg-gray-800",y="border-gray-600",b="text-emerald-400",S="bg-gray-500",_="text-gray-300",v="bg-gray-700 text-gray-400";else switch(_="text-gray-300",l){case"cyan":w="bg-cyan-900/20",y="border-cyan-700/50",b="text-cyan-400",S="bg-cyan-500",v="bg-cyan-900/50 text-cyan-200";break;default:w="bg-emerald-900/20",y="border-emerald-700/50",b="text-emerald-400",S="bg-emerald-500",v="bg-emerald-900/50 text-emerald-200"}const f=T=>{T.stopPropagation(),navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),1500)};return o.jsxs("div",{ref:h,onMouseDown:T=>T.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${w} ${y} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${v}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${S}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${b}`,children:e})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:f,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!i&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${a?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:a?"ON":"OFF"})]})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${_} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${S}`})]})}),G5=({uiState:e,onUpdateUiState:t,generateLyrics:n,onToggleGenerateLyrics:r,verseCount:a,onVerseCountChange:i,model:s,t:l})=>{let c=0;const d=h=>h==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":h==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":h;return o.jsxs("div",{className:"border border-gray-600 hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:l("node.content.activePromptStack")}),o.jsx("div",{className:"text-gray-400",children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar max-h-64",onWheel:h=>h.stopPropagation(),children:[o.jsx(Rr,{label:l("node.content.model"),text:d(s),isMandatory:!0,color:"gray",className:"mb-2"}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"1. Context"}),o.jsx(Rr,{label:l(`instruction.${Wt.ROLE.id}`),text:Wt.ROLE.text,translatedText:l(`instruction.desc.${Wt.ROLE.id}`),isMandatory:!0,color:"emerald",index:++c}),o.jsx(Rr,{label:l(`instruction.${Wt.INPUT_CONTEXT.id}`),text:Wt.INPUT_CONTEXT.text,translatedText:l(`instruction.desc.${Wt.INPUT_CONTEXT.id}`),isMandatory:!0,color:"gray",index:++c})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"2. Generation Rules"}),o.jsx(Rr,{label:l(`instruction.${Wt.CREATIVE_RULE.id}`),text:Wt.CREATIVE_RULE.text,translatedText:l(`instruction.desc.${Wt.CREATIVE_RULE.id}`),isMandatory:!0,color:"cyan",index:++c}),o.jsx(Rr,{label:l(`instruction.${Wt.MUSIC_PROMPT_RULE.id}`),text:Wt.MUSIC_PROMPT_RULE.text,translatedText:l(`instruction.desc.${Wt.MUSIC_PROMPT_RULE.id}`),isMandatory:!0,color:"cyan",index:++c}),o.jsx(Rr,{label:l(`instruction.${Wt.LYRICS_RULE.id}`),text:Wt.LYRICS_RULE.text,translatedText:l(`instruction.desc.${Wt.LYRICS_RULE.id}`),isEnabled:n,onToggle:r,color:"emerald",index:n?++c:void 0}),n&&o.jsxs("div",{className:"flex flex-row p-2 rounded border border-gray-700 text-xs transition-all relative overflow-hidden group select-none items-center gap-3 bg-emerald-900/20 flex-shrink-0",children:[o.jsx("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:o.jsx("div",{className:"text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full bg-emerald-900/50 text-emerald-200",children:++c})}),o.jsxs("div",{className:"flex-grow min-w-0 flex items-center justify-between",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:"font-bold uppercase tracking-wider text-[10px] leading-tight text-emerald-400",children:l(`instruction.${Wt.VERSE_COUNT_RULE.id}`)}),o.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:Wt.VERSE_COUNT_RULE.text.replace("{N}",a.toString())})]}),o.jsx("input",{type:"number",min:"1",max:"20",value:a,onChange:h=>i(Math.max(1,parseInt(h.target.value)||1)),className:"w-12 h-6 bg-gray-800 border border-gray-600 rounded text-center text-white text-xs focus:outline-none focus:ring-1 focus:ring-emerald-500",onClick:h=>h.stopPropagation(),onMouseDown:h=>h.stopPropagation()})]})]})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"3. Output Format"}),o.jsx(Rr,{label:l(`instruction.${Wt.FORMAT.id}`),text:Wt.FORMAT.text,translatedText:l(`instruction.desc.${Wt.FORMAT.id}`),isMandatory:!0,color:"gray",index:++c})]})]})]})},U5=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"fr",label:"FR"},{code:"de",label:"DE"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],H5={ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italiano",pt:"Portugus",zh:"",ja:"",ko:""},B5=({node:e,onValueChange:t,t:n,deselectAllNodes:r,connectedInputs:a,onGenerateMusicIdeas:i,isGeneratingMusicIdeas:s,isStopping:l,onStopGeneration:c,addToast:d})=>{const h=s,g=a==null?void 0:a.has(void 0),m=x.useMemo(()=>{try{const U=JSON.parse(e.value||"{}"),O=U.targetLanguages||{ru:!0,en:!1},D=U.languageSelectionOrder||Object.keys(O).filter(z=>O[z]);return{generateLyrics:U.generateLyrics??!0,verseCount:U.verseCount||2,idea:U.idea||"",targetLanguages:O,generatedLyrics:U.generatedLyrics||{},generatedMusicPrompts:U.generatedMusicPrompts||{},generatedTitles:U.generatedTitles||{},languageSelectionOrder:D,model:U.model||"gemini-3-flash-preview",uiState:U.uiState||{isSettingsCollapsed:!0}}}catch{return{generateLyrics:!0,verseCount:2,idea:"",targetLanguages:{ru:!0,en:!1},generatedLyrics:{},generatedMusicPrompts:{},generatedTitles:{},languageSelectionOrder:["ru"],model:"gemini-3-flash-preview",uiState:{isSettingsCollapsed:!0}}}},[e.value]),{generateLyrics:w,verseCount:y,idea:b,targetLanguages:S,generatedLyrics:_,generatedMusicPrompts:v,generatedTitles:f,languageSelectionOrder:T,model:A,uiState:I}=m,M=U=>{t(e.id,JSON.stringify({...m,...U}))},N=U=>{M({uiState:{...I,...U}})},k=U=>{const O=!!S[U];let D={...S},z=[...T||[]];if(O)D[U]=!1,z=z.filter(G=>G!==U);else{for(;z.length>=2;){const G=z.shift();G&&(D[G]=!1)}D[U]=!0,z.push(U)}M({targetLanguages:D,languageSelectionOrder:z})},E=U=>{U&&(navigator.clipboard.writeText(U),d(n("toast.copied"),"success"))},P=()=>{i&&i(e.id)},L=U=>{const O=f[U]||"Untitled",D=_[U]||"",z=v[U]||"",G=`Title: ${O}

--- Music Prompt ---
${z}

--- Lyrics ---
${D}`,F=new Date,K=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}-${String(F.getDate()).padStart(2,"0")}_${String(F.getHours()).padStart(2,"0")}-${String(F.getMinutes()).padStart(2,"0")}`,ae=O.replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_")||"Song",Y=new Blob([G],{type:"text/plain"}),ge=URL.createObjectURL(Y),W=document.createElement("a");W.href=ge,W.download=`${ae}_${K}.txt`,W.click(),URL.revokeObjectURL(ge),d("TXT Saved","success")},H=Object.entries(S).filter(([,U])=>U).map(([U])=>U),$=()=>H.length===0?null:o.jsx("div",{className:"flex flex-row flex-grow min-h-0 space-x-2",children:H.map(U=>{const O=_[U]||"",D=v[U]||"",z=f[U]||"",G=H5[U]||U.toUpperCase();return o.jsxs("div",{className:"flex flex-col flex-1 min-h-0 space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 border-b border-gray-700/50 pb-1",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm",children:G}),o.jsx(Pe,{title:"Download TXT",onClick:()=>L(U),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),o.jsxs("div",{className:"flex flex-col flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("music_idea_generator.songTitle")}),o.jsx(Pe,{title:n("node.action.copy"),onClick:()=>E(z),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:z,placeholder:n("music_idea_generator.songTitlePlaceholder"),className:"w-full p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:outline-none focus:ring-1 focus:ring-emerald-500 selection:bg-emerald-500 selection:text-white",rows:1})]}),w&&o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("music_idea_generator.mode.lyrics")}),o.jsx(Pe,{title:n("node.action.copy"),onClick:()=>E(O),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:O,placeholder:n("music_idea_generator.lyricsPlaceholder"),className:"w-full flex-grow p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:outline-none focus:ring-1 focus:ring-emerald-500 selection:bg-emerald-500 selection:text-white"})]}),o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("music_idea_generator.mode.music_prompt")}),o.jsx(Pe,{title:n("node.action.copy"),onClick:()=>E(D),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:D,placeholder:n("music_idea_generator.musicPromptPlaceholder"),className:"w-full flex-grow p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:outline-none focus:ring-1 focus:ring-emerald-500 selection:bg-emerald-500 selection:text-white"})]})]},U)})});return o.jsxs("div",{className:"flex flex-col h-full space-y-2",onWheel:U=>U.stopPropagation(),children:[o.jsx("textarea",{value:b,onChange:U=>M({idea:U.target.value}),placeholder:n(g?"node.content.connectedPlaceholder":"music_idea_generator.ideaPlaceholder"),disabled:g||h,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-y min-h-[60px] max-h-[120px] focus:border-emerald-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar selection:bg-emerald-500 selection:text-white flex-shrink-0 transition-colors",rows:2,onMouseDown:U=>U.stopPropagation(),onFocus:r}),o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 h-10",children:[o.jsxs("div",{className:"flex w-36 flex-shrink-0 gap-1 select-none bg-gray-900/50 rounded-lg p-0.5 h-full",children:[o.jsx(ht,{title:n("tooltip.model.flash"),position:"top",className:"h-full flex-1",children:o.jsx("button",{onClick:()=>M({model:"gemini-3-flash-preview"}),className:`w-full h-full text-[10px] font-bold text-center transition-colors rounded-md flex items-center justify-center ${A==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"FLASH"})}),o.jsx(ht,{title:n("tooltip.model.pro"),position:"top",className:"h-full flex-1",children:o.jsx("button",{onClick:()=>M({model:"gemini-3-pro-preview"}),className:`w-full h-full text-[10px] font-bold text-center transition-colors rounded-md flex items-center justify-center ${A==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"PRO"})})]}),o.jsx(ht,{title:n("music_idea_generator.mode.lyrics"),position:"top",children:o.jsx("button",{onClick:()=>M({generateLyrics:!w}),className:`w-10 h-10 rounded-md flex items-center justify-center transition-colors border ${w?"bg-emerald-600 border-emerald-500 text-white shadow-sm":"bg-gray-700 border-gray-600 text-gray-400 hover:text-white hover:border-gray-500"}`,title:n("music_idea_generator.mode.lyrics"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),w&&o.jsxs("div",{className:"flex items-center bg-gray-900/50 rounded-lg p-0.5 border border-gray-700/50 h-full",title:n("node.content.verseCount"),children:[o.jsx("span",{className:"text-[9px] text-gray-500 px-1 font-bold select-none",children:"V:"}),o.jsx("input",{type:"number",min:"1",max:"12",value:y,onChange:U=>M({verseCount:Math.max(1,parseInt(U.target.value)||1)}),className:"w-8 h-full bg-transparent text-center text-xs text-white outline-none font-mono",onMouseDown:U=>U.stopPropagation()})]}),o.jsxs("button",{onClick:h?c:P,disabled:l||!h&&!b.trim()&&!g,className:`flex-grow h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center gap-2 ${l?"bg-yellow-600":h?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed"}`,children:[h?o.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):!l&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})}),o.jsx("span",{children:n(l?"node.action.stopping":h?"node.content.generating":"node.content.generateText")})]})]}),o.jsx(G5,{uiState:I,onUpdateUiState:N,generateLyrics:w,onToggleGenerateLyrics:()=>M({generateLyrics:!w}),verseCount:y,onVerseCountChange:U=>M({verseCount:U}),model:A,t:n}),o.jsx("div",{className:"flex-shrink-0 bg-gray-700/50 p-1.5 rounded-md border border-gray-600/30",children:o.jsx("div",{className:"flex flex-wrap gap-1",children:U5.map(U=>o.jsx(ht,{title:n(`languages.${U.code}`),position:"top",className:"flex-1",children:o.jsx("button",{onClick:()=>k(U.code),className:`w-full min-w-[30px] py-1 px-2 rounded text-[10px] font-bold uppercase transition-colors ${S[U.code]?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:U.label})},U.code))})}),$()]})},V5=e=>new Promise((t,n)=>{const r=new Image;r.src=URL.createObjectURL(e),r.onload=()=>{const a=document.createElement("canvas"),i=a.getContext("2d");if(!i){n(new Error("Could not get canvas context"));return}const s=128,l=72;a.width=s,a.height=l;const c=Math.max(s/r.width,l/r.height),d=s/2-r.width/2*c,h=l/2-r.height/2*c;i.drawImage(r,d,h,r.width*c,r.height*c),t(a.toDataURL("image/png").split(",")[1])},r.onerror=n}),$5=e=>new Promise((t,n)=>{const r=new Image;r.src=URL.createObjectURL(e),r.onload=()=>{const i=document.createElement("canvas");i.width=136,i.height=r.height;const s=i.getContext("2d");if(!s){n("Canvas error");return}s.drawImage(r,0,0,136,r.height,0,0,136,r.height);const l=document.createElement("canvas"),c=r.width-136;l.width=c,l.height=r.height;const d=l.getContext("2d");if(!d){n("Canvas error");return}d.drawImage(r,136,0,c,r.height,0,0,c,r.height),t({thumbnail:i.toDataURL("image/png").split(",")[1],metadataImage:l.toDataURL("image/png").split(",")[1]})},r.onerror=n}),W5=({stats:e,videos:t,showSubs:n,showViews:r,showVideos:a})=>{if(!e.length&&!t.length)return o.jsx("div",{className:"h-24 flex items-center justify-center text-gray-500 text-xs",children:"No data for chart"});const i=new Set;e.forEach(S=>i.add(S.date)),t.forEach(S=>i.add(S.uploadDate.split("T")[0]));const s=Array.from(i).sort();if(s.length<2)return o.jsx("div",{className:"h-24 flex items-center justify-center text-gray-500 text-xs",children:"Not enough data points"});const l=s.map(S=>{const _=e.find(T=>T.date===S),v=new Date(S).getTime(),f=t.filter(T=>T.uploadDate.split("T")[0]<=S).length;return{date:S,time:v,subscribers:_?_.subscribers:void 0,totalViews:_?_.totalViews:void 0,videoCount:f}}),c=l[0].time,h=l[l.length-1].time-c||1,g=S=>{const _=l.filter(I=>I[S]!==void 0);if(_.length===0)return[];const v=_.map(I=>I[S]),f=Math.min(...v),A=Math.max(...v)-f||1;return _.map(I=>({x:(I.time-c)/h*100,y:100-(I[S]-f)/A*100,val:I[S],date:I.date}))},m=n?g("subscribers"):[],w=r?g("totalViews"):[],y=a?g("videoCount"):[],b=(S,_)=>{if(S.length<2)return null;const v=S.map((f,T)=>`${T===0?"M":"L"} ${f.x} ${f.y}`).join(" ");return o.jsxs(o.Fragment,{children:[o.jsx("path",{d:v,fill:"none",stroke:_,strokeWidth:"2",vectorEffect:"non-scaling-stroke"}),S.map((f,T)=>o.jsx("circle",{cx:f.x,cy:f.y,r:"1.5",fill:_,stroke:"none",vectorEffect:"non-scaling-stroke",children:o.jsx("title",{children:`${f.date}: ${f.val}`})},T))]})};return o.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-24 bg-gray-900/30 rounded border border-gray-700 overflow-visible",preserveAspectRatio:"none",children:[b(m,"#10b981")," ",b(w,"#06b6d4")," ",b(y,"#a855f7")," "]})},Y5=({advice:e,addToast:t})=>{if(!e)return null;const n=x.useMemo(()=>e.split(/(?=###\s)/).map(s=>{const l=s.trim();if(l.startsWith("###")){const[c,...d]=l.split(`
`);return{title:c.replace(/^###\s*/,"").trim(),content:d.join(`
`).trim(),isHeader:!0}}return{title:null,content:l,isHeader:!1}}).filter(s=>s.content),[e]),r=i=>{navigator.clipboard.writeText(i),t("Copied to clipboard","success")},a=i=>i.split(/(\*\*.*?\*\*)/g).map((l,c)=>l.startsWith("**")&&l.endsWith("**")?o.jsx("strong",{className:"text-emerald-300 font-semibold",children:l.slice(2,-2)},c):l);return o.jsx("div",{className:"space-y-2 mt-2",children:n.map((i,s)=>o.jsxs("div",{className:`bg-gray-800/80 border border-gray-700 rounded-md overflow-hidden ${i.isHeader?"mb-2":"mb-1"}`,children:[i.title&&o.jsxs("div",{className:"flex justify-between items-center bg-gray-900/60 px-2 py-1.5 border-b border-gray-700/50",children:[o.jsx("h4",{className:"text-sm font-bold text-emerald-400",children:i.title}),o.jsx(Pe,{title:"Copy Section",onClick:()=>r(`${i.title}
${i.content}`),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("div",{className:"p-2 text-xs text-gray-300 whitespace-pre-wrap select-text leading-relaxed",children:a(i.content)})]},s))})},q5=({node:e,onValueChange:t,t:n,deselectAllNodes:r,onAnalyzeYouTubeStats:a,isAnalyzingYouTubeStats:i,isStopping:s,onStopGeneration:l,addToast:c,saveDataToCatalog:d,getUpstreamTextValue:h,connections:g})=>{const[m,w]=x.useState(!1),[y,b]=x.useState(""),[S,_]=x.useState(""),[v,f]=x.useState(""),[T,A]=x.useState("all"),[I,M]=x.useState(!1),[N,k]=x.useState(null),[E,P]=x.useState(!0),[L,H]=x.useState(!1),[$,U]=x.useState(!0),O=x.useRef(null),D=x.useMemo(()=>{try{const V=JSON.parse(e.value||"{}"),re=Array.isArray(V.channels)?V.channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}];return{authorName:V.authorName||"",channels:re,activeChannelId:V.activeChannelId||"default",globalNotes:Array.isArray(V.globalNotes)?V.globalNotes:Array.isArray(V.notes)?V.notes:[],aiAdvice:V.aiAdvice||"",aiSuggestedGoal:V.aiSuggestedGoal||"",targetLanguage:V.targetLanguage||"ru",contextPrompt:V.contextPrompt||""}}catch{return{authorName:"",channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}],activeChannelId:"default",globalNotes:[],aiAdvice:"",aiSuggestedGoal:"",targetLanguage:"ru",contextPrompt:""}}},[e.value]),{authorName:z,channels:G,activeChannelId:F,globalNotes:K,aiAdvice:ae,aiSuggestedGoal:Y,targetLanguage:ge,contextPrompt:W}=D,le=G.find(V=>V.id===F)||G[0],X=V=>{t(e.id,JSON.stringify({...D,...V}))},Te=(V,re)=>{const ze=G.map(ne=>ne.id===V?{...ne,...re}:ne);X({channels:ze})},pe=()=>{if(!h||!g)return;const V=g.find(re=>re.toNodeId===e.id);if(V){const re=h(V.fromNodeId,V.fromHandleId);try{const ze=JSON.parse(re),ne=ze.title||(typeof ze=="string"?ze:""),xe=ze.description||"";ne?(k({title:ne,description:xe}),c(n("node.action.refreshData"),"success")):c(n("youtube_analytics.noIncomingData"),"info")}catch{re&&re.trim()?(k({title:re,description:""}),c(n("node.action.refreshData"),"success")):k(null)}}else k(null)};x.useEffect(()=>{pe()},[g]);const ue=()=>{if(!N||!le)return;const re=[{id:`vid-${Date.now()}`,thumbnailBase64:null,uploadDate:new Date().toISOString(),title:N.title,description:N.description,views:0,likes:0,isShort:!1},...le.videos];Te(le.id,{videos:re}),c(n("youtube_analytics.videoAdded"),"success")},Oe=()=>{const V=`channel-${Date.now()}`,re={id:V,name:`Channel ${G.length+1}`,videos:[],stats:[]};X({channels:[...G,re],activeChannelId:V})},he=(V,re)=>{if(V.stopPropagation(),G.length<=1)return;const ze=G.filter(ne=>ne.id!==re);X({channels:ze,activeChannelId:F===re?ze[0].id:F})},ye=()=>{if(Y&&le){const V=G.map(re=>re.id===le.id?{...re,goal:Y}:re);t(e.id,JSON.stringify({...D,channels:V,aiSuggestedGoal:""})),c("Goal updated based on AI suggestion","success")}},j=V=>{V.preventDefault(),V.stopPropagation(),w(!0)},q=V=>{V.preventDefault(),V.stopPropagation(),w(!1)},Q=V=>{var ze;if(V.preventDefault(),V.stopPropagation(),w(!1),!le)return;const re=(ze=V.dataTransfer.files)==null?void 0:ze[0];re&&re.type.startsWith("image/")&&$5(re).then(async({thumbnail:ne,metadataImage:xe})=>{const _e=`vid-${Date.now()}`,me=[{id:_e,thumbnailBase64:ne,uploadDate:new Date().toISOString(),title:"Processing...",views:0,likes:0,isShort:!1},...le.videos],Ee=G.map(Ae=>Ae.id===le.id?{...Ae,videos:me}:Ae);t(e.id,JSON.stringify({...D,channels:Ee})),c(n("toast.videoPasted"),"success");try{const Ae=await Kk(xe);B(_e,Ae)}catch(Ae){console.error("Failed to extract metadata",Ae),c("Failed to extract text from image","info")}}).catch(ne=>{console.error("Failed to process screenshot",ne),c("Failed to process image","info")})},J=x.useRef(G);x.useEffect(()=>{J.current=G},[G]);const oe=x.useRef(F);x.useEffect(()=>{oe.current=F},[F]);const B=(V,re)=>{const ze=J.current,ne=oe.current,xe=ze.findIndex(Ae=>Ae.id===ne);if(xe===-1)return;const _e=ze[xe],Ie=_e.videos.findIndex(Ae=>Ae.id===V);if(Ie===-1)return;const me=[..._e.videos];me[Ie]={...me[Ie],title:re.title||"Untitled",description:re.description||"",views:re.views||0};const Ee=[...ze];Ee[xe]={..._e,videos:me},t(e.id,JSON.stringify({...D,channels:Ee})),c("Title and description extracted!","success")},fe=(V,re)=>{var ne;V.preventDefault(),V.stopPropagation();const ze=(ne=V.dataTransfer.files)==null?void 0:ne[0];ze&&ze.type.startsWith("image/")&&V5(ze).then(xe=>{ie(re,{thumbnailBase64:xe}),c(n("youtube_analytics.thumbnailUpdated"),"success")})},ie=(V,re)=>{if(!le)return;const ze=le.videos.map(ne=>ne.id===V?{...ne,...re}:ne);Te(le.id,{videos:ze})},Z=V=>{if(!le)return;const re=le.videos.filter(ze=>ze.id!==V);Te(le.id,{videos:re})},ee=x.useMemo(()=>{if(!le)return[];if(T==="all")return le.videos;const V=T==="shorts";return le.videos.filter(re=>!!re.isShort===V)},[le,T]),R=()=>{if(!le)return;const V=new Date,re=V.getFullYear()+"-"+String(V.getMonth()+1).padStart(2,"0")+"-"+String(V.getDate()).padStart(2,"0"),ze=parseInt(y)||0,ne=parseInt(S)||0,xe=parseInt(v)||0,_e=ne+xe;if(ze===0&&_e===0)return;const Ie=le.stats.findIndex(Ae=>Ae.date===re);let me=[...le.stats];const Ee={date:re,subscribers:ze,totalViews:_e,shortsViews:xe,longViews:ne};Ie>=0?me[Ie]=Ee:(me.push(Ee),me.sort((Ae,Ke)=>new Date(Ae.date).getTime()-new Date(Ke.date).getTime())),Te(le.id,{stats:me}),b(""),_(""),f(""),c(n("youtube_analytics.statsUpdated"),"success")},be=V=>{if(!le)return;const re=le.stats.filter(ze=>ze.date!==V);Te(le.id,{stats:re})},Le=()=>{const V=new Date,re=V.getFullYear()+"-"+String(V.getMonth()+1).padStart(2,"0")+"-"+String(V.getDate()).padStart(2,"0"),ze={id:`note-${Date.now()}`,date:re,content:""};X({globalNotes:[ze,...K]})},je=(V,re)=>{const ze=K.map(ne=>ne.id===V?{...ne,content:re}:ne);X({globalNotes:ze})},Ue=V=>{const re=K.filter(ze=>ze.id!==V);X({globalNotes:re})},Fe=()=>{const V={type:"youtube-analytics-data",...D},re=JSON.stringify(V,null,2),ze=new Blob([re],{type:"application/json"}),ne=URL.createObjectURL(ze),xe=document.createElement("a"),_e=z.replace(/[^a-z0-9-\s-_]/gi,"").trim()||"Unknown",Ie=le.name.replace(/[^a-z0-9-\s-_]/gi,"").trim()||"Channel",me=new Date().toISOString().replace(/[:.]/g,"-");xe.href=ne,xe.download=`youtube_analytics_${_e.replace(/\s+/g,"_")}_${Ie.replace(/\s+/g,"_")}_${me}.json`,xe.click(),URL.revokeObjectURL(ne),c(n("youtube_analytics.savedToDisk"),"success")},ot=()=>{d&&d(e.id,Ze.YOUTUBE,le.name||"YouTube Data")},at=V=>{var ne;const re=(ne=V.target.files)==null?void 0:ne[0];if(!re)return;const ze=new FileReader;ze.onload=xe=>{var _e;try{const Ie=JSON.parse((_e=xe.target)==null?void 0:_e.result);t(e.id,JSON.stringify(Ie)),c(n("youtube_analytics.loadedFromDisk"),"success")}catch{c(n("youtube_analytics.loadFailed"),"info")}},ze.readAsText(re),V.target&&(V.target.value="")},rt=V=>{const re=new Date,ze=new Date(re.getTime()-7*24*60*60*1e3),ne=new Date(re.getTime()-30*24*60*60*1e3),xe=V.videos.filter(me=>new Date(me.uploadDate)>=ze).length,_e=V.videos.filter(me=>new Date(me.uploadDate)>=ne).length;let Ie="0";if(V.stats.length>=2){const me=V.stats[V.stats.length-1],Ee=V.stats[V.stats.length-2],Ae=me.subscribers-Ee.subscribers;Ie=Ae>0?`+${Ae}`:`${Ae}`}return{videosWeek:xe,videosMonth:_e,growth:Ie}},Ce=le?rt(le):{videosWeek:0,growth:"0"},ve=G.reduce((V,re)=>V+rt(re).videosWeek,0),Ge=G.reduce((V,re)=>V+rt(re).videosMonth,0),ce=["100 Subscribers","1,000 Subscribers","Monetization (4k hours / 1k subs)","10,000 Subscribers","Silver Play Button (100k)","Gold Play Button (1M)","High Retention","Increase CTR","Regular Upload Schedule"],He=x.useMemo(()=>new Date().toLocaleString(),[]);return o.jsxs("div",{className:"flex flex-row h-full bg-gray-800/50 rounded-lg overflow-hidden",children:[o.jsxs("div",{className:"flex flex-col flex-1 h-full border-r border-gray-700 min-w-0",children:[o.jsxs("div",{className:"bg-gray-900 px-2 border-b border-gray-700 flex items-center space-x-2 flex-shrink-0 h-12",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap font-semibold",children:[n("youtube_analytics.authorName"),":"]}),o.jsx("input",{type:"text",value:z,onChange:V=>X({authorName:V.target.value}),className:"bg-gray-800 text-sm rounded p-1 border border-transparent focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 outline-none flex-grow text-emerald-300 font-medium transition-all",onFocus:r,placeholder:n("youtube_analytics.authorName")})]}),o.jsxs("div",{className:"flex items-center bg-gray-900 p-1 gap-1 overflow-x-auto custom-scrollbar flex-shrink-0",children:[G.map(V=>o.jsxs("div",{onClick:()=>X({activeChannelId:V.id}),className:`px-3 py-1.5 h-8 text-xs rounded-t-md cursor-pointer flex items-center gap-2 flex-shrink-0 transition-colors ${F===V.id?"bg-gray-800 text-emerald-400 font-bold":"bg-gray-900 hover:bg-gray-800 text-gray-400"}`,children:[F===V.id?o.jsx("input",{type:"text",value:V.name,onChange:re=>Te(V.id,{name:re.target.value}),className:"bg-transparent border-none focus:ring-0 p-0 text-emerald-400 font-bold w-24 text-xs focus:outline-none",onClick:re=>re.stopPropagation(),onFocus:r}):o.jsx("span",{children:V.name}),G.length>1&&o.jsx("button",{onClick:re=>he(re,V.id),className:"text-gray-500 hover:text-red-400",children:""})]},V.id)),o.jsx("button",{onClick:Oe,className:"px-2 text-gray-400 hover:text-emerald-400 font-bold text-lg",children:"+"})]}),le&&o.jsxs("div",{className:"p-2 bg-gray-900/50 border-b border-gray-700 grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"col-span-2",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block cursor-pointer select-none hover:text-gray-300 transition-colors",onClick:()=>M(!I),children:"Description"}),o.jsx(Pe,{title:I?"Expand":"Collapse",onClick:V=>{V.stopPropagation(),M(!I)},tooltipPosition:"left",children:I?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!I&&o.jsx("textarea",{value:le.description||"",onChange:V=>Te(le.id,{description:V.target.value}),className:"w-full bg-gray-800 text-xs rounded p-1 border border-transparent focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 outline-none text-white transition-all resize-none h-[80px] custom-scrollbar",placeholder:"Channel description...",onFocus:r,onWheel:V=>V.stopPropagation()})]}),o.jsxs("div",{className:"col-span-2",children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block mb-1",children:"Goal"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("input",{list:`goal-options-${e.id}`,type:"text",value:le.goal||"",onChange:V=>Te(le.id,{goal:V.target.value}),className:"flex-grow bg-gray-800 text-xs rounded p-1 border border-transparent focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 outline-none text-white transition-all",placeholder:"e.g. 1000 Subscribers",onFocus:r}),o.jsx("datalist",{id:`goal-options-${e.id}`,children:ce.map(V=>o.jsx("option",{value:V},V))}),Y&&le.goal!==Y&&o.jsx("button",{onClick:ye,className:"bg-emerald-600 hover:bg-emerald-500 text-white text-[10px] font-bold px-2 rounded animate-pulse",title:`Accept Suggestion: ${Y}`,children:"Accept"})]}),Y&&le.goal!==Y&&o.jsxs("div",{className:"text-[10px] text-emerald-400 mt-1",children:["Suggestion: ",Y]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block mb-1",children:"Current Subs"}),o.jsx("input",{type:"number",value:le.currentSubscribers||"",onChange:V=>Te(le.id,{currentSubscribers:parseInt(V.target.value)||0}),className:"w-full bg-gray-800 text-xs rounded p-1 border border-transparent focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 outline-none text-white transition-all",placeholder:"0",onFocus:r})]}),o.jsx("div",{className:"flex flex-col justify-end",children:o.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer bg-gray-800 p-1 rounded border border-gray-700 h-[26px]",children:[o.jsx("input",{type:"checkbox",checked:le.isMonetized||!1,onChange:V=>Te(le.id,{isMonetized:V.target.checked}),className:"form-checkbox h-3.5 w-3.5 text-emerald-500 rounded border-gray-500 bg-gray-900 focus:ring-0"}),o.jsx("span",{className:"text-[10px] text-gray-300 font-bold uppercase select-none",children:"Monetization"})]})})]}),o.jsxs("div",{className:"flex-grow flex flex-col p-2 min-h-0",children:[o.jsx("div",{className:"flex space-x-1 mb-2",children:["all","long","shorts"].map(V=>o.jsx("button",{onClick:()=>A(V),className:`px-2 py-1 text-[10px] font-bold uppercase rounded ${T===V?"bg-emerald-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:V},V))}),g&&g.some(V=>V.toNodeId===e.id)&&o.jsxs("div",{className:"bg-gray-900/80 border border-emerald-500/30 rounded-md p-2 mb-2 flex flex-col gap-2 shadow-lg flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h4",{className:"text-xs font-bold text-emerald-400 uppercase tracking-wider",children:n("youtube_analytics.incomingData")}),o.jsx("button",{onClick:pe,className:"text-gray-400 hover:text-white",title:n("node.action.refreshData"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),N?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"text-sm text-white font-semibold truncate",title:N.title,children:N.title}),N.description&&o.jsx("div",{className:"text-xs text-gray-400 line-clamp-2",children:N.description}),o.jsx("button",{onClick:ue,className:"w-full bg-emerald-700 hover:bg-emerald-600 text-white text-xs py-1 rounded font-bold transition-colors",children:n("youtube_analytics.addToChannel")})]}):o.jsx("div",{className:"text-xs text-gray-500 italic",children:n("youtube_analytics.noIncomingData")})]}),o.jsx("div",{onDragOver:j,onDragLeave:q,onDrop:Q,className:`flex-shrink-0 h-16 border-2 border-dashed rounded-lg flex flex-col items-center justify-center mb-2 transition-colors ${m?"border-emerald-400 bg-emerald-900/20":"border-gray-600 hover:border-gray-500 bg-gray-800/50"}`,children:o.jsx("p",{className:"text-xs text-gray-400 pointer-events-none text-center px-2",children:n("youtube_analytics.dragDrop")})}),o.jsxs("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-2",onWheel:V=>V.stopPropagation(),children:[ee.map(V=>o.jsxs("div",{className:"flex gap-2 bg-gray-900/50 p-2 rounded-md group relative hover:bg-gray-800 transition-colors",onDragOver:re=>{re.preventDefault(),re.stopPropagation()},onDrop:re=>fe(re,V.id),children:[o.jsxs("div",{className:"w-20 h-12 bg-black flex-shrink-0 rounded overflow-hidden relative group/thumb",children:[V.thumbnailBase64?o.jsx("img",{src:`data:image/png;base64,${V.thumbnailBase64}`,className:"w-full h-full object-cover",alt:"Thumb"}):o.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-600 text-[9px]",children:"No Image"}),o.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity pointer-events-none",children:o.jsx("span",{className:"text-[8px] text-white",children:"Drop Image"})}),V.isShort&&o.jsx("div",{className:"absolute bottom-0 right-0 bg-red-600 text-white text-[8px] px-1 font-bold",children:"SHORTS"})]}),o.jsxs("div",{className:"flex-grow min-w-0 flex flex-col justify-between",children:[o.jsxs("div",{className:"flex justify-between items-start gap-1",children:[o.jsx("input",{type:"text",value:V.title,onChange:re=>ie(V.id,{title:re.target.value}),placeholder:n("youtube_analytics.videoTitle"),className:"bg-transparent border border-transparent rounded p-0.5 -ml-1 text-sm text-white font-medium focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 focus:bg-gray-800 w-full transition-all outline-none",onFocus:r}),o.jsx("input",{type:"checkbox",checked:!!V.isShort,onChange:re=>ie(V.id,{isShort:re.target.checked}),className:"form-checkbox h-3 w-3 text-red-500 rounded border-gray-600 bg-gray-800 flex-shrink-0 mt-1",title:"Mark as Shorts"})]}),o.jsx("textarea",{value:V.description||"",onChange:re=>ie(V.id,{description:re.target.value}),placeholder:"Description...",className:"bg-transparent border border-transparent rounded p-0.5 -ml-1 text-xs text-gray-400 w-full resize-none focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 focus:bg-gray-800 focus:text-gray-300 transition-all outline-none",rows:1,onFocus:r}),o.jsxs("div",{className:"flex justify-between items-end mt-1",children:[o.jsx("span",{className:"text-xs text-gray-500",children:new Date(V.uploadDate).toLocaleString()}),o.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("input",{type:"number",placeholder:n("youtube_analytics.views"),value:V.views||"",onChange:re=>ie(V.id,{views:parseInt(re.target.value)||0}),className:"w-16 bg-gray-800 text-xs p-0.5 rounded text-right text-gray-300 border border-gray-700 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all",onFocus:r}),o.jsx("button",{onClick:()=>Z(V.id),className:"text-gray-500 hover:text-red-400",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]},V.id)),ee.length===0&&o.jsx("p",{className:"text-center text-xs text-gray-500 mt-4",children:n("youtube_analytics.noVideos")})]})]}),o.jsxs("div",{className:"bg-gray-900 p-2 flex flex-col gap-2 border-t border-gray-700 flex-shrink-0 mt-auto",children:[o.jsxs("div",{className:"bg-gray-800/50 p-2 rounded-md border border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400",children:n("youtube_analytics.statsTrend")}),o.jsx("div",{className:"text-[10px] text-gray-500 font-mono bg-gray-800 px-1 rounded",children:He})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsxs("label",{className:"flex items-center text-[10px] text-emerald-400 space-x-1 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:E,onChange:V=>P(V.target.checked),className:"form-checkbox h-3 w-3 text-emerald-600 rounded focus:ring-0 border-gray-600 bg-gray-800"}),o.jsx("span",{children:"Subs"})]}),o.jsxs("label",{className:"flex items-center text-[10px] text-cyan-400 space-x-1 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:L,onChange:V=>H(V.target.checked),className:"form-checkbox h-3 w-3 text-cyan-600 rounded focus:ring-0 border-gray-600 bg-gray-800"}),o.jsx("span",{children:"Views"})]}),o.jsxs("label",{className:"flex items-center text-[10px] text-purple-400 space-x-1 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:$,onChange:V=>U(V.target.checked),className:"form-checkbox h-3 w-3 text-purple-600 rounded focus:ring-0 border-gray-600 bg-gray-800"}),o.jsx("span",{children:"Vids"})]})]})]}),o.jsx(W5,{stats:(le==null?void 0:le.stats)||[],videos:(le==null?void 0:le.videos)||[],showSubs:E,showViews:L,showVideos:$})]}),o.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 px-2",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"block text-[10px] text-gray-500 uppercase",children:n("youtube_analytics.currentChannel")}),o.jsxs("span",{className:"text-white font-bold",children:[Ce.videosWeek," videos/wk"]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"block text-[10px] text-gray-500 uppercase",children:n("youtube_analytics.growth")}),o.jsxs("span",{className:`${parseInt(Ce.growth)>0?"text-green-400":"text-gray-300"}`,children:[Ce.growth," subs"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("span",{className:"block text-[10px] text-gray-500 uppercase",children:n("youtube_analytics.allChannels")}),o.jsxs("span",{className:"text-emerald-400 font-bold",children:[ve," vids/wk  |  ",Ge," vids/mo"]})]})]}),o.jsxs("div",{className:"flex gap-2 border-t border-gray-800 pt-2",children:[o.jsx("button",{onClick:Fe,className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-1 rounded transition-colors",children:n("youtube_analytics.saveDisk")}),o.jsx("button",{onClick:ot,className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-1 rounded transition-colors",children:n("youtube_analytics.saveCatalog")}),o.jsxs("label",{className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-1 rounded transition-colors text-center cursor-pointer",children:[n("youtube_analytics.loadDisk"),o.jsx("input",{type:"file",accept:".json",onChange:at,className:"hidden",ref:O})]})]})]})]}),o.jsxs("div",{className:"flex flex-col flex-1 h-full border-r border-gray-700 min-w-0 bg-gray-900/20",children:[o.jsxs("div",{className:"flex flex-col bg-gray-900 px-2 pt-2 pb-2 border-b border-gray-700 gap-2",children:[o.jsxs("div",{className:"w-full",children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block mb-1",children:"Context / Question"}),o.jsx("textarea",{value:W,onChange:V=>X({contextPrompt:V.target.value}),className:"w-full bg-gray-800 text-xs rounded p-2 border border-gray-700 focus:border-emerald-500 outline-none text-white resize-y custom-scrollbar",placeholder:"Add specific context or ask a question for the analysis...",rows:2,onFocus:r,onWheel:V=>V.stopPropagation()})]}),o.jsxs("div",{className:"flex items-center h-8",children:[o.jsxs("div",{className:"flex items-center space-x-1 mr-2 h-full",children:[o.jsx("button",{onClick:()=>X({targetLanguage:"ru"}),className:`px-2 h-full rounded text-xs font-bold transition-colors ${ge==="ru"?"bg-emerald-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"RU"}),o.jsx("button",{onClick:()=>X({targetLanguage:"en"}),className:`px-2 h-full rounded text-xs font-bold transition-colors ${ge==="en"?"bg-emerald-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"EN"})]}),o.jsx("button",{onClick:()=>a&&a(e.id),disabled:i||s,className:`flex-grow h-full px-3 text-xs font-bold uppercase tracking-wider rounded transition-colors ${i?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500 text-white"}`,children:n(i?"youtube_analytics.analyzing":"youtube_analytics.askAI")})]})]}),ae?o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar p-2",onWheel:V=>V.stopPropagation(),children:o.jsx(Y5,{advice:ae,addToast:c})}):o.jsx("div",{className:"flex-grow flex items-center justify-center text-xs text-gray-600 italic p-4 text-center",children:n(i?"youtube_analytics.analyzing":"youtube_analytics.clickForAdvice")})]}),o.jsxs("div",{className:"w-80 flex flex-col p-2 border-l border-gray-700 bg-gray-900/20 flex-shrink-0 gap-2 overflow-hidden",children:[o.jsxs("div",{className:"flex flex-col bg-gray-900/30 rounded-md border border-gray-700/50 overflow-hidden h-1/3 flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-900/50 border-b border-gray-700/50",children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:n("youtube_analytics.dailyNotes")}),o.jsx("button",{onClick:Le,className:"text-emerald-400 hover:text-emerald-300 bg-gray-800 rounded px-2 py-0.5 text-sm font-bold",children:"+"})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto custom-scrollbar p-2 space-y-2",onWheel:V=>V.stopPropagation(),children:[K.map(V=>o.jsxs("div",{className:"bg-gray-800 rounded p-2 flex flex-col space-y-1 group",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-[10px] text-emerald-500 font-mono",children:V.date}),o.jsx("button",{onClick:()=>Ue(V.id),className:"text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]}),o.jsx("textarea",{value:V.content,onChange:re=>je(V.id,re.target.value),className:"w-full bg-transparent border border-transparent rounded text-xs text-gray-300 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 p-1 resize-y h-[90px] min-h-[90px] transition-colors outline-none",placeholder:"Write a note...",rows:3,onFocus:r})]},V.id)),K.length===0&&o.jsx("p",{className:"text-center text-[10px] text-gray-600 mt-4",children:n("youtube_analytics.noNotes")})]})]}),o.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-md space-y-2 flex-shrink-0 border border-emerald-500/20",children:[o.jsx("h4",{className:"text-xs font-bold text-emerald-400 uppercase",children:n("youtube_analytics.logDailyStats")}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-gray-400 block",children:n("youtube_analytics.subscribers")}),o.jsx("input",{type:"number",value:y,onChange:V=>b(V.target.value),className:"w-full bg-gray-800 text-sm rounded p-1 border border-gray-700 focus:border-emerald-500 outline-none",onFocus:r})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-gray-400 block",children:"Long Views"}),o.jsx("input",{type:"number",value:S,onChange:V=>_(V.target.value),className:"w-full bg-gray-800 text-sm rounded p-1 border border-gray-700 focus:border-emerald-500 outline-none",onFocus:r,placeholder:"Video Views"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-gray-400 block",children:"Shorts Views"}),o.jsx("input",{type:"number",value:v,onChange:V=>f(V.target.value),className:"w-full bg-gray-800 text-sm rounded p-1 border border-gray-700 focus:border-emerald-500 outline-none",onFocus:r,placeholder:"Shorts Views"})]})]}),o.jsxs("div",{className:"text-[10px] text-right text-gray-500",children:["Monthly Views (Sum): ",(parseInt(S)||0)+(parseInt(v)||0)]}),o.jsx("button",{onClick:R,className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold py-1 rounded transition-colors",children:n("youtube_analytics.updateStats")})]}),o.jsxs("div",{className:"bg-gray-900/30 p-2 rounded-md flex-grow overflow-y-auto custom-scrollbar border border-gray-700/50 min-h-0",onWheel:V=>V.stopPropagation(),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-2 sticky top-0 bg-gray-900/90 py-1 z-10",children:n("youtube_analytics.history")}),le!=null&&le.stats&&le.stats.length>0?o.jsx("div",{className:"space-y-1",children:[...le.stats].reverse().map((V,re)=>o.jsxs("div",{className:"flex flex-col justify-between text-[10px] bg-gray-800/50 p-1.5 rounded hover:bg-gray-800 gap-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-gray-300 font-mono font-bold",children:V.date}),o.jsx("button",{onClick:()=>be(V.date),className:"text-gray-500 hover:text-red-400 ml-1",children:""})]}),o.jsxs("div",{className:"flex gap-2 text-gray-400",children:[o.jsxs("span",{className:"text-emerald-400",children:["S: ",V.subscribers]}),o.jsxs("span",{className:"text-cyan-400",title:"Total Views",children:["V: ",V.totalViews]})]}),(V.longViews!==void 0||V.shortsViews!==void 0)&&o.jsxs("div",{className:"flex gap-2 text-[9px] text-gray-500 border-t border-gray-700 pt-1 mt-0.5",children:[o.jsxs("span",{title:"Long Views",children:["L: ",V.longViews||0]}),o.jsxs("span",{title:"Shorts Views",children:["Sh: ",V.shortsViews||0]})]})]},V.date))}):o.jsx("p",{className:"text-center text-[10px] text-gray-600",children:n("youtube_analytics.noHistory")})]})]})]})},K5=40,J5=({node:e,t,addToast:n,onMouseDown:r,onTouchStart:a,onNodeDoubleClick:i,onValueChange:s,onReadData:l,onPasteNodeValue:c,onCopyNodeValue:d,onCutConnections:h,onDeleteNode:g,onDuplicateNode:m,onDuplicateNodeEmpty:w,onRenameNode:y})=>{const{saveDataToCatalog:b,handleToggleNodeOutputVisibility:S,setNodes:_}=Qo(),v=e.type===C.REROUTE_DOT,f={[C.TEXT_INPUT]:t("node.help.text_input"),[C.PROMPT_PROCESSOR]:t("node.help.prompt_processor"),[C.PROMPT_ANALYZER]:t("node.help.prompt_analyzer"),[C.CHARACTER_ANALYZER]:t("node.help.character_analyzer"),[C.CHARACTER_GENERATOR]:t("node.help.character_generator"),[C.IMAGE_GENERATOR]:t("node.help.image_generator"),[C.IMAGE_PREVIEW]:t("node.help.image_preview"),[C.CHARACTER_CARD]:t("node.help.character_card"),[C.GEMINI_CHAT]:t("node.help.gemini_chat"),[C.TRANSLATOR]:t("node.help.translator"),[C.SCRIPT_GENERATOR]:t("node.help.script_generator"),[C.SCRIPT_ANALYZER]:t("node.help.script_analyzer"),[C.SCRIPT_PROMPT_MODIFIER]:t("node.help.script_prompt_modifier"),[C.ERROR_ANALYZER]:t("node.help.error_analyzer"),[C.NOTE]:t("node.help.note"),[C.REROUTE_DOT]:t("node.help.reroute_dot"),[C.DATA_READER]:t("node.help.data_reader"),[C.SPEECH_SYNTHESIZER]:t("node.help.speech_synthesizer"),[C.IDEA_GENERATOR]:t("node.help.idea_generator"),[C.NARRATOR_TEXT_GENERATOR]:t("node.help.narrator_text_generator"),[C.AUDIO_TRANSCRIBER]:t("node.help.audio_transcriber"),[C.YOUTUBE_TITLE_GENERATOR]:t("node.help.youtube_title_generator"),[C.MUSIC_IDEA_GENERATOR]:t("node.help.music_idea_generator"),[C.YOUTUBE_ANALYTICS]:t("node.help.youtube_analytics"),[C.IMAGE_EDITOR]:t("node.help.image_editor")},T=()=>{let E={};try{E=JSON.parse(e.value||"{}")}catch{}let P;switch(e.type){case C.PROMPT_ANALYZER:P={...E,environment:"",characters:[],action:"",style:""};break;case C.CHARACTER_ANALYZER:P={...E,character:"",clothing:""};break;case C.CHARACTER_GENERATOR:P={...E,prompt:"",characters:[],error:null};break;case C.CHARACTER_CARD:P=[{id:`char-card-${Date.now()}`,name:"",index:"Entity-1",imageSources:{},prompt:"",fullDescription:"",selectedRatio:"1:1"}];break;case C.GEMINI_CHAT:P={messages:[],currentInput:""};break;case C.SCRIPT_GENERATOR:P={...E,prompt:"",summary:"",detailedCharacters:[],scenes:[],generatedStyle:""};break;case C.SCRIPT_ANALYZER:P={...E,characters:[],scenes:[],visualStyle:"",generatedStyle:"",detailedCharacters:[]};break;case C.SCRIPT_PROMPT_MODIFIER:P={...E,finalPrompts:[],videoPrompts:[],generationProgress:null,usedCharacters:[],styleOverride:"",sceneContexts:{}};break;case C.NARRATOR_TEXT_GENERATOR:P={...E,prompt:"",generatedTexts:{ru:"",en:""}};break;case C.SPEECH_SYNTHESIZER:P={...E,audioFiles:[]};break;case C.IDEA_GENERATOR:P={...E,theme:"",stage:"initial",categories:null,selection:{action:null,place:null,obstacle:null},generatedIdea:""};break;case C.YOUTUBE_ANALYTICS:P={...E,channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}],activeChannelId:"default",aiAdvice:""};break;case C.MUSIC_IDEA_GENERATOR:P={...E,idea:"",generatedLyrics:{},generatedMusicPrompts:{},generatedTitles:{}};break;case C.AUDIO_TRANSCRIBER:P={audioBase64:null,mimeType:null,transcription:"",segments:[],fileName:null};break;case C.TEXT_INPUT:case C.NOTE:case C.ERROR_ANALYZER:s(e.id,""),n(t("toast.cleared")),l&&l(e.id);return;default:s(e.id,JSON.stringify({})),n(t("toast.cleared")),l&&l(e.id);return}s(e.id,JSON.stringify(P)),n(t("toast.cleared")),l&&setTimeout(()=>l(e.id),50)},A=()=>{try{let E=JSON.parse(e.value||"[]");Array.isArray(E)||(Object.keys(E).length>0?E=[E]:E=[]);let P=0;const L=/^New Entity\s*(\d*)$/i;E.forEach(G=>{const F=(G.name||"").match(L);if(F){const K=F[1]?parseInt(F[1],10):1;K>P&&(P=K)}});const H=`New Entity ${P+1}`;let $=0;const U=/^(?:Entity|Character)-(\d+)$/i;E.forEach(G=>{const F=(G.index||"").match(U);if(F){const K=parseInt(F[1],10);K>$&&($=K)}});const O=`Entity-${$+1}`,D={id:`char-card-${Date.now()}`,name:H,index:O,image:null,imageSources:{},thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!1,isDescriptionCollapsed:!1,isImageCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"},z=[...E,D];s(e.id,JSON.stringify(z)),_(G=>G.map(F=>F.id===e.id?{...F,width:Math.max(460,z.length*jr)}:F))}catch(E){console.error("Failed to add character card:",E)}},M=(()=>{switch(e.type){case C.CHARACTER_GENERATOR:return Ze.CHARACTERS;case C.CHARACTER_CARD:return Ze.CHARACTERS;case C.SCRIPT_GENERATOR:return Ze.SCRIPT;case C.SCRIPT_ANALYZER:return Ze.ANALYSIS;case C.SCRIPT_PROMPT_MODIFIER:return Ze.FINAL_PROMPTS;case C.YOUTUBE_TITLE_GENERATOR:return Ze.YOUTUBE;case C.YOUTUBE_ANALYTICS:return Ze.YOUTUBE;case C.MUSIC_IDEA_GENERATOR:return Ze.MUSIC;default:return null}})(),N=()=>{if(!b||!M)return;const E=new Date,P=E.getFullYear(),L=String(E.getMonth()+1).padStart(2,"0"),H=String(E.getDate()).padStart(2,"0"),$=String(E.getHours()).padStart(2,"0"),U=String(E.getMinutes()).padStart(2,"0"),O=String(E.getSeconds()).padStart(2,"0"),D=`${P}-${L}-${H} ${$}:${U}:${O}`,z=`${e.title} (${D})`;b(e.id,M,z)},k=v?"bg-transparent":e.type===C.NOTE?"bg-transparent border-b border-gray-700/50":"bg-gray-700";return o.jsx("div",{className:`${k} node-header text-white font-bold p-2 ${v?"":e.isCollapsed?"rounded-lg":"rounded-t-lg"} flex justify-between items-center ${v?"":"cursor-move"} flex-shrink-0`,onMouseDown:v?void 0:r,onTouchStart:v?void 0:a,onDoubleClick:E=>{E.stopPropagation(),i(e.id)},style:{height:v?"100%":`${K5}px`,zIndex:10},children:v?o.jsx("div",{className:"w-full h-full flex justify-center items-center",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[o.jsx(Pe,{title:e.isCollapsed?t("node.action.expand"):t("node.action.collapse"),onClick:()=>i(e.id),children:e.isCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("span",{className:"truncate pr-2",children:e.title})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[e.type===C.SCRIPT_PROMPT_MODIFIER&&o.jsx(Pe,{title:e.areOutputHandlesHidden?"Show Outputs":"Hide Outputs",onClick:()=>S(e.id),children:e.areOutputHandlesHidden?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),o.jsx(ht,{title:f[e.type]||"No help available.",position:"top",contentClassName:"w-56 whitespace-normal text-left leading-relaxed",children:o.jsx("button",{onMouseDown:E=>E.stopPropagation(),className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-emerald-500","aria-label":t("node.action.help"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),o.jsx(Pe,{title:t("node.action.rename"),onClick:()=>y(e.id,e.title),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.type===C.CHARACTER_CARD&&o.jsx(Pe,{title:t("node.action.addCharacter"),onClick:A,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),M&&o.jsx(Pe,{title:t("group.saveToCatalog"),onClick:N,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),(e.type===C.SCRIPT_GENERATOR||e.type===C.SCRIPT_ANALYZER||e.type===C.SCRIPT_PROMPT_MODIFIER||e.type===C.YOUTUBE_ANALYTICS||e.type===C.YOUTUBE_TITLE_GENERATOR||e.type===C.CHARACTER_CARD||e.type===C.MUSIC_IDEA_GENERATOR)&&o.jsx(Pe,{title:t("catalog.card.save"),onClick:()=>{try{const E=JSON.parse(e.value||"{}");let P="",L="data.json",H=E;const $=new Date,U=$.getFullYear(),O=String($.getMonth()+1).padStart(2,"0"),D=String($.getDate()).padStart(2,"0"),z=String($.getHours()).padStart(2,"0"),G=String($.getMinutes()).padStart(2,"0"),F=String($.getSeconds()).padStart(2,"0"),K=`${U}-${O}-${D}_${z}-${G}-${F}`;if(e.type===C.SCRIPT_GENERATOR)P="script-generator-data",L=`script_generated_${K}.json`;else if(e.type===C.SCRIPT_ANALYZER)P="script-analyzer-data",L=`script_analysis_${K}.json`;else if(e.type===C.SCRIPT_PROMPT_MODIFIER)P="script-prompt-modifier-data",L=`final_prompts_${K}.json`,H={finalPrompts:E.finalPrompts||[],videoPrompts:E.videoPrompts||[],usedCharacters:E.usedCharacters||[],sceneContexts:E.sceneContexts||{},visualStyle:E.styleOverride||""};else if(e.type===C.YOUTUBE_ANALYTICS)P="youtube-analytics-data",L=`youtube_analytics_${K}.json`;else if(e.type===C.YOUTUBE_TITLE_GENERATOR)P="youtube-title-data",L=`youtube_titles_${K}.json`;else if(e.type===C.MUSIC_IDEA_GENERATOR)P="music-idea-data",L=`music_ideas_${K}.json`;else if(e.type===C.CHARACTER_CARD){P="character-card";const X=Array.isArray(E)?E:[E];L=`${(X.length===1?X[0].name||"Entity":"Entity_Collection").replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_")}_${K}.json`,H=X.map(he=>{const ye={},j=["1:1","16:9","9:16"],q=he.thumbnails||he.imageSources||{};j.forEach(J=>{let oe=q[J];J==="1:1"&&!oe&&(oe=he.image||he.imageBase64),oe?ye[J]=oe.startsWith("data:image")?oe:`data:image/png;base64,${oe}`:ye[J]=null});let Q=ye["1:1"]||null;if(!Q&&(he.image||he.imageBase64)){const J=he.image||he.imageBase64;Q=J.startsWith("data:image")?J:`data:image/png;base64,${J}`,ye["1:1"]||(ye["1:1"]=Q)}return{type:P,id:he.id||`char-card-${Date.now()}-${Math.random()}`,name:he.name,index:he.index||he.alias||"Entity-1",image:Q,selectedRatio:he.selectedRatio||"1:1",prompt:he.prompt||"",fullDescription:he.fullDescription||"",nodeTitle:e.title,imageSources:ye,additionalPrompt:he.additionalPrompt,targetLanguage:he.targetLanguage,isOutput:he.isOutput}})}const ae=e.type===C.CHARACTER_CARD?H:{type:P,title:e.title,...H},Y=JSON.stringify(ae,null,2),ge=new Blob([Y],{type:"application/json"}),W=URL.createObjectURL(ge),le=document.createElement("a");le.href=W,le.download=L,le.click(),URL.revokeObjectURL(W)}catch(E){console.error("Failed to download data:",E)}},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(e.type===C.TEXT_INPUT||e.type===C.NOTE||e.type===C.CHARACTER_CARD)&&o.jsx(Pe,{title:t("node.action.paste"),onClick:()=>{c(e.id),n(t("toast.pasted"))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),o.jsx(Pe,{title:t("node.action.copy"),onClick:()=>{d(e.id),n(t("toast.copied"))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(e.type===C.PROMPT_ANALYZER||e.type===C.CHARACTER_ANALYZER||e.type===C.SCRIPT_GENERATOR||e.type===C.SCRIPT_ANALYZER||e.type===C.CHARACTER_GENERATOR||e.type===C.SCRIPT_PROMPT_MODIFIER||e.type===C.CHARACTER_CARD||e.type===C.TEXT_INPUT||e.type===C.NOTE||e.type===C.ERROR_ANALYZER||e.type===C.NARRATOR_TEXT_GENERATOR||e.type===C.SPEECH_SYNTHESIZER||e.type===C.IDEA_GENERATOR||e.type===C.YOUTUBE_ANALYTICS||e.type===C.YOUTUBE_TITLE_GENERATOR||e.type===C.MUSIC_IDEA_GENERATOR||e.type===C.GEMINI_CHAT||e.type===C.AUDIO_TRANSCRIBER)&&o.jsx(Pe,{title:t("node.action.clear"),onClick:T,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx(Pe,{title:t("node.action.duplicateWithContent"),onClick:()=>m(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),o.jsx(Pe,{title:t("node.action.duplicateEmpty"),onClick:()=>w(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21h10a2 2 0 002-2V7.414a1 1 0 00-.293-.707l-4.414-4.414A1 1 0 0013.586 2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.type!==C.NOTE&&e.type!==C.IMAGE_PREVIEW&&o.jsx(Pe,{title:t("node.action.cutConnections"),onClick:()=>{h(e.id),n(t("toast.connectionsCut"))},children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121M12 12L4.5 4.5"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l.707-.707M19.5 4.5l-.707.707"})]})}),o.jsx(Pe,{title:t("node.action.close"),onClick:()=>{g(e.id)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},X5=({onResizeMouseDown:e,onResizeTouchStart:t})=>o.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize group",onMouseDown:e,onTouchStart:t,style:{zIndex:13},children:o.jsx("div",{className:"w-full h-full border-r-2 border-b-2 border-gray-600 group-hover:border-emerald-400 transition-colors rounded-br-lg"})}),Mn=({id:e,title:t,color:n,handleCursor:r,position:a,style:i,onMouseDown:s,onTouchStart:l})=>{const[c,d]=x.useState(!1),h=a==="left"?"left-full ml-1.5":"right-full mr-1.5",g={...i,position:"absolute",display:"flex",alignItems:"center",zIndex:16};return a==="left"?g.left="-10px":g.right="-10px",o.jsxs("div",{style:g,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[o.jsx("div",{id:e,onMouseDown:s,onTouchStart:l,className:`w-5 h-5 ${n} rounded-full border-2 border-gray-900 flex-shrink-0`,style:{cursor:r}}),o.jsx("div",{className:`absolute px-2 py-1 bg-gray-900 text-gray-200 text-xs font-medium whitespace-nowrap rounded shadow-xl z-[100] transition-opacity duration-200 pointer-events-none ${h} ${c?"opacity-100":"opacity-0"}`,role:"tooltip",children:t})]})},Ts=40,li=10,Z5=({node:e,getHandleColor:t,handleCursor:n,isCollapsed:r,t:a})=>{if(r){let c=[];if(e.type===C.SCRIPT_GENERATOR)c=[{handleId:"prompt",type:"text",title:a("node.content.scriptPromptPlaceholder")},{handleId:"characters",type:"text",title:a("node.content.characters")}];else if(e.type===C.SCRIPT_PROMPT_MODIFIER)c=[{handleId:"all-script-analyzer-data",type:"text",title:a("node.content.allScriptAnalyzerData")},{handleId:"style",type:"text",title:a("node.content.style")}];else if(e.type===C.SCRIPT_ANALYZER)c=[{handleId:void 0,type:"text",title:a("node.input.default")}];else{const d=Kr(e);(d!==null||e.type===C.REROUTE_DOT)&&(c=[{handleId:void 0,type:d,title:a("node.input.default")}])}return o.jsx(o.Fragment,{children:c.map((d,h)=>o.jsx(Mn,{id:`handle-in-${e.id}-${d.handleId||"default"}`,title:d.title,color:t(d.type,d.handleId),handleCursor:n,position:"left",style:{top:`${(h+1)*(Ts/(c.length+1))}px`,transform:"translateY(-50%)"}},d.handleId||`input-${h}`))})}if(e.type===C.SCRIPT_GENERATOR){const c=[{handleId:"prompt",title:a("node.content.scriptPromptPlaceholder"),y_pos:95},{handleId:"characters",title:a("node.content.characters"),y_pos:330}];return o.jsx(o.Fragment,{children:c.map(d=>{const h=Math.max(Ts+li,Math.min(d.y_pos,e.height-li));return o.jsx(Mn,{id:`handle-in-${e.id}-${d.handleId}`,title:d.title,color:t("text",d.handleId),handleCursor:n,position:"left",style:{top:`${h}px`,transform:"translateY(-50%)"}},d.handleId)})})}if(e.type===C.SCRIPT_PROMPT_MODIFIER){const c=[{handleId:"all-script-analyzer-data",title:a("node.content.allScriptAnalyzerData"),y_pos_ratio:.3333333333333333},{handleId:"style",title:a("node.content.style"),y_pos_ratio:.6666666666666666}];return o.jsx(o.Fragment,{children:c.map(d=>{const h=e.height*d.y_pos_ratio,g=Math.max(Ts+li,Math.min(h,e.height-li));return o.jsx(Mn,{id:`handle-in-${e.id}-${d.handleId}`,title:d.title,color:t("text",d.handleId),handleCursor:n,position:"left",style:{top:`${g}px`,transform:"translateY(-50%)"}},d.handleId)})})}const i=Kr(e);if(i===null&&e.type!==C.REROUTE_DOT)return null;const s=e.height/2,l=Math.max(Ts/2,Math.min(s,e.height-li));return o.jsx(Mn,{id:`handle-in-${e.id}-default`,title:a("node.input.default"),color:t(i,void 0),handleCursor:n,position:"left",style:{top:`${l}px`,transform:"translateY(-50%)"}})},tn=40,ia=12,bn=10,Q5=({node:e,getHandleColor:t,handleCursor:n,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,isCollapsed:i,t:s})=>{if(e.areOutputHandlesHidden)return null;let l=[];const c=Ga(e);if(i){if(e.type===C.PROMPT_ANALYZER){let d=[];try{d=JSON.parse(e.value||"{}").characters||[]}catch{}l=["environment",...Array.from({length:Math.max(1,d.length)},(g,m)=>`character-${m}`),"action","style"].map(g=>({handleId:g,type:"text",title:g.replace("-"," ")}))}else if(e.type===C.CHARACTER_ANALYZER)l=[{handleId:"character",type:"text",title:"Character"},{handleId:"clothing",type:"text",title:"Clothing"}];else if(e.type===C.SCRIPT_GENERATOR){l.push({handleId:"all-script-parts",type:"text",title:s("node.content.allScriptParts")});let d={};try{d=JSON.parse(e.value||"{}")}catch{}(d.scenes||[]).some(m=>m.narratorText&&m.narratorText.trim()!=="")&&l.push({handleId:"all-narrator-text",type:"text",title:s("node.content.allNarratorData")})}else e.type===C.CHARACTER_CARD?l=[{handleId:"all-characters",type:"text",title:s("node.output.allCharacters")},{handleId:"primary-character",type:"text",title:s("node.output.primaryCharacter")}]:(c!==null||e.type===C.REROUTE_DOT)&&(l=[{handleId:void 0,type:c,title:s("node.output.default")}]);return o.jsx(o.Fragment,{children:l.map((d,h)=>o.jsx(Mn,{id:`handle-out-${e.id}-${d.handleId||"default"}`,title:d.title,color:t(d.type,d.handleId),handleCursor:n,position:"right",style:{top:`${(h+1)*(tn/(l.length+1))}px`,transform:"translateY(-50%)"},onMouseDown:g=>{g.stopPropagation(),r(g,e.id,d.handleId)},onTouchStart:g=>{g.stopPropagation(),a(g,e.id,d.handleId)}},d.handleId||`output-${h}`))})}switch(e.type){case C.PROMPT_ANALYZER:let d=[];try{d=JSON.parse(e.value||"{}").characters||[]}catch{}const h=Math.max(1,d.length),g=3+h,m=["environment",...Array.from({length:h},(k,E)=>`character-${E}`),"action","style"],w=40,y=8,b=tn+ia,_=e.height-ia-w-y-b;return o.jsx(o.Fragment,{children:m.map((k,E)=>{const P=b+_/g*(E+.5),L=Math.max(tn+bn,Math.min(P,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${k}`,title:k.replace("-"," "),color:t("text",k),handleCursor:n,position:"right",style:{top:`${L}px`,transform:"translateY(-50%)"},onMouseDown:H=>{H.stopPropagation(),r(H,e.id,k)},onTouchStart:H=>{H.stopPropagation(),a(H,e.id,k)}},k)})});case C.CHARACTER_ANALYZER:const v=["character","clothing"],f=2,T=40,A=8,I=tn+ia,N=e.height-ia-T-A-I;return o.jsx(o.Fragment,{children:v.map((k,E)=>{const P=I+N/f*(E+.5),L=Math.max(tn+bn,Math.min(P,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${k}`,title:k,color:t("text",k),handleCursor:n,position:"right",style:{top:`${L}px`,transform:"translateY(-50%)"},onMouseDown:H=>{H.stopPropagation(),r(H,e.id,k)},onTouchStart:H=>{H.stopPropagation(),a(H,e.id,k)}},k)})});case C.CHARACTER_GENERATOR:{let k=[];try{k=JSON.parse(e.value||"{}").characters||[]}catch{}const E=[];k.forEach((H,$)=>{const U=H.id?`character-${H.id}`:`character-${$}`;E.push({handleId:U,title:H.name||`${s("node.content.character")} ${$+1}`})});const P=E.length,L=e.height-tn;return P===0?null:o.jsx(o.Fragment,{children:E.map(({handleId:H,title:$},U)=>{const O=tn+L/(P+1)*(U+1),D=Math.max(tn+bn,Math.min(O,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${H}`,title:$,color:t("text",H),handleCursor:n,position:"right",style:{top:`${D}px`,transform:"translateY(-50%)"},onMouseDown:z=>{z.stopPropagation(),r(z,e.id,H)},onTouchStart:z=>{z.stopPropagation(),a(z,e.id,H)}},H)})})}case C.SCRIPT_GENERATOR:{const k=Lf(e,s);return o.jsx(o.Fragment,{children:Array.from(k.entries()).map(([E,{y:P,title:L}])=>{const H=Math.max(tn+bn,Math.min(P,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${E}`,title:L,color:t("text",E),handleCursor:n,position:"right",style:{top:`${H}px`,transform:"translateY(-50%)"},onMouseDown:$=>{$.stopPropagation(),r($,e.id,E)},onTouchStart:$=>{$.stopPropagation(),a($,e.id,E)}},E)})})}case C.SCRIPT_ANALYZER:{let k={characters:[],scenes:[]};try{k=JSON.parse(e.value||"{}")}catch{}const{characters:E=[],scenes:P=[]}=k,L=[];L.push({handleId:"all-script-analyzer-data",title:s("node.content.allScriptAnalyzerData")}),P.some(O=>O.narratorText)&&L.push({handleId:"all-narrator-data",title:s("node.content.allNarratorData")}),E.forEach((O,D)=>{const z=O.id||`char-idx-${D}`;L.push({handleId:`character-${z}`,title:O.name||`${s("node.content.character")} ${D+1}`})});const $=L.length,U=e.height-tn;return o.jsx(o.Fragment,{children:L.map(({handleId:O,title:D},z)=>{const G=tn+U/($+1)*(z+1),F=Math.max(tn+bn,Math.min(G,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${O}`,title:D,color:t("text",O),handleCursor:n,position:"right",style:{top:`${F}px`,transform:"translateY(-50%)"},onMouseDown:K=>{K.stopPropagation(),r(K,e.id,O)},onTouchStart:K=>{K.stopPropagation(),a(K,e.id,O)}},O)})})}case C.SCRIPT_PROMPT_MODIFIER:{let k={finalPrompts:[]};try{k=JSON.parse(e.value||"{}")}catch{}const{finalPrompts:E=[]}=k,P=E.map($=>({handleId:`final-prompt-${$.frameNumber}`,title:`${s("node.content.finalPrompt")} - ${s("node.content.frame")} ${$.frameNumber}`})),L=P.length,H=e.height-tn;return L===0?null:o.jsx(o.Fragment,{children:P.map(({handleId:$,title:U},O)=>{const D=tn+H/(L+1)*(O+1),z=Math.max(tn+bn,Math.min(D,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${$}`,title:U,color:t("text",$),handleCursor:n,position:"right",style:{top:`${z}px`,transform:"translateY(-50%)"},onMouseDown:G=>{G.stopPropagation(),r(G,e.id,$)},onTouchStart:G=>{G.stopPropagation(),a(G,e.id,$)}},$)})})}case C.NARRATOR_TEXT_GENERATOR:{let k={};try{k=JSON.parse(e.value||"{}").targetLanguages||{}}catch{}const E=Object.entries(k).filter(([,F])=>F).map(([F])=>F);if(E.length===0)return null;const P=E.length,L=60,H=96,$=40,U=8,O=L+U+H+U+$,D=tn+ia+O+U,G=e.height-ia-D;if(G<=20*P){const F=e.height-D,K=D;return o.jsx(o.Fragment,{children:E.map((ae,Y)=>{const ge=K+F/(P+1)*(Y+1),W=ae==="ru"?" ":"English Text";return o.jsx(Mn,{id:`handle-out-${e.id}-${ae}`,title:W,color:t("text",ae),handleCursor:n,position:"right",style:{top:`${ge}px`,transform:"translateY(-50%)"},onMouseDown:le=>{le.stopPropagation(),r(le,e.id,ae)},onTouchStart:le=>{le.stopPropagation(),a(le,e.id,ae)}},ae)})})}return o.jsx(o.Fragment,{children:E.map((F,K)=>{const ae=D+G/P*(K+.5),Y=Math.max(tn+bn,Math.min(ae,e.height-bn)),ge=F==="ru"?" ":"English Text";return o.jsx(Mn,{id:`handle-out-${e.id}-${F}`,title:ge,color:t("text",F),handleCursor:n,position:"right",style:{top:`${Y}px`,transform:"translateY(-50%)"},onMouseDown:W=>{W.stopPropagation(),r(W,e.id,F)},onTouchStart:W=>{W.stopPropagation(),a(W,e.id,F)}},F)})})}case C.YOUTUBE_TITLE_GENERATOR:{let k={};try{k=JSON.parse(e.value||"{}").targetLanguages||{}}catch{}const E=Object.entries(k).filter(([,H])=>H).map(([H])=>H);if(E.length===0)return null;const P=E.length,L=e.height-tn;return o.jsx(o.Fragment,{children:E.map((H,$)=>{const U=tn+L/(P+1)*($+1),O=Math.max(tn+bn,Math.min(U,e.height-bn)),D=s("youtube_title_generator.title")+(H==="ru"?" (RU)":" (EN)");return o.jsx(Mn,{id:`handle-out-${e.id}-${H}`,title:D,color:t("text",H),handleCursor:n,position:"right",style:{top:`${O}px`,transform:"translateY(-50%)"},onMouseDown:z=>{z.stopPropagation(),r(z,e.id,H)},onTouchStart:z=>{z.stopPropagation(),a(z,e.id,H)}},H)})})}case C.CHARACTER_CARD:{const k=[{handleId:"all-characters",type:"text",title:s("node.output.allCharacters")},{handleId:"primary-character",type:"text",title:s("node.output.primaryCharacter")}],E=e.height-tn,P=k.length;return o.jsx(o.Fragment,{children:k.map((L,H)=>{const $=tn+E/(P+1)*(H+1),U=Math.max(tn+bn,Math.min($,e.height-bn));return o.jsx(Mn,{id:`handle-out-${e.id}-${L.handleId}`,title:L.title,color:t("text",L.handleId),handleCursor:n,position:"right",style:{top:`${U}px`,transform:"translateY(-50%)"},onMouseDown:O=>{O.stopPropagation(),r(O,e.id,L.handleId)},onTouchStart:O=>{O.stopPropagation(),a(O,e.id,L.handleId)}},L.handleId)})})}case C.IMAGE_GENERATOR:case C.TEXT_INPUT:case C.PROMPT_PROCESSOR:case C.TRANSLATOR:case C.ERROR_ANALYZER:case C.REROUTE_DOT:case C.AUDIO_TRANSCRIBER:case C.IDEA_GENERATOR:case C.MUSIC_IDEA_GENERATOR:case C.YOUTUBE_ANALYTICS:return c!==null||e.type===C.REROUTE_DOT?o.jsx(Mn,{id:`handle-out-${e.id}-default`,title:s("node.output.default"),color:t(c,void 0),handleCursor:n,position:"right",style:{top:"50%",transform:"translateY(-50%)"},onMouseDown:k=>{k.stopPropagation(),r(k,e.id,void 0)},onTouchStart:k=>{k.stopPropagation(),a(k,e.id,void 0)}}):null;default:return null}},gg=40,eI=e=>{const{node:t,onMouseDown:n,onTouchStart:r,onResizeMouseDown:a,onResizeTouchStart:i,activeTool:s,onOutputHandleMouseDown:l,onOutputHandleTouchStart:c,onNodeClick:d,isHovered:h,isSelected:g,isGrouped:m,onNodeMouseEnter:w,onNodeMouseLeave:y,onDeleteNode:b,onCutConnections:S,onCopyNodeValue:_,onPasteNodeValue:v,onValueChange:f,onReadData:T,connectingInfo:A,connectionTarget:I,lastAddedNodeId:M,isExecuting:N,isDragOverTarget:k,addToast:E,onDuplicateNode:P,onNodeDoubleClick:L,onDuplicateNodeEmpty:H,onRenameNode:$,inputData:U,onSaveCharacterCard:O,onLoadCharacterCard:D,onSaveCharacterToCatalog:z,setFullSizeImage:G,getFullSizeImage:F,setImageViewer:K,onCopyImageToClipboard:ae,onDownloadImage:Y,onUpdateCharacterDescription:ge,isUpdatingDescription:W,onModifyCharacter:le,isModifyingCharacter:X,getUpstreamNodeValues:Te,onAddNode:pe}=e,{t:ue}=Bt(),Oe=t.type===C.REROUTE_DOT,he=x.useMemo(()=>{if(!Oe)return null;try{return JSON.parse(t.value||"{}").type||null}catch{return null}},[Oe,t.value]),ye=x.useMemo(()=>{switch(t.type){case C.TEXT_INPUT:return{minWidth:460,minHeight:280};case C.PROMPT_PROCESSOR:return{minWidth:460,minHeight:280};case C.PROMPT_ANALYZER:return{minWidth:460,minHeight:1e3};case C.CHARACTER_ANALYZER:return{minWidth:460,minHeight:500};case C.CHARACTER_GENERATOR:return{minWidth:680,minHeight:800};case C.IMAGE_GENERATOR:return{minWidth:400,minHeight:520};case C.IMAGE_PREVIEW:return{minWidth:300,minHeight:400};case C.CHARACTER_CARD:return{minWidth:460,minHeight:1e3};case C.GEMINI_CHAT:return{minWidth:400,minHeight:640};case C.TRANSLATOR:return{minWidth:380,minHeight:640};case C.SCRIPT_GENERATOR:return{minWidth:680,minHeight:800};case C.SCRIPT_ANALYZER:return{minWidth:680,minHeight:800};case C.SCRIPT_PROMPT_MODIFIER:return{minWidth:680,minHeight:800};case C.ERROR_ANALYZER:return{minWidth:380,minHeight:280};case C.DATA_READER:return{minWidth:380,minHeight:280};case C.NOTE:return{minWidth:440,minHeight:640};case C.SPEECH_SYNTHESIZER:return{minWidth:680,minHeight:800};case C.NARRATOR_TEXT_GENERATOR:return{minWidth:680,minHeight:800};case C.IDEA_GENERATOR:return{minWidth:680,minHeight:800};case C.AUDIO_TRANSCRIBER:return{minWidth:400,minHeight:480};case C.YOUTUBE_TITLE_GENERATOR:return{minWidth:680,minHeight:800};case C.MUSIC_IDEA_GENERATOR:return{minWidth:680,minHeight:800};case C.YOUTUBE_ANALYTICS:return{minWidth:680,minHeight:800};case C.REROUTE_DOT:return{minWidth:60,minHeight:40};default:return{minWidth:200,minHeight:150}}},[t.type]),j=Fe=>n(Fe,t.id),q=Fe=>r(Fe,t.id),Q=Fe=>{s==="cutter"&&(Fe.stopPropagation(),Fe.preventDefault(),d(t.id))},J=s==="edit"?"crosshair":"inherit",oe=()=>{const Fe={...e,nodes:e.nodes,connections:e.connections,t:ue,handleCursor:J,isEnhancing:e.isEnhancing===t.id,isAnalyzing:e.isAnalyzing===t.id,isAnalyzingCharacter:e.isAnalyzingCharacter===t.id,isStopping:e.stoppingNodes.has(t.id),onRemoveConnection:e.removeConnectionById,getUpstreamTextValue:e.getUpstreamTextValue,addToast:e.addToast,isGeneratingIdeaCategories:e.isGeneratingIdeaCategories===t.id,isCombiningStoryIdea:e.isCombiningStoryIdea===t.id,isTranscribingAudio:e.isTranscribingAudio===t.id,isGeneratingYouTubeTitles:e.isGeneratingYouTubeTitles===t.id,isGeneratingYouTubeChannelInfo:e.isGeneratingYouTubeChannelInfo===t.id,isGeneratingMusicIdeas:e.isGeneratingMusicIdeas===t.id,isExtractingText:e.isExtractingText===t.id,isAnalyzingYouTubeStats:e.isAnalyzingYouTubeStats===t.id,isImprovingScriptConcept:e.isImprovingScriptConcept===t.id,isGeneratingEntities:e.isGeneratingEntities===t.id?e.isGeneratingEntities:null,inputData:U,onSaveCharacterCard:O,onLoadCharacterCard:D,onSaveCharacterToCatalog:z,setFullSizeImage:G,getFullSizeImage:F,setImageViewer:K,onCopyImageToClipboard:ae,onDownloadImage:Y,onUpdateCharacterDescription:ge,isUpdatingDescription:e.isUpdatingDescription===t.id?e.isUpdatingDescription:null,onModifyCharacter:le,isModifyingCharacter:e.isModifyingCharacter===t.id?e.isModifyingCharacter:null,getUpstreamNodeValues:Te,onAddNode:pe,onDeleteNode:b};switch(t.type){case C.REROUTE_DOT:return o.jsx(qA,{...Fe});case C.NOTE:return o.jsx($A,{...Fe});case C.TRANSLATOR:return o.jsx(w5,{...Fe});case C.GEMINI_CHAT:return o.jsx(HA,{...Fe});case C.SCRIPT_GENERATOR:return o.jsx(u5,{...Fe});case C.SCRIPT_ANALYZER:return o.jsx(r5,{...Fe});case C.SCRIPT_PROMPT_MODIFIER:return o.jsx(x5,{...Fe});case C.CHARACTER_GENERATOR:return o.jsx(GA,{...Fe});case C.CHARACTER_CARD:return o.jsx(OA,{...Fe});case C.IMAGE_GENERATOR:return o.jsx(BA,{...Fe});case C.IMAGE_PREVIEW:return o.jsx(VA,{...Fe});case C.ERROR_ANALYZER:return o.jsx(UA,{...Fe});case C.DATA_READER:return o.jsx(_5,{...Fe});case C.SPEECH_SYNTHESIZER:return o.jsx(S5,{...Fe});case C.NARRATOR_TEXT_GENERATOR:return o.jsx(P5,{...Fe});case C.IDEA_GENERATOR:return o.jsx(N5,{...Fe});case C.AUDIO_TRANSCRIBER:return o.jsx(j5,{...Fe});case C.YOUTUBE_TITLE_GENERATOR:return o.jsx(z5,{...Fe});case C.MUSIC_IDEA_GENERATOR:return o.jsx(B5,{...Fe});case C.YOUTUBE_ANALYTICS:return o.jsx(q5,{...Fe});case C.TEXT_INPUT:return o.jsx(b5,{...Fe});case C.PROMPT_ANALYZER:return o.jsx(WA,{...Fe});case C.CHARACTER_ANALYZER:return o.jsx(_A,{...Fe});case C.PROMPT_PROCESSOR:return o.jsx(YA,{...Fe});default:return null}},B=(I==null?void 0:I.nodeId)===t.id;let fe="border-gray-700";k?fe="border-emerald-400":B?fe="border-green-400":N?fe="border-yellow-500":g?fe="border-emerald-400":Oe&&(he==="text"?fe="border-emerald-500":he==="image"&&(fe="border-cyan-500"));const ie=s==="cutter"?`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:"default",Z=Oe?he==="text"?"bg-emerald-900/30":he==="image"?"bg-cyan-900/30":"bg-gray-600":t.type===C.NOTE?"bg-gray-900/70 backdrop-blur-sm":"bg-gray-800",ee=(Fe,ot)=>{let at=Fe;Oe&&(at=he);let rt;return at==="text"?rt="bg-emerald-400":at==="image"?rt="bg-cyan-400":rt="bg-gray-400",!A||!h&&!Oe?rt:B&&(t.type===C.REROUTE_DOT||A.fromType===Kr(t))?"bg-green-500":h?"bg-red-500 cursor-not-allowed":rt},R=t.id===M,be="absolute flex flex-col transition-colors duration-200 pointer-events-auto",Le="rounded-lg",je="p-3",Ue=g?50:m?6:20;return o.jsxs("div",{className:`${be} ${Z} ${Le} ${R?"node-newly-added":""} ${Oe?"cursor-move":""}`,style:{transform:`translate3d(${t.position.x}px, ${t.position.y}px, 0)`,width:t.width,height:t.isCollapsed?`${gg}px`:t.height,minWidth:Oe?void 0:`${ye.minWidth}px`,minHeight:t.isCollapsed?`${gg}px`:Oe?void 0:`${ye.minHeight}px`,zIndex:Ue,cursor:ie,backfaceVisibility:"hidden"},onClick:Q,onMouseEnter:()=>w(t.id),onMouseLeave:y,onMouseDown:Oe?j:void 0,onTouchStart:Oe?q:void 0,onContextMenu:Fe=>Fe.stopPropagation(),onWheel:Fe=>Fe.stopPropagation(),children:[o.jsx("div",{className:`absolute inset-0 border-2 ${fe} rounded-lg pointer-events-none`,style:{zIndex:12}}),o.jsx(J5,{node:t,t:ue,addToast:E,onMouseDown:j,onTouchStart:q,onNodeDoubleClick:L,onValueChange:f,onReadData:T,onPasteNodeValue:v,onCopyNodeValue:_,onCutConnections:S,onDeleteNode:b,onDuplicateNode:P,onDuplicateNodeEmpty:H,onRenameNode:$}),!Oe&&!t.isCollapsed&&o.jsx("div",{className:`${je} flex-grow min-h-0`,children:oe()}),o.jsx(Z5,{node:t,getHandleColor:ee,handleCursor:J,t:ue,isHovered:h,isCollapsed:t.isCollapsed}),o.jsx(Q5,{node:t,getHandleColor:ee,handleCursor:J,t:ue,isHovered:h,isCollapsed:t.isCollapsed,onOutputHandleMouseDown:l,onOutputHandleTouchStart:c}),!Oe&&!t.isCollapsed&&o.jsx(X5,{onResizeMouseDown:Fe=>a(Fe,t.id),onResizeTouchStart:Fe=>i(Fe,t.id)})]})};function tI(e,t){return!(e.node!==t.node||e.isSelected!==t.isSelected||e.isGrouped!==t.isGrouped||e.isHovered!==t.isHovered||e.isExecuting!==t.isExecuting||e.isEnhancing!==t.isEnhancing||e.isAnalyzing!==t.isAnalyzing||e.isAnalyzingCharacter!==t.isAnalyzingCharacter||e.isExecutingChain!==t.isExecutingChain||e.isChatting!==t.isChatting||e.isTranslating!==t.isTranslating||e.isFixingErrors!==t.isFixingErrors||e.isReadingData!==t.isReadingData||e.isGeneratingScript!==t.isGeneratingScript||e.isGeneratingEntities!==t.isGeneratingEntities||e.isModifyingScriptPart!==t.isModifyingScriptPart||e.isAnalyzingScript!==t.isAnalyzingScript||e.isGeneratingCharacters!==t.isGeneratingCharacters||e.isGeneratingImage!==t.isGeneratingImage||e.isGeneratingCharacterImage!==t.isGeneratingCharacterImage||e.isModifyingScriptPrompts!==t.isModifyingScriptPrompts||e.isGeneratingSpeech!==t.isGeneratingSpeech||e.isGeneratingIdeaCategories!==t.isGeneratingIdeaCategories||e.isCombiningStoryIdea!==t.isCombiningStoryIdea||e.isGeneratingNarratorText!==t.isGeneratingNarratorText||e.isTranscribingAudio!==t.isTranscribingAudio||e.isGeneratingYouTubeTitles!==t.isGeneratingYouTubeTitles||e.isGeneratingYouTubeChannelInfo!==t.isGeneratingYouTubeChannelInfo||e.isGeneratingMusicIdeas!==t.isGeneratingMusicIdeas||e.isExtractingText!==t.isExtractingText||e.isAnalyzingYouTubeStats!==t.isAnalyzingYouTubeStats||e.isImprovingScriptConcept!==t.isImprovingScriptConcept||e.isUpdatingDescription!==t.isUpdatingDescription||e.isModifyingCharacter!==t.isModifyingCharacter||e.inputData!==t.inputData||e.activeTool!==t.activeTool||e.connections!==t.connections||e.connectionTarget!==t.connectionTarget||e.isDragOverTarget!==t.isDragOverTarget||e.connectingInfo!==t.connectingInfo||e.lastAddedNodeId!==t.lastAddedNodeId||e.clearSelectionsSignal!==t.clearSelectionsSignal)}const nI=bt.memo(eI,tI),oI=({connection:e,fromNode:t,start:n,end:r,isNodeHovered:a,activeTool:i,onDelete:s,onSplit:l,lineStyle:c})=>{const[d,h]=x.useState(!1),g=c==="orthogonal"?`M ${n.x} ${n.y} L ${(n.x+r.x)/2} ${n.y} L ${(n.x+r.x)/2} ${r.y} L ${r.x} ${r.y}`:`M ${n.x} ${n.y} C ${n.x+80} ${n.y}, ${r.x-80} ${r.y}, ${r.x} ${r.y}`,m=Ga(t,e.fromHandleId);let w;m==="text"?w="#34d399":m==="image"?w="#22d3ee":w="#6b7280";const y=i==="cutter",b=i==="reroute",S=(y||b)&&(d||a),_=y&&S?"#ef4444":b&&S?"#10b981":w,v=S?5:3;let f="default";y&&(d||a)?f=`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:b&&d?f="crosshair":(y||b)&&(f="pointer");const T=A=>{A.stopPropagation(),y?s(e.id):b&&l(e.id,A)};return o.jsxs("g",{onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:T,onContextMenu:A=>A.stopPropagation(),style:{cursor:f,pointerEvents:"auto"},children:[o.jsx("path",{d:g,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),o.jsx("path",{d:g,stroke:_,strokeWidth:v,fill:"none",style:{pointerEvents:"none",transition:"stroke 0.2s ease-in-out, stroke-width 0.2s ease-in-out"}}),o.jsx("path",{d:g,stroke:"white",strokeWidth:"2",fill:"none",className:"connection-flow",style:{pointerEvents:"none"}})]})},rI=bt.memo(oI),aI=({group:e,onMouseDown:t,onTouchStart:n,onClose:r,onRename:a,onSaveToCatalog:i,onSaveToDisk:s,onCopy:l,onDuplicate:c,isHoveredForDrop:d,isBeingDragged:h})=>{const{t:g}=Bt(),m=h?"border-solid border-emerald-400":d?"border-solid border-emerald-400 ring-2 ring-emerald-400/50":"border-dashed border-gray-500";return o.jsx("div",{className:`absolute bg-white/5 border-2 ${m} rounded-lg transition-colors duration-200 pointer-events-auto`,style:{transform:`translate3d(${e.position.x}px, ${e.position.y}px, 0)`,width:e.width,height:e.height,zIndex:5,backfaceVisibility:"hidden"},children:o.jsxs("div",{className:"bg-gray-700/50 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move pointer-events-auto",onMouseDown:t,onTouchStart:y=>n(y,e.id),onDoubleClick:()=>a(e.id,e.title),onContextMenu:y=>y.stopPropagation(),children:[o.jsx("span",{className:"truncate pr-2",children:e.title}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:g("group.rename"),onClick:()=>a(e.id,e.title),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),o.jsx(Pe,{title:g("node.action.copy"),onClick:()=>l(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Pe,{title:g("node.action.duplicateWithContent"),onClick:()=>c(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),o.jsx(Pe,{title:g("group.saveToCatalog"),onClick:()=>i(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),o.jsx(Pe,{title:g("group.saveToDisk"),onClick:()=>s(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Pe,{title:g("group.ungroup"),onClick:y=>r(e.id,y),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},iI=bt.memo(aI),sI=({children:e})=>{const t=Qo(),n=x.useRef(null),r=x.useRef(null);if(!t)return null;const{viewTransform:a,handleCanvasMouseDown:i,handleCanvasContextMenu:s,updatePointerPosition:l,handleWheel:c,handleCanvasDoubleClick:d,handleDrop:h,handleDragOver:g,handleDragLeave:m,getCanvasCursor:w,handleCanvasTouchStart:y,handleCanvasTouchMove:b,handleCanvasTouchEnd:S,isDraggingOverCanvas:_,openContextMenu:v,connections:f,nodes:T,groups:A,creationLine:I,selectionRect:M,groupButtonPosition:N,hoveredNodeId:k,selectedNodeIds:E,effectiveTool:P,lineStyle:L,hoveredGroupIdForDrop:H,draggingInfo:$,getConnectionPoints:U,removeConnectionById:O,handleSplitConnection:D,handleGroupMouseDown:z,handleGroupTouchStart:G,handleRenameGroup:F,handleRemoveGroup:K,handleSaveGroupToCatalog:ae,handleSaveGroupToDisk:Y,handleCopyGroup:ge,handleDuplicateGroup:W,handleNodeMouseDown:le,handleNodeTouchStart:X,handleNodeResizeMouseDown:Te,handleNodeResizeTouchStart:pe,handleValueChange:ue,handleEnhance:Oe,isEnhancing:he,handleAnalyzePrompt:ye,isAnalyzing:j,handleAnalyzeCharacter:q,isAnalyzingCharacter:Q,handleExecuteChain:J,handleExecuteFullChain:oe,isExecutingChain:B,executingNodeId:fe,stopGeneration:ie,stoppingNodes:Z,handleSendMessage:ee,isChatting:R,handleTranslate:be,isTranslating:Le,handleGenerateScript:je,isGeneratingScript:Ue,handleGenerateEntities:Fe,isGeneratingEntities:ot,handleModifyScriptPart:at,handleModifyAnalyzerFramePart:rt,isModifyingScriptPart:Ce,handleFixErrors:ve,isFixingErrors:Ge,handleReadData:ce,isReadingData:He,handleAnalyzeScript:V,isAnalyzingScript:re,handleGenerateCharacters:ze,isGeneratingCharacters:ne,handleGenerateImage:xe,isGeneratingImage:_e,handleGenerateCharacterImage:Ie,isGeneratingCharacterImage:me,handleModifyScriptPrompts:Ee,isModifyingScriptPrompts:Ae,handleApplyAliases:Ke,handleDetachCharacter:mt,handleStartConnection:Nt,handleStartConnectionTouchStart:It,handleNodeClick:kt,setHoveredNodeId:xt,deleteNodeAndConnections:Dt,removeConnectionsByNodeId:Mt,copyNodeValue:hn,pasteNodeValue:an,handleDuplicateNode:we,handleDuplicateNodeEmpty:Ve,handleNodeDoubleClick:qe,connectedInputs:it,connectingInfo:lt,connectionTarget:Lt,libraryItems:Nn,deselectAllNodes:Ot,dragOverNodeId:se,handleProcessChainForward:De,lastAddedNodeId:Re,getUpstreamTextValue:Je,addToast:st,handleGenerateSpeech:nt,isGeneratingSpeech:St,handleGenerateIdeaCategories:Ft,isGeneratingIdeaCategories:zt,handleCombineStoryIdea:de,isCombiningStoryIdea:ke,handleGenerateNarratorText:Ne,isGeneratingNarratorText:Qe,handleTranscribeAudio:ct,isTranscribingAudio:Gt,handleGenerateYouTubeTitles:Vt,isGeneratingYouTubeTitles:cn,handleGenerateYouTubeChannelInfo:Vn,isGeneratingYouTubeChannelInfo:xn,handleGenerateMusicIdeas:vn,isGeneratingMusicIdeas:io,handleExtractTextFromImage:Do,isExtractingText:Nr,onAnalyzeYouTubeStats:er,isAnalyzingYouTubeStats:Va,saveDataToCatalog:$a,handleRenameNode:dt,clearSelectionsSignal:et,handleImproveScriptConcept:$t,isImprovingScriptConcept:sn,t:_t,pointerPosition:xo,setFullSizeImage:Wa,getFullSizeImage:kr,setImageViewer:Qr,onCopyImageToClipboard:Ya,onDownloadImage:Bl,onSaveCharacterCard:Vl,onLoadCharacterCard:$l,onSaveCharacterToCatalog:Wl}=t,{visibleNodes:Yl,visibleConnections:ql}=bA(T,f,a),Kl=x.useMemo(()=>{const gt=new Set;return A.forEach(mn=>mn.nodeIds.forEach(en=>gt.add(en))),gt},[A]),Jl=bt.useMemo(()=>lt?lt.fromType==="text"?"#34d399":lt.fromType==="image"?"#22d3ee":"#6b7280":"#6b7280",[lt]),Zn=gt=>{if(gt.touches.length===1){n.current&&clearTimeout(n.current);const mn=gt.touches[0];r.current={x:mn.clientX,y:mn.clientY},n.current=window.setTimeout(()=>{r.current&&v(r.current),n.current=null},500)}y(gt)},Xl=gt=>{if(n.current&&r.current&&gt.touches.length>0){const mn=gt.touches[0].clientX-r.current.x,en=gt.touches[0].clientY-r.current.y;Math.hypot(mn,en)>10&&(clearTimeout(n.current),n.current=null)}b(gt)},qa=gt=>{n.current&&(clearTimeout(n.current),n.current=null),S(gt)},Ka=gt=>{const mn=f.filter(en=>en.toNodeId===gt);return mn.length===0?"":mn.map(en=>{const Ao=T.find(Ja=>Ja.id===en.fromNodeId);return Ao?Ao.value.length>2e3?`${en.fromHandleId}:LEN_${Ao.value.length}_${Ao.value.substring(0,50)}`:`${en.fromHandleId}:${Ao.value}`:""}).sort().join("||")};return o.jsxs("div",{id:"app-container",tabIndex:-1,className:`relative w-full h-full min-h-0 bg-gray-900 select-none outline-none ${_?"outline-4 outline-dashed outline-emerald-500 outline-offset-[-4px]":""}`,onMouseDown:i,onContextMenu:s,onMouseMove:l,onWheel:c,onDoubleClick:d,onDrop:h,onDragOver:g,onDragLeave:m,onTouchStart:Zn,onTouchMove:Xl,onTouchEnd:qa,style:{cursor:w(),touchAction:"none",overflow:"hidden"},children:[o.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"radial-gradient(rgba(52, 211, 153, 0.15) 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e,o.jsxs("div",{id:"canvas-transform-layer",className:"pointer-events-none",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",transform:`translate3d(${a.translate.x}px, ${a.translate.y}px, 0) scale(${a.scale})`,transformOrigin:"0 0"},children:[o.jsxs("div",{className:"absolute pointer-events-none",style:{left:0,top:0,zIndex:0},children:[o.jsx("div",{className:"absolute bg-emerald-500/50",style:{width:"20px",height:"2px",left:"-10px",top:"-1px"}}),o.jsx("div",{className:"absolute bg-emerald-500/50",style:{width:"2px",height:"20px",left:"-1px",top:"-10px"}}),o.jsx("div",{className:"absolute text-[10px] text-emerald-500/50 font-mono select-none",style:{left:"4px",top:"4px"},children:"0,0"})]}),M&&o.jsx("div",{className:"absolute border-2 border-dashed border-emerald-400 bg-emerald-400/20 pointer-events-none",style:{left:M.x,top:M.y,width:M.width,height:M.height,zIndex:100}}),N&&o.jsxs("button",{onClick:gt=>{gt.stopPropagation(),t.handleGroupSelection()},className:"absolute z-20 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors duration-200 -translate-x-1/2 flex items-center space-x-2 pointer-events-auto shadow-lg",style:{left:N.x,top:N.y},children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"})}),o.jsx("span",{children:_t("group.button.create",{count:E.length})})]}),o.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full overflow-visible pointer-events-none",style:{zIndex:9},children:[o.jsx("defs",{children:o.jsxs("filter",{id:"glow-connection",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[o.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),o.jsx("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]})}),ql.map(gt=>{const mn=T.find(ea=>ea.id===gt.fromNodeId),en=T.find(ea=>ea.id===gt.toNodeId);if(!mn||!en)return null;const{start:Ao,end:Ja}=U(mn,en,gt);return o.jsx(rI,{connection:gt,fromNode:mn,start:Ao,end:Ja,isNodeHovered:P==="cutter"&&(k===gt.fromNodeId||k===gt.toNodeId),activeTool:P,onDelete:O,onSplit:D,lineStyle:L},gt.id)}),lt&&o.jsx("path",{d:`M ${lt.fromPoint.x} ${lt.fromPoint.y} C ${lt.fromPoint.x+80} ${lt.fromPoint.y}, ${xo.x-80} ${xo.y}, ${xo.x} ${xo.y}`,stroke:Jl,strokeWidth:"3",fill:"none",style:{strokeDasharray:"8 4"}}),I&&o.jsx("line",{x1:I.start.x,y1:I.start.y,x2:I.end.x,y2:I.end.y,stroke:"#34d399",strokeWidth:"2",className:"creation-line"})]}),A.map(gt=>{const mn=($==null?void 0:$.type)==="group"&&$.id===gt.id||($==null?void 0:$.type)==="node"&&gt.nodeIds.some(en=>$.offsets.has(en));return o.jsx(iI,{group:gt,onMouseDown:en=>z(en,gt.id),onTouchStart:en=>G(en,gt.id),onRename:F,onClose:K,onSaveToCatalog:ae,onSaveToDisk:Y,onCopy:ge,onDuplicate:W,isHoveredForDrop:H===gt.id,isBeingDragged:mn},gt.id)}),Yl.map(gt=>o.jsx(nI,{node:gt,nodes:T,connections:f,removeConnectionById:O,onMouseDown:le,onTouchStart:X,onResizeMouseDown:Te,onResizeTouchStart:pe,onValueChange:ue,onEnhance:Oe,isEnhancing:he,onAnalyze:ye,isAnalyzing:j,onAnalyzeCharacter:q,isAnalyzingCharacter:Q,onExecuteChain:J,onExecuteFullChain:oe,isExecutingChain:B,isExecuting:fe===gt.id,onStopGeneration:ie,stoppingNodes:Z,onSendMessage:ee,isChatting:R,onTranslate:be,isTranslating:Le,onGenerateScript:je,isGeneratingScript:Ue,onGenerateEntities:Fe,isGeneratingEntities:ot,onModifyScriptPart:at,isModifyingScriptPart:Ce,onModifyAnalyzerFramePart:rt,onFixErrors:ve,isFixingErrors:Ge,onReadData:ce,isReadingData:He,onAnalyzeScript:V,isAnalyzingScript:re,onGenerateCharacters:ze,isGeneratingCharacters:ne,onGenerateImage:xe,isGeneratingImage:_e,onGenerateCharacterImage:Ie,isGeneratingCharacterImage:me,onModifyScriptPrompts:Ee,isModifyingScriptPrompts:Ae,onApplyAliases:Ke,onDetachCharacter:mt,activeTool:P,onOutputHandleMouseDown:Nt,onOutputHandleTouchStart:It,onNodeClick:kt,isHovered:k===gt.id,isSelected:E.includes(gt.id),isGrouped:Kl.has(gt.id),onNodeMouseEnter:mn=>xt(mn),onNodeMouseLeave:()=>xt(null),onDeleteNode:Dt,onCutConnections:Mt,onCopyNodeValue:hn,onPasteNodeValue:an,onDuplicateNode:we,onDuplicateNodeEmpty:Ve,onNodeDoubleClick:qe,connectedInputs:it.get(gt.id),connectingInfo:lt,connectionTarget:Lt,libraryItems:Nn,deselectAllNodes:Ot,isDragOverTarget:se===gt.id,onProcessChainForward:De,lastAddedNodeId:Re,getUpstreamTextValue:Je,addToast:st,onGenerateSpeech:nt,isGeneratingSpeech:St,onGenerateIdeaCategories:Ft,isGeneratingIdeaCategories:zt,onCombineStoryIdea:de,isCombiningStoryIdea:ke,onGenerateNarratorText:Ne,isGeneratingNarratorText:Qe,onTranscribeAudio:ct,isTranscribingAudio:Gt,onGenerateYouTubeTitles:Vt,isGeneratingYouTubeTitles:cn,onGenerateYouTubeChannelInfo:Vn,isGeneratingYouTubeChannelInfo:xn,onGenerateMusicIdeas:vn,isGeneratingMusicIdeas:io,onExtractTextFromImage:Do,isExtractingText:Nr,onAnalyzeYouTubeStats:er,isAnalyzingYouTubeStats:Va,saveDataToCatalog:$a,onRenameNode:dt,clearSelectionsSignal:et,onImproveScriptConcept:$t,isImprovingScriptConcept:sn,inputData:Ka(gt.id),setFullSizeImage:Wa,getFullSizeImage:kr,setImageViewer:Qr,onCopyImageToClipboard:Ya,onDownloadImage:Bl,onSaveCharacterCard:Vl,onLoadCharacterCard:$l,onSaveCharacterToCatalog:Wl},gt.id))]})]})},yt=({title:e,onClick:t,isActive:n=!1,children:r,tooltipPosition:a="top",customClasses:i,hoverBgClass:s,sizeClass:l="h-9 w-9"})=>{const c=`p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center ${l}`,d="bg-emerald-600 text-white shadow-md",h=`bg-gray-700 ${s||"hover:bg-emerald-600"} text-gray-300 hover:text-white`,g=i?`${c} ${i}`:`${c} ${n?d:h}`;return o.jsx(ht,{title:e,position:a,children:o.jsx("button",{onClick:t,"aria-label":e,className:g,children:r})})},lI=({activeTool:e,onToolChange:t,onAddNode:n,onSaveCanvas:r,onSaveProject:a,onLoadCanvas:i,onOpenSearch:s,onOpenCatalog:l,viewTransform:c,setZoom:d,isSnapToGrid:h,setIsSnapToGrid:g,lineStyle:m,setLineStyle:w,handleClearCanvas:y})=>{const{t:b}=Bt(),[S,_]=bt.useState(!1),[v,f]=bt.useState(!1),[T,A]=bt.useState(!1),[I,M]=x.useState(!1),N=x.useRef(null);x.useEffect(()=>{const F=()=>{if(N.current){const ae=N.current.offsetWidth,Y=(window.innerWidth-ae)/2;M(Y<380)}else M(window.innerWidth<1400)};F(),window.addEventListener("resize",F);const K=new ResizeObserver(()=>F());return N.current&&K.observe(N.current),()=>{window.removeEventListener("resize",F),K.disconnect()}},[]);const[k,E]=x.useState(64),P=x.useRef(null),L=x.useRef(!1),H=x.useRef({y:0,initialTop:0}),$=F=>{F.preventDefault(),F.stopPropagation(),L.current=!0,H.current={y:F.clientY,initialTop:k},document.body.style.cursor="ns-resize",window.addEventListener("mousemove",U),window.addEventListener("mouseup",O)},U=F=>{var le;if(!L.current)return;const K=F.clientY-H.current.y,ae=((le=P.current)==null?void 0:le.offsetHeight)||200,Y=56,ge=window.innerHeight-ae-56,W=Math.max(Y,Math.min(ge,H.current.initialTop+K));E(W)},O=()=>{L.current=!1,document.body.style.cursor="default",window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",O)};x.useEffect(()=>()=>{window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",O)},[]);const D=F=>{d(F,{x:window.innerWidth/2,y:window.innerHeight/2})},z=F=>{const K=Number(F),ae=.2,Y=2;if(K<1){const W=Math.pow(1/ae,.01);return Math.log(K/ae)/Math.log(W)-100}const ge=Math.pow(Y,1/100);return Math.log(K)/Math.log(ge)},G=F=>{const K=Number(F),ae=.2,Y=2;if(K<0){const W=Math.pow(1/ae,.01);return Math.pow(W,K+100)*ae}const ge=Math.pow(Y,1/100);return Math.pow(ge,K)};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:P,style:{top:`${k}px`},className:"absolute left-2 z-20 bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-col items-center gap-1 border border-gray-700 select-none",onMouseDown:F=>F.stopPropagation(),children:[o.jsx("div",{onMouseDown:$,className:"w-full h-4 flex items-center justify-center cursor-ns-resize group hover:bg-gray-800/50 rounded-t-lg -mt-0.5 mb-1",title:"Drag to move",children:o.jsx("div",{className:"w-6 h-1 bg-gray-600 rounded-full group-hover:bg-gray-400 transition-colors"})}),o.jsx(yt,{sizeClass:"h-9 w-9",title:b("toolbar.edit"),onClick:()=>t("edit"),isActive:e==="edit",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),o.jsx(yt,{sizeClass:"h-9 w-9",title:b("toolbar.cutter"),onClick:()=>t("cutter"),isActive:e==="cutter",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(yt,{sizeClass:"h-9 w-9",title:b("toolbar.selection"),onClick:()=>t("selection"),isActive:e==="selection",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),o.jsx(yt,{sizeClass:"h-9 w-9",title:b("toolbar.reroute"),onClick:()=>t("reroute"),isActive:e==="reroute",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})})]}),o.jsx("div",{className:`absolute bottom-2 left-14 right-14 z-20 flex justify-center pointer-events-none transition-transform duration-300 ease-in-out ${v?"translate-y-[calc(100%+8px)]":"translate-y-0"}`,children:o.jsxs("div",{className:"relative pointer-events-auto cursor-auto max-w-full",children:[o.jsxs("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 h-7 w-28 bg-gray-900/50 backdrop-blur-md border-t border-x border-gray-700 rounded-t-xl flex items-stretch overflow-hidden shadow-lg",children:[o.jsx("button",{onClick:()=>A(!T),className:`flex-1 flex items-center justify-center transition-colors border-r border-gray-700/50 ${T?"text-emerald-400 bg-emerald-900/20":"text-gray-400 hover:text-white hover:bg-gray-700"}`,title:b("toolbar.toggleHeaders"),children:T?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}):o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),o.jsx("button",{onClick:()=>f(!v),className:"flex-1 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-700 transition-all",title:b(v?"toolbar.expand":"toolbar.collapse"),children:v?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 5l-7 14h14l-7-14z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 19l-7-14h14l-7 14z"})})})]}),o.jsxs("div",{ref:N,className:"bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-wrap justify-center items-center gap-x-2 gap-y-2 border border-gray-700",children:[o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("catalog.title")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addNode"),onClick:s,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),o.jsx(yt,{title:b("toolbar.catalog"),onClick:l,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.general")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addNote"),onClick:()=>n(C.NOTE),hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),o.jsx(yt,{title:b("toolbar.addDataReader"),onClick:()=>n(C.DATA_READER),hoverBgClass:"hover:bg-emerald-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.prompting")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addTextInput"),onClick:()=>n(C.TEXT_INPUT),hoverBgClass:"hover:bg-purple-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})}),o.jsx(yt,{title:b("toolbar.addPromptProcessor"),onClick:()=>n(C.PROMPT_PROCESSOR),hoverBgClass:"hover:bg-purple-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}),o.jsx(yt,{title:b("toolbar.addPromptAnalyzer"),onClick:()=>n(C.PROMPT_ANALYZER),hoverBgClass:"hover:bg-purple-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.scripting")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addIdeaGenerator"),onClick:()=>n(C.IDEA_GENERATOR),hoverBgClass:"hover:bg-cyan-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})}),o.jsx(yt,{title:b("toolbar.addScriptGenerator"),onClick:()=>n(C.SCRIPT_GENERATOR),hoverBgClass:"hover:bg-cyan-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})}),o.jsx(yt,{title:b("toolbar.addScriptAnalyzer"),onClick:()=>n(C.SCRIPT_ANALYZER),hoverBgClass:"hover:bg-cyan-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})}),o.jsx(yt,{title:b("toolbar.addScriptPromptModifier"),onClick:()=>n(C.SCRIPT_PROMPT_MODIFIER),hoverBgClass:"hover:bg-cyan-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.characters")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addCharacterGenerator"),onClick:()=>n(C.CHARACTER_GENERATOR),hoverBgClass:"hover:bg-pink-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),o.jsx(yt,{title:b("toolbar.addCharacterAnalyzer"),onClick:()=>n(C.CHARACTER_ANALYZER),hoverBgClass:"hover:bg-pink-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}),o.jsx(yt,{title:b("toolbar.addCharacterCard"),onClick:()=>n(C.CHARACTER_CARD),hoverBgClass:"hover:bg-pink-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.images")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addImageGenerator"),onClick:()=>n(C.IMAGE_GENERATOR),hoverBgClass:"hover:bg-yellow-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),o.jsx(yt,{title:b("toolbar.addImagePreview"),onClick:()=>n(C.IMAGE_PREVIEW),hoverBgClass:"hover:bg-yellow-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.ai")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addTranslator"),onClick:()=>n(C.TRANSLATOR),hoverBgClass:"hover:bg-green-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})}),o.jsx(yt,{title:b("toolbar.addGeminiChat"),onClick:()=>n(C.GEMINI_CHAT),hoverBgClass:"hover:bg-green-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(yt,{title:b("toolbar.addErrorAnalyzer"),onClick:()=>n(C.ERROR_ANALYZER),hoverBgClass:"hover:bg-green-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.audio")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addNarratorTextGenerator"),onClick:()=>n(C.NARRATOR_TEXT_GENERATOR),hoverBgClass:"hover:bg-blue-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})}),o.jsx(yt,{title:b("toolbar.addSpeechSynthesizer"),onClick:()=>n(C.SPEECH_SYNTHESIZER),hoverBgClass:"hover:bg-blue-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})}),o.jsx(yt,{title:b("toolbar.addAudioTranscriber"),onClick:()=>n(C.AUDIO_TRANSCRIBER),hoverBgClass:"hover:bg-blue-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})}),o.jsx(yt,{title:b("toolbar.addMusicIdeaGenerator"),onClick:()=>n(C.MUSIC_IDEA_GENERATOR),hoverBgClass:"hover:bg-blue-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.youtube")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.addYouTubeTitleGenerator"),onClick:()=>n(C.YOUTUBE_TITLE_GENERATOR),hoverBgClass:"hover:bg-red-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})}),o.jsx(yt,{title:b("toolbar.addYouTubeAnalytics"),onClick:()=>n(C.YOUTUBE_ANALYTICS),hoverBgClass:"hover:bg-red-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:b("toolbar.group.file")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(yt,{title:b("toolbar.saveProject"),onClick:a,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),o.jsx(yt,{title:b("toolbar.saveCanvas"),onClick:r,hoverBgClass:"hover:bg-emerald-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[o.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),o.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),o.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),o.jsx(yt,{title:b("toolbar.loadCanvas"),onClick:i,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})]})]})]})}),o.jsxs("div",{className:`absolute bottom-2 left-2 z-20 bg-gray-900/50 backdrop-blur-md rounded-lg flex items-center border border-gray-700 shadow-lg pointer-events-auto p-1 
            ${S?"gap-0":"gap-1"} 
            ${I?"flex-col-reverse items-start":"flex-row"}
            max-h-[680px]:top-[calc(4rem+200px+0.5rem)] max-h-[680px]:bottom-auto`,children:[o.jsx("div",{className:"relative flex items-center",children:o.jsx(ht,{title:b(S?"toolbar.expand":"toolbar.collapse"),position:"right",children:o.jsx("button",{onClick:()=>_(!S),className:"h-9 w-9 flex-shrink-0 flex items-center justify-center rounded-md hover:bg-emerald-600 bg-gray-700 text-gray-300 hover:text-white transition-colors",children:S?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M5 3l14 9-14 9V3z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19 3l-14 9 14 9V3z"})})})})}),!S&&o.jsxs("div",{className:`flex items-center gap-1 ${I?"flex-col-reverse":"flex-row"}`,children:[o.jsx(yt,{title:b("toolbar.zoom"),onClick:()=>t("zoom"),isActive:e==="zoom",tooltipPosition:I?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),o.jsxs("div",{className:`flex items-center space-x-2 px-2 h-9 ${I?"hidden":""}`,children:[o.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:z(c.scale),onChange:F=>D(G(parseFloat(F.target.value))),className:"w-24 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),o.jsx(ht,{title:b("toolbar.resetZoom"),position:"top",children:o.jsxs("button",{onClick:()=>D(1),className:"text-sm font-semibold text-gray-300 hover:text-white w-12 text-center hover:bg-emerald-600 rounded-md py-1 transition-colors",children:[Math.round(c.scale*100),"%"]})})]}),I&&o.jsx(yt,{title:b("toolbar.resetZoom"),onClick:()=>D(1),isActive:!1,tooltipPosition:I?"right":"top",children:o.jsxs("span",{className:"text-xs font-bold",children:[Math.round(c.scale*100),"%"]})}),o.jsx(yt,{title:b("toolbar.snapToGrid"),onClick:()=>g(F=>!F),isActive:h,tooltipPosition:I?"right":"top",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:[o.jsx("circle",{cx:"4",cy:"4",r:"1.5"}),o.jsx("circle",{cx:"10",cy:"4",r:"1.5"}),o.jsx("circle",{cx:"16",cy:"4",r:"1.5"}),o.jsx("circle",{cx:"4",cy:"10",r:"1.5"}),o.jsx("circle",{cx:"10",cy:"10",r:"1.5"}),o.jsx("circle",{cx:"16",cy:"10",r:"1.5"}),o.jsx("circle",{cx:"4",cy:"16",r:"1.5"}),o.jsx("circle",{cx:"10",cy:"16",r:"1.5"}),o.jsx("circle",{cx:"16",cy:"16",r:"1.5"})]})}),o.jsx(yt,{title:b("toolbar.lineStyleSpaghetti"),onClick:()=>w("spaghetti"),isActive:m==="spaghetti",tooltipPosition:I?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6C6 12, 18 12, 18 18"})})}),o.jsx(yt,{title:b("toolbar.lineStyleOrthogonal"),onClick:()=>w("orthogonal"),isActive:m==="orthogonal",tooltipPosition:I?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 8h6v8h6"})})}),o.jsx(yt,{title:b("toolbar.clearCanvas"),onClick:y,customClasses:"bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white",tooltipPosition:I?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})},cI=bt.memo(lI),dI=({isOpen:e,onClose:t,onAddNode:n})=>{const{t:r}=Bt(),[a,i]=x.useState(""),[s,l]=x.useState(0),[c,d]=x.useState(!1),[h,g]=x.useState(!1),m=x.useRef(null),w=x.useRef(null),y=x.useMemo(()=>[{group:"input",type:C.TEXT_INPUT,title:r("search.node.text_input.title"),description:r("search.node.text_input.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{group:"input",type:C.NOTE,title:r("search.node.note.title"),description:r("search.node.note.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{group:"scripting",type:C.IDEA_GENERATOR,title:r("search.node.idea_generator.title"),description:r("search.node.idea_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{group:"scripting",type:C.SCRIPT_GENERATOR,title:r("search.node.script_generator.title"),description:r("search.node.script_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{group:"scripting",type:C.SCRIPT_ANALYZER,title:r("search.node.script_analyzer.title"),description:r("search.node.script_analyzer.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{group:"scripting",type:C.SCRIPT_PROMPT_MODIFIER,title:r("search.node.script_prompt_modifier.title"),description:r("search.node.script_prompt_modifier.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})},{group:"process",type:C.PROMPT_PROCESSOR,title:r("search.node.prompt_processor.title"),description:r("search.node.prompt_processor.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"process",type:C.PROMPT_ANALYZER,title:r("search.node.prompt_analyzer.title"),description:r("search.node.prompt_analyzer.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{group:"process",type:C.DATA_READER,title:r("search.node.data_reader.title"),description:r("search.node.data_reader.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{group:"process",type:C.REROUTE_DOT,title:r("search.node.reroute_dot.title"),description:r("search.node.reroute_dot.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})},{group:"character",type:C.CHARACTER_GENERATOR,title:r("search.node.character_generator.title"),description:r("search.node.character_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{group:"character",type:C.CHARACTER_CARD,title:r("search.node.character_card.title"),description:r("search.node.character_card.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{group:"character",type:C.CHARACTER_ANALYZER,title:r("search.node.character_analyzer.title"),description:r("search.node.character_analyzer.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{group:"images",type:C.IMAGE_GENERATOR,title:r("search.node.image_generator.title"),description:r("search.node.image_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{group:"images",type:C.IMAGE_PREVIEW,title:r("search.node.image_preview.title"),description:r("search.node.image_preview.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})},{group:"ai",type:C.TRANSLATOR,title:r("search.node.translator.title"),description:r("search.node.translator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{group:"ai",type:C.GEMINI_CHAT,title:r("search.node.gemini_chat.title"),description:r("search.node.gemini_chat.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:C.ERROR_ANALYZER,title:r("search.node.error_analyzer.title"),description:r("search.node.error_analyzer.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:C.YOUTUBE_TITLE_GENERATOR,title:r("search.node.youtube_title_generator.title"),description:r("search.node.youtube_title_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{group:"ai",type:C.YOUTUBE_ANALYTICS,title:r("node.title.youtube_analytics"),description:r("node.help.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})},{group:"audio",type:C.SPEECH_SYNTHESIZER,title:r("search.node.speech_synthesizer.title"),description:r("search.node.speech_synthesizer.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{group:"audio",type:C.NARRATOR_TEXT_GENERATOR,title:r("search.node.narrator_text_generator.title"),description:r("search.node.narrator_text_generator.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{group:"audio",type:C.AUDIO_TRANSCRIBER,title:r("search.node.audio_transcriber.title"),description:r("search.node.audio_transcriber.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{group:"audio",type:C.MUSIC_IDEA_GENERATOR,title:r("search.node.music_idea_generator.title"),description:r("search.node.music_idea_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}],[r]),b=x.useMemo(()=>({input:r("search.group.input"),process:r("search.group.process"),scripting:r("search.group.scripting"),character:r("search.group.characters"),images:r("search.group.images"),ai:r("search.group.ai"),audio:r("search.group.audio")}),[r]),S={input:"bg-purple-800/50 text-purple-300",process:"bg-green-800/50 text-green-300",scripting:"bg-cyan-800/50 text-cyan-300",character:"bg-pink-800/50 text-pink-300",images:"bg-yellow-800/50 text-yellow-300",ai:"bg-green-800/50 text-green-300",audio:"bg-blue-800/50 text-blue-300"},_=y.filter(f=>f.title.toLowerCase().includes(a.toLowerCase())||f.description.toLowerCase().includes(a.toLowerCase()));x.useEffect(()=>{if(e)d(!0),requestAnimationFrame(()=>g(!0)),setTimeout(()=>{var f;return(f=m.current)==null?void 0:f.focus()},50),i(""),l(0);else{g(!1);const f=setTimeout(()=>d(!1),200);return()=>clearTimeout(f)}},[e]),x.useEffect(()=>{var f;if(s>=0&&s<_.length){const T=(f=w.current)==null?void 0:f.querySelector(`[data-index="${s}"]`);T==null||T.scrollIntoView({block:"nearest"})}},[s,_]);const v=f=>{f.key==="Escape"?t():f.key==="ArrowDown"?(f.preventDefault(),l(T=>Math.min(T+1,_.length-1))):f.key==="ArrowUp"?(f.preventDefault(),l(T=>Math.max(T-1,0))):f.key==="Enter"&&(f.preventDefault(),_[s]&&(n(_[s].type),t()))};return c?o.jsx("div",{className:`fixed inset-0 bg-black/50 z-50 flex items-center justify-center transition-opacity duration-200 ease-out ${h?"opacity-100":"opacity-0"}`,onMouseDown:t,children:o.jsxs("div",{className:`bg-gray-800 rounded-lg w-full max-w-md border border-gray-700 flex flex-col transition-all duration-200 ease-out ${h?"scale-100 opacity-100":"scale-95 opacity-0"}`,onMouseDown:f=>f.stopPropagation(),onKeyDown:v,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("input",{ref:m,type:"text",placeholder:r("search.placeholder"),value:a,onChange:f=>{i(f.target.value),l(0)},className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"})}),o.jsx("ul",{ref:w,className:"max-h-80 overflow-y-auto p-2",onWheel:f=>f.stopPropagation(),children:_.length>0?_.map((f,T)=>{const A=T>0?_[T-1]:null,I=!A||f.group!==A.group;return o.jsxs(bt.Fragment,{children:[I&&o.jsx("li",{className:`px-3 py-1 mt-2 mb-1 text-xs font-bold rounded ${S[f.group]} select-none list-none`,"aria-hidden":"true",children:b[f.group]}),o.jsxs("li",{"data-index":T,onClick:()=>{n(f.type),t()},onMouseEnter:()=>l(T),className:`flex items-center space-x-4 p-3 rounded-md cursor-pointer transition-colors duration-150 ${T===s?"bg-emerald-600":"hover:bg-gray-700"}`,children:[o.jsx("div",{className:`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded ${T===s?"text-white":"text-gray-300"}`,children:f.icon}),o.jsxs("div",{children:[o.jsx("p",{className:`font-semibold ${T===s?"text-white":"text-gray-100"}`,children:f.title}),o.jsx("p",{className:`text-sm ${T===s?"text-emerald-100":"text-gray-400"}`,children:f.description})]})]})]},f.type)}):o.jsx("li",{className:"p-4 text-center text-gray-500",children:r("search.noResults")})})]})}):null},uI=({title:e,onClick:t,children:n})=>{const[r,a]=x.useState(!1);return o.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[o.jsx("button",{onClick:i=>{i.stopPropagation(),t()},onMouseDown:i=>i.stopPropagation(),className:"flex items-center justify-center bg-gray-700 rounded-md hover:bg-emerald-600 transition-colors text-gray-300 hover:text-white w-9 h-9",children:n}),o.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-gray-900 text-gray-100 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 origin-bottom transform ${r?"opacity-100":"opacity-0 pointer-events-none"}`,role:"tooltip",children:e})]})},pI=({isOpen:e,position:t,onClose:n,onAddNode:r,onToolChange:a})=>{const{t:i}=Bt(),{isQuickAddPinned:s,toggleQuickAddPin:l,handlePasteFromClipboard:c}=Qo(),d=x.useRef(null),[h,g]=x.useState(t),[m,w]=x.useState(!1),y=x.useRef(!1),b=x.useRef({x:0,y:0});x.useLayoutEffect(()=>{if(e){const E=d.current?d.current.getBoundingClientRect():{width:300,height:400},P=window.innerWidth,L=window.innerHeight,H=20;let $=t.x+H,U=t.y+H;$+E.width>P&&($=t.x-E.width-H),U+E.height>L&&(U=t.y-E.height-H),$<0&&($=H),U<0&&(U=H),y.current||g({x:$,y:U}),requestAnimationFrame(()=>w(!0)),setTimeout(()=>{var O;return(O=d.current)==null?void 0:O.focus()},50)}else w(!1)},[e,t]),x.useLayoutEffect(()=>{d.current&&(d.current.style.left=`${h.x}px`,d.current.style.top=`${h.y}px`)},[h]);const S=x.useCallback(E=>{if(!y.current||!d.current)return;E.preventDefault();const P=E.clientX-b.current.x,L=E.clientY-b.current.y;d.current.style.left=`${P}px`,d.current.style.top=`${L}px`},[]),_=x.useCallback(E=>{if(y.current&&d.current){const P=E.clientX-b.current.x,L=E.clientY-b.current.y;g({x:P,y:L})}y.current=!1,window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",_)},[]),v=E=>{var L;if(E.button!==0)return;E.stopPropagation();const P=(L=d.current)==null?void 0:L.getBoundingClientRect();P&&(y.current=!0,b.current={x:E.clientX-P.left,y:E.clientY-P.top},window.addEventListener("mousemove",S),window.addEventListener("mouseup",_))},f=x.useCallback(async()=>{await c(),s||n()},[c,s,n]);x.useEffect(()=>()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",_)},[S,_]);const T=E=>{E.key==="Escape"&&(E.stopPropagation(),n())},A=x.useMemo(()=>({tools:{title:i("hotkeys.tools.title"),items:[{type:"tool",id:"edit",title:i("toolbar.edit"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})},{type:"tool",id:"cutter",title:i("toolbar.cutter"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"tool",id:"selection",title:i("toolbar.selection"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})},{type:"tool",id:"reroute",title:i("toolbar.reroute"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})}]},general_youtube:{title:`${i("toolbar.group.general")} / ${i("toolbar.group.youtube")}`,items:[{type:"node",id:C.NOTE,title:i("toolbar.addNote"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:"node",id:C.DATA_READER,title:i("toolbar.addDataReader"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:C.YOUTUBE_TITLE_GENERATOR,title:i("toolbar.addYouTubeTitleGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:"node",id:C.YOUTUBE_ANALYTICS,title:i("toolbar.addYouTubeAnalytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]},prompting:{title:i("toolbar.group.prompting"),items:[{type:"node",id:C.TEXT_INPUT,title:i("toolbar.addTextInput"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{type:"node",id:C.PROMPT_PROCESSOR,title:i("toolbar.addPromptProcessor"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:"node",id:C.PROMPT_ANALYZER,title:i("toolbar.addPromptAnalyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}]},scripting:{title:i("toolbar.group.scripting"),items:[{type:"node",id:C.IDEA_GENERATOR,title:i("toolbar.addIdeaGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:"node",id:C.SCRIPT_GENERATOR,title:i("toolbar.addScriptGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:"node",id:C.SCRIPT_ANALYZER,title:i("toolbar.addScriptAnalyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:"node",id:C.SCRIPT_PROMPT_MODIFIER,title:i("toolbar.addScriptPromptModifier"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},characters:{title:i("toolbar.group.characters"),items:[{type:"node",id:C.CHARACTER_GENERATOR,title:i("toolbar.addCharacterGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:"node",id:C.CHARACTER_CARD,title:i("toolbar.addCharacterCard"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:"node",id:C.CHARACTER_ANALYZER,title:i("toolbar.addCharacterAnalyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},images:{title:i("toolbar.group.images"),items:[{type:"node",id:C.IMAGE_GENERATOR,title:i("toolbar.addImageGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:"node",id:C.IMAGE_PREVIEW,title:i("toolbar.addImagePreview"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},ai:{title:i("toolbar.group.ai"),items:[{type:"node",id:C.TRANSLATOR,title:i("toolbar.addTranslator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:"node",id:C.GEMINI_CHAT,title:i("toolbar.addGeminiChat"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"node",id:C.ERROR_ANALYZER,title:i("toolbar.addErrorAnalyzer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},audio:{title:i("toolbar.group.audio"),items:[{type:"node",id:C.SPEECH_SYNTHESIZER,title:i("toolbar.addSpeechSynthesizer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:"node",id:C.NARRATOR_TEXT_GENERATOR,title:i("toolbar.addNarratorTextGenerator"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:"node",id:C.AUDIO_TRANSCRIBER,title:i("toolbar.addAudioTranscriber"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:"node",id:C.MUSIC_IDEA_GENERATOR,title:i("toolbar.addMusicIdeaGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]}}),[i]),I=E=>{E.type==="tool"?a(E.id):E.type==="node"&&r(E.id),s||n()},M=["tools","audio","characters","prompting"],N=["scripting","general_youtube","ai","images"],k=E=>o.jsxs("div",{className:"w-full",children:[o.jsx("span",{className:"text-xs text-gray-400 font-semibold px-1",children:E.title}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:E.items.map(P=>o.jsx(uI,{title:P.title,onClick:()=>I(P),children:P.icon},P.id))})]});return e?o.jsxs("div",{ref:d,tabIndex:-1,className:`fixed bg-gray-800/90 backdrop-blur-sm rounded-lg border border-gray-700 p-2 flex flex-col items-start z-[51] focus:outline-none cursor-default transition-[opacity,transform] duration-200 ease-out ${m?"opacity-100 scale-100":"opacity-0 scale-95"} ${s?"pinned-menu":""}`,style:{left:h.x,top:h.y},onMouseDown:v,onKeyDown:T,children:[o.jsxs("div",{className:"flex justify-between items-center w-full mb-1 cursor-move border-b border-gray-700/50 pb-1",children:[o.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase px-1 select-none",children:i("quickAddMenu.title")}),o.jsx("button",{onClick:E=>{E.stopPropagation(),l()},className:`p-1 rounded hover:bg-emerald-600 hover:text-white transition-colors ${s?"text-emerald-400":"text-gray-400"}`,title:s?"Unpin":"Pin",onMouseDown:E=>E.stopPropagation(),children:s?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:o.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.563.045.796.77.357 1.145l-4.163 3.566a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.163-3.566c-.44-.375-.206-1.1.357-1.145l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"})})})]}),o.jsxs("div",{className:"flex flex-row items-start gap-2 w-full",children:[o.jsx("div",{className:"flex flex-col space-y-2 w-full",children:M.map(E=>A[E]&&o.jsx("div",{children:k(A[E])},E))}),o.jsx("div",{className:"flex flex-col space-y-2 w-full",children:N.map(E=>A[E]&&o.jsx("div",{children:k(A[E])},E))})]}),o.jsx("div",{className:"h-px bg-gray-700 w-full my-1"}),o.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center space-x-2 p-1.5 rounded hover:bg-gray-700 text-gray-300 hover:text-white transition-colors text-xs font-semibold",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),o.jsx("span",{children:i("contextMenu.paste")})]})]}):null},Or=400,Rn=Or/2,ar=184,ir=116,hI=60,Ac=Math.PI,Es={emerald:{fill:"rgba(6, 95, 70, 0.8)",stroke:"rgba(5, 150, 105, 0.9)",iconBg:"rgba(5, 150, 105, 1)",iconColor:"#34d399"},purple:{fill:"rgba(91, 33, 182, 0.8)",stroke:"rgba(124, 58, 237, 0.9)",iconBg:"rgba(124, 58, 237, 1)",iconColor:"#c084fc"},cyan:{fill:"rgba(21, 94, 117, 0.8)",stroke:"rgba(6, 182, 212, 0.9)",iconBg:"rgba(6, 182, 212, 1)",iconColor:"#22d3ee"},pink:{fill:"rgba(157, 23, 77, 0.8)",stroke:"rgba(219, 39, 119, 0.9)",iconBg:"rgba(219, 39, 119, 1)",iconColor:"#f472b6"},yellow:{fill:"rgba(180, 83, 9, 0.8)",stroke:"rgba(234, 179, 8, 0.9)",iconBg:"rgba(234, 179, 8, 1)",iconColor:"#facc15"},amber:{fill:"rgba(146, 64, 14, 0.8)",stroke:"rgba(217, 119, 6, 0.9)",iconBg:"rgba(217, 119, 6, 1)",iconColor:"#fbbf24"},blue:{fill:"rgba(30, 64, 175, 0.8)",stroke:"rgba(59, 130, 246, 0.9)",iconBg:"rgba(59, 130, 246, 1)",iconColor:"#60a5fa"},gray:{fill:"rgba(55, 65, 81, 0.8)",stroke:"rgba(107, 114, 128, 0.9)",iconBg:"rgb(75, 85, 99)",iconColor:"#9ca3af"},green:{fill:"rgba(22, 163, 74, 0.8)",stroke:"rgba(21, 128, 61, 0.9)",iconBg:"rgba(21, 128, 61, 1)",iconColor:"#4ade80"},red:{fill:"rgba(185, 28, 28, 0.8)",stroke:"rgba(220, 38, 38, 0.9)",iconBg:"rgba(220, 38, 38, 1)",iconColor:"#f87171"}},mI=({isOpen:e,position:t,onClose:n,onAddNode:r,onSelectItem:a})=>{const{t:i}=Bt(),[s,l]=x.useState(null),c=x.useMemo(()=>[{name:i("search.group.input"),color:"emerald",options:[{type:C.TEXT_INPUT,title:i("search.node.text_input.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{type:C.NOTE,title:i("search.node.note.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:C.DATA_READER,title:i("search.node.data_reader.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}]},{name:i("search.group.process"),color:"purple",options:[{type:C.PROMPT_PROCESSOR,title:i("search.node.prompt_processor.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:C.PROMPT_ANALYZER,title:i("search.node.prompt_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:C.REROUTE_DOT,title:i("search.node.reroute_dot.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})}]},{name:i("search.group.scripting"),color:"cyan",options:[{type:C.IDEA_GENERATOR,title:i("node.title.idea_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:C.SCRIPT_GENERATOR,title:i("search.node.script_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:C.SCRIPT_ANALYZER,title:i("search.node.script_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:C.SCRIPT_PROMPT_MODIFIER,title:i("search.node.script_prompt_modifier.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},{name:i("search.group.character"),color:"pink",options:[{type:C.CHARACTER_GENERATOR,title:i("search.node.character_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:C.CHARACTER_CARD,title:i("search.node.character_card.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:C.CHARACTER_ANALYZER,title:i("search.node.character_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},{name:i("search.group.images"),color:"yellow",options:[{type:C.IMAGE_GENERATOR,title:i("search.node.image_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:C.IMAGE_PREVIEW,title:i("search.node.image_preview.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},{name:i("search.group.ai"),color:"green",options:[{type:C.TRANSLATOR,title:i("search.node.translator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:C.GEMINI_CHAT,title:i("search.node.gemini_chat.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:C.ERROR_ANALYZER,title:i("search.node.error_analyzer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},{name:i("search.group.audio"),color:"blue",options:[{type:C.SPEECH_SYNTHESIZER,title:i("search.node.speech_synthesizer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:C.NARRATOR_TEXT_GENERATOR,title:i("search.node.narrator_text_generator.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:C.AUDIO_TRANSCRIBER,title:i("search.node.audio_transcriber.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:C.MUSIC_IDEA_GENERATOR,title:i("search.node.music_idea_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]},{name:i("search.group.youtube"),color:"red",options:[{type:C.YOUTUBE_TITLE_GENERATOR,title:i("search.node.youtube_title_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:C.YOUTUBE_ANALYTICS,title:i("search.node.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]}],[i]),d=x.useMemo(()=>c.reduce((m,w)=>m+w.options.length,0),[c]),h=m=>{const w=m.clientX-t.x,y=m.clientY-t.y;if(Math.sqrt(w*w+y*y)<hI){s&&(l(null),a(null));return}let S=Math.atan2(y,w)-Ac;S<0&&(S+=2*Math.PI);let _=0,v=null;for(const f of c){const T=f.options.length/d*(2*Math.PI);if(S>=_&&S<_+T){const A=S-_,I=T/f.options.length,M=Math.floor(A/I);M>=0&&M<f.options.length&&(v=f.options[M]);break}_+=T}s!==v&&(l(v),a(v?v.type:null))},g=m=>{s&&r(s.type),n()};return e?o.jsx("div",{className:"fixed inset-0 z-40 pointer-events-auto",onMouseMove:h,onMouseDown:g,onContextMenu:m=>m.preventDefault(),children:o.jsx("div",{className:"absolute pointer-events-none",style:{left:t.x-Rn,top:t.y-Rn},children:o.jsxs("svg",{width:Or,height:Or,viewBox:`0 0 ${Or} ${Or}`,children:[o.jsx("defs",{children:o.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),o.jsx("g",{children:(()=>{let m=Ac;return c.map(w=>{const y=w.options.length/d*(2*Math.PI),b=m,S=b+y;m=S;const _=y>Math.PI?1:0,v=`
                                    M ${Rn+ir*Math.cos(b)} ${Rn+ir*Math.sin(b)}
                                    A ${ir} ${ir} 0 ${_} 1 ${Rn+ir*Math.cos(S)} ${Rn+ir*Math.sin(S)}
                                    L ${Rn+ar*Math.cos(S)} ${Rn+ar*Math.sin(S)}
                                    A ${ar} ${ar} 0 ${_} 0 ${Rn+ar*Math.cos(b)} ${Rn+ar*Math.sin(b)}
                                    Z
                                `;return o.jsx("path",{d:v,stroke:"none",style:{fill:"rgba(31, 41, 55, 0.9)",transition:"fill 0.2s"}},w.name)})})()}),o.jsx("circle",{cx:Rn,cy:Rn,r:ar,fill:"none",stroke:"rgba(75, 85, 99, 0.6)",strokeWidth:"1"}),o.jsx("circle",{cx:Rn,cy:Rn,r:ir,fill:"none",stroke:"rgba(75, 85, 99, 0.6)",strokeWidth:"1"}),o.jsx("g",{children:(()=>{let m=Ac;return c.map(w=>{const y=w.options.length/d*(2*Math.PI),b=m,S=y/w.options.length;return m+=y,w.options.map((_,v)=>{const f=b+(v+.5)*S,T=(ir+ar)/2,A=Rn+T*Math.cos(f),I=Rn+T*Math.sin(f),M=s===_;return o.jsxs("g",{transform:`translate(${A}, ${I})`,style:{pointerEvents:"none"},children:[o.jsx("circle",{cx:"0",cy:"0",r:"20",style:{fill:M?Es[w.color].iconBg:"transparent",transition:"transform 0.2s, filter 0.2s, fill 0.2s",transform:M?"scale(1.2)":"scale(1)",filter:M?"url(#glow)":"none"}}),o.jsx("g",{transform:"translate(-12, -12)",style:{color:M?"white":Es[w.color].iconColor},children:bt.cloneElement(_.icon,{width:24,height:24})})]},_.type)})})})()}),s&&o.jsx("foreignObject",{x:"0",y:"0",width:Or,height:Or,style:{pointerEvents:"none"},children:o.jsxs("div",{className:"relative w-full h-full",children:[(()=>{const m=c.find(y=>y.options.includes(s)),w=m?Es[m.color].iconBg:Es.gray.iconBg;return o.jsx("div",{style:{backgroundColor:w},className:"w-14 h-14 rounded-lg flex items-center justify-center text-white absolute top-[42%] left-1/2 -translate-x-1/2 -translate-y-1/2",children:bt.cloneElement(s.icon,{className:"h-8 w-8"})})})(),o.jsx("p",{className:"absolute top-[42%] left-1/2 -translate-x-1/2 mt-9 w-40 text-center font-bold text-white drop-shadow-lg",children:s.title})]})})]})})}):null},gI=({isOpen:e,initialValue:t,onConfirm:n,onClose:r,title:a,label:i,confirmButtonText:s,cancelButtonText:l,deselectAllNodes:c})=>{const{t:d}=Bt(),[h,g]=x.useState(t),m=x.useRef(null);x.useEffect(()=>{e&&(g(t),setTimeout(()=>{var b;return(b=m.current)==null?void 0:b.focus()},100))},[e,t]);const w=()=>{h.trim()&&n(h.trim())},y=b=>{b.key==="Enter"?w():b.key==="Escape"&&r()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onMouseDown:r,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-sm border border-gray-700 flex flex-col",onMouseDown:b=>b.stopPropagation(),onKeyDown:y,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:a||d("dialog.rename.title")})}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsx("label",{htmlFor:"rename-input",className:"block text-sm font-medium text-gray-300",children:i||d("dialog.rename.label")}),o.jsx("input",{id:"rename-input",ref:m,type:"text",value:h,onChange:b=>g(b.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500",onFocus:c})]}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:l||d("dialog.rename.cancel")}),o.jsx("button",{onClick:w,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:s||d("dialog.rename.confirm")})]})]})}):null},Go=({title:e,onClick:t,children:n})=>o.jsx("button",{onClick:t,onMouseDown:r=>r.stopPropagation(),"aria-label":e,title:e,className:"p-2 text-gray-300 rounded-full hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-emerald-500",children:n}),fI=({item:e,onAddToCanvas:t,onNavigate:n,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:h,setIsDragOver:g})=>{const{t:m}=Bt(),w=e.type===Ze.FOLDER,y=w?()=>n(e.id):()=>{},b=f=>{l(),f.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===Ze.GROUP?"catalog-group":`catalog-data-${e.type.toLowerCase()}`,itemId:e.id,itemData:e.data})),f.dataTransfer.effectAllowed="copyMove"},S=f=>{w&&s&&(s.tab==="groups"||s.tab==="generic")&&s.id!==e.id&&(f.preventDefault(),g(!0))},_=f=>{w&&(f.preventDefault(),f.stopPropagation(),g(!1),d(e.id))},v=()=>{if(w)return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})});switch(e.type){case Ze.GROUP:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})});case Ze.CHARACTERS:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-pink-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})});case Ze.SCRIPT:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})});case Ze.ANALYSIS:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case Ze.FINAL_PROMPTS:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case Ze.YOUTUBE:return e.data&&e.data.type==="youtube-analytics-data"?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case Ze.MUSIC:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})});default:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})}};return o.jsxs("div",{draggable:!0,onDragStart:b,onDragEnd:c,onDragOver:S,onDragLeave:()=>g(!1),onDrop:_,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-emerald-500 transition-colors duration-200 ${h?"ring-2 ring-emerald-400":""}`,children:[o.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:y,style:{cursor:w?"pointer":"default"},children:o.jsx("div",{className:`absolute w-full h-full ${w?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center transition-transform`,children:v()})}),o.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),o.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[e.type===Ze.GROUP&&o.jsx(Go,{title:m("catalog.card.addToCanvas"),onClick:()=>t(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(Go,{title:m("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),o.jsx(Go,{title:m("catalog.card.save"),onClick:()=>a(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Go,{title:m("catalog.card.delete"),onClick:()=>i(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},yI=({item:e,onNavigate:t,onEdit:n,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:h,setIsDragOver:g})=>{const{t:m}=Bt(),w=e.type===Yt.FOLDER,y=()=>{e.content&&navigator.clipboard.writeText(e.content).catch(f=>console.error("Copy failed",f))},b=w?()=>t(e.id):()=>{},S=f=>{l(),f.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===Yt.FOLDER?"library-folder":"library-prompt",itemId:e.id,content:e.content})),f.dataTransfer.effectAllowed="copyMove"},_=f=>{w&&s&&s.tab==="library"&&s.id!==e.id&&(f.preventDefault(),g(!0))},v=f=>{w&&(f.preventDefault(),f.stopPropagation(),g(!1),d(e.id))};return o.jsxs("div",{draggable:!0,onDragStart:S,onDragEnd:c,onDragOver:_,onDragLeave:()=>g(!1),onDrop:v,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-emerald-500 transition-colors duration-200 ${h?"ring-2 ring-emerald-400":""}`,children:[o.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:b,style:{cursor:w?"pointer":"default"},children:o.jsx("div",{className:`absolute w-full h-full ${w?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center transition-transform`,children:w?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),o.jsxs("div",{className:"text-center w-full min-h-[4rem]",children:[o.jsx("p",{className:"font-semibold text-gray-100 break-all w-full truncate",title:e.name,children:e.name}),!w&&o.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:e.content||m("library.emptyPrompt")})]}),o.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[!w&&o.jsxs(o.Fragment,{children:[o.jsx(Go,{title:m("library.actions.copy"),onClick:y,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Go,{title:m("library.actions.edit"),onClick:()=>n(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),o.jsx(Go,{title:m("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),o.jsx(Go,{title:m("catalog.card.save"),onClick:()=>a(e),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Go,{title:m("catalog.card.delete"),onClick:()=>i(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},xI=e=>{const{isOpen:t,onClose:n,currentCatalogItems:r,catalogPath:a,onCatalogNavigateBack:i,onCatalogNavigateToFolder:s,onCreateCatalogFolder:l,onAddGroupFromCatalog:c,onRenameCatalogItem:d,onSaveCatalogItem:h,onDeleteCatalogItem:g,onLoadCatalogItemFromFile:m,onMoveCatalogItem:w,activeCategory:y,setActiveCategory:b,libraryItems:S,libraryPath:_,onNavigateBack:v,onNavigateToFolder:f,onCreateLibraryItem:T,onEditLibraryItem:A,onRenameLibraryItem:I,onDeleteLibraryItem:M,onSaveLibraryItem:N,onLoadLibraryItemFromFile:k,onMoveLibraryItem:E}=e,{t:P}=Bt(),[L,H]=x.useState(Ze.GROUP),[$,U]=x.useState(null),[O,D]=x.useState(null),z=x.useRef(null),G=x.useRef([]);if(!t)return null;const F=()=>{U(null),D(null)},K=(W,le)=>{H(W),W!=="library"?(b(W),s(null)):f(null);const X=z.current,Te=G.current[le];if(X&&Te){const pe=X.getBoundingClientRect(),ue=Te.getBoundingClientRect(),Oe=pe.left+pe.width/2,ye=ue.left+ue.width/2-Oe;X.scrollTo({left:X.scrollLeft+ye,behavior:"smooth"})}},ae=[{id:Ze.GROUP,label:P("catalog.tabs.groups")},{id:"library",label:P("catalog.tabs.library")},{id:Ze.CHARACTERS,label:P("catalog.tabs.characters")},{id:Ze.SCRIPT,label:P("catalog.tabs.scripts")},{id:Ze.ANALYSIS,label:P("catalog.tabs.analysis")},{id:Ze.FINAL_PROMPTS,label:P("catalog.tabs.final_prompts")},{id:Ze.YOUTUBE,label:P("catalog.tabs.youtube")},{id:Ze.MUSIC,label:P("catalog.tabs.music")}],Y=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[o.jsx("button",{onClick:i,disabled:a.length<=1,className:`p-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${O==="back-catalog"?"bg-emerald-700":"hover:bg-gray-700"}`,onDragOver:W=>{(($==null?void 0:$.tab)==="groups"||($==null?void 0:$.tab)==="generic")&&a.length>1&&(W.preventDefault(),D("back-catalog"))},onDragLeave:()=>D(null),onDrop:W=>{if(W.preventDefault(),D(null),!$||$.tab!=="groups"&&$.tab!=="generic")return;const le=a.length>1?a[a.length-2].id:null;w($.id,le)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),o.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:a.map((W,le)=>o.jsxs(bt.Fragment,{children:[o.jsx("span",{onClick:()=>s(W.id),className:"px-1 hover:text-white cursor-pointer truncate",children:W.name}),le<a.length-1&&o.jsx("span",{className:"px-1 select-none",children:"/"})]},W.id||"root"))})]}),o.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[o.jsxs("button",{onClick:m,className:"px-3 py-2 text-sm font-semibold bg-emerald-600 hover:bg-emerald-700 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),o.jsx("span",{children:P("catalog.loadFromFile")})]}),o.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),o.jsx("span",{children:P("library.actions.newFolder")})]})]})]}),o.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:r.length>0?o.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(W=>o.jsx(fI,{item:W,onAddToCanvas:c,onNavigate:le=>s(le),onRename:d,onSave:h,onDelete:g,draggedItem:$,onDragStart:()=>U({id:W.id,tab:W.type===Ze.GROUP?"groups":"generic"}),onDragEnd:F,onMoveItem:le=>w($.id,le),isDragOver:O===W.id,setIsDragOver:le=>D(le?W.id:null)},W.id))}):o.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),o.jsx("p",{className:"font-semibold",children:P("catalog.empty.title")}),o.jsx("p",{className:"text-sm",children:P("catalog.empty.description")})]})})]}),ge=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[o.jsx("button",{onClick:v,disabled:_.length<=1,className:`p-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${O==="back-library"?"bg-emerald-700":"hover:bg-gray-700"}`,onDragOver:W=>{($==null?void 0:$.tab)==="library"&&_.length>1&&(W.preventDefault(),D("back-library"))},onDragLeave:()=>D(null),onDrop:W=>{if(W.preventDefault(),D(null),!$||$.tab!=="library")return;const le=_.length>1?_[_.length-2].id:null;E($.id,le)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),o.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:_.map((W,le)=>o.jsxs(bt.Fragment,{children:[o.jsx("span",{onClick:()=>f(W.id==="root"?null:W.id),className:"px-1 hover:text-white cursor-pointer truncate",children:W.name}),le<_.length-1&&o.jsx("span",{className:"px-1 select-none",children:"/"})]},W.id||"root"))})]}),o.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[o.jsxs("button",{onClick:k,className:"px-3 py-2 text-sm font-semibold bg-emerald-600 hover:bg-emerald-700 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),o.jsx("span",{children:P("library.loadFromFile")})]}),o.jsxs("button",{onClick:()=>T(Yt.FOLDER),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),o.jsx("span",{children:P("library.actions.newFolder")})]}),o.jsxs("button",{onClick:()=>T(Yt.PROMPT),className:"px-3 py-2 text-sm font-semibold bg-emerald-600 hover:bg-emerald-700 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("span",{children:P("library.actions.newPrompt")})]})]})]}),o.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:S.length>0?o.jsx("div",{className:"grid grid-cols-3 gap-4",children:S.map(W=>o.jsx(yI,{item:W,onNavigate:f,onEdit:A,onRename:I,onSave:N,onDelete:M,draggedItem:$,onDragStart:()=>U({id:W.id,tab:"library"}),onDragEnd:F,onMoveItem:le=>E($.id,le),isDragOver:O===W.id,setIsDragOver:le=>D(le?W.id:null)},W.id))}):o.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),o.jsx("p",{className:"font-semibold",children:P("library.empty.title")}),o.jsx("p",{className:"text-sm",children:P("library.empty.description")})]})})]});return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl border border-gray-700 flex flex-col h-[80vh] pointer-events-auto shadow-2xl",onMouseDown:W=>W.stopPropagation(),children:[o.jsxs("div",{className:"p-4 pb-0 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[o.jsx("div",{ref:z,className:"flex items-end space-x-1 overflow-x-auto pb-2 w-full mr-4 no-scrollbar relative",style:{scrollbarWidth:"none"},children:ae.map((W,le)=>o.jsx("button",{ref:X=>{G.current[le]=X},onClick:()=>K(W.id,le),className:`px-4 py-2 text-sm font-bold whitespace-nowrap transition-colors rounded-t-md ${L===W.id?"bg-gray-700 text-emerald-400 border-t-2 border-emerald-400":"text-gray-400 hover:text-white hover:bg-gray-700/50"}`,children:W.label},W.id))}),o.jsx("button",{onClick:n,className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white mb-2",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),L==="library"?ge():Y()]})})},vI=()=>{const{language:e,setLanguage:t}=Bt(),[n,r]=x.useState(!1),[a,i]=x.useState(()=>e==="en"?"ru":e);x.useEffect(()=>{e!=="en"&&i(e)},[e]);const s=x.useMemo(()=>jl.filter(b=>hw.includes(b.code)&&b.code!=="en").sort((b,S)=>b.code==="sys"?1:S.code==="sys"?-1:0),[]),l=s.find(y=>y.code===a)||s[0],c=()=>{e!==l.code&&t(l.code)},d=y=>{t(y),r(!1)},h=x.useRef(null),g=x.useRef(null);x.useEffect(()=>{const y=b=>{h.current&&!h.current.contains(b.target)&&g.current&&!g.current.contains(b.target)&&r(!1)};return n&&document.addEventListener("mousedown",y,!0),()=>{document.removeEventListener("mousedown",y,!0)}},[n]);const[m,w]=x.useState({});return x.useEffect(()=>{if(n&&g.current){const y=g.current.getBoundingClientRect();w({position:"fixed",top:`${y.bottom+6}px`,right:`${window.innerWidth-y.right}px`,minWidth:"140px",zIndex:9999})}},[n]),o.jsxs("div",{className:"flex items-center h-9 gap-1",children:[o.jsx(ht,{title:"English",position:"bottom",className:"h-full",children:o.jsx("button",{onClick:()=>t("en"),className:`px-3 py-1 text-xs font-bold transition-colors h-full rounded-md min-w-[36px] ${e==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-700 text-gray-300 hover:bg-emerald-600 hover:text-white"}`,children:"EN"})}),o.jsxs("div",{className:"flex items-center h-full relative group",children:[o.jsx(ht,{title:l.name,position:"bottom",className:"h-full",children:o.jsx("button",{onClick:c,className:`px-2 py-1 text-xs font-bold transition-colors h-full min-w-[36px] flex items-center justify-center rounded-l-md ${e===l.code?"bg-emerald-600 text-white shadow-sm":"bg-gray-700 text-gray-300 hover:bg-emerald-600 hover:text-white"}`,children:l.label})}),o.jsx("button",{ref:g,onClick:y=>{y.stopPropagation(),r(!n)},className:`px-1 py-1 h-full rounded-r-md flex items-center justify-center transition-colors border-l ${e===l.code?"bg-emerald-600 hover:bg-emerald-500 text-white border-emerald-700":"bg-gray-700 hover:bg-emerald-600 text-gray-400 hover:text-white border-gray-600/30"}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transition-transform duration-200 ${n?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n&&Yi.createPortal(o.jsxs("div",{ref:h,style:m,className:"bg-gray-800 border border-gray-600 rounded-lg shadow-2xl py-1 flex flex-col animate-fade-in-up origin-top-right",onWheel:y=>y.stopPropagation(),children:[o.jsx("div",{className:"px-3 py-1.5 text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-gray-700 mb-1 select-none",children:"Select Language"}),s.map(y=>o.jsxs("button",{onClick:()=>d(y.code),className:`px-4 py-2 text-left text-sm hover:bg-gray-700 flex justify-between items-center group transition-colors ${e===y.code?"text-emerald-400 font-bold bg-gray-700/50":"text-gray-300"}`,children:[o.jsx("span",{className:"truncate mr-4",children:y.name}),o.jsx("span",{className:`text-xs font-mono px-1.5 py-0.5 rounded ${e===y.code?"bg-emerald-900/30 text-emerald-400":"bg-gray-900 text-gray-500 group-hover:text-gray-400"}`,children:y.label})]},y.code))]}),document.body)]})]})},bI=({isOpen:e,onAllow:t,onDecline:n})=>{const{t:r}=Bt();return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md border border-gray-700 flex flex-col",children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:r("dialog.permission.title")})}),o.jsx("div",{className:"p-4 space-y-4",children:o.jsx("p",{className:"text-sm text-gray-300",children:r("dialog.permission.description")})}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:n,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:r("dialog.permission.decline")}),o.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:r("dialog.permission.allow")})]})]})}):null},wI=({isOpen:e,onConfirm:t,onClose:n,title:r,message:a})=>{const{t:i}=Bt(),s=()=>{t(),n()},l=c=>{c.key==="Enter"?s():c.key==="Escape"&&n()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4",onMouseDown:n,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-sm border border-gray-700 flex flex-col",onMouseDown:c=>c.stopPropagation(),onKeyDown:l,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:r})}),o.jsx("div",{className:"p-4 space-y-4",children:o.jsx("p",{className:"text-sm text-gray-300",children:a})}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:n,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:i("dialog.confirmDelete.cancel")}),o.jsx("button",{onClick:s,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:i("dialog.confirmDelete.confirm")})]})]})}):null},Ud=({title:e,children:t,position:n="bottom",className:r=""})=>{const[a,i]=x.useState(!1),s={top:"bottom-full left-1/2 -translate-x-1/2 mb-1.5",bottom:"top-full left-1/2 -translate-x-1/2 mt-1.5",left:"right-full top-1/2 -translate-y-1/2 mr-1.5",right:"left-full top-1/2 -translate-y-1/2 ml-1.5"};return o.jsxs("div",{className:`relative flex items-center ${r}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[t,o.jsx("div",{className:`absolute px-2 py-1 bg-gray-900 text-gray-200 text-xs font-medium whitespace-nowrap rounded shadow-xl z-[100] pointer-events-none transition-opacity duration-200 ${s[n]} ${a?"opacity-100":"opacity-0"}`,role:"tooltip",children:e})]})},_I=()=>{const{t:e}=Bt(),[t,n]=x.useState(!1),[r,a]=x.useState("hotkeys"),i=x.useRef(null),s=x.useRef(null),[l,c]=x.useState({opacity:0,pointerEvents:"none",position:"fixed"}),[d,h]=x.useState(null);x.useEffect(()=>{const v=f=>{f.key==="F1"&&(f.preventDefault(),n(T=>!T))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[]),x.useEffect(()=>{if(t){if(i.current){const v=i.current.getBoundingClientRect();c({position:"fixed",top:`${v.bottom+8}px`,left:`${v.left}px`,opacity:1,pointerEvents:"auto",transition:"opacity 150ms ease-in-out"})}}else c(v=>({...v,opacity:0,pointerEvents:"none"}))},[t]),x.useEffect(()=>{if(!t)return;const v=f=>{s.current&&!s.current.contains(f.target)&&i.current&&!i.current.contains(f.target)&&n(!1)};return document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[t]);const g=v=>{navigator.clipboard.writeText(v),h(v),setTimeout(()=>h(null),1500)},m=x.useMemo(()=>[{category:e("help.category.socials"),headerColor:"text-red-400",links:[{label:e("help.link.youtube"),subLabel:"@MurcelloNovaes",url:"https://www.youtube.com/@MurcelloNovaes",iconType:"youtube"},{label:"Linktree",subLabel:"meowmasterart",url:"https://linktr.ee/meowmasterart",iconType:"linktree"},{label:e("help.link.telegram_channel"),subLabel:e("help.sub.news"),url:"https://t.me/+h0YEu0nx9QdhMDNi",iconType:"telegram"},{label:e("help.link.telegram_chat"),subLabel:e("help.sub.discussion"),url:"https://t.me/+tyQLGFxiEbRhMDdi",iconType:"telegram"}]},{category:e("help.category.gh_pages"),headerColor:"text-purple-400",links:[{label:"Script Modifier",subLabel:"GitHub Pages",url:"https://neytrino2134.github.io/Script-Modifier/",iconType:"github"},{label:"Prompt Modifier",subLabel:"GitHub Pages",url:"https://neytrino2134.github.io/Prompt-Modifier/",iconType:"github"}]},{category:e("help.category.web"),headerColor:"text-cyan-400",links:[{label:"Script Modifier Web",subLabel:"scriptmodifier2.netlify.app",url:"https://scriptmodifier2.netlify.app/",iconType:"netlify"},{label:"Prompt Modifier Web",subLabel:"promptmodifier2.netlify.app",url:"https://promptmodifier2.netlify.app/",iconType:"netlify"}]},{category:e("help.category.stable"),headerColor:"text-blue-400",links:[{label:"Script Modifier 0.1.3",subLabel:e("help.sub.stable"),url:"https://ai.studio/apps/drive/1enTmQ5Wz9RBArkZMZm5s5nYQcKxQ9L8M?fullscreenApplet=true",iconType:"google"},{label:"Prompt Modifier 0.1.7",subLabel:e("help.sub.stable"),url:"https://ai.studio/apps/drive/1YCO0DaA4BTm9p0j5XqvpBhX_XTg9ClwC?fullscreenApplet=true",iconType:"google"}]},{category:e("help.category.alpha"),headerColor:"text-blue-400",links:[{label:"Script Modifier 0.1.5",subLabel:e("help.sub.alpha"),url:"https://aistudio.google.com/apps/drive/1y9CSUmlVQK2xq7ckses7fpM6wpbZdBnB?showAssistant=true&resourceKey=&showPreview=true",iconType:"google"},{label:"Prompt Modifier 0.1.8",subLabel:e("help.sub.alpha"),url:"https://aistudio.google.com/apps/drive/1OJfPP9wUKlnjvZ5_2_Fxq_v1dW0iftlW?showAssistant=true&resourceKey=&showPreview=true",iconType:"google"}]},{category:e("help.category.github"),headerColor:"text-yellow-400",links:[{label:"Script Modifier Repo",subLabel:"v0.1.5 Alpha",url:"https://github.com/Neytrino2134/Script-Modifier",iconType:"github"},{label:"Prompt Modifier Repo",subLabel:"v0.1.8 Alpha",url:"https://github.com/Neytrino2134/Prompt-Modifier",iconType:"github"}]}],[e]),w=v=>{switch(v){case"youtube":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-red-500",children:o.jsx("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})});case"telegram":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-sky-400",children:o.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 11.944 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})});case"google":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-blue-500",children:o.jsx("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})});case"netlify":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-cyan-400",children:o.jsx("path",{d:"M6.48 2.81L2.09 10.42 5.54 21.19zM11.66 21.19L8.21 10.42 12.6 2.81 17 10.42zM18.46 21.19L21.91 10.42 17.52 2.81z"})});case"github":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-gray-200",children:o.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})});case"linktree":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-green-500",children:o.jsx("path",{d:"M13.736 5.853L12 2 10.264 5.853H2v2.836l6.632 2.65L2.35 17.65l1.836 1.837 6.945-6.946v9.433h1.738v-9.433l6.945 6.946 1.836-1.837-6.281-6.282 6.631-2.65V5.853h-8.264z"})});default:return o.jsx("div",{className:"w-5 h-5 bg-gray-500 rounded-full"})}},y={tools:[{key:"V",description:e("hotkeys.tools.edit")},{key:"C",description:e("hotkeys.tools.cutter")},{key:"S",description:e("hotkeys.tools.selection")},{key:"R",description:e("hotkeys.tools.reroute")},{key:"Z",description:e("hotkeys.tools.zoom")},{key:"H",description:e("node.action.collapse")},{key:"Shift + W",description:e("hotkeys.tools.snapToGrid")},{key:"Shift + E",description:e("hotkeys.tools.toggleLineStyle")},{key:"G",description:e("hotkeys.tools.group")},{key:"D",description:e("node.action.duplicateEmpty")},{key:"Ctrl + D",description:e("hotkeys.tools.duplicate")},{key:"X / Del",description:e("hotkeys.tools.closeNode")},{key:"Ctrl + A",description:e("hotkeys.tools.selectAll")},{key:"Alt + A",description:e("hotkeys.tools.deselectAll")},{key:"Shift+Click",description:e("hotkeys.tools.deleteGroup")}],windows:[{key:"F",description:e("hotkeys.windows.search")},{key:"Space",description:e("hotkeys.windows.quickAdd")},{key:"Ctrl+Space",description:e("hotkeys.windows.catalog")},{key:"F1",description:e("hotkeys.show")}],file:[{key:"Ctrl + S",description:e("hotkeys.file.save")},{key:"Ctrl + Shift + S",description:e("hotkeys.file.saveProject")},{key:"Ctrl + O",description:e("hotkeys.file.load")}],createNode:[{key:"T",description:e("node.title.text_input")},{key:"P",description:e("node.title.prompt_processor")},{key:"A",description:e("node.title.prompt_analyzer")},{key:"M",description:e("node.title.gemini_chat")},{key:"L",description:e("node.title.translator")},{key:"N",description:e("node.title.note")},{key:"O",description:e("node.title.image_generator")},{key:"I",description:e("node.title.image_preview")},{key:"Shift+A",description:e("node.title.idea_generator")},{key:"Shift+C",description:e("node.title.character_generator")},{key:"Ctrl+Shift+C",description:e("node.title.character_card")},{key:"Shift+S",description:e("node.title.script_generator")},{key:"Shift+D",description:e("node.title.script_analyzer")},{key:"Shift+F",description:e("node.title.script_prompt_modifier")},{key:"Shift+R",description:e("node.title.data_reader")},{key:"Shift+G",description:e("node.title.narrator_text_generator")},{key:"Shift+N",description:e("node.title.speech_synthesizer")},{key:"Shift+B",description:e("node.title.audio_transcriber")},{key:"Shift+T",description:e("node.title.youtube_title_generator")},{key:"Shift+Y",description:e("node.title.youtube_analytics")},{key:"Shift+M",description:e("node.title.music_idea_generator")}]},b=(v,f)=>o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-gray-300 mb-2 border-b border-gray-600 pb-1 select-none",children:v}),o.jsx("ul",{className:"space-y-1.5",children:f.map(({key:T,description:A})=>o.jsxs("li",{className:"flex justify-between items-center select-none",children:[o.jsx("span",{children:A}),o.jsx("kbd",{className:"font-mono bg-gray-700 px-2 py-1 rounded-md text-gray-300 text-xs",children:T})]},T))})]}),S=()=>o.jsx("div",{className:"space-y-4",children:m.map(v=>o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:`font-bold text-xs uppercase tracking-wider select-none border-b border-gray-700/50 pb-1 text-center ${v.headerColor}`,children:v.category}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.links.map((f,T)=>o.jsxs("div",{onClick:()=>window.open(f.url,"_blank"),className:"bg-gray-900/50 hover:bg-gray-800 border border-gray-700 hover:border-emerald-500/50 rounded-lg p-2.5 flex items-center justify-between transition-all group cursor-pointer relative",children:[o.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center flex-shrink-0 group-hover:bg-gray-700 transition-colors",children:w(f.iconType)}),o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-semibold text-gray-200 text-sm truncate select-none",children:f.label}),o.jsx("span",{className:"text-[10px] text-gray-500 truncate select-none",children:f.subLabel||f.url})]})]}),o.jsxs("div",{className:"flex items-center gap-2 opacity-80 group-hover:opacity-100 transition-opacity",children:[o.jsx(Ud,{title:d===f.url?e("app.error.copied"):"Copy URL",position:"top",children:o.jsx("button",{onClick:A=>{A.stopPropagation(),g(f.url)},className:"p-1.5 rounded-md hover:bg-gray-700 text-gray-500 hover:text-white transition-colors",children:d===f.url?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx(Ur,{className:"h-4 w-4"})})}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600 group-hover:text-emerald-400 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]},T))})]},v.category))}),_=o.jsxs("div",{ref:s,className:"bg-gray-800 rounded-lg w-[600px] h-[600px] border border-gray-700 z-[60] flex flex-col shadow-2xl select-none",style:l,onMouseDown:v=>v.stopPropagation(),onWheel:v=>v.stopPropagation(),children:[o.jsxs("div",{className:"flex flex-col border-b border-gray-700 flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center p-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-6 h-6 rounded-full bg-emerald-900/50 flex items-center justify-center border border-emerald-500/30",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx("h2",{className:"text-lg font-bold text-emerald-400 select-none",children:e("help.title")})]}),o.jsx("button",{onClick:()=>n(!1),className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"flex px-3 gap-2",children:[o.jsx("button",{onClick:()=>a("hotkeys"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider border-b-2 transition-colors ${r==="hotkeys"?"border-emerald-500 text-white":"border-transparent text-gray-500 hover:text-gray-300"}`,children:e("help.tabs.hotkeys")}),o.jsx("button",{onClick:()=>a("links"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider border-b-2 transition-colors ${r==="links"?"border-emerald-500 text-white":"border-transparent text-gray-500 hover:text-gray-300"}`,children:e("help.tabs.links")})]})]}),o.jsx("div",{className:"p-4 overflow-y-auto text-sm text-gray-400 flex-grow min-h-0 custom-scrollbar",children:r==="hotkeys"?o.jsxs("div",{className:"flex flex-col gap-6",children:[b(e("hotkeys.tools.title"),y.tools),b(e("hotkeys.createNode.title"),y.createNode),b(e("hotkeys.windows.title"),y.windows),b(e("hotkeys.file.title"),y.file)]}):S()}),o.jsxs("div",{className:"p-3 bg-gray-900 border-t border-gray-700 text-xs text-gray-500 flex flex-col gap-2 rounded-b-lg select-none",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"Script Modifier"}),o.jsx("span",{className:"font-mono",children:"Licensed under GNU GPLv3"})]}),o.jsxs("div",{className:"flex justify-between items-end border-t border-gray-800 pt-2 text-gray-400",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("span",{children:"Author: MeowMaster"}),o.jsx("span",{children:"Email: MeowMasterart@gmail.com"}),o.jsx("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"hover:text-emerald-400 transition-colors",children:"GitHub: Neytrino2134/Script-Modifier"})]}),o.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-70 hover:opacity-100 transition-opacity",children:o.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify",style:{height:"32px"}})})]})]})]});return o.jsxs("div",{ref:i,children:[o.jsx(Ud,{title:e("hotkeys.show"),position:"bottom",children:o.jsx("button",{onClick:()=>n(!t),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),t&&Yi.createPortal(_,document.body)]})},CI=({isOpen:e,initialName:t,initialContent:n,onConfirm:r,onClose:a,deselectAllNodes:i})=>{const{t:s}=Bt(),[l,c]=x.useState(t),[d,h]=x.useState(n),g=x.useRef(null);x.useEffect(()=>{e&&(c(t),h(n),setTimeout(()=>{var y;return(y=g.current)==null?void 0:y.focus()},100))},[e,t,n]);const m=()=>{l.trim()&&r(l.trim(),d)},w=y=>{y.key==="Escape"&&a()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onMouseDown:a,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg border border-gray-700 flex flex-col",onMouseDown:y=>y.stopPropagation(),onKeyDown:w,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:s("dialog.promptEdit.title")})}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"prompt-name-input",className:"block text-sm font-medium text-gray-300 mb-2",children:s("dialog.promptEdit.nameLabel")}),o.jsx("input",{id:"prompt-name-input",ref:g,type:"text",value:l,onChange:y=>c(y.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500",onFocus:i})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"prompt-content-input",className:"block text-sm font-medium text-gray-300 mb-2",children:s("dialog.promptEdit.contentLabel")}),o.jsx("textarea",{id:"prompt-content-input",value:d,onChange:y=>h(y.target.value),className:"w-full h-40 px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none",onWheel:y=>y.stopPropagation(),onFocus:i})]})]}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:a,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:s("dialog.promptEdit.cancel")}),o.jsx("button",{onClick:m,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:s("dialog.promptEdit.confirm")})]})]})}):null},fg=({message:e,type:t,onClose:n,isPositioned:r})=>{const a=()=>{n()},i=r?"toast-animate-positioned":"toast-animate-centered",s=t==="success",l=s?"bg-emerald-600/90 text-white":"bg-gray-700/90 text-gray-100",c=s?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):null;return o.jsxs("div",{onAnimationEnd:a,className:`flex items-center space-x-3 px-4 py-2 rounded-lg shadow-lg backdrop-blur-sm pointer-events-auto ${l} ${i}`,role:"alert",children:[c&&o.jsx("div",{className:"flex-shrink-0",children:c}),o.jsx("p",{className:"text-sm font-semibold whitespace-pre-wrap",children:e})]})},SI=({toasts:e,removeToast:t})=>{const n=e.filter(a=>a.position),r=e.filter(a=>!a.position);return o.jsxs(o.Fragment,{children:[r.length>0&&o.jsx("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-[101] flex flex-col items-center space-y-2 pointer-events-none",children:r.map(a=>o.jsx(fg,{message:a.message,type:a.type,onClose:()=>t(a.id),isPositioned:!1},a.id))}),n.map(a=>{var i,s;return o.jsx("div",{className:"fixed z-[101] pointer-events-none",style:{left:`${(i=a.position)==null?void 0:i.x}px`,top:`${(s=a.position)==null?void 0:s.y}px`},children:o.jsx(fg,{message:a.message,type:a.type,onClose:()=>t(a.id),isPositioned:!0})},a.id)})]})},TI=()=>{const[e,t]=x.useState(0),n=x.useRef(0),r=x.useRef(performance.now()),a=x.useRef(0);return x.useEffect(()=>{const i=s=>{n.current++,s-r.current>1e3&&(t(n.current),n.current=0,r.current=s),a.current=requestAnimationFrame(i)};return a.current=requestAnimationFrame(i),()=>{cancelAnimationFrame(a.current)}},[]),o.jsx("div",{className:"absolute top-2 right-2 z-20 pointer-events-none bg-gray-800/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-gray-700",children:o.jsxs("div",{className:"font-mono text-2xl font-bold text-emerald-400 select-none",children:[e," FPS"]})})},yg="",EI=({isOpen:e,onSave:t,onClose:n,onClear:r,hasExistingKey:a,initialUseFreeKey:i})=>{const{t:s}=Bt(),[l,c]=x.useState(""),[d,h]=x.useState(i),g=x.useRef(null);x.useEffect(()=>{if(e){const y=localStorage.getItem("gemini-api-key");c(y?yg:""),h(i),setTimeout(()=>{var b;return(b=g.current)==null?void 0:b.focus()},100)}},[e,i]);const m=()=>{const y=l.trim()===yg?"":l.trim();t(y,d)},w=y=>{y.key==="Enter"?m():y.key==="Escape"&&n()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 cursor-default",onMouseDown:n,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md border border-gray-700 flex flex-col",onMouseDown:y=>y.stopPropagation(),onKeyDown:w,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:s("dialog.apiKey.title")})}),o.jsxs("div",{className:"p-6 space-y-4",children:[o.jsx("p",{className:"text-sm text-gray-300",children:s("dialog.apiKey.description")}),o.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"block text-sm text-emerald-400 hover:text-emerald-300 hover:underline",children:s("dialog.settings.getApiKeyLink")}),a&&o.jsx("div",{className:"text-sm text-emerald-300 bg-emerald-900/50 p-3 rounded-md border border-emerald-700",children:s("dialog.apiKey.keyExists")}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"api-key-input",className:"block text-sm font-medium text-gray-300 mb-2",children:s(a?"dialog.apiKey.update":"dialog.settings.apiKeyLabel")}),o.jsx("input",{id:"api-key-input",ref:g,type:"password",value:l,onChange:y=>c(y.target.value),placeholder:s("dialog.settings.apiKeyPlaceholder"),disabled:d,className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:bg-gray-800 disabled:text-gray-500"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{id:"use-free-key-checkbox",type:"checkbox",checked:d,onChange:y=>h(y.target.checked),className:"h-4 w-4 rounded border-gray-500 text-emerald-600 focus:ring-emerald-500 bg-gray-700"}),o.jsx("label",{htmlFor:"use-free-key-checkbox",className:"text-sm text-gray-300 select-none",children:s("dialog.apiKey.useFreeKey")})]})]}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-800/50 rounded-b-lg",children:[a?o.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-white bg-gray-700 rounded-md hover:bg-red-700 transition-colors",children:s("dialog.apiKey.clear")}):o.jsx("div",{}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("button",{onClick:n,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:s("dialog.rename.cancel")}),o.jsx("button",{onClick:m,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:s(a?"dialog.apiKey.update":"dialog.apiKey.save")})]})]})]})}):null},xg="",NI=({isOpen:e,onSave:t,isFirstRun:n})=>{const{t:r,language:a,setLanguage:i}=Bt(),[s,l]=x.useState(""),c=x.useRef(null),[d,h]=x.useState(!1),[g,m]=x.useState(!1),[w,y]=x.useState(!1),b=x.useRef(null),[S,_]=x.useState(!1),[v,f]=x.useState(!1),T=x.useMemo(()=>jl.filter(D=>D.code!=="sys"),[]),A=T.find(D=>D.code===a)||T[0];x.useEffect(()=>{if(e){const D=localStorage.getItem("gemini-api-key");l(D?xg:""),m(!1),requestAnimationFrame(()=>{h(!0)}),setTimeout(()=>{var z;return(z=c.current)==null?void 0:z.focus()},100)}else h(!1),y(!1),f(!1)},[e]),x.useEffect(()=>{const D=z=>{b.current&&!b.current.contains(z.target)&&y(!1)};return w&&document.addEventListener("mousedown",D),()=>document.removeEventListener("mousedown",D)},[w]),x.useEffect(()=>{S&&a==="ru"&&(_(!1),I("",!0))},[a,S]);const I=(D,z)=>{m(!0),setTimeout(()=>{h(!1),setTimeout(()=>{t(D,z)},50)},1e3)},M=()=>{const D=s.trim()===xg?"":s.trim();I(D,!1)},N=()=>{i("ru"),_(!0)},k=()=>{f(!0)},E=async()=>{localStorage.removeItem("script-modifier-autosave"),await new Promise(z=>{const G=indexedDB.deleteDatabase("ScriptModifierDB");G.onsuccess=()=>z(),G.onerror=()=>z(),G.onblocked=()=>z()}),window.isReloading=!0,window.location.reload()},P=D=>{const z=T.findIndex(K=>K.code===a),G=T.length;let F;if(z===-1){i(T[0].code);return}D==="next"?F=(z+1)%G:F=(z-1+G)%G,i(T[F].code)},L=D=>{if(D.key==="Enter"&&!v){M();return}const z=document.activeElement===c.current,G=s.length>0;if(!(z&&G)){if(v){D.key==="Escape"&&f(!1);return}D.key==="ArrowLeft"?P("prev"):D.key==="ArrowRight"&&P("next")}},H=D=>{i(D),y(!1)},$=()=>{var D;!w&&!v&&((D=c.current)==null||D.focus())};if(!e)return null;const U=d&&!g?"opacity-100":"opacity-0";return o.jsxs("div",{className:`fixed inset-0 bg-gray-900 z-[200] flex flex-col items-center justify-center overflow-hidden font-sans cursor-default transition-opacity duration-700 ease-in-out ${U}`,style:{transitionDelay:g?"0.5s":"0s"},onMouseDown:D=>D.stopPropagation(),onKeyDown:L,onClick:$,children:[o.jsx("style",{children:`
    @keyframes launchSequence {
        0% { transform: scale(1) translateY(0); opacity: 1; }
        /* Phase 1: Preparation (Breathing in / Anticipation) - Scales UP slightly */
        35% { transform: scale(1.03) translateY(5px); opacity: 1; }
        /* Phase 2: Launch (Spring out) - Shoots UP and zooms away */
        100% { transform: scale(0.8) translateY(-120vh); opacity: 0; }
    }
    @keyframes textShimmer {
        0% { background-position: 100% 50%; }
        100% { background-position: -100% 50%; }
    }
    @keyframes rotate-ring {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  `}),o.jsxs("div",{className:`absolute top-4 right-4 z-50 flex items-center gap-4 transition-opacity duration-300 ${g?"opacity-0":""}`,children:[o.jsxs("button",{onClick:D=>{D.stopPropagation(),k()},className:"flex items-center gap-2 px-3 py-1 bg-gray-800 hover:bg-red-900/50 border border-gray-600 hover:border-red-500 rounded-full text-xs text-gray-400 hover:text-red-400 transition-all group",title:r("welcome.reload"),children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 transition-transform group-hover:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),o.jsx("span",{className:"hidden sm:inline",children:r("welcome.reload")})]}),o.jsx("div",{className:"h-4 w-px bg-gray-700 mx-1"}),o.jsx("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"opacity-70 hover:opacity-100 transition-opacity",title:"View on GitHub",children:o.jsx("svg",{width:"32",height:"32",viewBox:"0 0 98 96",xmlns:"http://www.w3.org/2000/svg",className:"text-white fill-current",children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})}),o.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-70 hover:opacity-100 transition-opacity",children:o.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify"})})]}),o.jsx("div",{className:"absolute bottom-0 right-0 text-emerald-900/20 pointer-events-none select-none transition-transform duration-1000",style:{transform:g?"scale(1.5) rotate(-30deg)":"scale(1) rotate(-20deg)"},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-[50vw] h-[50vw] transform translate-x-1/5 translate-y-1/5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"0.5",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),v&&o.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:D=>{D.stopPropagation(),f(!1)},children:o.jsxs("div",{className:"bg-gray-800 border border-gray-600 p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 transform transition-all scale-100",onClick:D=>D.stopPropagation(),children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:r("welcome.reloadTitle")}),o.jsx("p",{className:"text-gray-300 text-sm mb-6 leading-relaxed",children:r("welcome.reloadMessage")}),o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 transition-colors text-sm font-semibold",children:r("dialog.rename.cancel")}),o.jsxs("button",{onClick:E,className:"px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 text-white shadow-lg shadow-red-900/30 transition-colors text-sm font-bold flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),r("welcome.confirmReload")]})]})]})}),o.jsxs("div",{className:`z-10 w-full flex flex-col items-center ${v?"blur-sm pointer-events-none":""}`,style:{animation:g?"launchSequence 0.8s cubic-bezier(0.5, 0, 0.2, 1) forwards":"none"},children:[o.jsxs("div",{className:"w-full px-4 mb-4 flex items-center justify-center gap-6 md:gap-12 relative z-20",children:[o.jsx("button",{onClick:()=>P("prev"),className:`mt-3 w-12 h-12 md:w-16 md:h-16 flex-shrink-0 rounded-full bg-gray-800/40 hover:bg-emerald-600/80 border border-gray-600/50 hover:border-emerald-400 backdrop-blur-md flex items-center justify-center transition-all duration-300 transform hover:scale-110 group focus:outline-none focus:ring-2 focus:ring-emerald-500/50 ${g?"opacity-0 scale-75":"opacity-100 scale-100"}`,"aria-label":"Previous Language",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-6 h-6 md:w-8 md:h-8 text-gray-400 group-hover:text-white transition-colors",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),o.jsxs("div",{className:"flex flex-col items-center justify-center -space-y-4 md:-space-y-6 mb-2",style:{transform:g?"scale(0.9) translateY(10px)":"scale(1) translateY(0)",opacity:g?0:1,filter:g?"blur(4px)":"none",transition:"all 0.5s ease-out"},children:[o.jsx("h1",{className:"font-black tracking-tighter select-none leading-tight whitespace-nowrap text-center text-transparent bg-clip-text px-4",style:{fontSize:"clamp(2.5rem, 10vw, 8rem)",backgroundImage:"linear-gradient(90deg, #34d399, #22d3ee, #34d399)",backgroundSize:"200% auto",animation:"textShimmer 3s linear infinite",paddingBottom:"0.1em",paddingRight:"0.2em",marginRight:"-0.2em"},children:r("dialog.welcome.heading")}),o.jsx("h1",{className:"font-black tracking-tighter select-none leading-tight whitespace-nowrap text-center text-transparent bg-clip-text px-4",style:{fontSize:"clamp(2.5rem, 10vw, 8rem)",backgroundImage:"linear-gradient(90deg, #34d399, #22d3ee, #34d399)",backgroundSize:"200% auto",animation:"textShimmer 3s linear infinite reverse",paddingBottom:"0.1em",paddingRight:"0.2em",marginRight:"-0.2em"},children:r("app.title")})]}),o.jsx("button",{onClick:()=>P("next"),className:`mt-3 w-12 h-12 md:w-16 md:h-16 flex-shrink-0 rounded-full bg-gray-800/40 hover:bg-emerald-600/80 border border-gray-600/50 hover:border-emerald-400 backdrop-blur-md flex items-center justify-center transition-all duration-300 transform hover:scale-110 group focus:outline-none focus:ring-2 focus:ring-emerald-500/50 ${g?"opacity-0 scale-75":"opacity-100 scale-100"}`,"aria-label":"Next Language",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-6 h-6 md:w-8 md:h-8 text-gray-400 group-hover:text-white transition-colors",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})})]}),o.jsxs("div",{className:"relative w-[850px] h-[550px] mx-auto max-w-[95vw] max-h-[85vh]",children:[o.jsx("div",{className:"welcome-ring",style:{"--ring-speed":"10s"}}),o.jsx("div",{className:"relative w-full h-full bg-gray-800/90 backdrop-blur-2xl rounded-3xl border border-gray-700 shadow-2xl overflow-visible z-10 flex flex-col justify-center",onClick:D=>D.stopPropagation(),children:o.jsxs("div",{className:"p-8 md:p-12 space-y-8 flex flex-col h-full justify-between",children:[o.jsxs("div",{className:"space-y-6 flex flex-col flex-grow justify-center",children:[o.jsx("div",{className:"space-y-4 w-full text-left",children:o.jsxs("p",{className:"text-lg md:text-xl text-gray-300 leading-relaxed font-normal",children:[r("dialog.welcome.intro1")," ",r("dialog.welcome.intro2")]})}),o.jsx("div",{className:"h-px w-full bg-gray-700"}),o.jsxs("div",{className:"w-full space-y-5",children:[o.jsxs("div",{className:"space-y-2 relative",ref:b,children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-400 uppercase tracking-wider text-left pl-1",children:"SELECT YOUR PRIMARY LANGUAGE"}),o.jsxs("button",{onClick:()=>y(!w),className:`w-full p-2.5 bg-gray-900/80 border ${w?"border-emerald-500":"border-gray-600 hover:border-gray-500"} rounded-xl text-white focus:outline-none focus:ring-0 transition-colors shadow-inner flex justify-between items-center group`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold border border-gray-600 bg-gray-800 text-gray-400",children:A.label}),o.jsxs("span",{className:"font-semibold tracking-wide text-sm",children:[A.name," ",o.jsxs("span",{className:"text-gray-500 ml-1",children:["(",A.englishName,")"]})]})]}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-gray-400 group-hover:text-emerald-400 transition-all duration-300 ${w?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&o.jsx("div",{className:"absolute top-full left-0 w-full mt-2 bg-gray-900 border border-cyan-800/50 rounded-xl overflow-hidden shadow-2xl z-50 animate-slide-down max-h-60 overflow-y-auto custom-scrollbar",children:T.map(D=>{const z=a===D.code;return o.jsxs("div",{onClick:()=>H(D.code),className:`p-2.5 px-4 cursor-pointer transition-colors flex justify-between items-center ${z?"bg-cyan-900/30 text-cyan-400":"text-gray-300 hover:bg-gray-800 hover:text-white"}`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold border transition-colors ${z?"border-cyan-500 bg-cyan-900/50 text-cyan-400":"border-gray-600 bg-gray-800 text-gray-400"}`,children:D.label}),o.jsxs("span",{className:"font-medium text-sm",children:[D.name," ",o.jsxs("span",{className:`ml-1 ${z?"text-cyan-600/70":"text-gray-600"}`,children:["(",D.englishName,")"]})]})]}),z&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},D.code)})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-baseline px-1",children:[o.jsx("label",{htmlFor:"welcome-api-key",className:"block text-sm font-semibold text-gray-300",children:r("dialog.settings.apiKeyLabel")}),o.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-emerald-400 hover:text-emerald-300 hover:underline transition-colors",children:r("dialog.settings.getApiKeyLink")})]}),o.jsx("div",{className:"relative group",children:o.jsx("input",{type:"password",id:"welcome-api-key",ref:c,value:s,onChange:D=>l(D.target.value),placeholder:r("dialog.settings.apiKeyPlaceholder"),className:"w-full p-3.5 text-lg bg-gray-900/80 border border-gray-600 rounded-xl text-white focus:outline-none focus:border-emerald-500 focus:ring-0 placeholder-gray-500 transition-colors shadow-inner block hover:border-gray-500"})}),o.jsx("p",{className:"text-xs text-gray-500 px-1 text-center",children:r("dialog.welcome.apiKeyExplanation")})]})]})]}),o.jsxs("div",{className:"flex flex-col-reverse justify-center items-center gap-2 w-full pt-4 border-t border-gray-700/50",children:[o.jsx("button",{onClick:N,className:"w-full py-3 text-sm font-bold text-gray-500 hover:text-gray-300 hover:bg-white/5 rounded-xl transition-all duration-200",children:r("welcome.iAmDeveloper")}),o.jsx("button",{onClick:M,className:`
                                w-full px-12 py-3.5 text-xl font-bold text-white 
                                rounded-xl 
                                shadow-lg shadow-emerald-900/40 
                                transition-all duration-300 ease-out
                                flex items-center justify-center gap-2
                                relative overflow-hidden group
                                ${g?"":"hover:scale-105 active:scale-95"}
                            `,style:{backgroundImage:"linear-gradient(90deg, #059669, #34d399, #059669)",backgroundSize:"200% auto",animation:"textShimmer 3s linear infinite"},children:o.jsxs("div",{className:`flex items-center gap-2 transition-all duration-500 transform ${g?"translate-x-[150%] opacity-0":"translate-x-0 opacity-100"}`,children:[o.jsx("span",{children:r(n?"welcome.letsGo":"welcome.resume")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",className:"w-5 h-5 transition-transform duration-300 group-hover:translate-x-1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})})]})})]})]})})]}),o.jsxs("a",{href:"https://promptmodifier2.netlify.app/",target:"_blank",rel:"noopener noreferrer",className:`
            mt-8 px-6 py-2 rounded-full
            bg-gray-800/50 hover:bg-gray-700/80
            border border-gray-600/50 hover:border-emerald-500/50
            text-gray-400 hover:text-emerald-400
            text-sm font-semibold tracking-wide
            transition-all duration-300
            flex items-center gap-2
            backdrop-blur-sm
            z-50
            ${g?"opacity-0 translate-y-4":"opacity-100"}
          `,style:{transitionDelay:"0.1s"},children:[o.jsx("span",{children:"Go to Prompt Modifier"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})]})},kI=()=>o.jsx("div",{className:"flex items-center h-full px-2 select-none",children:o.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-mono text-gray-400 bg-gray-800 border border-gray-700 shadow-sm",children:"v0.1.5 Alpha.3"})}),AI=({tab:e,index:t,isActive:n,onClick:r,onClose:a,onRename:i})=>{const[s,l]=x.useState(!1),[c,d]=x.useState(e.name),h=x.useRef(null);x.useEffect(()=>{d(e.name)},[e.name]),x.useEffect(()=>{s&&h.current&&(h.current.focus(),h.current.select())},[s]);const g=()=>{c.trim()===""?d(e.name):c.trim()!==e.name&&i(t,c.trim()),l(!1)},m=y=>{y.key==="Enter"?g():y.key==="Escape"&&(d(e.name),l(!1))},w=n?"hover:bg-emerald-700":"hover:bg-gray-500";return o.jsx(Ud,{title:e.name,position:"bottom",className:"h-full",children:o.jsxs("div",{onMouseDown:()=>r(t),onDoubleClick:()=>l(!0),className:`flex items-center justify-between px-4 h-full cursor-pointer max-w-[200px] transition-colors rounded-md ${n?"bg-emerald-600 text-white":"bg-gray-700 text-gray-300 hover:bg-emerald-600 hover:text-white"}`,children:[s?o.jsx("input",{ref:h,value:c,onChange:y=>d(y.target.value),onBlur:g,onKeyDown:m,onMouseDown:y=>y.stopPropagation(),onClick:y=>y.stopPropagation(),className:"bg-transparent outline-none w-full text-sm"}):o.jsx("span",{className:"truncate text-sm",children:e.name}),o.jsx("button",{onMouseDown:y=>{y.stopPropagation(),a(t)},className:`ml-2 p-0.5 rounded-full ${w} transition-colors`,title:"Close tab",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})})},II=({tabs:e,activeTabIndex:t,onTabClick:n,onCloseTab:r,onRenameTab:a})=>o.jsx("div",{className:"flex items-center h-full gap-1",children:e.map((i,s)=>o.jsx(AI,{tab:i,index:s,isActive:s===t,onClick:n,onClose:r,onRename:a},i.id))}),Ns=({active:e,onClick:t,icon:n,title:r})=>o.jsx(ht,{title:r,position:"top",children:o.jsx("button",{onClick:t,className:`rounded-md flex items-center justify-center transition-colors w-8 h-8 ${e?"bg-emerald-600 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,children:n})}),PI=({isOpen:e,position:t,onClose:n,onAddNode:r,slots:a,onAssignSlot:i,activeTool:s,onToolChange:l})=>{const{t:c}=Bt(),{isContextMenuPinned:d,toggleContextMenuPin:h,viewTransform:g,setZoom:m,handlePasteFromClipboard:w}=Qo(),y=x.useRef(null),[b,S]=x.useState(null),[_,v]=x.useState(t),[f,T]=x.useState(!1),A=x.useRef(!1),I=x.useRef({x:0,y:0});x.useLayoutEffect(()=>{e?(v(t),S(null),requestAnimationFrame(()=>{T(!0)})):T(!1)},[e,t]),x.useLayoutEffect(()=>{y.current&&(y.current.style.left=`${_.x}px`,y.current.style.top=`${_.y}px`)},[_]);const M=x.useCallback(G=>{if(!A.current||!y.current)return;G.preventDefault();const F=G.clientX-I.current.x,K=G.clientY-I.current.y;y.current.style.left=`${F}px`,y.current.style.top=`${K}px`},[]),N=x.useCallback(G=>{if(A.current&&y.current){const F=G.clientX-I.current.x,K=G.clientY-I.current.y;v({x:F,y:K})}A.current=!1,window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",N)},[]),k=G=>{var K;if(G.button!==0)return;const F=(K=y.current)==null?void 0:K.getBoundingClientRect();F&&(A.current=!0,I.current={x:G.clientX-F.left,y:G.clientY-F.top},window.addEventListener("mousemove",M),window.addEventListener("mouseup",N))},E=x.useCallback(async()=>{await w(),d||n()},[w,d,n]);x.useEffect(()=>()=>{window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",N)},[M,N]);const P=G=>{const F=Number(G),K=.2,ae=2;if(F<1){const ge=Math.pow(1/K,.01);return Math.log(F/K)/Math.log(ge)-100}const Y=Math.pow(ae,1/100);return Math.log(F)/Math.log(Y)},L=G=>{const F=Number(G),K=.2,ae=2;if(F<0){const ge=Math.pow(1/K,.01);return Math.pow(ge,F+100)*K}const Y=Math.pow(ae,1/100);return Math.pow(Y,F)},H=G=>{m(G,{x:window.innerWidth/2,y:window.innerHeight/2})},$=(G,F)=>{F.stopPropagation(),a[G]&&!F.shiftKey?(r(a[G]),d||n()):S(G)},U=(G,F)=>{F.preventDefault(),F.stopPropagation(),S(G)},O=G=>{l(G),d||n()},D=x.useMemo(()=>[{title:c("search.group.input"),items:[{type:C.TEXT_INPUT,title:c("search.node.text_input.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{type:C.NOTE,title:c("search.node.note.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:C.DATA_READER,title:c("search.node.data_reader.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}]},{title:c("search.group.process"),items:[{type:C.PROMPT_PROCESSOR,title:c("search.node.prompt_processor.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:C.PROMPT_ANALYZER,title:c("search.node.prompt_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:C.REROUTE_DOT,title:c("search.node.reroute_dot.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})}]},{title:c("search.group.scripting"),items:[{type:C.IDEA_GENERATOR,title:c("search.node.idea_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:C.SCRIPT_GENERATOR,title:c("search.node.script_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:C.SCRIPT_ANALYZER,title:c("search.node.script_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:C.SCRIPT_PROMPT_MODIFIER,title:c("search.node.script_prompt_modifier.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},{title:c("search.group.character"),items:[{type:C.CHARACTER_GENERATOR,title:c("search.node.character_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:C.CHARACTER_CARD,title:c("search.node.character_card.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:C.CHARACTER_ANALYZER,title:c("search.node.character_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},{title:c("search.group.images"),items:[{type:C.IMAGE_GENERATOR,title:c("search.node.image_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:C.IMAGE_PREVIEW,title:c("search.node.image_preview.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},{title:c("search.group.ai"),items:[{type:C.TRANSLATOR,title:c("search.node.translator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:C.GEMINI_CHAT,title:c("search.node.gemini_chat.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:C.ERROR_ANALYZER,title:c("search.node.error_analyzer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},{title:c("search.group.audio"),items:[{type:C.SPEECH_SYNTHESIZER,title:c("search.node.speech_synthesizer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:C.NARRATOR_TEXT_GENERATOR,title:c("search.node.narrator_text_generator.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:C.AUDIO_TRANSCRIBER,title:c("search.node.audio_transcriber.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:C.MUSIC_IDEA_GENERATOR,title:c("search.node.music_idea_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]},{title:c("search.group.youtube"),items:[{type:C.YOUTUBE_TITLE_GENERATOR,title:c("search.node.youtube_title_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:C.YOUTUBE_ANALYTICS,title:c("node.title.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]}],[c]),z=G=>{for(const F of D){const K=F.items.find(ae=>ae.type===G);if(K)return K.icon}return null};return e?o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:y,className:`fixed bg-gray-800/90 backdrop-blur-sm rounded-lg border border-gray-700 shadow-xl p-1.5 flex flex-col space-y-1.5 z-50 cursor-default transition-[opacity,transform] duration-200 ease-out origin-top-left ${f?"opacity-100 scale-100":"opacity-0 scale-95"} ${d?"pinned-menu":""}`,onClick:G=>G.stopPropagation(),onMouseDown:G=>G.stopPropagation(),onWheel:G=>G.stopPropagation(),onContextMenu:G=>G.preventDefault(),children:[o.jsxs("div",{className:"flex items-center justify-between pb-1 border-b border-gray-600 cursor-move w-full",onMouseDown:k,children:[o.jsx("span",{className:"text-xs text-gray-400 font-semibold px-1 select-none",children:c("contextMenu.tools")}),o.jsx(ht,{title:d?"Unpin":"Pin",position:"left",children:o.jsx("button",{onClick:G=>{G.stopPropagation(),h()},className:`p-1 rounded hover:bg-gray-700 transition-colors ${d?"text-emerald-400":"text-gray-400"}`,onMouseDown:G=>G.stopPropagation(),children:d?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:o.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.563.045.796.77.357 1.145l-4.163 3.566a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.163-3.566c-.44-.375-.206-1.1.357-1.145l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"})})})})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-0.5",children:[o.jsx(Ns,{active:s==="edit",onClick:()=>O("edit"),title:c("toolbar.edit"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),o.jsx(Ns,{active:s==="cutter",onClick:()=>O("cutter"),title:c("toolbar.cutter"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(Ns,{active:s==="selection",onClick:()=>O("selection"),title:c("toolbar.selection"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),o.jsx(Ns,{active:s==="reroute",onClick:()=>O("reroute"),title:c("toolbar.reroute"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})})]}),o.jsx("div",{className:"h-px bg-gray-600 w-full my-0.5"}),o.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:a.map((G,F)=>o.jsx(ht,{title:G?c("contextMenu.addNodeFromSlot",{node:c(`node.title.${G.toLowerCase()}`),index:F+1}):c("contextMenu.assignSlot",{index:F+1}),position:"bottom",children:o.jsxs("button",{onClick:K=>$(F,K),onContextMenu:K=>U(F,K),className:`w-8 h-8 rounded-md flex items-center justify-center transition-colors relative group ${G?"bg-gray-700 hover:bg-emerald-600 text-emerald-400":"bg-gray-800 border border-gray-700 hover:bg-gray-700 text-gray-500"}`,children:[G?z(G):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),o.jsx("span",{className:"absolute top-0.5 right-0.5 text-[8px] font-mono text-gray-500 group-hover:text-gray-300",children:F+1})]})},F))}),o.jsxs("div",{className:"flex items-center justify-center space-x-2 pt-1 border-t border-gray-600 w-full",children:[o.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:P(g.scale),onChange:G=>H(L(parseFloat(G.target.value))),className:"w-20 min-w-0 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),o.jsxs("button",{onClick:()=>H(1),className:"text-[10px] font-semibold text-gray-400 hover:text-white w-8 text-center hover:bg-emerald-600 rounded py-0.5 flex-shrink-0",children:[Math.round(g.scale*100),"%"]})]}),o.jsx("div",{className:"text-[10px] text-gray-500 text-center pt-1 select-none border-t border-gray-700/50 w-full",children:"Key 1-8 to Quick Add"}),o.jsx("div",{className:"h-px bg-gray-700 w-full my-0.5"}),o.jsxs("button",{onClick:E,className:"w-full flex items-center justify-center space-x-2 p-1 rounded hover:bg-gray-700 text-gray-300 hover:text-white transition-colors text-xs font-semibold",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),o.jsx("span",{children:c("contextMenu.paste")})]})]}),b!==null&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-[59] bg-transparent",onClick:G=>{G.stopPropagation(),S(null)},onMouseDown:G=>G.stopPropagation()}),o.jsxs("div",{className:"fixed z-[60] bg-gray-800 rounded-lg border border-gray-700 shadow-xl flex flex-col overflow-hidden max-h-[400px] w-64 cursor-default",style:{left:_.x+20,top:_.y+20},onClick:G=>G.stopPropagation(),onMouseDown:G=>G.stopPropagation(),onWheel:G=>G.stopPropagation(),children:[o.jsxs("div",{className:"p-2 bg-gray-900 border-b border-gray-700 font-semibold text-gray-300 text-sm flex justify-between items-center",children:[o.jsx("span",{children:c("contextMenu.assignSlot",{index:b+1})}),o.jsx("button",{onClick:()=>S(null),className:"text-gray-500 hover:text-white",children:""})]}),o.jsx("div",{className:"overflow-y-auto custom-scrollbar p-1",children:D.map((G,F)=>o.jsxs("div",{className:"mb-2",children:[o.jsx("div",{className:"px-2 py-1 text-xs font-bold text-gray-500 uppercase",children:G.title}),G.items.map(K=>o.jsxs("button",{onClick:()=>{i(b,K.type),S(null)},className:"w-full flex items-center space-x-2 px-2 py-1.5 hover:bg-emerald-600 rounded-md text-left text-sm text-gray-300 hover:text-white transition-colors",children:[o.jsx("div",{className:"text-gray-400 group-hover:text-white",children:K.icon}),o.jsx("span",{children:K.title})]},K.type))]},F))})]})]})]}):null},RI=bt.memo(PI),MI=({isOpen:e,position:t,fromType:n,onClose:r,onSelect:a})=>{const{t:i}=Bt(),s=x.useRef(null),l=x.useRef(null),[c,d]=x.useState(""),[h,g]=x.useState(t),[m,w]=x.useState(!1),y=x.useRef(!1),b=x.useRef({x:0,y:0});x.useLayoutEffect(()=>{e?(g(t),d(""),requestAnimationFrame(()=>w(!0)),setTimeout(()=>{var N;return(N=l.current)==null?void 0:N.focus()},50)):w(!1)},[e,t]),x.useLayoutEffect(()=>{s.current&&(s.current.style.left=`${h.x}px`,s.current.style.top=`${h.y}px`)},[h]),x.useEffect(()=>{const N=k=>{if(s.current&&!s.current.contains(k.target)){if(y.current||k.target.closest(".pinned-menu"))return;r()}};return e&&document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[e,r]);const S=N=>{if(!y.current||!s.current)return;N.preventDefault();const k=N.clientX-b.current.x,E=N.clientY-b.current.y;s.current.style.left=`${k}px`,s.current.style.top=`${E}px`},_=N=>{if(y.current&&s.current){const k=N.clientX-b.current.x,E=N.clientY-b.current.y;g({x:k,y:E})}y.current=!1,window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",_)},v=N=>{var E;if(N.button!==0)return;N.stopPropagation();const k=(E=s.current)==null?void 0:E.getBoundingClientRect();k&&(y.current=!0,b.current={x:N.clientX-k.left,y:N.clientY-k.top},window.addEventListener("mousemove",S),window.addEventListener("mouseup",_))};x.useEffect(()=>()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",_)},[]);const f={[C.TEXT_INPUT]:"T",[C.PROMPT_PROCESSOR]:"P",[C.PROMPT_ANALYZER]:"A",[C.GEMINI_CHAT]:"M",[C.TRANSLATOR]:"L",[C.NOTE]:"N",[C.IMAGE_GENERATOR]:"O",[C.IMAGE_PREVIEW]:"I",[C.IDEA_GENERATOR]:"Shift+A",[C.SCRIPT_GENERATOR]:"Shift+S",[C.SCRIPT_ANALYZER]:"Shift+D",[C.SCRIPT_PROMPT_MODIFIER]:"Shift+F",[C.CHARACTER_GENERATOR]:"Shift+C",[C.CHARACTER_CARD]:"Ctrl+Shift+C",[C.DATA_READER]:"Shift+R",[C.NARRATOR_TEXT_GENERATOR]:"Shift+G",[C.SPEECH_SYNTHESIZER]:"Shift+N",[C.AUDIO_TRANSCRIBER]:"Shift+B",[C.YOUTUBE_TITLE_GENERATOR]:"Shift+T",[C.YOUTUBE_ANALYTICS]:"Shift+Y",[C.MUSIC_IDEA_GENERATOR]:"Shift+M"},T=x.useMemo(()=>[{title:i("toolbar.group.prompting"),items:[{type:C.PROMPT_PROCESSOR,title:i("node.title.prompt_processor"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:C.PROMPT_ANALYZER,title:i("node.title.prompt_analyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}]},{title:i("toolbar.group.scripting"),items:[{type:C.IDEA_GENERATOR,title:i("node.title.idea_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:C.SCRIPT_GENERATOR,title:i("node.title.script_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:C.SCRIPT_ANALYZER,title:i("node.title.script_analyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:C.SCRIPT_PROMPT_MODIFIER,title:i("node.title.script_prompt_modifier"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},{title:i("toolbar.group.characters"),items:[{type:C.CHARACTER_GENERATOR,title:i("node.title.character_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:C.CHARACTER_CARD,title:i("node.title.character_card"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:C.CHARACTER_ANALYZER,title:i("node.title.character_analyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},{title:i("toolbar.group.images"),items:[{type:C.IMAGE_GENERATOR,title:i("node.title.image_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:C.IMAGE_PREVIEW,title:i("node.title.image_preview"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},{title:i("toolbar.group.ai"),items:[{type:C.TRANSLATOR,title:i("node.title.translator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:C.GEMINI_CHAT,title:i("node.title.gemini_chat"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:C.ERROR_ANALYZER,title:i("node.title.error_analyzer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},{title:i("toolbar.group.audio"),items:[{type:C.SPEECH_SYNTHESIZER,title:i("node.title.speech_synthesizer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:C.NARRATOR_TEXT_GENERATOR,title:i("node.title.narrator_text_generator"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:C.MUSIC_IDEA_GENERATOR,title:i("node.title.music_idea_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]},{title:`${i("toolbar.group.general")} / ${i("toolbar.group.youtube")}`,items:[{type:C.DATA_READER,title:i("node.title.data_reader"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:C.YOUTUBE_TITLE_GENERATOR,title:i("node.title.youtube_title_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:C.YOUTUBE_ANALYTICS,title:i("node.title.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]}],[i]),A=x.useMemo(()=>{const N=[];let k=1;return T.forEach(E=>{E.items.forEach(P=>{const L=Kr({type:P.type});L!==null&&(n==="image"&&L!=="image"||n==="text"&&L!=="text"||N.push({...P,index:k++,hotkey:f[P.type]||""}))})}),N},[T,n]),I=x.useMemo(()=>{if(!c)return A;const N=c.toLowerCase();return A.filter(k=>k.title.toLowerCase().includes(N)||k.index.toString().startsWith(N)||k.hotkey&&k.hotkey.toLowerCase().includes(N))},[A,c]),M=N=>{N.stopPropagation(),N.key==="Escape"?r():N.key==="Enter"&&I.length>0&&a(I[0].type)};return e?o.jsxs("div",{ref:s,className:`fixed bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-2xl border border-gray-700 p-2 flex flex-col space-y-2 max-h-[400px] w-72 cursor-default transition-[opacity,transform] duration-200 ease-out ${m?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{left:h.x,top:h.y,zIndex:1e3},onMouseDown:v,onWheel:N=>N.stopPropagation(),children:[o.jsxs("div",{className:"px-2 py-1 border-b border-gray-700 flex justify-between items-center cursor-move",onMouseDown:v,children:[o.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase select-none",children:i("connectionMenu.title")}),o.jsx("button",{onClick:N=>{N.stopPropagation(),r()},className:"text-gray-400 hover:text-white hover:bg-red-600/20 focus:outline-none p-1 rounded transition-colors",title:"Close",onMouseDown:N=>N.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsx("input",{ref:l,type:"text",value:c,onChange:N=>d(N.target.value),onKeyDown:M,placeholder:i("search.placeholder"),className:"w-full px-2 py-1.5 bg-gray-900/50 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm",onMouseDown:N=>N.stopPropagation()}),o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-1 min-h-0",children:I.length===0?o.jsx("div",{className:"p-2 text-gray-400 text-sm text-center",children:i("search.noResults")}):I.map(N=>o.jsxs("button",{onClick:()=>a(N.type),className:"flex items-center space-x-3 p-2 rounded-md text-left w-full text-gray-200 hover:bg-emerald-600 hover:text-white transition-colors group",onMouseDown:k=>k.stopPropagation(),children:[o.jsx("div",{className:"flex-shrink-0 w-6 text-center text-gray-500 font-mono text-xs group-hover:text-emerald-200 select-none",children:N.index}),o.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center bg-gray-700 rounded text-gray-300 group-hover:text-white",children:N.icon}),o.jsx("span",{className:"text-sm font-semibold truncate flex-grow",children:N.title}),N.hotkey&&o.jsx("span",{className:"text-[10px] text-gray-500 font-mono px-1.5 py-0.5 bg-gray-800 rounded group-hover:bg-emerald-700 group-hover:text-emerald-100 select-none",children:N.hotkey})]},N.type))})]}):null};let LI=1e3;const vg=()=>++LI,jI=(e,t=2)=>{if(e===0)return"0 Bytes";const n=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(r))+" "+a[i]},Ic="imageViewerPosition",Pc="imageViewerSize",DI=({sources:e,initialIndex:t,initialPosition:n,onClose:r,onDownloadImageFromUrl:a,onCopyImageToClipboard:i,onOpenInEditor:s})=>{const{t:l}=Bt(),[c,d]=x.useState(vg()),[h,g]=x.useState(!1),[m,w]=x.useState(()=>{try{const j=localStorage.getItem(Ic);if(j){const q=JSON.parse(j);if(typeof q.x=="number"&&typeof q.y=="number")return q}}catch(j){console.error("Failed to load ImageViewer position",j)}return n}),[y,b]=x.useState(()=>{try{const j=localStorage.getItem(Pc);if(j){const q=JSON.parse(j);if(q.width&&q.height)return q}}catch(j){console.error("Failed to load ImageViewer size",j)}return{width:"80vw",height:"80vh"}}),[S,_]=x.useState(!1),v=x.useRef(m);x.useEffect(()=>{v.current=m},[m]);const[f,T]=x.useState(t),A=x.useRef(null),I=x.useRef(null),M=x.useRef(null),[N,k]=x.useState(1),[E,P]=x.useState({x:0,y:0}),[L,H]=x.useState(!1),$=x.useRef(null),[U,O]=x.useState({width:0,height:0,size:null}),D=e[f],z=j=>{if(j.startsWith("data:")){const q=j.length-(j.indexOf(",")+1),Q=j.charAt(j.length-1)==="="?j.charAt(j.length-2)==="="?2:1:0,J=q*.75-Q;return jI(J)}return null};x.useEffect(()=>{requestAnimationFrame(()=>_(!0)),G()},[]),x.useEffect(()=>{if(!D)return;const j=new Image;j.onload=()=>{O({width:j.naturalWidth,height:j.naturalHeight,size:z(D.src)});const q=localStorage.getItem(Ic),Q=localStorage.getItem(Pc);if(!q||!Q){const B=window.innerWidth,fe=window.innerHeight,ie=B*.95,Z=fe*.95;let ee=j.naturalWidth+20,R=j.naturalHeight+100;if(ee>ie||R>Z){const be=Math.min((ie-20)/j.naturalWidth,(Z-100)/j.naturalHeight);ee=j.naturalWidth*be+20,R=j.naturalHeight*be+100}ee=Math.max(ee,800),R=Math.max(R,456),b({width:ee,height:R}),w({x:(B-ee)/2,y:(fe-R)/2})}if(I.current){const{width:J,height:oe}=I.current.getBoundingClientRect(),B=J-20,fe=oe-20;if(B>0&&fe>0){const ie=B/j.naturalWidth,Z=fe/j.naturalHeight,ee=Math.min(ie,Z);k(Math.min(ee,1))}else k(1)}else k(1);P({x:0,y:0})},j.src=D.src},[D]);const G=()=>{d(vg())},F=j=>{j.stopPropagation(),g(!h)},K=j=>{j==null||j.stopPropagation(),T(q=>q>0?q-1:e.length-1)},ae=j=>{j==null||j.stopPropagation(),T(q=>q<e.length-1?q+1:0)},Y=()=>{k(1),P({x:0,y:0})};x.useEffect(()=>{const j=q=>{q.stopPropagation(),q.key==="ArrowLeft"?K():q.key==="ArrowRight"?ae():q.key==="Escape"&&r()};return window.addEventListener("keydown",j,!0),()=>{window.removeEventListener("keydown",j,!0)}},[r,e.length]);const ge=j=>{j.target.closest("button")||(G(),j.preventDefault(),j.stopPropagation(),!h&&(j.currentTarget.setPointerCapture(j.pointerId),A.current={offset:{x:j.clientX-m.x,y:j.clientY-m.y}}))},W=j=>{if(!A.current)return;const q=j.clientX-A.current.offset.x,Q=j.clientY-A.current.offset.y;w({x:q,y:Q})},le=j=>{A.current=null,j.currentTarget.releasePointerCapture(j.pointerId),localStorage.setItem(Ic,JSON.stringify(v.current))},X=()=>{if(M.current&&!h){const j=M.current.getBoundingClientRect(),q={width:j.width,height:j.height};b(q),localStorage.setItem(Pc,JSON.stringify(q))}},Te=j=>{if(j.stopPropagation(),!I.current)return;const q=Math.pow(1.0005,-j.deltaY),Q=Math.max(.1,Math.min(10,N*q)),J=I.current.getBoundingClientRect(),oe=j.clientX-J.left,B=j.clientY-J.top,fe=oe-J.width/2,ie=B-J.height/2,Z=Q/N,ee=fe-(fe-E.x)*Z,R=ie-(ie-E.y)*Z;k(Q),P({x:ee,y:R})},pe=()=>{if(!I.current||U.width===0)return!1;const{width:j,height:q}=I.current.getBoundingClientRect(),Q=U.width*N,J=U.height*N;return Q>j||J>q},ue=N>1||pe(),Oe=j=>{G(),(ue||j.button===1)&&(j.preventDefault(),j.stopPropagation(),H(!0),$.current={x:j.clientX-E.x,y:j.clientY-E.y},window.addEventListener("mousemove",he),window.addEventListener("mouseup",ye))},he=j=>{$.current&&(j.preventDefault(),j.stopPropagation(),P({x:j.clientX-$.current.x,y:j.clientY-$.current.y}))},ye=()=>{H(!1),$.current=null,window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",ye)};return x.useEffect(()=>()=>{window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",ye)},[]),D?o.jsxs("div",{ref:M,className:`fixed bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col group transition-opacity duration-300 ease-out ${S?"opacity-100":"opacity-0"}`,style:h?{zIndex:c,left:0,top:0,width:"100%",height:"100%",maxWidth:"100vw",maxHeight:"100vh",borderRadius:0,border:"none"}:{zIndex:c,left:m.x,top:m.y,width:y.width,height:y.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"456px",resize:"both",overflow:"hidden"},onMouseDown:j=>{j.stopPropagation(),G()},onMouseUp:X,children:[o.jsxs("div",{onPointerDown:ge,onPointerMove:W,onPointerUp:le,className:"bg-gray-700 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move flex-shrink-0",children:[o.jsxs("span",{children:[l("imageViewer.title")," - Frame ",D.frameNumber]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Pe,{title:"Copy Image",onClick:j=>{j.stopPropagation(),i(D.src)},children:o.jsx(Ur,{className:"h-5 w-5"})}),o.jsx(Pe,{title:"Download Image",onClick:j=>{j.stopPropagation(),a(D.src,D.frameNumber,D.prompt||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx("div",{className:"w-px h-4 bg-gray-500 mx-1"}),o.jsx("button",{onClick:F,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",title:h?"Restore":"Full Screen",children:h?o.jsx(EA,{}):o.jsx(TA,{})}),o.jsx("button",{onClick:j=>{j.stopPropagation(),r()},className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsxs("div",{ref:I,className:"p-1 flex-grow min-h-0 bg-gray-900 relative overflow-hidden flex items-center justify-center",onWheel:Te,onMouseDown:Oe,children:[o.jsx("img",{src:D.src,alt:`Full-size view of frame ${D.frameNumber}`,className:"shrink-0",style:{width:U.width||"auto",height:U.height||"auto",maxWidth:"none",maxHeight:"none",transform:`translate(${E.x}px, ${E.y}px) scale(${N})`,cursor:ue?L?"grabbing":"grab":"default",pointerEvents:"auto",transformOrigin:"center"},draggable:!1,onMouseDown:j=>j.preventDefault()}),o.jsxs("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 bg-gray-800/90 backdrop-blur-sm p-2 rounded-full flex items-center space-x-3 border border-gray-600 shadow-lg z-20",onMouseDown:j=>j.stopPropagation(),children:[o.jsx("button",{onClick:Y,className:"w-8 h-8 rounded-full bg-gray-700 hover:bg-gray-600 text-xs font-bold text-white flex items-center justify-center border border-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500",title:"Reset to 100% (Actual Size)",children:"1:1"}),o.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.01",value:N,onChange:j=>k(parseFloat(j.target.value)),className:"w-32 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),o.jsxs("span",{className:"text-xs font-mono text-gray-300 w-12 text-right",children:[Math.round(N*100),"%"]})]}),e.length>1&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:K,className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Previous image",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),o.jsx("button",{onClick:ae,className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Next image",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),o.jsxs("div",{className:"bg-gray-800 text-gray-400 text-xs px-3 py-1 border-t border-gray-700 flex justify-between items-center rounded-b-lg select-none",children:[o.jsx("div",{children:U.width>0&&o.jsxs("span",{children:[U.width," x ",U.height," px"]})}),s&&o.jsx("button",{onClick:j=>{j.stopPropagation(),s(D.src)},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors font-semibold",children:l("node.action.editor")}),o.jsx("div",{children:U.size&&o.jsx("span",{children:U.size})})]})]}):(r(),null)},OI=({children:e})=>{const[t,n]=x.useState("en"),r=x.useCallback((a,i)=>mw(t,a,i),[t]);return o.jsx(Mf.Provider,{value:{language:t,setLanguage:n,t:r},children:e})},FI=()=>{const e=Qo();if(!e)return null;const{tabs:t,activeTabIndex:n,switchTab:r,addTab:a,closeTab:i,renameTab:s,t:l,isSnapToGrid:c,setIsSnapToGrid:d,lineStyle:h,setLineStyle:g,viewTransform:m,fileInputRef:w,handleFileChange:y,catalogFileInputRef:b,handleCatalogFileChange:S,libraryFileInputRef:_,handleLibraryFileChange:v,isQuickSearchOpen:f,handleCloseAddNodeMenus:T,onAddNode:A,isQuickAddOpen:I,quickAddPosition:M,setActiveTool:N,isRadialMenuOpen:k,radialMenuPosition:E,openRadialMenu:P,isContextMenuOpen:L,contextMenuPosition:H,contextMenuSlots:$,setContextMenuSlot:U,openContextMenu:O,closeContextMenu:D,isContextMenuPinned:z,isCatalogOpen:G,onOpenCatalog:F,currentCatalogItems:K,catalogPath:ae,navigateCatalogBack:Y,navigateCatalogToFolder:ge,createCatalogItem:W,handleAddGroupFromCatalog:le,handleRenameCatalogItem:X,saveCatalogItemToDisk:Te,handleDeleteCatalogItem:pe,triggerLoadFromFile:ue,moveCatalogItem:Oe,currentLibraryItems:he,libraryItems:ye,libraryPath:j,navigateBack:q,navigateToFolder:Q,createLibraryItem:J,updateLibraryItem:oe,deleteLibraryItem:B,saveLibraryItemToDisk:fe,triggerLoadLibraryFromFile:ie,moveLibraryItem:Z,setPromptEditInfo:ee,renameInfo:R,confirmRename:be,setRenameInfo:Le,promptEditInfo:je,confirmPromptEdit:Ue,confirmInfo:Fe,setConfirmInfo:ot,error:at,handleCopyError:rt,isErrorCopied:Ce,setError:ve,showDialog:Ge,requestPermission:ce,declinePermission:He,effectiveTool:V,handleSaveCanvas:re,handleSaveProject:ze,handleLoadCanvas:ne,openQuickSearchMenu:xe,openQuickAddMenu:_e,handleClearCanvas:Ie,handleResetToDefault:me,clearCanvasData:Ee,clientPointerPosition:Ae,selectedNodeIds:Ke,deselectAllNodes:mt,toasts:Nt,removeToast:It,addToast:kt,activeCategory:xt,setActiveCategory:Dt,connectionMenu:Mt,setConnectionMenu:hn,handleAddNodeFromConnectionMenu:an,handleAddNodeFromToolbar:we,translateGraph:Ve,imageViewerState:qe,setImageViewer:it,onDownloadImage:lt,onCopyImageToClipboard:Lt}=e,[Nn,Ot]=x.useState(!1),[se,De]=x.useState(!1),[Re,Je]=x.useState(!1),[st,nt]=x.useState(!1),[St,Ft]=x.useState(()=>!!(localStorage.getItem("gemini-api-key")||localStorage.getItem("gemini-use-free-key")==="true")),[zt,de]=x.useState(()=>{const dt=localStorage.getItem("gemini-use-free-key")==="true",et=localStorage.getItem("gemini-api-key");return{hasApiKey:dt||!!et&&et.trim()!=="",useFreeKey:dt}}),[ke,Ne]=x.useState(null);x.useEffect(()=>{const dt=localStorage.getItem("gemini-api-key"),$t=localStorage.getItem("gemini-use-free-key")==="true";!dt&&!$t?(De(!0),Ft(!1)):zt.hasApiKey||Ot(!0)},[zt.hasApiKey]),x.useEffect(()=>{const dt=()=>{nt(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",dt),()=>{document.removeEventListener("fullscreenchange",dt)}},[]);const Qe=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(dt=>{console.error(`Error attempting to enable full-screen mode: ${dt.message} (${dt.name})`)})},ct=(dt,et)=>{const $t=dt.trim();localStorage.setItem("gemini-use-free-key",et?"true":"false"),et?localStorage.removeItem("gemini-api-key"):$t&&localStorage.setItem("gemini-api-key",$t);const sn=localStorage.getItem("gemini-api-key"),_t=localStorage.getItem("gemini-use-free-key")==="true";de({hasApiKey:_t||!!sn&&sn.length>0,useFreeKey:_t}),St||me(!0),Ot(!1),De(!1),Ft(!0),setTimeout(()=>{Ve()},50),kt(l("toast.apiKeySaved"),"success")},Gt=()=>{localStorage.removeItem("gemini-api-key"),localStorage.removeItem("gemini-use-free-key"),de({hasApiKey:!1,useFreeKey:!1}),kt(l("toast.apiKeyCleared"),"info")},Vt=x.useCallback(()=>{T(),Ne(null)},[T]),cn=x.useCallback(dt=>{Ne(null),P(dt)},[P]),Vn=x.useCallback(dt=>{const et={x:(H.x-m.translate.x)/m.scale,y:(H.y-m.translate.y)/m.scale};A(dt,et,void 0)},[H,m,A]),xn=x.useCallback(()=>{hn(null)},[hn]);x.useEffect(()=>{const dt=et=>{const $t=et.target,sn=$t.tagName==="INPUT"||$t.tagName==="TEXTAREA";if((et.ctrlKey||et.metaKey)&&!sn){if(et.code==="KeyS"){et.preventDefault(),re();return}if(et.code==="KeyO"){et.preventDefault(),ne();return}}if(et.code==="Space"&&!et.repeat&&!sn){et.ctrlKey?(et.preventDefault(),F()):I||(et.preventDefault(),_e(Ae));return}if(et.code==="KeyF"&&!et.shiftKey&&!et.ctrlKey&&!et.metaKey&&!et.altKey&&!sn){et.preventDefault(),f||xe(Ae);return}if(sn||et.repeat)return;let _t=null;if(et.shiftKey&&!et.ctrlKey&&!et.metaKey&&!et.altKey)switch(et.code){case"KeyC":_t=C.CHARACTER_GENERATOR;break;case"KeyS":_t=C.SCRIPT_GENERATOR;break;case"KeyD":_t=C.SCRIPT_ANALYZER;break;case"KeyF":_t=C.SCRIPT_PROMPT_MODIFIER;break;case"KeyR":_t=C.DATA_READER;break;case"KeyG":_t=C.NARRATOR_TEXT_GENERATOR;break;case"KeyN":_t=C.SPEECH_SYNTHESIZER;break;case"KeyB":_t=C.AUDIO_TRANSCRIBER;break;case"KeyT":_t=C.YOUTUBE_TITLE_GENERATOR;break;case"KeyY":_t=C.YOUTUBE_ANALYTICS;break;case"KeyM":_t=C.MUSIC_IDEA_GENERATOR;break}else if(!et.shiftKey&&!et.ctrlKey&&!et.metaKey&&!et.altKey)switch(et.code){case"KeyT":_t=C.TEXT_INPUT;break;case"KeyA":_t=C.PROMPT_ANALYZER;break;case"KeyP":_t=C.PROMPT_PROCESSOR;break;case"KeyM":_t=C.GEMINI_CHAT;break;case"KeyL":_t=C.TRANSLATOR;break;case"KeyN":_t=C.NOTE;break;case"KeyO":_t=C.IMAGE_GENERATOR;break;case"KeyI":_t=C.IMAGE_PREVIEW;break}if(_t){et.preventDefault();const Wa=Ci(_t,l).width,kr=40,Qr={x:(Ae.x-m.translate.x)/m.scale,y:(Ae.y-m.translate.y)/m.scale},Ya={x:Qr.x-Wa/2,y:Qr.y-kr/2};A(_t,Ya,void 0)}};return window.addEventListener("keydown",dt),()=>window.removeEventListener("keydown",dt)},[f,I,F,xe,_e,Ae,A,m.scale,m.translate.x,m.translate.y,l,re,ne]);const vn=x.useCallback(dt=>{const $t=Ci(dt,l).width,sn=40,_t={x:(M.x-m.translate.x)/m.scale,y:(M.y-m.translate.y)/m.scale},xo={x:_t.x-$t/2,y:_t.y-sn/2};A(dt,xo,void 0)},[M,m,A,l]),io=x.useCallback(dt=>{const $t=Ci(dt,l).width,sn=40,_t={x:(E.x-m.translate.x)/m.scale,y:(E.y-m.translate.y)/m.scale},xo={x:_t.x-$t/2,y:_t.y-sn/2};A(dt,xo,void 0)},[E,m,A,l]);x.useEffect(()=>{const dt=$t=>{const sn=$t.target;sn.tagName==="INPUT"||sn.tagName==="TEXTAREA"||$t.key==="Tab"&&($t.preventDefault(),k||cn(Ae))},et=$t=>{$t.key==="Tab"&&k&&($t.preventDefault(),ke&&io(ke),Vt())};return window.addEventListener("keydown",dt),window.addEventListener("keyup",et),()=>{window.removeEventListener("keydown",dt),window.removeEventListener("keyup",et)}},[k,ke,cn,Vt,io,Ae]);const Do=dt=>{const et=ye.find($t=>$t.id===dt);et&&ee(et)},Nr=()=>{if(!R)return"";switch(R.type){case"group":return l("dialog.rename.group.title");case"catalog":return l("dialog.rename.catalog.title");case"node":return l("dialog.rename.title");default:return l("dialog.rename.title")}},er=()=>{const dt=t[n];!dt||dt.nodes.length===0?De(!0):ot({title:l("dialog.exit.title"),message:l("dialog.exit.message"),onConfirm:()=>{Ee(),De(!0),Ft(!1)}})},Va=(dt,et,$t)=>{const sn=`Image_${et}_${$t.slice(0,10).replace(/\s+/g,"_")}.png`;lt(dt.startsWith("data:")?dt.split(",")[1]:dt,sn)},$a=async dt=>{const et=dt.startsWith("data:")?dt.split(",")[1]:dt;await Lt(et),kt(l("toast.copied"),"success")};return o.jsx("div",{className:"w-screen h-screen overflow-hidden bg-gray-900 flex flex-col",children:o.jsxs(sI,{children:[o.jsx(TI,{}),o.jsxs("div",{className:"absolute bottom-2 right-2 z-50 text-[10px] text-gray-600 pointer-events-none flex flex-col items-end select-none",children:[o.jsx("span",{children:"Author: MeowMaster"}),o.jsx("span",{children:"Email: MeowMasterart@gmail.com"}),o.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"pointer-events-auto hover:text-emerald-400 transition-colors mt-1",children:"Powered by Netlify"})]}),o.jsx(SI,{toasts:Nt,removeToast:It}),o.jsx(bI,{isOpen:Ge,onAllow:ce,onDecline:He}),o.jsx(NI,{isOpen:se,onSave:ct,isFirstRun:!St}),o.jsx(EI,{isOpen:Nn,onSave:ct,onClose:()=>Ot(!1),onClear:Gt,hasExistingKey:zt.hasApiKey,initialUseFreeKey:zt.useFreeKey}),qe&&o.jsx(DI,{sources:qe.sources,initialIndex:qe.initialIndex,initialPosition:{x:window.innerWidth/2-400,y:window.innerHeight/2-300},onClose:()=>it(null),onDownloadImageFromUrl:Va,onCopyImageToClipboard:$a}),o.jsx("input",{type:"file",ref:w,onChange:y,accept:".json,application/json",className:"hidden"}),o.jsx("input",{type:"file",ref:b,onChange:S,accept:".json,application/json",className:"hidden"}),o.jsx("input",{type:"file",ref:_,onChange:v,accept:".json,application/json",className:"hidden"}),o.jsx(dI,{isOpen:f,onClose:Vt,onAddNode:vn}),o.jsx(pI,{isOpen:I,position:M,onClose:Vt,onAddNode:vn,onToolChange:N}),o.jsx(mI,{isOpen:k,position:E,onClose:Vt,onAddNode:io,onSelectItem:Ne}),o.jsx(RI,{isOpen:L,position:H,onClose:D,onAddNode:Vn,slots:$,onAssignSlot:U,activeTool:V,onToolChange:N}),o.jsx(MI,{isOpen:!!(Mt!=null&&Mt.isOpen),position:(Mt==null?void 0:Mt.position)||{x:0,y:0},fromType:(Mt==null?void 0:Mt.fromType)||null,onClose:xn,onSelect:an}),o.jsx(xI,{isOpen:G,onClose:F,currentCatalogItems:K,catalogPath:ae,onCatalogNavigateBack:Y,onCatalogNavigateToFolder:ge,onCreateCatalogFolder:()=>W(Ze.FOLDER),onAddGroupFromCatalog:le,onRenameCatalogItem:X,onSaveCatalogItem:Te,onDeleteCatalogItem:pe,onLoadCatalogItemFromFile:ue,onMoveCatalogItem:Oe,libraryItems:he,libraryPath:j,onNavigateBack:q,onNavigateToFolder:Q,onCreateLibraryItem:J,onEditLibraryItem:Do,onRenameLibraryItem:(dt,et)=>Le({type:"library",id:dt,currentTitle:et}),onDeleteLibraryItem:B,onSaveLibraryItem:fe,onLoadLibraryItemFromFile:ie,onMoveLibraryItem:Z,activeCategory:xt,setActiveCategory:Dt}),o.jsx(gI,{isOpen:!!R,initialValue:(R==null?void 0:R.currentTitle)||"",onConfirm:be,onClose:()=>Le(null),title:Nr(),label:l("dialog.rename.label"),confirmButtonText:l("dialog.rename.confirm"),cancelButtonText:l("dialog.rename.cancel"),deselectAllNodes:mt}),o.jsx(CI,{isOpen:!!je,initialName:(je==null?void 0:je.name)||"",initialContent:(je==null?void 0:je.content)||"",onConfirm:Ue,onClose:()=>ee(null),deselectAllNodes:mt}),o.jsx(wI,{isOpen:!!Fe,onClose:()=>ot(null),onConfirm:()=>{Fe==null||Fe.onConfirm(),ot(null)},title:(Fe==null?void 0:Fe.title)||"",message:(Fe==null?void 0:Fe.message)||""}),at&&o.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-30 bg-blue-900/95 p-4 rounded-lg border border-blue-500 flex items-start space-x-4 max-w-md shadow-xl backdrop-blur-md",children:[o.jsxs("div",{className:"flex-grow text-blue-100",children:[o.jsx("p",{className:"font-bold text-blue-50 mb-1",children:l("app.error.title")}),o.jsx("p",{className:"text-sm text-blue-100",children:l(at)})]}),o.jsxs("div",{className:"flex flex-col space-y-1 flex-shrink-0",children:[o.jsx("button",{onClick:()=>ve(null),className:"p-1 text-blue-300 rounded-full hover:bg-blue-700/50 hover:text-white transition-colors","aria-label":l("node.action.close"),title:l("node.action.close"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),o.jsx("button",{onClick:rt,className:"p-1 text-blue-300 rounded-full hover:bg-blue-700/50 hover:text-white transition-colors","aria-label":l("app.error.copy"),title:l(Ce?"app.error.copied":"app.error.copy"),children:Ce?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),o.jsx(cI,{activeTool:V,onToolChange:N,onAddNode:we,onSaveCanvas:re,onSaveProject:ze,onLoadCanvas:ne,onOpenSearch:()=>xe(Ae),onOpenCatalog:F,viewTransform:m,setZoom:e.setZoom,isSnapToGrid:c,setIsSnapToGrid:d,lineStyle:h,setLineStyle:g,handleClearCanvas:Ie}),o.jsx("div",{className:"absolute top-2 left-2 z-20 flex items-center",children:o.jsxs("div",{className:`flex items-center p-1 ${Re?"gap-0":"gap-1"} rounded-lg border border-gray-700 shadow-lg bg-gray-900/50 backdrop-blur-md`,children:[o.jsx(ht,{title:l(Re?"toolbar.expand":"toolbar.collapse"),position:"right",children:o.jsx("button",{onClick:()=>Je(!Re),className:"h-9 w-9 flex-shrink-0 flex items-center justify-center rounded-md hover:bg-emerald-600 bg-gray-700 text-gray-300 hover:text-white transition-colors",children:Re?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M5 3l14 9-14 9V3z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19 3l-14 9 14 9V3z"})})})}),!Re&&o.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[o.jsx(ht,{title:l("toolbar.home"),position:"bottom",children:o.jsx("button",{onClick:()=>De(!0),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})})}),o.jsx(_I,{}),o.jsx(ht,{title:l("dialog.apiKey.title"),position:"bottom",children:o.jsx("button",{onClick:()=>Ot(!0),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),o.jsx(ht,{title:l("toolbar.resetToDefault"),position:"bottom",children:o.jsx("button",{onClick:()=>me(!1),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})}),o.jsx(ht,{title:l(st?"toolbar.exitFullscreen":"toolbar.enterFullscreen"),position:"bottom",children:o.jsx("button",{onClick:Qe,className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:st?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})})})}),o.jsx(vI,{}),o.jsxs("div",{className:"flex items-center h-9 gap-1",children:[o.jsx(II,{tabs:t,activeTabIndex:n,onTabClick:r,onCloseTab:i,onRenameTab:s}),o.jsx(ht,{title:"Add new tab",position:"bottom",className:"h-full",children:o.jsx("button",{onClick:a,className:"flex items-center justify-center h-full w-9 text-gray-300 hover:bg-emerald-600 bg-gray-700 rounded-md transition-colors hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})})]}),o.jsxs("div",{className:"flex items-center justify-start pl-3 pr-2 h-full",children:[o.jsx("div",{className:"mr-3 text-emerald-400",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),o.jsx("path",{d:"m15 5 4 4"})]})}),o.jsx("div",{className:"text-left",children:o.jsx("h1",{className:"text-lg font-bold text-emerald-400 select-none leading-tight",children:l("app.title")})})]}),o.jsx(kI,{}),o.jsx(ht,{title:l("toolbar.closeProject"),position:"bottom",children:o.jsx("button",{onClick:er,className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})})})})]})]})})]})})},zI=()=>o.jsx(OI,{children:o.jsx(wA,{children:o.jsx(FI,{})})}),Ay=document.getElementById("root");if(!Ay)throw new Error("Could not find root element to mount to");const GI=Rc.createRoot(Ay);GI.render(o.jsx(bt.StrictMode,{children:o.jsx(zI,{})}));
